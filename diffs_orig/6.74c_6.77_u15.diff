--- 74c.j	2012-12-29 18:24:59.000000000 +0100
+++ 77.j	2012-12-29 18:25:36.000000000 +0100
@@ -801,30 +801,31 @@
 trigger gg_trg_OM=null
 trigger gg_trg_NB=null
 trigger gg_trg_UB=null
 trigger gg_trg_NM=null
 trigger gg_trg_NT=null
 trigger gg_trg_NS=null
 trigger gg_trg_NR=null
 trigger gg_trg_SO=null
 trigger gg_trg_PM=null
 trigger gg_trg_OI=null
 trigger gg_trg_MI=null
 trigger gg_trg_FR=null
 trigger gg_trg_ER=null
 trigger gg_trg_ZM=null
 trigger gg_trg_CP=null
+trigger gg_trg_TT=null
 trigger gg_trg_timer1=null
 trigger gg_trg_timer2=null
 trigger gg_trg_timer3=null
 trigger gg_trg_timer4=null
 trigger gg_trg_timer5=null
 trigger gg_trg_timer7=null
 trigger gg_trg_timer8=null
 trigger gg_trg_timer9=null
 trigger gg_trg_timer10=null
 trigger gg_trg_timer11=null
 trigger gg_trg_Sec15=null
 trigger gg_trg_Sec65=null
 trigger gg_trg_Sec90=null
 trigger gg_trg_Sec120=null
 trigger gg_trg_Runes=null
@@ -2082,44 +2083,47 @@
 constant real Assist_Damage_MaxDuration=15
 player array AssistPlayers
 unit array CustomHeroRevive_Hero
 real array CustomHeroRevive_Time
 boolean array CustomHeroRevive_QuickRevive
 integer CustomHeroRevive_MaxIndex=0
 unit array BUFFERCustomHeroRevive_Hero
 real array BUFFERCustomHeroRevive_Time
 boolean array BUFFERCustomHeroRevive_QuickRevive
 integer BUFFERCustomHeroRevive_MaxIndex=0
 unit bloodstone_tempdeadhero
 unit staffofhealing_tempdeadhero
 unit ancientjangoo_tempdeadhero
 integer staffofhealing_count
 integer ancientjangoo_count
+integer array udg_Deathsinarow
 constant integer SOUND_DOUBLEKILL=1
 constant integer SOUND_TRIPLEKILL=2
 constant integer SOUND_ULTRAKILL=3
 constant integer SOUND_RAMPAGE=4
 constant integer SOUND_OWNAGE=3
 integer bonusgoldxp_gold
 integer bonusgoldxp_xp
 integer array Bonus_XP
 integer array Bonus_Gold
 integer Bonus_Count_XP
 integer Bonus_Count_Gold
 unit aegisholder=null
 boolean AegisMSG_Disabled=true
 integer roshan_upgradelevel=1
+integer roshan_respawn=600
+integer aegis_reclaim=360
 trigger t_UpgradeRoshan
 integer RoshanUpgrade=0
 leaderboard array courierdeath_lb
 boolean array courierdeath_active
 integer array Item_Dummy
 integer array Item_Real
 integer array Item_Unit
 integer array Item_Mute
 string array Item_Icon
 integer array Item_Cooldown
 integer array Item_RealIndexId
 integer Item_Max=0
 integer indexid_orbofvenom
 integer indexid_orbofvenomranged
 integer indexid_bootsofspeed
@@ -2235,30 +2239,31 @@
 integer indexid_helmofthedominatorcourier
 integer indexid_maskofmadness
 integer indexid_eulsscepterofdivinity
 integer indexid_soulbooster
 integer indexid_mekansm
 integer indexid_sangeandyasha
 integer indexid_stygiandesolator
 integer indexid_battlefury
 integer indexid_crystalys
 integer indexid_blackkingbar10
 integer indexid_blackkingbar09
 integer indexid_blackkingbar08
 integer indexid_blackkingbar07
 integer indexid_blackkingbar06
 integer indexid_blackkingbar05
+integer indexid_blackkingbar04
 integer indexid_aegis
 integer indexid_mantastyle
 integer indexid_mantastyleranged
 integer indexid_lotharsedge
 integer indexid_dagonlevel1
 integer indexid_dagonlevel2
 integer indexid_dagonlevel3
 integer indexid_dagonlevel4
 integer indexid_dagonlevel5
 integer indexid_necronomiconlevel1
 integer indexid_necronomiconlevel2
 integer indexid_necronomiconlevel3
 integer indexid_linkenssphere
 integer indexid_linkensspherecd
 integer indexid_divinerapier
@@ -2296,30 +2301,31 @@
 integer indexid_magicwand
 integer indexid_forcestaff
 integer indexid_pipeofinsight
 integer indexid_poormanshield
 integer indexid_poormanshieldranged
 integer indexid_ghostscepter
 integer indexid_staffofhealing
 integer indexid_staffofhealingempty
 integer indexid_soulring
 integer indexid_arcaneboots
 integer indexid_phoenixblade
 integer indexid_medallionofcourage
 integer indexid_veilofdiscord
 integer indexid_prudence
 integer indexid_annihilator
+integer indexid_shadowamulet
 integer indexid_recipe_headdressofrejuvenation
 integer indexid_recipe_nathrezimbuckler
 integer indexid_recipe_bootsoftravel
 integer indexid_recipe_powertreads
 integer indexid_recipe_handofmidas
 integer indexid_recipe_bracer
 integer indexid_recipe_wraithband
 integer indexid_recipe_nulltalisman
 integer indexid_recipe_yasha
 integer indexid_recipe_sange
 integer indexid_recipe_craniumbasher
 integer indexid_recipe_blademail
 integer indexid_recipe_maelstrom
 integer indexid_recipe_diffusalblade
 integer indexid_recipe_maskofmadness
@@ -2350,30 +2356,31 @@
 integer indexid_recipe_magicwand
 integer indexid_recipe_forcestaff
 integer indexid_recipe_pipeofinsight
 integer indexid_recipe_aghanimsscepter
 integer indexid_recipe_mjollnir
 integer indexid_recipe_staffofhealing
 integer indexid_recipe_soulring
 integer indexid_recipe_etherealblade
 integer indexid_recipe_ancientjangoo
 integer indexid_recipe_medallionofcourage
 integer indexid_recipe_veilofdiscord
 integer indexid_recipe_orchidmalevolence
 integer indexid_recipe_bladeofthereaper
 integer indexid_recipe_ironboots
 integer indexid_recipe_prudence
+integer indexid_recipe_cripplingstaff
 constant integer powerup_haste=1227894838
 constant integer powerup_regeneration=1227894840
 constant integer powerup_invisibility=1227894858
 constant integer powerup_doubledamage=1227894859
 constant integer powerup_illusion=1227894839
 trigger t_spawnpowerup
 integer powerup_previous=-1
 integer array Recipe_Component_1
 integer array Recipe_Component_2
 integer array Recipe_Component_3
 integer array Recipe_Component_4
 integer array Recipe_Component_5
 integer array Recipe_Component_6
 integer array Recipe_Component_7
 integer array Recipe_Result
@@ -2553,31 +2560,32 @@
 integer array HasItem_Heart
 integer array HasItem_IronBoots
 constant real sangeandyasha_proc_chance=15
 constant real sangeandyasha_duration=4
 constant integer sangeandyasha_slow=1093809717
 constant integer sangeandyasha_buffid=1110456398
 constant integer sangeandyasha_fx=1093809731
 constant real sange_proc_chance=15
 constant real sange_duration=4
 constant integer sange_slow=1093809718
 constant integer sange_buffid=1110454857
 constant integer sange_fx=1093809731
 constant integer abilityid_craniumbasher=1093744436
 constant integer itemid_euls=1919248946
 constant integer abilityid_eulsmovement=1093686832
-constant real armlet_drain=37
+constant integer armlet_hpregen=1093685333
+constant real armlet_drain=40
 constant integer powerup_linkensphere=1227901005
 constant integer buffid_linkensphere=1110458953
 constant integer abilityid_linkenpshere=1093746994
 constant integer abilityid_emptybottle=1093683254
 constant integer abilityid_summoncourier=1093681718
 constant integer abilityid_summoncrow=1093683796
 constant integer unitid_goodcourier0=1697657160
 constant integer unitid_goodcourier1=1848651849
 constant integer unitid_goodcourier2=1848652338
 constant integer unitid_goodcourier3=1848652337
 constant integer unitid_goodcourier4=1848658777
 constant integer unitid_goodcourier5=1848658778
 constant integer unitid_badcourier0=1697657178
 constant integer unitid_badcourier1=1848652339
 constant integer unitid_badcourier2=1848652340
@@ -2634,45 +2642,48 @@
 real array TPMemory_Y
 real array TPMemory_Time
 integer TPMemory_Index=-1
 constant real tpmemory_duration=25
 constant real tpsroll_maxrange=525
 region tpmemory_r
 constant integer abilityid_necronomicon1=1093683266
 constant integer abilityid_necronomicon2=1093682227
 constant integer abilityid_necronomicon3=1093682246
 constant integer unitid_necrounit1=1848651848
 constant integer unitid_necrounit2=1848651847
 constant integer unitid_necrounit3=1848651851
 constant integer unitid_necrounit4=1848651850
 constant integer unitid_necrounit5=1848651841
 constant integer unitid_necrounit6=1848651830
+integer necromarker_id
 constant integer abilityid_satanic=1093748304
 constant integer abilityid_satanicbonus=1093747534
 constant integer abilityid_helmofthedominator=1094935400
 integer abilityid_bkbitem10=1093742918
 integer abilityid_bkbitem09=1093742917
 integer abilityid_bkbitem08=1093686067
 integer abilityid_bkbitem07=1093742916
 integer abilityid_bkbitem06=1093742919
 integer abilityid_bkbitem05=1093742920
+integer abilityid_bkbitem04=1093815369
 integer abilityid_bkbavatar10=1093742914
 integer abilityid_bkbavatar09=1093742913
 integer abilityid_bkbavatar08=1093686066
 integer abilityid_bkbavatar07=1093742905
 integer abilityid_bkbavatar06=1093742915
 integer abilityid_bkbavatar05=1093742904
+integer abilityid_bkbavatar04=1093815368
 integer abilityid_bkbimmunity=1093682777
 constant integer abilityid_mekansm=1093681995
 constant integer abilityid_pipeofinsight=1093748055
 constant integer MSG_PipeOfInsight_STACK=1848652365
 constant integer pipeofinsight_barrier=1093748054
 unit pipeofinsight_caster
 constant integer abilityid_refresherorb=1093677655
 constant integer abilityid_orchid=1093682756
 constant integer abilityid_orchidbuff=1110455089
 constant integer abilityid_mjollnir=1093683788
 constant integer abilityid_mjollnirlightning=1093684022
 unit mjollnir_target
 unit mjollnir_source
 constant integer abilityid_crowmana=1093686866
 constant integer abilityid_crowmanaupgrade=1093686869
@@ -2681,30 +2692,31 @@
 constant integer unitid_shivasguard=1747988546
 group shivasguard_group
 unit shivasguard_unit
 unit shivasguard_nuker
 integer shivasguard_count
 constant integer abilityid_magicstick=1093683801
 player fortify_player
 constant integer abilityid_fortify1=1093743665
 constant integer abilityid_fortify2=1093752649
 constant integer abilityif_fortify_sent=1093743694
 constant integer abilityif_fortify_scourge=1093743693
 constant integer abilityid_fortify_armor=1093744466
 constant integer abilityid_fortify_magic=1093809222
 boolean fortify_sent_disabled=false
 boolean fortify_scourge_disabled=false
+constant real fortify_duration=5
 constant integer abilityid_phaseboots=1093743191
 constant integer abilityid_blademail=1093743959
 boolean blademail_flag=false
 constant integer abilityid_forcestaff=1093744973
 constant integer abilityid_ghostpotion=1093747011
 constant integer abilityid_etherblast=1093751108
 constant integer etherblast_ms=1093751107
 constant integer buffid_etherblastms=1110459225
 real etherblast_damage
 constant integer abilityid_soulring=1093751096
 constant string soulring_fx="Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl"
 constant integer abilityid_treechop=1093748292
 constant integer abilityid_returnhome=1093747027
 constant integer abilityid_findsecretshop=1093815123
 constant integer abilityid_mantastyle=1093681720
@@ -2726,30 +2738,34 @@
 constant integer smokeofdeceit_phasebuff=1110456665
 unit smokeofdeceit_caster
 player smokeofdeceit_player
 constant integer abilityid_veilofdiscord=1093810244
 constant integer veilofdiscord=1093810246
 constant integer veilofdiscord_buffid=1110459729
 constant real veilofdiscord_duration=20
 constant string veilofdiscord_fx="war3mapImported\\DarkLightningNova.mdx"
 constant integer abilityid_cripplingstaff=1093813569
 constant integer cripplingstaff_miss=1093814861
 constant integer cripplingstaff_miss_buffid=1110459989
 constant integer cripplingstaff_slow=1093813571
 constant integer cripplingstaff_slow_buffid=1110459957
 constant real cripplingstaff_duration=4
 constant integer abilityid_tranquilboots=1093815089
+constant integer shadowamulet_buffid1=1110460214
+constant integer shadowamulet_buffid2=1110460216
+constant real shadowamulet_fadetime=2.6
+constant string shadowamulet_castfx="Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl"
 constant integer abilityid_corruptor=1093753420
 constant integer abilityid_corruptor_ranged=1093753421
 constant integer unitid_corruptor=1848659021
 constant integer unitid_corruptor_ranged=1848659022
 constant integer abilityid_medallion_of_courage=1093753417
 constant integer medallion_armor=1093753418
 constant string medallion_fx="Abilities\\Spells\\Undead\\Cripple\\CrippleTarget.mdl"
 boolean aegis_meepo=false
 constant integer abilityid_armletofmordiggianoff=1093686327
 constant integer abilityid_armletofmordiggianon=1093686328
 boolean throne_damage_10=false
 boolean throne_damage_25=false
 boolean throne_damage_50=false
 boolean throne_damage_75=false
 boolean tree_damage_10=false
@@ -2897,33 +2913,33 @@
 integer ModeCM_Current
 integer array ModeCM_Bans1
 integer array ModeCM_Bans2
 integer ModeCM_BanCount1=0
 integer ModeCM_BanCount2=0
 integer array ModeCM_Picks1
 integer array ModeCM_Picks2
 integer ModeCM_PickCount1=0
 integer ModeCM_PickCount2=0
 integer ModeCM_PickPhase=0
 constant integer ModeCM_Ban1Duration=40
 constant integer ModeCM_Pick1Duration=50
 constant integer ModeCM_Ban2Duration=50
 constant integer ModeCM_Pick2Duration=50
 constant integer ModeCM_BankDuration=90
-constant integer ModeCM_Ban1Max=3
+constant integer ModeCM_Ban1Max=2
 constant integer ModeCM_Pick1Max=3
-constant integer ModeCM_Ban2Max=2
+constant integer ModeCM_Ban2Max=3
 constant integer ModeCM_Pick2Max=2
 constant string ModeCM_Color1="|c006699CC"
 constant string ModeCM_Color2="|c00ff0303"
 constant string ModeCM_Color3="|c00555555"
 multiboard CMBoard
 image CM_Image1
 image CM_Image2
 image CM_Image3
 image CM_Image4
 image CM_Image5
 image CM_Image6
 image CM_Image7
 image CM_Image8
 unit array RD_VisionUnits
 integer array RD_HeroPool
@@ -2947,31 +2963,31 @@
 constant real RD_HeroSpace=75
 constant real RD_HeroDistance=125
 player RD_CurrentPlayer1=null
 player RD_CurrentPlayer2=null
 integer RD_StartingTeam
 boolean udg_ModeRD=false
 boolean udg_RDSpawn=false
 boolean array RD_HasHero
 real RD_TextX_Sent
 real RD_TextY_Sent
 real RD_TextX_Scourge
 real RD_TextY_Scourge
 constant integer RD_Shadow=1747990089
 unit array RD_ShadowUnits
 integer ShadowUnitsMax=0
-constant integer RD_COUNT=20
+constant integer RD_COUNT=22
 trigger RD_Sell
 unit array ModeRD_Selectors1
 unit array ModeRD_Selectors2
 boolean ModeRD_Cap=false
 trigger CD_Trigger_Sell
 integer array CD_HeroPool
 unit array CD_VisionUnits
 unit array CD_HeroDummies
 integer CD_ShadowUnitsMax=0
 unit array CD_ShadowUnits
 integer CD_StartingTeam
 integer CD_CurrentTurn
 integer array CD_TimePool
 player CD_CurrentPlayer
 integer CD_Phase
@@ -3115,30 +3131,40 @@
 real CP3_Sentinel_Timer
 image CP1_Scourge_Text_a
 image CP1_Scourge_Text_b
 image CP2_Scourge_Text_a
 image CP2_Scourge_Text_b
 image CP3_Scourge_Text_a
 image CP3_Scourge_Text_b
 image CP1_Sentinel_Text_a
 image CP1_Sentinel_Text_b
 image CP2_Sentinel_Text_a
 image CP2_Sentinel_Text_b
 image CP3_Sentinel_Text_a
 image CP3_Sentinel_Text_b
 image array CP_Image_a
 image array CP_Image_b
+boolean udg_ModeTT=false
+real array TT_LastTag
+unit array TT_HeroA
+unit array TT_HeroB
+integer array TT_PreviousGold
+integer array TT_GoldBank
+trigger tt_t_tracker=CreateTrigger()
+boolean array TT_DisableTracker
+constant integer tt_tagcooldown=180
+player tt_itemplayer
 constant integer abilityid_torrent=1093743414
 constant integer torrent_toss=1093743447
 constant integer torrent_slow=1093742924
 constant integer abilityid_watersword=1093743444
 constant integer watersword_damage=1093742927
 constant integer watersword_fx=1093742930
 constant integer watersword_cleave1=1093743671
 constant integer watersword_cleave2=1093743672
 constant integer watersword_cleave3=1093742933
 constant integer watersword_cleave4=1093743673
 constant integer abilityid_xmarksthespot=1093742926
 constant integer abilityid_xmarksthespot_helper=1093743428
 constant integer abilityid_ghostship=1093742923
 constant integer unitid_ghostship=1747990101
 constant integer unitid_ghostship_alt=1747993674
@@ -3184,33 +3210,45 @@
 constant integer buffid_track=1110454348
 constant integer abilityid_track_ms=1093742901
 integer bounty_totalgold=0
 constant integer abilityid_jinada=1093749073
 constant integer jinada_damage=1093749074
 constant integer jinada_fx=1093749075
 constant integer jinada_cleave1=1093749300
 constant integer jinada_cleave2=1093749299
 constant integer jinada_cleave3=1093749301
 constant integer jinada_cleave4=1093749077
 constant integer jinada_critical=1093751124
 constant integer jinada_maim=1093749079
 constant integer abilityid_windwalk=1093678913
 constant integer buffid_windwalk=1110455864
 integer quillcache
-constant integer abilityid_doubleedge=1093677132
+constant integer abilityid_doubleedge=1093816142
 constant string doubleedge_fx_cast="war3mapImported\\DoubleEdgeCaster.mdx"
 constant string doubleedge_fx_impact="war3mapImported\\DoubleEdgeTarget.mdx"
+unit doubleedge_source
+real doubleedge_damage
+constant integer abilityid_stampede=1093816118
+constant integer stampede_haste=1093816116
+constant integer stampede_haste_buffid=1110460226
+unit stampede_source
+unit stampede_daamgesource
+integer stampede_level
+constant real stampede_duration=3.75
+constant integer stampede_slow=1093816139
+constant integer buffid_stampede=1110460230
+constant integer abilityid_testoffath_allied=1093815619
 constant integer abilityid_penitence=1093684045
 constant integer label_dispelable=1093743175
 constant integer abilityid_holypersuasion=1093810260
 constant integer abilityid_holypersuasion_helper=1093678649
 constant integer abilityid_rocketflare=1093687862
 constant string fx_rocketflare="Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl"
 constant string fx_rocketflare_vision="Abilities\\Spells\\Human\\Flare\\FlareCaster.mdl"
 constant integer unitid_rocketflare=1747989337
 real rocketflare_damage
 unit rocketflare_source
 integer powercogscache
 constant integer abilityid_powercog=1093687861
 constant integer unitid_powercog=1966092371
 constant integer unitid_powercogeffect=1966092375
 constant integer abilityid_hookshot=1093687864
@@ -3218,30 +3256,31 @@
 constant integer abilityid_hookshotstun=1093687865
 constant integer unitid_hookshot=1966092374
 constant integer unitid_hookshothead=1966092373
 constant integer abilityid_batteryassault=1093687860
 constant integer abilityid_batteryassaultstun=1093687863
 constant string fx_batteryassault="Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl"
 constant integer unitid_batteryassault=1747988570
 constant integer abilityid_freezingfieldcast=1093677912
 constant integer abilityid_freezingfield=1093677906
 constant integer abilityid_freezingfieldupgrade=1093681494
 constant integer abilityid_freezingfield_slow=1093742676
 unit freezingfield_source
 integer freezingfield_damage
 constant integer abilityid_crystalnova=1093748025
 constant integer crystalnova_nuke=1093677380
+constant integer abilityid_brillianceaura=1095262562
 constant integer abilityid_staticremnant=1093743696
 constant integer unitid_staticremnant=1747990342
 unit staticremnant_source
 real staticremnant_damage
 constant integer abilityid_overload=1093685591
 constant integer abilityid_overloadslow=1093686069
 unit overload_source
 real overload_damage
 constant integer abilityid_electricvortex=1093743698
 constant integer electricvortex_shackle=1093743697
 constant integer unitid_electricvortex=1966092376
 constant integer electricvortex_slow=1093743699
 constant integer abilityid_balllightning=1093743695
 integer balllightning_cache
 integer balllightning_level
@@ -3312,30 +3351,36 @@
 constant integer buffid_burningspear=1110456369
 constant integer abilityid_berserkersblood=1093685585
 constant integer abilityid_berserkersblooddmg=1093685842
 constant integer abilityid_berserkersbloodias=1093685843
 constant integer abilityid_macropyre=1093685045
 constant integer abilityid_macropyreeffect=1093685061
 constant integer abilityid_macropyreupgrade=1093747249
 constant integer abilityid_macropyreeffectupgrade=1093747250
 unit array macropyre_caster
 constant integer abilityid_liquidfire=1093685048
 constant integer liquidfire_fx=1093748291
 constant string liquidfire_fx_target="Abilities\\Spells\\Other\\BreathOfFire\\BreathOfFireDamage.mdl"
 constant string liquidfire_fx_cast="Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl"
 unit liquidfire_source
 integer liquidfire_level
+constant integer abilityid_icepath=1093685046
+constant integer icepath_stun=1093685062
+group icepath_alreadyhit
+unit icepath_source
+real icepath_stunduration
+integer icepath_level
 constant integer abilityid_dualbreath=1093685047
 constant integer abilityid_dualbreathfrost=1093685058
 constant integer abilityid_dualbreathfire=1093685059
 constant integer abilityid_dualbreathfrosteffect=1093685057
 constant integer abilityid_omnislash=1093684529
 constant integer abilityid_omnislashupgrade=1093747032
 constant integer abilityid_bladefury=1093678407
 unit bladefury_source
 integer bladefury_level
 constant integer abilityid_tpally1=1093742677
 constant integer abilityid_tpally2=1093742937
 constant integer abilityid_tpally3=1093742938
 constant integer abilityid_tpally4=1093750321
 unit recall_target
 real recall_distance
@@ -3472,52 +3517,58 @@
 constant integer abilityid_sentinel=1093748535
 constant integer abilityid_sentinel_helper=1093751126
 constant integer unitid_sentinel_defend=1747993172
 constant integer unitid_sentinel_attack=1747993173
 constant integer abilityid_sentinel_slow_1=1093809232
 constant integer abilityid_sentinel_slow_2=1093809232
 constant integer abilityid_sentinel_slow_3=1093809232
 constant integer abilityid_sentinel_slow_4=1093809232
 constant integer abilityid_sentinel_slow_buffid=1110459719
 constant string sentinel_fx="Abilities\\Spells\\Other\\AcidBomb\\BottleImpact.mdl"
 unit sentinel_closest
 unit sentinel_hero
 real sentinel_x
 real sentinel_y
 real sentinel_d
-constant integer abilityid_livingarmor=1093809231
-constant integer abilityid_livingarmor_aura_hp=1093809229
-constant integer abilityid_livingarmor_aura_hp_structure=1093809459
-constant integer abilityid_livingarmor_aura_hp_global=1093810224
-constant integer abilityid_livingarmor_aura_hp_structure_global=1093810225
-constant integer abilityid_livingarmor_aura_armor=1093809230
-constant integer abilityid_livingarmor_aura_armor_structure=1093809460
-constant integer abilityid_livingarmor_aura_armor_global=1093810009
-constant integer abilityid_livingarmor_aura_armor_structure_global=1093810010
-constant integer abilityid_livingarmor_fx=1093810483
+constant integer abilityid_livingarmor=1093815628
+constant integer livingarmor_damageblock_1=1093815640
+constant integer livingarmor_damageblock_2=1093815641
+constant integer livingarmor_damageblock_3=1093815639
+constant integer livingarmor_damageblock_4=1093815638
+constant integer livingarmor_buffid=1110460213
+unit livingarmor_target
+real livingarmor_distance
+real livingarmor_x
+real livingarmor_y
+unit livingarmor_source
 constant integer abilityid_leechseed=1093809742
 constant string leechseed_fx="war3mapImported\\LeechSeed.MDX"
 constant string leechseed_pulse="Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl"
 constant integer unitid_leechseed=1747993656
 constant integer unitid_leechseed_projectile=1747993657
 constant integer leechseed_slow=1093809971
 constant integer leechseed_slow_buffid=1110459724
 unit leechseed_source
 unit leechseed_target
 real leechseed_amount
-constant integer abilityid_lastword=1093684547
+constant integer abilityid_lastword=1093815892
 integer array LastWord_Stolen
+constant integer lastword_visual=1093815893
+constant integer lastword_visual_buffid=1110455638
+constant string lastword_fx="war3mapImported\\LastWordDebuff_6.mdx"
+constant string lastword_fx_end_natural="war3mapImported\\LastWordDamageDuration.mdx"
+constant string lastword_fx_end_forced="war3mapImported\\LastWordDamageSpell.mdx"
 constant integer abilityid_glaivesofwisdom=1093684314
 constant integer buffid_glaivesofwisdom=1110455640
 constant integer abilityid_curseofthesilent=1093743692
 unit curseofthesilent_source
 constant integer curseofthesilent_icon=1093750867
 constant integer curseofthesilent_icon_buff=1110459217
 constant integer abilityid_shrapnel=1093678644
 constant integer shrapnel_slow=1093744966
 constant string fx_shrapnel="Abilities\\Weapons\\FlyingMachine\\FlyingMachineImpact.mdl"
 constant integer unitid_shrapnel_fx=1747990593
 unit shrapnel_source
 unit shrapnel_caster
 real shrapnel_damage
 constant integer abilityid_assassinate=1093678160
 constant integer abilityid_assassinateupgrade=1093747029
@@ -3530,30 +3581,31 @@
 constant integer abilityid_backstab=1093682266
 constant integer abilityid_warcry=1093814611
 constant integer warcry_abilityid_1=1093748278
 constant integer warcry_abilityid_2=1093748279
 constant integer warcry_abilityid_3=1093748275
 constant integer warcry_abilityid_4=1093748277
 constant string warcry_fx="Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl"
 integer warcry_abilityid
 constant integer abilityid_godstrength=1093752648
 constant integer abilityid_stormbolt=1093744944
 constant integer unitid_stormbolt=1747990353
 constant integer stormbolt_stun=1093685850
 constant string stormbolt_fx="Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl"
 constant string stormbolt_fx_attach="origin"
 unit stormbolt_caster
+integer stormbolt_level
 constant integer abilityid_rabid_1=1093748038
 constant integer abilityid_rabid_2=1093748037
 constant integer abilityid_rabid_3=1093748040
 constant integer abilityid_rabid_4=1093748041
 constant integer abilityid_rabid_5=1093748039
 constant integer rabid_bonus_1=1093681473
 constant integer rabid_bonus_2=1093681474
 constant integer rabid_bonus_3=1093681475
 constant integer rabid_bonus_4=1093681476
 constant integer rabid_bonus_5=1093681477
 unit spiritbear_entangle_source
 constant integer abilityid_greatstomp=1093747009
 constant integer unitid_greatstomp=1747990362
 constant integer greatstomp_stun=1093747001
 constant integer buffid_greatstomp=1110458957
@@ -3572,31 +3624,32 @@
 constant string earthsplitter_fx="Abilities\\Spells\\Other\\Volcano\\VolcanoDeath.mdl"
 constant string earthsplitter_fx2="Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl"
 constant string earthsplitter_fx3="Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl"
 unit earthsplitter_caster
 unit earthsplitter_source
 real earthspliter_x0
 real earthspliter_y0
 real earthspliter_x1
 real earthspliter_y1
 constant integer abilityid_ancestralcharge=1093747000
 constant integer unitid_ancestralcharge=1747990357
 constant integer ancestralcharge_banish=1093746999
 constant integer unitid_ancestralchargefx=1697657410
 constant integer ancestralcharge_movement=1093748537
 constant string ancestralcharge_fx="Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl"
-constant integer abilityid_ancestralcharge_end=1093808458
+constant integer abilityid_ancestralcharge_end=1093815881
+constant integer abilityid_image_echostomp=1093815371
 group ancestralcharge_group
 unit ancestralcharge_source
 real ancestralcharge_damage
 integer ancestralcharge_level
 integer ancestralcharge_attackbonus
 integer ancestralcharge_movementbonus
 unit array ancestralcharge_image
 boolean ancestralcharge_active=false
 boolean echostomp_ignore=false
 constant integer abilityid_suicidesound=1093678658
 trigger remotemine_deathtrigger
 integer remotemine_unitid
 player remotemine_player
 integer minescommand_count
 constant integer abilityid_marchofthemachines=1093681745
@@ -3628,51 +3681,52 @@
 constant integer abilityid_whirlingaxes=1093808460
 constant integer abilityid_whirlingaxes_ranged=1093808461
 constant integer abilityid_whirlingaxes_melee=1093808462
 constant integer abilityid_whirlingaxes_melee_blind=1093808463
 constant integer abilityid_whirlingaxes_ranged_slow=1093808464
 constant integer troll_melee1=1311781175
 constant integer troll_melee2=1311781442
 constant integer troll_ranged=1311781174
 constant integer unitid_whirlingaxe_melee=1697657433
 constant integer unitid_whirlingaxe_ranged=1697657434
 unit whirlingaxes_source
 unit whirlingaxes_caster
 unit whirlingaxes_axe
 group whirlingaxes_group
 integer whirlingaxes_level
-constant integer abilityid_overpower=1093750324
+constant integer abilityid_overpower=1093750841
 constant integer overpower_speed=1093750323
 constant integer overpower_fx=1093750326
 constant integer overpower_icon=1093750327
 constant integer overpower_icon_buff=1110459208
 constant integer abilityid_enrage=1093684291
 constant integer buffid_enrage=1110454856
 constant integer abilityid_terrorwave=1093744463
 constant integer terrorwave_effect=1093681488
 constant string terrorwave_fx="Abilities\\Spells\\Other\\HowlOfTerror\\HowlCaster.mdl"
 group terrorwave_group
 unit terrorwave_source
 real terrorwave_damage
 constant integer abilityid_netherswap=1093683534
 constant integer abilityid_netherswapupgrade=1093747031
 constant string netherswap_fx="Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl"
 constant integer abilityid_magicmissle=1093677633
 constant integer abilityid_wardentrapactivate=1093685841
 constant integer abilityid_wardentrapslow=1093685845
 constant integer unitid_wardentrap=1697657392
 constant integer abilityid_wardentrapburn=1093686071
+integer wardentrapslow_level
 constant integer abilityid_vorpalblade=1093685839
 constant integer upgradeid_vorpalblade=1382379618
 constant integer abilityid_refraction=1093748033
 constant integer abilityid_refractionpreventionbuff=1093685838
 constant integer abilityid_refractionbonusdamagebuff=1093685837
 constant integer unitid_refraction=1747990618
 constant integer abilityid_insta=1093685846
 constant integer buffid_instainvis=1110456395
 constant integer abilityid_windrunner=1093743689
 constant integer windrunner_bonus1=1093743413
 constant integer windrunner_bonus2=1093743183
 constant integer windrunner_bonus3=1093743412
 constant integer windrunner_bonus4=1093743417
 constant integer windrunner_bonusbuff=1110456663
 constant integer abilityid_shackleshot=1093743178
@@ -3722,38 +3776,44 @@
 constant integer battlehunger_ms_3=1093812565
 constant integer battlehunger_ms_4=1093812564
 constant integer battlehunger_ms_5=1093812561
 constant integer battlehunger_ms_6=1093812560
 constant integer battlehunger_ms_buffid=1110459738
 integer battlehunger_count
 constant integer abilityid_berserkerscall=1093683510
 unit berserkerscall_unit
 constant integer abilityid_counterhelix=1093681974
 constant integer buffid_counterhelix=1110455120
 constant integer abilityid_cullingblade=1093682482
 constant integer abilityid_cullingblade_upgrade=1093750098
 constant integer cullingblade_haste=1093814595
 constant integer cullingblade_buffid=1110459990
 constant integer abilityid_nightmare=1093678169
+constant integer abilityid_nightmare_helper=1093816121
 constant integer buffid_nightmare=1110454854
 constant integer abilityid_fiendsgrip=1093677649
 constant integer abilityid_fiendsgripupgrade=1093747769
-constant integer abilityid_enfeeble=1093678166
-constant integer enfeeble_1=1093808689
-constant integer enfeeble_2=1093808691
-constant integer enfeeble_3=1093808692
-constant integer enfeeble_4=1093808690
+constant integer abilityid_enfeeble=1093816137
+constant integer enfeeble_1=1093816135
+constant integer enfeeble_1_real=1093816132
+constant integer enfeeble_2=1093816129
+constant integer enfeeble_2_real=1093816133
+constant integer enfeeble_3=1093816134
+constant integer enfeeble_3_real=1093816131
+constant integer enfeeble_4=1093816136
+constant integer enfeeble_4_real=1093816130
+constant integer enfeeble_buffid=1110460229
 constant integer abilityid_stickynapalm=1093748044
 integer array stickynapalm_slow_1
 integer array stickynapalm_slow_2
 integer array stickynapalm_slow_3
 integer array stickynapalm_slow_4
 constant integer buffid_stickynapalm=1110458963
 constant string stickynapalm_fx_explode="Abilities\\Weapons\\LordofFlameMissile\\LordofFlameMissile.mdl"
 constant string stickynapalm_fx_apply="Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGargoyle.mdl"
 constant integer abilityid_flamebreak=1093744982
 constant integer unitid_flamebreak=1747993924
 unit flamebreak_source
 unit flamebreak_target
 integer flamebreak_level
 real flamebreak_x
 real flamebreak_y
@@ -3951,31 +4011,31 @@
 constant integer abilityid_invoke9a=1093686855
 constant integer abilityid_invoke9b=1093687625
 constant integer abilityid_invoke10a=1093686874
 constant integer abilityid_invoke10b=1093687617
 constant integer abilityid_hellfire=1095267426
 constant integer hellfire_slow=1093752403
 constant integer hellfire_slow_buff=1110459470
 constant integer abilityid_reincarnation=1093677401
 constant integer abilityid_dividedwestand=1093684567
 constant integer abilityid_dividedwestand_upgrade=1093809987
 trigger dividedwestand_t
 trigger DoubleTroubleTrigger
 integer dividedwestand_count=0
 boolean dividedwestand_usedscepter=false
 constant integer abilityid_splitearth=1093678679
-constant integer abilityid_diabolicedict=1093808212
+constant integer abilityid_diabolicedict=1093677877
 constant integer abilityid_pulsenova=1093808454
 constant integer abilityid_pulsenovaupgraded=1093808455
 constant integer abilityid_pulsenova_disabled=1093808456
 constant string pulsenova_fx="Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl"
 unit pulsenova_source
 real pulsenova_damage
 constant integer abilityid_chainfrost=1093678420
 constant integer abilityid_chainfrostupgraded=1093679176
 constant integer abilityid_chainfrosteffect=1093679409
 constant integer unitid_chainfrostunit=1697656889
 constant integer abilityid_lionimpale=1093687349
 constant integer abilityid_fingerofdeath=1093679413
 constant integer abilityid_fingerofdeath_upgrade=1093679447
 constant integer abilityid_shapeshift=1093679411
 constant integer abilityid_shapeshift_bonus=1093687875
@@ -4037,68 +4097,73 @@
 constant integer abilityid_wound=1093744948
 constant integer abilityid_woundslow=1093686344
 constant integer abilityid_woundstun=1093686608
 constant integer abilityid_snatch=1093686103
 constant integer abilityid_snatchin=1093686104
 constant integer unitid_snatch=1697657136
 unit snatch_source
 integer snatch_level
 constant integer abilityid_rage=1093686322
 constant integer abilityid_rageimmunity=1093686100
 constant integer abilityid_feast=1093686099
 constant integer abilityid_heartstopper=1093677390
 constant integer buffid_heartstopper=1110456372
 unit heartstopper_source
 integer heartstopper_level
+constant integer abilityid_sadist=1093678640
+constant integer buffid_sadist=1110454866
 integer abilityid_deathpulse=1093678422
 constant integer abilityid_reapersscythe=1093678647
 constant integer abilityid_reapersscythe_upgrade=1093679184
 constant string reapersscythe_fx="Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl"
+boolean reaperscythe_hit=false
 constant integer abilityid_nerubimpale=1093687351
 constant integer abilityid_manaburn=1093748789
 constant integer abilityid_watchersuicide=1093748808
 constant integer scarab_silence=1093748551
 unit scarab_caster
 constant integer abilityid_spikedcarapace=1093815119
-constant integer abilityid_necromastry=1093681746
-constant integer abilityid_necromastryhelper=1093682001
 constant string shadowraze_fx="Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl"
 constant integer abilityid_requiemofsouls=1093810506
 constant integer abilityid_requiemofsouls_upgrade=1093750096
+constant integer abilityid_necromastry=1093681746
+constant integer abilityid_necromastryhelper=1093682001
 constant integer abilityid_fear=1093679171
 constant integer unitid_fear=1966092617
 constant integer abilityid_stiflingknife=1093687629
 constant integer abilityid_stiflingknifeslow=1093687628
 constant integer unitid_stiflingknife=1747988784
 constant integer abilityid_blinkattack=1093685324
 constant integer blinkattack_ias=1093747535
 constant integer abilityid_blur=1093677904
 constant integer blur_buff=1093743430
 constant integer blur_buff_id=1110458674
 constant integer abilityid_cage=1093685825
 constant integer abilityid_cagehelper=1093685833
 constant real settings_cageduration=7
 constant real settings_cageradius=300
 unit cage_source
 constant integer abilityid_portal=1093685808
+constant integer abilityid_portal_disabled=1093815618
 constant integer abilityid_expulsion=1093810232
 constant integer abilityid_expulsion_aura=1093810227
 real expulsion_amount
 unit expulsion_source
-constant integer abilityid_firestorm=1093809743
+constant integer abilityid_firestorm=1093677385
 constant integer abilityid_firestormhelper=1093809744
 constant integer abilityid_firestormhelper2=1093809714
+real firestorm_amount
 constant integer abilityid_demonicclutch=1093809233
 constant integer demonicclutch_slow_1=1093809242
 constant integer demonicclutch_slow_2=1093809456
 constant integer demonicclutch_slow_3=1093809240
 constant integer demonicclutch_slow_4=1093809457
 constant integer demonicclutch_slow_5=1093809241
 constant integer demonicclutch_slow_buffid=1110459720
 constant string demonicclutch_fx="effects\\EntanglingBonesTarget.mdx"
 constant integer abilityid_corpsecollector=1093809713
 constant integer corpsecollector_bonus_1=1093809496
 constant integer corpsecollector_bonus_2=1093809497
 constant integer corpsecollector_bonus_3=1093809498
 constant integer corpsecollector_bonus_4=1093809492
 constant integer corpsecollector_bonus_5=1093809494
 constant integer corpsecollector_bonus_6=1093809493
@@ -4109,30 +4174,34 @@
 constant integer unitid_corpsecollector=1747993655
 constant integer corpsecollector_icon_0=1093809741
 constant integer corpsecollector_icon_1=1093809740
 constant integer corpsecollector_icon_2=1093809735
 constant integer corpsecollector_icon_3=1093809736
 constant integer corpsecollector_icon_4=1093809734
 constant integer corpsecollector_icon_5=1093809733
 constant integer corpsecollector_icon_6=1093809462
 constant integer corpsecollector_icon_7=1093809737
 constant integer corpsecollector_icon_8=1093809738
 constant integer corpsecollector_icon_9=1093809739
 constant integer corpsecollector_icon_10=1093809732
 constant string corpsecollector_fx_fire="war3mapImported\\CorpseFire.mdx"
 unit corpsecollector_source
 real corpsecollector_damage
+constant integer abilityid_summonshade=1093815350
+constant integer unitid_summonshade=1966092633
+unit summonshade_source
+constant integer abilityid_diffusionaura=1095328612
 constant integer abilityid_fleshheap=1093678660
 constant integer unitid_pudge_suicide=1747993154
 constant string pudge_suicide_fx="Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodAbomination.mdl"
 constant integer abilityid_hook=1093678665
 constant integer abilityid_hookministun=1093685338
 constant integer unitid_hooklink=1966092360
 integer array Hook_Hits
 integer array Hook_Total
 constant integer abilityid_dismember=1093682764
 constant integer abilityid_dismemberupgrade=1093747544
 constant integer abilityid_voltage=1093748023
 constant integer unitid_voltage=1747990585
 group voltage_group
 integer voltage_level
 unit voltage_unit
@@ -4142,30 +4211,31 @@
 constant string lightningsentry_fx="war3mapImported\\runeshell2.mdx"
 constant integer lightningsentry_magicresistance=1093747021
 constant integer lightningsentry_bolt=1093747019
 constant integer abilityid_staticlink=1093747792
 integer array staticlink_damage_positive
 integer array staticlink_damage_negative
 constant integer unitid_staticlink=1747990584
 constant integer abilityid_eyeofthestorm=1093747023
 constant integer abilityid_eyeofthestorm_upgrade=1093752150
 constant integer unitid_eyeofthestorm=1747990577
 real eyeofthestorm_damage
 unit eyeofthestorm_source
 unit eyeofthestrom_bestunit
 real eyeofthestrom_besthp
 integer eyeofthestorm_cache
+constant real eyeofthestorm_tickrate=0.05
 constant integer abilityid_burrowstrike=1093678671
 constant integer abilityid_epicenter=1093678674
 constant integer abilityid_epicenterupgrade=1093747252
 constant integer abilityid_epicentereffect=1093744450
 constant string epicenter_fx_1="war3mapImported\\EpiPulse_1_4.mdx"
 constant string epicenter_fx_2="war3mapImported\\EpiPulse_5_8.mdx"
 constant string epicenter_fx_3="war3mapImported\\EpiPulse_9_12.mdx"
 unit array epicenter_caster
 unit epicenter_source
 unit epicenter_helper
 constant integer abilityid_sandstorm=1093683248
 constant integer abilityid_sandstorm_invisibility=1093683279
 constant integer buffid_sandstorm_invisibility=1110455378
 constant integer unitid_sandstorm=1697656913
 constant integer abilityid_slithereencrush=1093810507
@@ -4191,85 +4261,88 @@
 unit charge_source
 unit charge_old
 real charge_distance
 group charge_group
 integer charge_level
 constant integer abilityid_netherstrike=1093682996
 constant integer abilityid_netherstrikeupgrade=1093747768
 unit netherstrike_source
 constant integer abilityid_zeal=1093809973
 constant integer zeal_regen_1=1093809974
 constant integer zeal_regen_2=1093809977
 constant integer zeal_regen_3=1093809975
 constant integer zeal_regen_4=1093809976
 constant integer abilityid_sunder=1093678929
 constant integer abilityid_sundercaster=1093678930
-constant integer abilityid_reflection=1093809985
+constant integer abilityid_reflection=1093815130
 constant integer reflection_slow_1=1093809752
 constant integer reflection_slow_2=1093809750
 constant integer reflection_slow_3=1093809753
 constant integer reflection_slow_4=1093809751
 constant integer reflection_slow_buffid=1110459722
 constant integer reflection_image=1093809227
 constant integer reflection_image_buffid=1110459726
 constant string reflection_fx="war3mapImported\\BlackChakraExplosion.mdx"
-constant integer abilityid_metamorph=1093751369
+constant integer abilityid_metamorph=1093815128
 constant integer metamorph_image=1093679185
 constant integer metamorph_buffid=1110459721
+constant integer metamorph_in=1093815129
 constant integer abilityid_soulsteal=1093750856
 constant integer abilityid_soulsteal_dummy=1093678156
 constant integer abilityid_soulsteal_secondary=1093751361
 constant integer unitid_soulsteal=1966092615
 constant integer abilityid_krakenshell=1093678149
 constant real krakenshell_maxtime=6
 constant real krakenshell_maxdamage=600
 constant integer abilityid_ravage=1093810505
 constant integer abilityid_anchorsmash=1093808694
 constant integer anchorsmash_attack=1093808696
 constant integer anchorsmash_attack_buffid=1110459704
 constant string anchorsmash_fx="Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl"
 unit anchorsmash_source
 integer anchorsmash_level
 unit shadowwave_source
 constant integer abilityid_weave=1093742673
 constant integer abilityid_weaveupgrade=1093747778
 constant integer WEAVE_POSITIVE=1
 constant integer WEAVE_NEGATIVE=2
+constant real weave_interval=1.0
 constant integer abilityid_shallowgrave=1093742668
 constant integer buff_shallowgrave=1093808457
 constant integer buff_shallowgrave_id=1110456132
 constant integer abilityid_venomousgale=1093744435
 constant integer abilityid_venomousgale_slow=1093744462
 constant integer unitid_venomousgale=1747990347
 constant integer unitid_venomousgale2=1747990349
 constant integer unitid_venomousgale3=1747990350
 constant integer unitid_venomousgale4=1747990351
 unit venomousgale_caster
 integer venomousgale_level
 constant integer abilityid_poisonnova=1093677363
 constant integer abilityid_poisonnovaupgrade=1093681462
 constant integer abilityid_poisonnovaeffect=1093678391
 constant integer unitid_poisonnovacaster=1697657143
 constant integer unitid_poisonnovaattacker=1865429065
 constant integer buffid_poisonnovabuff=1110454840
 constant integer abilityid_nethertoxin=1093746995
 constant integer abilityid_corrosiveskin=1093684557
 constant integer corrosiveskin_1=1093808983
 constant integer corrosiveskin_2=1093808981
 constant integer corrosiveskin_3=1093808982
 constant integer corrosiveskin_4=1093808984
 constant integer corrosiveskin_buffid=1110459713
+constant real corrosiveskin_duration=4
 constant integer abilityid_viperstrike=1093679152
 constant integer abilityid_viperstrike_ugprade=1093752154
 constant integer buffid_shadowstrike=1111847784
 constant integer buffid_shadowstrike2=1110458705
 constant integer abilityid_gravekeeperscloak=1093686872
 constant real gravekeeperscloak_decay=8
 constant integer gravekeeperscloak_level1_1=1093749586
 constant integer gravekeeperscloak_level1_2=1093749587
 constant integer gravekeeperscloak_level1_3=1093749585
 constant integer gravekeeperscloak_level1_4=1093749584
 constant integer gravekeeperscloak_level1_5=1093749589
 constant integer gravekeeperscloak_level1_6=1093749590
 constant integer gravekeeperscloak_level2_1=1093749553
 constant integer gravekeeperscloak_level2_2=1093749591
 constant integer gravekeeperscloak_level2_3=1093749592
@@ -4425,30 +4498,32 @@
 constant integer shadowdance_invis1=1093748823
 constant integer shadowdance_invis2=1093748824
 constant string shadowdance_fx="war3mapImported\\SmokescreenBlack5.mdx"
 constant integer unitid_shadowdance=1747993137
 constant real shadowdance_duration=5.5
 constant integer abilityid_pounce=1093749303
 constant integer pounce_fx=1093749302
 constant real pounce_duration=3.5
 constant integer pounce_leashrange=325
 constant integer abilityid_scream=1093678145
 constant integer abilityid_shackle=1093677136
 constant integer abilityid_dash=1093751370
 constant integer abilityid_dash_helper=1093808206
 constant string dash_fx="war3mapImported\\FireBlast.mdx"
 constant integer dash_disarm=1096971630
+constant integer dash_slow=1093816119
+constant integer dash_slow_buffid=1110460227
 group dash_alreadydamaged
 integer dash_level
 unit dash_source
 constant integer dash_width=500
 constant integer dash_length=1400
 constant integer abilityid_supernova=1093751371
 constant integer unitid_fx_ground=1747993176
 constant integer unitid_fx_sun_1=1747993430
 constant integer unitid_fx_sun_2=1747993432
 constant integer unitid_fx_sun_3=1747993431
 constant integer supernova_ensnare_1=1093753414
 constant integer supernova_ensnare_2=1093753415
 constant integer buffid_supernova_ensnare=1113943649
 constant integer supernova_stun=1093753428
 unit supernova_source
@@ -4464,51 +4539,60 @@
 constant integer abilityid_sweepingflame=1093809969
 group sweepingflame_group
 unit sweepingflame_source
 unit sweepingflame_projectile
 real sweepingflame_x
 real sweepingflame_y
 real sweepingflame_a
 constant string sweepingflame_fx="Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl"
 constant integer sweepingflame_slow=1093809968
 constant integer sweepingflame_slow_buffid=1110459723
 constant integer sweepingflame_projectileid=1747993665
 constant integer abilityid_sunray=1093753177
 constant integer abilityid_sunray_off=1093753395
 constant integer abilityid_sunray_movement=1093808181
 constant string sunray_fx="war3mapImported\\FireRayTarget.mdx"
-constant real sunray_maxdistance=1150
+constant real sunray_maxdistance=1300
 constant real sunray_offset_x=20
 constant real sunray_offset_y=20
 constant real sunray_offset_z=20
 constant integer sunray_maim_1=1093753396
 constant integer sunray_maim_2=1093753409
 constant integer sunray_maim_3=1093753410
 constant integer sunray_maim_4=1093753401
 constant integer buffid_sunray=1110459478
+constant real sunray_max_duration=6.0
 integer sunray_level
 unit sunray_source
 group sunray_group
-real sunray_damage
+real sunray_damage1
+real sunray_damage2
 constant integer abilityid_firespirits=1093753176
 constant integer abilityid_firespirits_helper=1093753394
 constant integer abilityid_firespirits_slow=1093808469
+constant integer firespirits_disarm=1093815352
 constant integer unitid_firespirits=1747993429
 constant string firespirits_fx="war3mapImported\\Firaga_2.mdx"
 unit firespirits_source
 unit firespirits_caster
 real firespirits_damage
+constant integer abilityid_overheat=1093815345
+constant string overheat_fx="Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl"
+constant integer overheat_disarm=1093815352
+group overheat_alreadydamaged
+integer overheat_level
+unit overheat_source
 constant integer abilityid_shadowpoison=1093751604
 constant integer abilityid_shadowpoison_explode=1093751609
 constant integer unitid_shadowpoison=1747993394
 constant string shadowpoison_fx="war3mapImported\\shamanyouranus-ShadowyMissile.mdl"
 unit shadowpoison_source
 group shadowpoison_group
 constant integer abilityid_disruption=1093751608
 constant integer disruption_image=1093751605
 constant integer abilityid_soulcatcher=1093751618
 constant string soulcatcher_fx="war3mapImported\\Desecrate.mdx"
 constant string soulcatcher_fx_overtime="war3mapImported\\void.mdx"
 constant integer abilityid_demonicpurge=1093751617
 constant integer abilityid_rocketbarrage=1093751631
 constant integer abilityid_rocketbarrage_spray=1093751632
 constant integer abilityid_seekingmissle=1093751633
@@ -4740,30 +4824,31 @@
 boolean divinewrath_active=true
 unit divinewrath_source
 group divinewrath_group
 real divinewrath_damage
 constant string divinewrath_fx_source="war3mapImported\\WispShellBlue_2.mdx"
 constant string divinewrath_fx="war3mapImported\\DivineWrathTarget.mdx"
 constant integer abilityid_wraith=1093812803
 constant integer abilityid_wraith_end=1093812804
 constant integer wraith_ms_buffid=1110459954
 constant integer wraith_ghost=1097167980
 constant integer wrath_magicbonus_1=1093812787
 constant integer wrath_magicbonus_2=1093812784
 constant integer wrath_magicbonus_3=1093812785
 constant integer wrath_magicbonus_4=1093812786
 constant integer abilityid_blackjack=1093812788
+group blackjack_alreadyhit
 constant integer abilityid_miasma=1093812789
 constant integer miasma_reveal_orderid=852625
 constant integer miasma_reveal=1093812791
 constant integer abilityid_brotherhood=1093814066
 constant integer brotherhood_fx=1093814607
 constant integer abilityid_gallop=1093812822
 constant integer gallop_ms_1=1093814604
 constant integer gallop_ms_2=1093814605
 constant integer gallop_ms_3=1093812825
 constant integer gallop_ms_4=1093814606
 constant integer gallop_ms_buffid=1110459956
 constant integer abilityid_momentofcourage=1093813593
 constant integer momentofcourage_bonus_1=1093814084
 constant integer momentofcourage_bonus_2=1093814085
 constant integer momentofcourage_bonus_3=1093814086
@@ -4844,52 +4929,69 @@
 constant integer unitid_timberchainhead=1966092624
 group timberchain_group
 integer timberchain_count
 constant integer abilityid_reactivearmor=1093813556
 integer array reactivearmor_bonus
 constant integer abilityid_chakram=1093813557
 constant integer abilityid_chakram_return=1093813848
 constant integer chakram_disableattack=1096971630
 constant real chakram_aoe=200
 constant real chakram_dps_aoe=200
 constant integer unitid_chakram=1747993683
 constant integer chakram_slow=1093813334
 group chakram_group
 unit chakram_source
 integer chakram_level
-constant integer abilityid_breeze=1093813582
-constant integer unitid_breeze=1747993688
-constant integer breeze_slow_1=1093813580
-constant integer breeze_slow_2=1093813579
-constant integer breeze_slow_3=1093813578
-constant integer breeze_slow_4=1093813581
-constant integer breeze_slow_buffid=1110459958
-unit breeze_source
-unit breeze_projectile
-group breeze_group
-constant integer abilityid_frostskin=1093813593
-constant integer frostskin_reduction_1=1093813592
-constant integer frostskin_reduction_2=1093813589
-constant integer frostskin_reduction_3=1093813590
-constant integer frostskin_reduction_4=1093813591
-constant integer frostskin_mana_1=1093813587
-constant integer frostskin_mana_2=1093813586
-constant integer frostskin_mana_3=1093813585
-constant integer frostskin_mana_4=1093813588
-constant integer abilityid_frostgiant=1093813594
-constant integer frostgiant_sourceid=1311788343
-constant integer unitid_frostgiant=1865429333
+constant integer abilityid_trap=1093815353
+constant integer trap_marker=1093815365
+constant integer trap_marker_buffid=1110460209
+constant real trap_duration=20
+integer trap_bonuscount
+unit trap_source
+integer trap_level
+constant integer abilityid_split=1093815361
+constant integer split_slow=1093815627
+constant integer split_slow_buffid=1110460212
+unit split_source
+unit split_target
+real split_time=1.35
+real split_minspeed=500
+constant integer abilityid_shield=1093815362
+constant integer shield_armor=1093815364
+constant string shield_fx="war3mapImported\\Cryofreeze5.mdx"
+constant integer abilityid_curse=1093687856
+group curse_group
+trigger curse_trigger
+unit curse_target
+unit curse_source=null
+constant string curse_fx="war3mapImported\\WintersCurse.mdx"
+constant string curse_ground_fx="war3mapImported\\WintersCurseAoE.mdx"
+constant integer abilityid_touch=1093815859
+constant integer buffid_touch=1110460215
+constant real touch_burnduration=6
+constant string touch_burnfx="effects\\BasicWaterFlash.mdx"
+constant integer abilityid_arcticsiege=1093815877
+constant integer arcticsiege_slow_1=1093815874
+constant integer arcticsiege_slow_1_real=1093815873
+constant integer arcticsiege_slow_2=1093815862
+constant integer arcticsiege_slow_2_real=1093815864
+constant integer arcticsiege_slow_3=1093815875
+constant integer arcticsiege_slow_3_real=1093815863
+constant integer arcticsiege_slow_4=1093815876
+constant integer arcticsiege_slow_4_real=1093815865
+constant integer arcticsiege_slow_buffid=1110460225
+constant real arcticsiege_duration=6
 constant integer abilityid_sonicboom=1093813812
 constant string sonicboom_impactfx="war3mapImported\\BlackDragonMissile.mdx"
 unit sonicboom_source
 integer sonicboom_level
 constant integer abilityid_windblast=1093813573
 constant integer windblast_armor=1093813811
 constant string windblast_fx="effects\\BasicWaterFlash.mdx"
 unit windblast_source
 integer windblast_level
 constant integer abilityid_windbarrier=1093813808
 constant integer windbarrier_speed=1093813810
 constant integer windbarrier_speed_buffid=1110459959
 constant integer windbarrier_barrier_buffid1=1110456374
 constant integer windbarrier_barrier_buffid2=1110456375
 constant integer abilityid_prevailingwinds=1093813813
@@ -4903,30 +5005,64 @@
 constant integer prevailingwinds_haste_3=1093813832
 constant integer prevailingwinds_haste_buffid=1110459960
 constant integer abilityid_holyshackles=1093813844
 constant integer holyshackles_ensnare=1093813845
 constant integer unitid_holyshackles=1747993690
 constant integer abilityid_focus=1093813841
 constant integer focus_bonus=1093813838
 constant integer focus_bonus_buffid=1110459969
 constant integer abilityid_divineintervention=1093813836
 constant integer divineintervention_invul=1098282348
 constant string divineintervention_fx="Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl"
 constant integer divineintervention_doom=1093813847
 constant integer divineintervention_disableattack=1096971630
 constant integer abilityid_chill=1093813583
 constant integer chill_silence=1093813584
+constant integer abilityid_lightningseeker=1093815372
+constant integer lightningseeker_unitid=1747993927
+constant real lightningseeker_duration=50
+constant integer abilityid_magneticfield=1093815373
+constant integer magneticfield_evasion1=1093815609
+constant integer magneticfield_evasion2=1093815617
+constant integer magneticfield_evasion3=1093815374
+constant integer magneticfield_evasion4=1093815608
+constant integer magneticfield_evasion1_basic=1093815888
+constant integer magneticfield_evasion2_basic=1093815891
+constant integer magneticfield_evasion3_basic=1093815890
+constant integer magneticfield_evasion4_basic=1093815889
+constant real magneticfield_duration=5
+constant string magneticfield_fx="war3mapImported\\MagneticField04.mdl"
+constant integer unitid_magneticfield=1747993928
+integer magneticfield_level
+integer magneticfield_desiredbuff
+constant integer abilityid_nuralshock=1093815601
+constant integer nuralshock_slow_1=1093815383
+constant integer nuralshock_slow_2=1093815385
+constant integer nuralshock_slow_1_buffid=1110460210
+constant integer nuralshock_slow_2_buffid=1110460211
+constant real nuralshock_duration=6
+constant string nuralshock_fx="war3mapImported\\Flux3.mdx"
+constant integer abilityid_tempestdouble=1093815600
+constant integer unitid_tempestdouble=1311788365
+constant string tempestdouble_fx="Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl"
+constant integer abilityid_marksmanship=1093686851
+constant integer abilityid_marksmanship_double=1093815896
+constant integer abilityid_trueshotaura=1093677625
+constant integer abilityid_trueshotaura_aura=1093815897
+constant integer abilityid_trueshotaura_aura_creeps_global=1093816115
+constant integer TRUESHOT_CREEPS_GLOBAL_ON=1
+constant integer TRUESHOT_CREEPS_GLOBAL_OFF=2
 endglobals
 function InitGlobals takes nothing returns nothing
 local integer i=0
 set i=0
 loop
 exitwhen(i>16)
 set udg_RevivalTimer[i]=0
 set i=i+1
 endloop
 set i=0
 loop
 exitwhen(i>100)
 set udg_HeroFlags[i]=false
 set i=i+1
 endloop
@@ -6279,37 +6415,74 @@
 loop
 exitwhen x>StrengthHeroCount
 if id==StrengthHero[x]then
 return HEROTYPE_STR
 endif
 set x=x+1
 endloop
 set x=1
 loop
 exitwhen x>IntelligenceHeroCount
 if id==IntelligenceHero[x]then
 return HEROTYPE_INT
 endif
 set x=x+1
 endloop
-if id==1164277357 or id==1160786518 or id==1160786519 or id==1160786517 or id==1311781442 or id==1311781175 or id==1211119684 or id==1211119683 or id==1211119668 or id==1211119682 or id==1311781171 or id==1311781172 or id==1311781173 or id==1160786511 then
+if id==1164277357 or id==1160786518 or id==1160786519 or id==1160786517 or id==1311781442 or id==1311781175 or id==1211119684 or id==1211119683 or id==1211119668 or id==1211119682 or id==1311781171 or id==1311781172 or id==1311781173 or id==1160786511 or id==1311788365 then
+return HEROTYPE_AGI
+endif
+if id==1311781192 or id==1311781204 or id==1311781194 or id==1211117637 or id==1211117639 or id==1211117638 or id==1211119433 or id==1160786229 or id==1211122513 or id==1211122995 or id==1211122996 or id==1211122997 or id==1429221720 then
+return HEROTYPE_STR
+endif
+if id==1211119192 or id==1211119193 or id==1211119191 or id==1211122243 or id==1328558391 or id==1311788354 or id==1311788355 or id==1311788367 or id==1311788353 then
+return HEROTYPE_INT
+endif
+return 0
+endfunction
+function GetHeroTypeById takes integer id returns integer
+local integer x
+set x=1
+loop
+exitwhen x>AgilityHeroCount
+if id==AgilityHero[x]then
+return HEROTYPE_AGI
+endif
+set x=x+1
+endloop
+set x=1
+loop
+exitwhen x>StrengthHeroCount
+if id==StrengthHero[x]then
+return HEROTYPE_STR
+endif
+set x=x+1
+endloop
+set x=1
+loop
+exitwhen x>IntelligenceHeroCount
+if id==IntelligenceHero[x]then
+return HEROTYPE_INT
+endif
+set x=x+1
+endloop
+if id==1164277357 or id==1160786518 or id==1160786519 or id==1160786517 or id==1311781442 or id==1311781175 or id==1211119684 or id==1211119683 or id==1211119668 or id==1211119682 or id==1311781171 or id==1311781172 or id==1311781173 or id==1160786511 or id==1311788365 then
 return HEROTYPE_AGI
 endif
 if id==1311781192 or id==1311781204 or id==1311781194 or id==1211117637 or id==1211117639 or id==1211117638 or id==1211119433 or id==1160786229 or id==1211122513 or id==1211122995 or id==1211122996 or id==1211122997 or id==1429221720 then
 return HEROTYPE_STR
 endif
-if id==1211119192 or id==1211119193 or id==1211119191 or id==1211122243 or id==1328558391 then
+if id==1211119192 or id==1211119193 or id==1211119191 or id==1211122243 or id==1328558391 or id==1311788354 or id==1311788355 or id==1311788367 or id==1311788353 then
 return HEROTYPE_INT
 endif
 return 0
 endfunction
 function GetPrimaryStat takes unit Hero returns integer
 local integer HeroType=GetHeroType(Hero)
 if HeroType==HEROTYPE_INT then
 return GetHeroInt(Hero,true)
 endif
 if HeroType==HEROTYPE_AGI then
 return GetHeroAgi(Hero,true)
 endif
 if HeroType==HEROTYPE_STR then
 return GetHeroStr(Hero,true)
 endif
@@ -6984,31 +7157,31 @@
 exitwhen IsPlayer(udg_Host)or loopcurrent>5
 set loopcurrent=loopcurrent+1
 set udg_Host=udg_SentPlayers[loopcurrent]
 endloop
 if IsPlayer(udg_Host)==false then
 set udg_Host=udg_ScourgePlayers[1]
 set loopcurrent=1
 loop
 exitwhen IsPlayer(udg_Host)or loopcurrent>5
 set loopcurrent=loopcurrent+1
 set udg_Host=udg_ScourgePlayers[loopcurrent]
 endloop
 endif
 endfunction
 function IsRealHero takes unit Hero returns boolean
-return IsUnitType(Hero,UNIT_TYPE_HERO)==true and IsUnitIllusion(Hero)==false and GetUnitTypeId(Hero)!=1211117645 and GetUnitTypeId(Hero)!=1211117657 and GetUnitTypeId(Hero)!=1211119431 and GetUnitTypeId(Hero)!=1211122232
+return IsUnitType(Hero,UNIT_TYPE_HERO)==true and IsUnitIllusion(Hero)==false and GetUnitTypeId(Hero)!=1211117645 and GetUnitTypeId(Hero)!=unitid_tempestdouble and GetUnitTypeId(Hero)!=1211117657 and GetUnitTypeId(Hero)!=1211119431 and GetUnitTypeId(Hero)!=1211122232
 endfunction
 function DummyToHero takes integer i returns integer
 local integer x=0
 loop
 exitwhen x>ScourgeMax
 if DummyID[x]==i then
 return HeroID[x]
 endif
 set x=x+1
 endloop
 return-1
 endfunction
 function GetHeroIndex takes integer heroid returns integer
 local integer i=1
 loop
@@ -7035,30 +7208,42 @@
 endif
 return 0
 endfunction
 function IsObserver takes player p returns boolean
 return udg_ObserverMode and(udg_Observer1==p or udg_Observer2==p)
 endfunction
 function IsCycloned takes unit u returns boolean
 return GetUnitAbilityLevel(u,1113815395)>0 or GetUnitAbilityLevel(u,1113815346)>0
 endfunction
 function Gargolye_IsFamiliar takes integer id returns boolean
 return id==unitid_gargoyle_a_1 or id==unitid_gargoyle_a_2 or id==unitid_gargoyle_a_3 or id==unitid_gargoyle_b_1 or id==unitid_gargoyle_b_2 or id==unitid_gargoyle_b_3
 endfunction
 function IsHexed takes unit u returns boolean
 return GetUnitAbilityLevel(u,1112500344)>0 or GetUnitAbilityLevel(u,1110454344)>0
 endfunction
+function PrimalSplit_IsPanda takes integer uid returns boolean
+if uid==1852862003 or uid==1852862006 or uid==1848652080 or uid==1848657754 then
+return true
+endif
+if uid==1852862002 or uid==1852862006 or uid==1848652082 or uid==1848657969 then
+return true
+endif
+if uid==1852862001 or uid==1852862004 or uid==1848652081 or uid==1848657968 then
+return true
+endif
+return false
+endfunction
 function DamageTarget takes unit Source,unit Target,integer DamageType,real Damage returns nothing
 if DamageType==0 then
 return
 endif
 if DamageType==DAMAGE_MAGICAL then
 call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_FIRE,WEAPON_TYPE_WHOKNOWS)
 elseif DamageType==DAMAGE_PHYSICAL then
 call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
 elseif DamageType==DAMAGE_PURE then
 call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)
 elseif DamageType==DAMAGE_PIERCE then
 call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_PIERCE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
 elseif DamageType==DAMAGE_MIXED then
 call UnitDamageTarget(Source,Target,Damage,true,true,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
 endif
@@ -7621,34 +7806,35 @@
 local integer Cache=GetHandleId(t)
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local integer SourceIndex=(LoadInteger(hash_main,(Cache),(43)))
 local unit Source=TI_GetUnit(SourceIndex)
 local real Speed=(LoadReal(hash_main,(Cache),(44)))
 local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
 local real x=GetUnitX(Projectile)
 local real y=GetUnitY(Projectile)
 local real TargetX=GetUnitX(Target)
 local real TargetY=GetUnitY(Target)
 local real MoveRate=Speed*0.03
 local real NewAngle=AngleBetweenXY(x,y,TargetX,TargetY)
 local real NewX=x+MoveRate*Cos(NewAngle*bj_DEGTORAD)
 local real NewY=y+MoveRate*Sin(NewAngle*bj_DEGTORAD)
+local boolean IgnoreDead=(LoadBoolean(hash_main,(Cache),(698)))
 call SetUnitX(Projectile,NewX)
 call SetUnitY(Projectile,NewY)
 call SetUnitFacing(Projectile,NewAngle)
-if IsDead(Target)then
+if IsDead(Target)and IgnoreDead==false then
 call KillUnit(Projectile)
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetDist(TargetX,TargetY,NewX,NewY)<=MoveRate then
 call KillUnit(Projectile)
 set tt_unit1=Source
 set tt_unit2=Target
 call ExecuteFunc((LoadStr(hash_main,(Cache),(46))))
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Target=null
@@ -7657,30 +7843,31 @@
 return false
 endfunction
 function CreateProjectileToUnit takes unit Source,unit Target,integer projectileid,string callback,real Speed returns trigger
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local real SourceX=GetUnitX(Source)
 local real SourceY=GetUnitY(Source)
 local real SourceA=GetUnitFacing(Source)
 call TriggerRegisterTimerEvent(t,0.03,true)
 call TriggerAddCondition(t,Condition(function CreateProjectileToUnit_Move))
 call SaveReal(hash_main,(Cache),(44),((Speed)*1.0))
 call SaveInteger(hash_main,(Cache),(30),(TI_AddUnit(Target)))
 call SaveStr(hash_main,(Cache),(46),(callback))
 call SaveInteger(hash_main,(Cache),(43),(TI_AddUnit(Source)))
 call SaveUnitHandle(hash_main,(Cache),(45),(CreateUnit(GetOwningPlayer(Source),projectileid,SourceX,SourceY,SourceA)))
+call SaveBoolean(hash_main,(Cache),(698),(false))
 set tt_trig1=t
 set t=null
 return tt_trig1
 endfunction
 function MoveProjectileToXY_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local real Speed=(LoadReal(hash_main,(Cache),(44)))
 local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
 local real x=GetUnitX(Projectile)
 local real y=GetUnitY(Projectile)
 local real TargetX=(LoadReal(hash_main,(Cache),(47)))
 local real TargetY=(LoadReal(hash_main,(Cache),(48)))
 local real MoveRate=Speed*0.03
 local real NewAngle=AngleBetweenXY(x,y,TargetX,TargetY)
@@ -8568,49 +8755,160 @@
 endif
 set NewX=x-i*20
 set NewY=y+i*20
 if IsPointInRegion(region_badplaces,NewX,NewY)==false then
 return Location(NewX,NewY)
 endif
 set NewX=x-i*20
 set NewY=y-i*20
 if IsPointInRegion(region_badplaces,NewX,NewY)==false then
 return Location(NewX,NewY)
 endif
 set i=i+1
 endloop
 return Location(x,y)
 endfunction
+function IsTowerOrRax takes unit u returns boolean
+if u==ScourgeBuilding_Tower1Top then
+return true
+endif
+if u==ScourgeBuilding_Tower1Mid then
+return true
+endif
+if u==ScourgeBuilding_Tower1Bot then
+return true
+endif
+if u==ScourgeBuilding_Tower2Top then
+return true
+endif
+if u==ScourgeBuilding_Tower2Mid then
+return true
+endif
+if u==ScourgeBuilding_Tower2Bot then
+return true
+endif
+if u==ScourgeBuilding_Tower3Top then
+return true
+endif
+if u==ScourgeBuilding_Tower3Mid then
+return true
+endif
+if u==ScourgeBuilding_Tower3Bot then
+return true
+endif
+if u==ScourgeBuilding_Tower4Left then
+return true
+endif
+if u==ScourgeBuilding_Tower4Right then
+return true
+endif
+if u==ScourgeBuilding_RaxMeleeTop then
+return true
+endif
+if u==ScourgeBuilding_RaxMeleeMid then
+return true
+endif
+if u==ScourgeBuilding_RaxMeleeBot then
+return true
+endif
+if u==ScourgeBuilding_RaxRangeTop then
+return true
+endif
+if u==ScourgeBuilding_RaxRangeMid then
+return true
+endif
+if u==ScourgeBuilding_RaxRangeBot then
+return true
+endif
+if u==SentinelBuilding_Tower1Top then
+return true
+endif
+if u==SentinelBuilding_Tower1Mid then
+return true
+endif
+if u==SentinelBuilding_Tower1Bot then
+return true
+endif
+if u==SentinelBuilding_Tower2Top then
+return true
+endif
+if u==SentinelBuilding_Tower2Mid then
+return true
+endif
+if u==SentinelBuilding_Tower2Bot then
+return true
+endif
+if u==SentinelBuilding_Tower3Top then
+return true
+endif
+if u==SentinelBuilding_Tower3Mid then
+return true
+endif
+if u==SentinelBuilding_Tower3Bot then
+return true
+endif
+if u==SentinelBuilding_Tower4Left then
+return true
+endif
+if u==SentinelBuilding_Tower4Right then
+return true
+endif
+if u==SentinelBuilding_RaxMeleeTop then
+return true
+endif
+if u==SentinelBuilding_RaxMeleeMid then
+return true
+endif
+if u==SentinelBuilding_RaxMeleeBot then
+return true
+endif
+if u==SentinelBuilding_RaxRangeTop then
+return true
+endif
+if u==SentinelBuilding_RaxRangeMid then
+return true
+endif
+if u==SentinelBuilding_RaxRangeBot then
+return true
+endif
+return false
+endfunction
 function GenericCondition_IsDotAInvis takes unit u returns boolean
-return GetUnitAbilityLevel(u,1110455864)>0 or GetUnitAbilityLevel(u,1110456148)>0 or GetUnitAbilityLevel(u,1110456118)>0 or GetUnitAbilityLevel(u,1112504171)>0 or GetUnitAbilityLevel(u,1110455378)>0 or GetUnitAbilityLevel(u,1110458677)>0 or GetUnitAbilityLevel(u,1110454609)>0 or GetUnitAbilityLevel(u,1110454326)>0 or GetUnitAbilityLevel(u,1114205814)>0 or GetUnitAbilityLevel(u,1097886070)>0 or GetUnitAbilityLevel(u,1093677617)>0 or GetUnitAbilityLevel(u,1093684020)>0 or GetUnitAbilityLevel(u,1093687362)>0 or GetUnitAbilityLevel(u,1093687858)>0 or GetUnitAbilityLevel(u,1093748545)>0 or GetUnitAbilityLevel(u,1093748823)>0 or GetUnitAbilityLevel(u,1093748824)>0 or GetUnitAbilityLevel(u,1093677130)>0 or GetUnitAbilityLevel(u,1110456395)>0 or GetUnitAbilityLevel(u,1110456408)>0 or GetUnitAbilityLevel(u,1110455097)>0 or GetUnitAbilityLevel(u,1110454347)>0 or GetUnitAbilityLevel(u,1112041075)>0 or GetUnitAbilityLevel(u,1093743664)>0 or GetUnitAbilityLevel(u,1110454833)>0 or GetUnitAbilityLevel(u,1093687876)>0 or GetUnitAbilityLevel(u,1093684052)>0
+return GetUnitAbilityLevel(u,1110455864)>0 or GetUnitAbilityLevel(u,1110456148)>0 or GetUnitAbilityLevel(u,1110456118)>0 or GetUnitAbilityLevel(u,1112504171)>0 or GetUnitAbilityLevel(u,1110455378)>0 or GetUnitAbilityLevel(u,1110458677)>0 or GetUnitAbilityLevel(u,1110454609)>0 or GetUnitAbilityLevel(u,1110454326)>0 or GetUnitAbilityLevel(u,1114205814)>0 or GetUnitAbilityLevel(u,1097886070)>0 or GetUnitAbilityLevel(u,1093677617)>0 or GetUnitAbilityLevel(u,1093684020)>0 or GetUnitAbilityLevel(u,1093687362)>0 or GetUnitAbilityLevel(u,1093687858)>0 or GetUnitAbilityLevel(u,1093748545)>0 or GetUnitAbilityLevel(u,1093748823)>0 or GetUnitAbilityLevel(u,1093748824)>0 or GetUnitAbilityLevel(u,1093677130)>0 or GetUnitAbilityLevel(u,1110456395)>0 or GetUnitAbilityLevel(u,1110456408)>0 or GetUnitAbilityLevel(u,1110455097)>0 or GetUnitAbilityLevel(u,1110454347)>0 or GetUnitAbilityLevel(u,1112041075)>0 or GetUnitAbilityLevel(u,1093743664)>0 or GetUnitAbilityLevel(u,1110454833)>0 or GetUnitAbilityLevel(u,1093687876)>0 or GetUnitAbilityLevel(u,1093684052)>0 or GetUnitAbilityLevel(u,1110460216)>0
+endfunction
+function GenericCondition_IsInvisibleToMe takes unit u,player p returns boolean
+return GenericCondition_IsDotAInvis(u)==false or IsUnitVisible(GetFilterUnit(),p)==true
 endfunction
 function GenericCondition_IsBear takes unit whichUnit returns boolean
 local integer TypeId=GetUnitTypeId(whichUnit)
 return TypeId==1848651828 or TypeId==1848652103 or TypeId==1848652099 or TypeId==1848652088 or TypeId==1697656907 or TypeId==1697656905 or TypeId==1697656908 or TypeId==1697657162
 endfunction
 function GenericCondition_Basics takes nothing returns boolean
 return GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false
 endfunction
 function GenericCondition_BasicsNoBlocker takes nothing returns boolean
 return(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and GetUnitAbilityLevel(GetFilterUnit(),1093751362)==0
 endfunction
 function GenericCondition_BasicsAndVisible takes nothing returns boolean
 return(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))
 endfunction
 function GenericCondition_BasicsAndStructure takes nothing returns boolean
 return GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false
 endfunction
+function GenericCondition_Structure takes nothing returns boolean
+return IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==true and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false
+endfunction
 function GenericCondition_EnemyUnitsExNoImmuneNoInvisAndStructure takes nothing returns boolean
 return IsMagicImmune(GetFilterUnit())==false and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_EnemyUnitsExNoImmuneAndStructure takes nothing returns boolean
 return IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_EnemyUnitsExNoImmuneNoInvisAndStructureWithAncient takes nothing returns boolean
 return IsMagicImmune(GetFilterUnit())==false and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)
 endfunction
 function GenericCondition_EnemyUnitsExNoInvisAndStructureWithAncient takes nothing returns boolean
 return IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)
 endfunction
 function GenericCondition_EnemySiegeEx takes nothing returns boolean
 return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitTypeId(GetFilterUnit())==1700946284 or GetUnitTypeId(GetFilterUnit())==1970107511)
 endfunction
@@ -8659,54 +8957,66 @@
 function GenericCondition_EnemyUnitsExNoImmuneNoInvisWithAncient takes nothing returns boolean
 return IsMagicImmune(GetFilterUnit())==false and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)
 endfunction
 function GenericCondition_EnemyUnitsExNoInvisWithAncient takes nothing returns boolean
 return IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)
 endfunction
 function GenericCondition_EnemyUnitsWithAncientsEx takes nothing returns boolean
 return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)
 endfunction
 function GenericCondition_EnemyUnitsNoNeutrals takes nothing returns boolean
 return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and GetOwningPlayer(GetFilterUnit())!=udg_NeutralHostile
 endfunction
 function GenericCondition_EnemyUnitsAndStructureEx takes nothing returns boolean
 return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
+function GenericCondition_AlliedUnitsAndStructureEx takes nothing returns boolean
+return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
+endfunction
+function GenericCondition_AlliedStructureEx takes nothing returns boolean
+return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==true and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
+endfunction
 function GenericCondition_EnemyUnitsAndStructureExNoHeroes takes nothing returns boolean
 return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false
 endfunction
 function GenericCondition_EnemyUnitsAndStructureExNoImmune takes nothing returns boolean
 return IsMagicImmune(GetFilterUnit())==false and(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))
 endfunction
 function GenericCondition_EnemyUnitsAndStructureWithAncientsEx takes nothing returns boolean
 return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false)
 endfunction
 function GenericCondition_AlliedUnits takes nothing returns boolean
 return IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_AlliedPlayerUnits takes nothing returns boolean
 return IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and IsRealPlayer(GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)
 endfunction
+function GenericCondition_AlliedPlayerUnitsEx takes nothing returns boolean
+return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and IsRealPlayer(GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)
+endfunction
 function GenericCondition_AlliedUnitsWithGargs takes nothing returns boolean
 return IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)
 endfunction
 function GenericCondition_AlliedUnitsEx takes nothing returns boolean
 return IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_AlliedHeroes takes nothing returns boolean
 return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
+function GenericCondition_MyUnits takes nothing returns boolean
+return GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
+endfunction
 function GenericCondition_AlliedHeroesAndCreeps takes nothing returns boolean
 return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true or GetOwningPlayer(GetFilterUnit())==udg_SentPlayers[0]or GetOwningPlayer(GetFilterUnit())==udg_ScourgePlayers[0])and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_AlliedHeroesNoImages takes nothing returns boolean
 return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_AlliedHeroesEx takes nothing returns boolean
 return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_EnemyHeroes takes nothing returns boolean
 return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==true and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_EnemyHeroesNoImmune takes nothing returns boolean
 return IsMagicImmune(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==true and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))
 endfunction
@@ -8756,61 +9066,71 @@
 return((IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1)))and IsNotAttackable(GetFilterUnit())==false
 endfunction
 function GenericCondition_RegularUnits takes nothing returns boolean
 return(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))
 endfunction
 function GenericCondition_RegularUnitsExVisible takes nothing returns boolean
 return((GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))
 endfunction
 function GenericCondition_RegularUnitsExVisibleNoImmune takes nothing returns boolean
 return IsMagicImmune(GetFilterUnit())==false and((GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))
 endfunction
 function GenericCondition_ValidCorpse takes nothing returns boolean
 return GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==true and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false and GetUnitTypeId(GetFilterUnit())!=unitid_tombstone_zombie
 endfunction
 function GenericCondition_FloatingHeroes takes nothing returns boolean
-return GetUnitTypeId(GetFilterUnit())==1211117637 or GetUnitTypeId(GetFilterUnit())==1211117639 or GetUnitTypeId(GetFilterUnit())==1211117638 or GetUnitTypeId(GetFilterUnit())==1160786000 or GetUnitTypeId(GetFilterUnit())==1311780930 or GetUnitTypeId(GetFilterUnit())==1430468144 or GetUnitTypeId(GetFilterUnit())==1162032951 or GetUnitTypeId(GetFilterUnit())==1429221456 or GetUnitTypeId(GetFilterUnit())==1160786510 or GetUnitTypeId(GetFilterUnit())==1160786511 or GetUnitTypeId(GetFilterUnit())==1328558390 or GetUnitTypeId(GetFilterUnit())==1328558391 or GetUnitTypeId(GetFilterUnit())==1160786502 or GetUnitTypeId(GetFilterUnit())==1211122767
+return GetUnitTypeId(GetFilterUnit())==1211117637 or GetUnitTypeId(GetFilterUnit())==1211117639 or GetUnitTypeId(GetFilterUnit())==1211117638 or GetUnitTypeId(GetFilterUnit())==1160786000 or GetUnitTypeId(GetFilterUnit())==1311780930 or GetUnitTypeId(GetFilterUnit())==1430468144 or GetUnitTypeId(GetFilterUnit())==1162032951 or GetUnitTypeId(GetFilterUnit())==1429221456 or GetUnitTypeId(GetFilterUnit())==1160786510 or GetUnitTypeId(GetFilterUnit())==1160786511 or GetUnitTypeId(GetFilterUnit())==1328558390 or GetUnitTypeId(GetFilterUnit())==1328558391 or GetUnitTypeId(GetFilterUnit())==1160786502 or GetUnitTypeId(GetFilterUnit())==1211122767 or GetUnitTypeId(GetFilterUnit())==1311788343 or GetUnitTypeId(GetFilterUnit())==1311788354 or GetUnitTypeId(GetFilterUnit())==1311788355 or GetUnitTypeId(GetFilterUnit())==1311788367 or GetUnitTypeId(GetFilterUnit())==1311788353
 endfunction
 function GenericCondition_EnemyTowers takes nothing returns boolean
 return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(tt_unit1))==true and GetTowerLevel(GetFilterUnit())>0
 endfunction
 function Stun_GetLevel takes real Duration returns integer
 if Duration>=4.00 then
-return 19
+return 24
 elseif Duration>=3.75 then
-return 18
+return 23
 elseif Duration>=3.5 then
-return 17
+return 22
 elseif Duration>=3.25 then
-return 16
+return 21
 elseif Duration>=3 then
-return 15
+return 20
+elseif Duration>=2.8 then
+return 19
 elseif Duration>=2.75 then
-return 14
+return 18
+elseif Duration>=2.6 then
+return 17
 elseif Duration>=2.5 then
-return 13
+return 16
+elseif Duration>=2.4 then
+return 15
 elseif Duration>=2.25 then
-return 12
+return 14
+elseif Duration>=2.2 then
+return 13
 elseif Duration>=2 then
-return 11
+return 12
 elseif Duration>=1.8 then
-return 10
+return 11
 elseif Duration>=1.75 then
-return 9
+return 10
 elseif Duration>=1.65 then
-return 8
+return 9
 elseif Duration>=1.5 then
+return 8
+elseif Duration>=1.4 then
 return 7
 elseif Duration>=1.25 then
 return 6
 elseif Duration>=1.2 then
 return 5
 elseif Duration>=1 then
 return 4
 elseif Duration>=0.75 then
 return 3
 elseif Duration>=0.5 then
 return 2
 elseif Duration>=0.25 then
 return 1
 endif
 return 1
@@ -12808,31 +13128,55 @@
 set HeroTips_4[i]=""
 set HeroTips_5[i]=""
 set i=i+1
 set HeroID[108]=1429221441
 set DummyID[108]=1747989831
 set HeroName[108]=MSG_HERO_CK
 set HeroIcon[108]="ReplaceableTextures\\CommandButtons\\BTNChaosWarlord.blp"
 call RegisterVictoryAnimation(HeroID[108],"stand victory")
 call RegisterHeroScale(HeroID[108],1.05,DummyID[108])
 set HeroTips_1[i]="Chaos Bolt and Blink Strike are active abilities that are more useful in the lane and for killing opponents than Critical Strike."
 set HeroTips_2[i]="Chaos Bolt is a disable that switches between average and extremely powerful, the sooner you have max out this spell, the better."
 set HeroTips_3[i]="His high natural movement speed (325 - the highest in the game) and Blink Strike make him very difficult for opponents to outrun or chase him."
 set HeroTips_4[i]="If you Blink Strike and then use Chaos Bolt, you can spend more time hitting opponents and less time waiting for his slow casting animation. "
 set HeroTips_5[i]="Make Nessaj and Phantasm stronger by buying Strength items like Armlet of Mordiggan (when activated) and Heart of Tarrasque."
 set i=i+1
-set ScourgeMax=108
+set HeroID[109]=1311788343
+set DummyID[109]=1747993687
+set HeroName[109]=1848659256
+set HeroIcon[109]="ReplaceableTextures\\CommandButtons\\BTNFrostWyrm.blp"
+call RegisterVictoryAnimation(HeroID[109],"stand victory")
+call RegisterHeroScale(HeroID[109],0.9,DummyID[109])
+set HeroTips_1[i]=""
+set HeroTips_2[i]=""
+set HeroTips_3[i]=""
+set HeroTips_4[i]=""
+set HeroTips_5[i]=""
+set i=i+1
+set HeroID[110]=1311788363
+set DummyID[110]=1747993926
+set HeroName[110]=1848659276
+set HeroIcon[110]="ReplaceableTextures\\CommandButtons\\BTNGnollWarden.blp"
+call RegisterVictoryAnimation(HeroID[110],"stand victory")
+call RegisterHeroScale(HeroID[110],1.1,DummyID[110])
+set HeroTips_1[i]=""
+set HeroTips_2[i]=""
+set HeroTips_3[i]=""
+set HeroTips_4[i]=""
+set HeroTips_5[i]=""
+set i=i+1
+set ScourgeMax=110
 set AgilityHero[1]=1315074670
 set AgilityHero[2]=1164207469
 set AgilityHero[3]=1311781174
 set AgilityHero[4]=1315070563
 set AgilityHero[5]=1315007329
 set AgilityHero[6]=1328558160
 set AgilityHero[7]=1433631084
 set AgilityHero[8]=1160785973
 set AgilityHero[9]=1311781199
 set AgilityHero[10]=1212365106
 set AgilityHero[11]=1215723364
 set AgilityHero[12]=1212363833
 set AgilityHero[13]=1215657064
 set AgilityHero[14]=1332179560
 set AgilityHero[15]=1429221430
@@ -12843,31 +13187,32 @@
 set AgilityHero[20]=1162032951
 set AgilityHero[21]=1215722344
 set AgilityHero[22]=1315334514
 set AgilityHero[23]=1160785970
 set AgilityHero[24]=1162032181
 set AgilityHero[25]=1165451634
 set AgilityHero[26]=1429221424
 set AgilityHero[27]=1211117654
 set AgilityHero[28]=1160786242
 set AgilityHero[29]=1311781206
 set AgilityHero[30]=1211117641
 set AgilityHero[31]=1160786265
 set AgilityHero[32]=1211119409
 set AgilityHero[33]=1160786510
 set AgilityHero[34]=1311788336
-set AgilityHeroCount=34
+set AgilityHero[35]=1311788363
+set AgilityHeroCount=35
 set StrengthHero[1]=1315988077
 set StrengthHero[2]=1215063922
 set StrengthHero[3]=1214345830
 set StrengthHero[4]=1211117616
 set StrengthHero[5]=1211117617
 set StrengthHero[6]=1214344551
 set StrengthHero[7]=1211117624
 set StrengthHero[8]=1432580716
 set StrengthHero[9]=1333027688
 set StrengthHero[10]=1313026096
 set StrengthHero[11]=1432646245
 set StrengthHero[12]=1430466865
 set StrengthHero[13]=1332109682
 set StrengthHero[14]=1429221446
 set StrengthHero[15]=1429221451
@@ -12919,31 +13264,32 @@
 set IntelligenceHero[24]=1429221456
 set IntelligenceHero[25]=1160786000
 set IntelligenceHero[26]=1160786243
 set IntelligenceHero[27]=1311781207
 set IntelligenceHero[28]=1211117646
 set IntelligenceHero[29]=1311786311
 set IntelligenceHero[30]=1211117651
 set IntelligenceHero[31]=1311780930
 set IntelligenceHero[32]=1211117653
 set IntelligenceHero[33]=1328558390
 set IntelligenceHero[34]=HeroID[97]
 set IntelligenceHero[35]=1160786504
 set IntelligenceHero[36]=1160786506
 set IntelligenceHero[37]=1160786520
 set IntelligenceHero[38]=1211122767
-set IntelligenceHeroCount=38
+set IntelligenceHero[39]=1311788343
+set IntelligenceHeroCount=39
 set RangeHero[1]=1332898670
 set RangeHero[2]=1164799855
 set RangeHero[3]=1164799603
 set RangeHero[4]=1211117620
 set RangeHero[5]=1214931305
 set RangeHero[6]=1433105516
 set RangeHero[7]=1215128178
 set RangeHero[8]=1211117643
 set RangeHero[9]=1316252014
 set RangeHero[10]=1315074670
 set RangeHero[11]=1214409837
 set RangeHero[12]=1311781185
 set RangeHero[13]=1211117633
 set RangeHero[14]=1433168227
 set RangeHero[15]=1164666213
@@ -12976,31 +13322,33 @@
 set RangeHero[42]=1162032951
 set RangeHero[43]=1315334514
 set RangeHero[44]=1160785970
 set RangeHero[45]=1211117654
 set RangeHero[46]=1311781206
 set RangeHero[47]=1211117649
 set RangeHero[48]=1328558390
 set RangeHero[49]=HeroID[97]
 set RangeHero[50]=1328558406
 set RangeHero[51]=1160786504
 set RangeHero[52]=1160786510
 set RangeHero[53]=1160786506
 set RangeHero[54]=1160786502
 set RangeHero[55]=1160786520
 set RangeHero[56]=1211122767
-set RangeHeroCount=56
+set RangeHero[57]=1311788363
+set RangeHero[58]=1311788343
+set RangeHeroCount=58
 set MeleeHero[1]=1215130471
 set MeleeHero[2]=1211117646
 set MeleeHero[3]=1164207469
 set MeleeHero[4]=1315070563
 set MeleeHero[5]=1315007329
 set MeleeHero[6]=1212363833
 set MeleeHero[7]=1215657064
 set MeleeHero[8]=1332179560
 set MeleeHero[9]=1429221430
 set MeleeHero[10]=1164277353
 set MeleeHero[11]=1215722344
 set MeleeHero[12]=1162032181
 set MeleeHero[13]=1165451634
 set MeleeHero[14]=1429221424
 set MeleeHero[15]=1160786242
@@ -13122,30 +13470,33 @@
 call SetUnitColor(IntTavern3,ConvertPlayerColor(9))
 call SetUnitColor(IntTavern4,ConvertPlayerColor(9))
 call SetUnitColor(AgiTavern1,ConvertPlayerColor(6))
 call SetUnitColor(AgiTavern2,ConvertPlayerColor(6))
 call SetUnitColor(AgiTavern3,ConvertPlayerColor(10))
 call SetUnitColor(AgiTavern4,ConvertPlayerColor(10))
 call SetUnitColor(StrTavern1,ConvertPlayerColor(0))
 call SetUnitColor(StrTavern2,ConvertPlayerColor(0))
 call SetUnitColor(StrTavern3,ConvertPlayerColor(11))
 call SetUnitColor(StrTavern4,ConvertPlayerColor(11))
 set t=null
 endfunction
 function InitTrig_Tavern takes nothing returns nothing
 call Tavern_Initialize()
 endfunction
+function IsGlobalHeroDummy takes integer id returns boolean
+return id==1211117642 or id==1311788365
+endfunction
 function IsItemAbility takes integer id returns boolean
 local integer i=0
 loop
 exitwhen i>ItemAbilities_Max
 if ItemAbilities[i]==id then
 return true
 endif
 set i=i+1
 endloop
 return false
 endfunction
 function ItemAbilities_Init takes nothing returns nothing
 set ItemAbilities_Max=ItemAbilities_Max+1
 set ItemAbilities[ItemAbilities_Max]=1093753431
 set ItemAbilities_Max=ItemAbilities_Max+1
@@ -13282,31 +13633,31 @@
 set ItemAbilities[ItemAbilities_Max]=1095332727
 set ItemAbilities_Max=ItemAbilities_Max+1
 set ItemAbilities[ItemAbilities_Max]=1093808182
 set ItemAbilities_Max=ItemAbilities_Max+1
 set ItemAbilities[ItemAbilities_Max]=1093753416
 set ItemAbilities_Max=ItemAbilities_Max+1
 set ItemAbilities[ItemAbilities_Max]=1093813569
 set ItemAbilities_Max=ItemAbilities_Max+1
 set ItemAbilities[ItemAbilities_Max]=1093815092
 set ItemAbilities_Max=ItemAbilities_Max+1
 set ItemAbilities[ItemAbilities_Max]=1093815095
 set ItemAbilities_Max=ItemAbilities_Max+1
 set ItemAbilities[ItemAbilities_Max]=1093815089
 endfunction
 function IsGlobalSpellIgnore takes integer id returns boolean
-return id==abilityid_pulsenova or id==abilityid_pulsenovaupgraded or id==abilityid_pulsenova_disabled or id==abilityid_shadowpoison_explode or id==abilityid_oscillation_in or id==abilityid_oscillation_out or id==abilityid_shadowpoison_explode or id==1093678667 or id==1093752391 or id==abilityid_overcharge or id==1093752646 or id==1093686328 or id==1093686327 or id==abilityid_dash_helper or id==abilityid_firespirits_helper or id==abilityid_sunray_off or id==abilityid_sunray_movement or id==1093743681 or id==1093809721 or id==1093815111 or id==1093808458 or id==1093810008 or id==1093810265 or id==1093809221 or id==1093753416 or id==1093752655 or id==1093748305 or id==1093686341 or id==1093814863 or id==1093813848 or id==1093684560 or id==1093815109 or id==1093815112 or id==1093815097 or id==1093814860
+return id==abilityid_pulsenova or id==abilityid_pulsenovaupgraded or id==abilityid_pulsenova_disabled or id==abilityid_shadowpoison_explode or id==abilityid_oscillation_in or id==abilityid_oscillation_out or id==abilityid_shadowpoison_explode or id==1093678667 or id==1093752391 or id==abilityid_overcharge or id==1093752646 or id==1093686328 or id==1093686327 or id==abilityid_dash_helper or id==abilityid_firespirits_helper or id==abilityid_sunray_off or id==abilityid_sunray_movement or id==1093743681 or id==1093809721 or id==1093815111 or id==abilityid_ancestralcharge_end or id==1093810008 or id==1093810265 or id==1093809221 or id==1093753416 or id==1093752655 or id==1093748305 or id==1093686341 or id==1093814863 or id==1093813848 or id==1093684560 or id==1093815109 or id==1093815112 or id==1093815097 or id==1093814860 or id==1093815857 or id==1093815618 or id==abilityid_trueshotaura or id==abilityid_nightmare_helper
 endfunction
 function MiscInit2 takes nothing returns nothing
 set AbusableSpells_Max=AbusableSpells_Max+1
 set AbusableSpells[AbusableSpells_Max]=1093683254
 set AbusableSpells_Max=AbusableSpells_Max+1
 set AbusableSpells[AbusableSpells_Max]=1093677362
 set AbusableSpells_Max=AbusableSpells_Max+1
 set AbusableSpells[AbusableSpells_Max]=1093678667
 set AbusableSpells_Max=AbusableSpells_Max+1
 set AbusableSpells[AbusableSpells_Max]=1093683513
 set AbusableSpells_Max=AbusableSpells_Max+1
 set AbusableSpells[AbusableSpells_Max]=1093683265
 set AbusableSpells_Max=AbusableSpells_Max+1
 set AbusableSpells[AbusableSpells_Max]=1093684021
 set AbusableSpells_Max=AbusableSpells_Max+1
@@ -13401,59 +13752,60 @@
 set udg_NotSpells[55]=1093684560
 set udg_NotSpells[56]=abilityid_xmarksthespot_helper
 set udg_NotSpells[57]=abilityid_magicstick
 set udg_NotSpells[58]=abilityid_blademail
 set udg_NotSpells[59]=1093748303
 set udg_NotSpells[60]=1093748292
 set udg_NotSpells[61]=1093750618
 set udg_NotSpells[62]=1093750095
 set udg_NotSpells[63]=1093749071
 set udg_NotSpells[64]=1093751096
 set udg_NotSpells[65]=1093751361
 set udg_NotSpells[66]=1093751126
 set udg_NotSpells[67]=1093752645
 set udg_NotSpells[68]=1093752642
 set udg_NotSpells[69]=1093815111
-set udg_NotSpellsMax=68
+set udg_NotSpells[70]=1093815859
+set udg_NotSpellsMax=70
 endfunction
 function RegisterMiscShit takes nothing returns boolean
 call MiscInit()
 call MiscInit2()
 call ItemAbilities_Init()
 return false
 endfunction
 function InitTrig_Misc takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterTimerEvent(t,0.01,false)
 call TriggerAddCondition(t,Condition(function RegisterMiscShit))
 endfunction
 function Trig_Map_Info_Actions takes nothing returns nothing
 call CreateQuestBJ(bj_QUESTTYPE_REQ_DISCOVERED,"TRIGSTR_50004","TRIGSTR_50005","ReplaceableTextures\\CommandButtons\\BTNSpy.blp")
 call CreateQuestBJ(bj_QUESTTYPE_REQ_DISCOVERED,"TRIGSTR_50006","TRIGSTR_50007","ReplaceableTextures\\CommandButtons\\BTNTome.blp")
 call CreateQuestBJ(bj_QUESTTYPE_REQ_DISCOVERED,"TRIGSTR_50008","TRIGSTR_50009","ReplaceableTextures\\CommandButtons\\BTNAmbush.blp")
 call CreateQuestBJ(bj_QUESTTYPE_OPT_DISCOVERED,"TRIGSTR_50010","TRIGSTR_50011","ReplaceableTextures\\CommandButtons\\BTNScrollOfHaste.blp")
 call CreateQuestBJ(bj_QUESTTYPE_OPT_DISCOVERED,"TRIGSTR_50012","TRIGSTR_50013","ReplaceableTextures\\CommandButtons\\BTNBansheeMaster.blp")
 call CreateQuestBJ(bj_QUESTTYPE_OPT_DISCOVERED,"TRIGSTR_50014","TRIGSTR_50015","ReplaceableTextures\\CommandButtons\\BTNCarrionScarabs.blp")
 endfunction
 function InitTrig_Map_Info takes nothing returns nothing
 set gg_trg_Map_Info=CreateTrigger()
 call TriggerRegisterTimerEventSingle(gg_trg_Map_Info,0.01)
 call TriggerAddAction(gg_trg_Map_Info,function Trig_Map_Info_Actions)
 endfunction
 function ObserverMode_Learned takes nothing returns boolean
 local string s
-if IsUnitIllusion(GetTriggerUnit())==false and GetUnitTypeId(GetTriggerUnit())!=1211117642 then
+if IsUnitIllusion(GetTriggerUnit())==false and IsGlobalHeroDummy(GetUnitTypeId(GetTriggerUnit()))==false then
 set s=GetUnitName(GetTriggerUnit())+" "+GetObjectName(MSG_OBS_LEARNED)+" "+GetAbilityName(GetLearnedSkill())+" ("+GetObjectName(MSG_OBS_LEARNED_LEVEL)+" "+I2S(GetUnitAbilityLevel(GetTriggerUnit(),GetLearnedSkill()))+")"
 call DisplayTimedTextToPlayer(udg_Observer1,0,0,3,s)
 call DisplayTimedTextToPlayer(udg_Observer2,0,0,3,s)
 endif
 return false
 endfunction
 function ObserverMode_Register takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function ObserverMode_Learned))
 set t=null
 endfunction
 function Leave_Observer takes nothing returns nothing
 call DisplayTimedTextToForceEx(GetPlayersAll(),25.00,(PlayerNames[GetPlayerId((GetTriggerPlayer()))])+"|c00ff0303 "+GetObjectName(MSG_PLAYER_LEFT)+"|r")
 endfunction
@@ -13917,50 +14269,52 @@
 function InitializeHero takes unit Hero returns nothing
 local integer PointValue=GetUnitPointValue(Hero)
 local unit TempUnit
 if(PointValue==34)then
 call ExecuteFunc("Register_ManaVoid")
 call ExecuteFunc("Register_Blink_AM")
 call ExecuteFunc("Register_ManaBreak")
 elseif(PointValue==37)then
 call ExecuteFunc("Register_PrimalRoar")
 call ExecuteFunc("RegisterWildAxes")
 call ExecuteFunc("RegisterCall_of_the_Wild")
 call ExecuteFunc("Register_HawkInvis")
 elseif(PointValue==38)then
 call ExecuteFunc("Register_DualBreath")
 call ExecuteFunc("Register_LiquidFire")
-call ExecuteFunc("RegisterIce_Path")
+call ExecuteFunc("Register_IcePath")
 call ExecuteFunc("Register_Macropyre")
 elseif(PointValue==32)then
 call ExecuteFunc("Register_Track")
 call ExecuteFunc("Register_Jinada")
 call ExecuteFunc("Register_Windwalk")
 elseif(PointValue==52)then
 call ExecuteFunc("RegisterWarpath")
 call ExecuteFunc("Goo")
 call ExecuteFunc("RegisterBristleback")
 call ExecuteFunc("RegisterQuillSpray")
 elseif(PointValue==31)then
 call ExecuteFunc("Register_DoubleEdge")
 call ExecuteFunc("Return")
+call ExecuteFunc("Register_Stampede")
 elseif(PointValue==24)then
 call ExecuteFunc("Register_Penitence")
 call ExecuteFunc("HandOfGod")
 call ExecuteFunc("Persuasion")
 call ExecuteFunc("TestOfFaith")
 elseif(PointValue==5)then
+call ExecuteFunc("Register_BrillianceAura")
 call ExecuteFunc("Register_CrystalNova")
 call ExecuteFunc("Register_FreezingField")
 elseif(PointValue==8)then
 call ExecuteFunc("Register_EchoSlam")
 call ExecuteFunc("Register_Fissure")
 call ExecuteFunc("Register_Aftershock")
 call ExecuteFunc("TotemDD")
 call ExecuteFunc("Totem")
 elseif(PointValue==3)then
 call ExecuteFunc("Register_Enchant")
 call ExecuteFunc("Register_NaturesAttendants")
 call ExecuteFunc("RegisterImpetus")
 call ExecuteFunc("RegisterUntouchable")
 elseif(PointValue==95)then
 call ExecuteFunc("Register_BlackHole")
@@ -14124,31 +14478,31 @@
 elseif(PointValue==102)then
 call ExecuteFunc("Register_ChainFrost")
 elseif(PointValue==64)then
 call ExecuteFunc("Register_LevelDeath")
 call ExecuteFunc("Register_Devour")
 call ExecuteFunc("Register_ScorchedEarth")
 elseif(PointValue==106)then
 call ExecuteFunc("Register_ReversePolarity")
 call ExecuteFunc("Register_Empower")
 call ExecuteFunc("Register_Skewer")
 elseif(PointValue==61)then
 call ExecuteFunc("Register_Splitshot")
 call ExecuteFunc("Register_MysticSnake")
 call ExecuteFunc("Register_StoneGaze")
 elseif(PointValue==76)then
-call ExecuteFunc("Sadist")
+call ExecuteFunc("Register_Sadist")
 call ExecuteFunc("Register_DeathPulse")
 call ExecuteFunc("Register_ReapersScythe")
 call ExecuteFunc("Register_Heartstopper")
 elseif(PointValue==80)then
 call ExecuteFunc("RegisterNecromastry")
 call ExecuteFunc("RegisterShadowraze")
 call ExecuteFunc("Requiem")
 call ExecuteFunc("RequiemEffect")
 call ExecuteFunc("NL")
 elseif(PointValue==62)then
 call ExecuteFunc("Hunter")
 call ExecuteFunc("NSVoid")
 call ExecuteFunc("Register_Fear")
 elseif(PointValue==60)then
 call ExecuteFunc("Register_Blur")
@@ -14261,30 +14615,32 @@
 call ExecuteFunc("Register_IonShell")
 call ExecuteFunc("Register_Surge")
 call ExecuteFunc("Register_WallOfReplica")
 elseif PointValue==42 then
 call ExecuteFunc("Register_InnerVitality")
 call ExecuteFunc("Register_BurningSpear")
 call ExecuteFunc("Register_BerserkersBlood")
 call ExecuteFunc("Register_SoulEater")
 elseif PointValue==91 then
 call ExecuteFunc("Register_Portal")
 call ExecuteFunc("Register_Expulsion")
 call ExecuteFunc("Register_Cage")
 call ExecuteFunc("Register_Firestorm")
 call ExecuteFunc("Register_DemonicClutch")
 call ExecuteFunc("Register_CorpseCollector")
+call ExecuteFunc("Register_SummonShade")
+call ExecuteFunc("Register_DiffusionAura")
 elseif PointValue==92 then
 call ExecuteFunc("Register_Decay")
 call ExecuteFunc("Register_Tombstone")
 call ExecuteFunc("Register_SoulRip")
 call ExecuteFunc("Register_FleshGolem")
 elseif PointValue==41 then
 call ExecuteFunc("Register_StaticRemnant")
 call ExecuteFunc("Register_ElectricVortex")
 call ExecuteFunc("Register_Overload")
 call ExecuteFunc("Register_BallLightning")
 call ExecuteFunc("Register_StormDies")
 elseif PointValue==43 then
 call ExecuteFunc("Register_Insta")
 call ExecuteFunc("Register_Refraction")
 call ExecuteFunc("Register_VorpalBlade")
@@ -14354,30 +14710,31 @@
 call ExecuteFunc("Register_IceBlast")
 call ExecuteFunc("Register_Gust")
 call ExecuteFunc("Register_ChillingTouch")
 elseif PointValue==98 then
 call ExecuteFunc("Register_EssenceShift")
 call ExecuteFunc("Register_ShadowDance")
 call ExecuteFunc("Register_Nightcrawler")
 call ExecuteFunc("Register_DarkPact")
 call ExecuteFunc("Register_Pounce")
 elseif PointValue==67 then
 call ExecuteFunc("Register_Scream")
 elseif PointValue==28 then
 call ExecuteFunc("Register_Shackle")
 elseif PointValue==51 then
 call ExecuteFunc("Register_Dash")
+call ExecuteFunc("Register_Overheat")
 call ExecuteFunc("Register_PhoenixTears")
 call ExecuteFunc("Register_Firespirits")
 call ExecuteFunc("Register_Sunray")
 call ExecuteFunc("Register_SweepingFlame")
 call ExecuteFunc("Register_Supernova")
 elseif PointValue==100 then
 elseif PointValue==101 then
 call ExecuteFunc("Register_ShadowPoison")
 call ExecuteFunc("Register_Disruption")
 call ExecuteFunc("Register_SoulCatcher")
 call ExecuteFunc("Register_DemonicPurge")
 elseif PointValue==48 then
 call ExecuteFunc("Register_RocketBarrage")
 call ExecuteFunc("Register_SeekingMissle")
 call ExecuteFunc("Register_CallDown")
@@ -14415,51 +14772,67 @@
 elseif PointValue==55 then
 call ExecuteFunc("Register_PressTheAttack")
 call ExecuteFunc("Register_MomentOfCourage")
 call ExecuteFunc("Register_Cleanse")
 call ExecuteFunc("Register_Duel")
 elseif PointValue==56 then
 call ExecuteFunc("Register_ConcussiveShot")
 call ExecuteFunc("Register_Starbeam")
 call ExecuteFunc("Register_ArcaneBolt")
 call ExecuteFunc("Register_ArcaneSilence")
 elseif PointValue==57 then
 call ExecuteFunc("Register_WhirlingDeath")
 call ExecuteFunc("Register_TimberChain")
 call ExecuteFunc("Register_ReactiveArmor")
 call ExecuteFunc("Register_Chakram")
+elseif PointValue==109 then
+call ExecuteFunc("Register_Shield")
+call ExecuteFunc("Register_Curse")
+call ExecuteFunc("Register_Split")
+call ExecuteFunc("Register_Trap")
+call ExecuteFunc("Register_Touch")
+call ExecuteFunc("Register_ArcticSiege")
+elseif PointValue==110 then
+call ExecuteFunc("Register_LightningSeeker")
+call ExecuteFunc("Register_MagneticField")
+call ExecuteFunc("Register_NuralShock")
+call ExecuteFunc("Register_TempestDouble")
+call ExecuteFunc("Register_Blackjack")
+elseif PointValue==35 then
+call ExecuteFunc("Register_TrueshotAura")
+call ExecuteFunc("Register_Marksmanship")
 endif
 endfunction
 function AnnouncePlayerGotHero takes player whichPlayer,string message returns nothing
 if IsPlayerInForce(GetLocalPlayer(),GetPlayersEnemies(whichPlayer))then
 call DisplayTimedTextToPlayer(GetLocalPlayer(),0,udg_TextY,40,udg_Colors[GetPlayerId(whichPlayer)]+(PlayerNames[GetPlayerId((whichPlayer))])+"|r "+message)
 endif
 endfunction
 function Main_AllHasHero takes nothing returns boolean
 return udg_Hero[GetPlayerId(udg_SentPlayers[1])]!=null and udg_Hero[GetPlayerId(udg_SentPlayers[2])]!=null and udg_Hero[GetPlayerId(udg_SentPlayers[3])]!=null and udg_Hero[GetPlayerId(udg_SentPlayers[4])]!=null and udg_Hero[GetPlayerId(udg_SentPlayers[5])]!=null and udg_Hero[GetPlayerId(udg_ScourgePlayers[1])]!=null and udg_Hero[GetPlayerId(udg_ScourgePlayers[2])]!=null and udg_Hero[GetPlayerId(udg_ScourgePlayers[3])]!=null and udg_Hero[GetPlayerId(udg_ScourgePlayers[4])]!=null and udg_Hero[GetPlayerId(udg_ScourgePlayers[5])]!=null
 endfunction
 function Main_CreateFog takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 set Main_HasFogged=true
 call CleanTrigger(t)
 call DestroyFogModifier(CreateFogModifierRadius(udg_SentPlayers[0],FOG_OF_WAR_MASKED,CD_CENTERX,CD_CENTERY,700,false,false))
 call DestroyFogModifier(CreateFogModifierRadius(udg_ScourgePlayers[0],FOG_OF_WAR_MASKED,CD_CENTERX,CD_CENTERY,700,false,false))
 set t=null
 return false
 endfunction
 function IsRealHero2 takes unit u returns boolean
-return GetUnitTypeId(u)!=1211117645 and GetUnitTypeId(u)!=1211119431 and GetUnitTypeId(u)!=1211117657 and GetUnitTypeId(u)!=1211117642 and GetUnitTypeId(u)!=1211122232
+return GetUnitTypeId(u)!=1211117645 and GetUnitTypeId(u)!=unitid_tempestdouble and GetUnitTypeId(u)!=1211119431 and GetUnitTypeId(u)!=1211117657 and GetUnitTypeId(u)!=1211117642 and GetUnitTypeId(u)!=1211122232
 endfunction
 function HeroEnters_Conditions takes nothing returns boolean
 return IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetTriggerUnit())==false and HaveSavedBoolean(hash_main,GetHandleId(GetTriggerUnit()),85)==false and IsRealHero2(GetTriggerUnit())
 endfunction
 function ModeAP_FindSelectors takes nothing returns boolean
 return GetUnitTypeId(GetFilterUnit())==1848651843
 endfunction
 function ModeAP_RemoveSelectors takes nothing returns nothing
 call RemoveUnit(GetEnumUnit())
 endfunction
 function RemoveAPUnits takes player PlayerVar returns nothing
 local group GroupVar=GetAvailableGroup()
 local boolexpr CondVar=Condition(function ModeAP_FindSelectors)
 call GroupEnumUnitsOfPlayer(GroupVar,PlayerVar,CondVar)
 call ForGroup(GroupVar,function ModeAP_RemoveSelectors)
@@ -14555,36 +14928,40 @@
 endif
 else
 if IsUnitInRegion(r,UnitVar)then
 set x=GetRandomReal(GetRectMinX(gg_rct_Hero_Creation_UD),GetRectMaxX(gg_rct_Hero_Creation_UD))
 set y=GetRandomReal(GetRectMinY(gg_rct_Hero_Creation_UD),GetRectMaxY(gg_rct_Hero_Creation_UD))
 else
 set x=GetUnitX(UnitVar)
 set y=GetUnitY(UnitVar)
 endif
 endif
 set udg_HasHero[GetPlayerId(PlayerVar)]=true
 if(not udg_ModeRV or udg_ModeRVHelper)then
 if udg_ModeRD==false and udg_ModeCD==false then
 call PanCameraToTimedForPlayer(PlayerVar,x,y,0)
 endif
+if GetUnitTypeId(UnitVar)!=unitid_tempestdouble then
 call ClearSelectionForPlayer(PlayerVar)
+endif
 call SelectUnitAddForPlayer(UnitVar,PlayerVar)
 endif
 call SetUnitX(UnitVar,x)
 call SetUnitY(UnitVar,y)
+if GetUnitTypeId(UnitVar)!=unitid_tempestdouble then
 set udg_Hero[GetPlayerId(PlayerVar)]=UnitVar
+endif
 call Traffic_GenericData(PlayerVar,"9",GetUnitTypeId(UnitVar))
 if udg_ModeRV and udg_ModeRVHelper==false then
 call TechAllForPlayer(RVPlayer)
 else
 call TechAllForPlayer(PlayerVar)
 endif
 call SaveBoolean(hash_main,(GetHandleId(UnitVar)),(85),(true))
 if not udg_ModeDU then
 set udg_HeroFlags[GetUnitPointValue(UnitVar)]=true
 call TechHeroForAll(GetUnitTypeId(UnitVar))
 endif
 if udg_ModeDM then
 if IsSent(PlayerVar)then
 set udg_DMGiven[0]=udg_DMGiven[0]+1
 else
@@ -14597,48 +14974,50 @@
 call SetHeroXP(UnitVar,GetHeroXP(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))]),false)
 call UnitAddItem(UnitVar,UnitItemInSlot(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))],0))
 call UnitAddItem(UnitVar,UnitItemInSlot(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))],1))
 call UnitAddItem(UnitVar,UnitItemInSlot(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))],2))
 call UnitAddItem(UnitVar,UnitItemInSlot(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))],3))
 call UnitAddItem(UnitVar,UnitItemInSlot(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))],4))
 call UnitAddItem(UnitVar,UnitItemInSlot(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))],5))
 call EnableTrigger(t_manipulateitem)
 if HeroRevive_IsKobold(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))])then
 call RemoveKoboldHero(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))])
 else
 call RemoveHero(udg_PreviousHero[GetPlayerId(GetOwningPlayer(UnitVar))])
 endif
 endif
 endif
+if PlayerVar!=udg_SentPlayers[0]and PlayerVar!=udg_ScourgePlayers[0]then
 if udg_ModeRV then
 if TimerGetElapsed(udg_GameTimer)>60 then
 call AnnouncePlayerGotHero(PlayerVar,GetObjectName(MSG_AUTOMATICALLY_ASSIGNED)+" "+GetUnitName(UnitVar))
 elseif udg_RandomOnce[GetPlayerId(RVPlayer)]==true then
 call AnnouncePlayerGotHero(PlayerVar,GetString_GivenBy(UnitVar,RVPlayer))
 else
 call SetPlayerState(RVPlayer,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(RVPlayer,PLAYER_STATE_RESOURCE_GOLD)+250)
 call AnnouncePlayerGotHero(PlayerVar,GetObjectName(MSG_ANNOUNCE_HASGIVEN)+" "+GetUnitName(UnitVar)+" "+GetObjectName(MSG_ANNOUNCE_BY)+" "+(PlayerNames[GetPlayerId((RVPlayer))]))
 endif
 elseif udg_ModeSH==false or PlayerVar==udg_Host then
 if(udg_RepickOnce[GetPlayerId(GetOwningPlayer(UnitVar))]==true and udg_ModeSH==false)then
 call AnnouncePlayerGotHero(PlayerVar,GetObjectName(MSG_ANNOUNCE_HASREPICKED)+" "+GetUnitName(UnitVar)+".")
 elseif((udg_RandomOnce[GetPlayerId(PlayerVar)]==true and udg_ModeDM==false)or udg_ModeAR or udg_ModeTR or udg_ModeVR)then
 call AnnouncePlayerGotHero(PlayerVar,GetObjectName(MSG_ANNOUNCE_HASRANDOMED)+" "+GetUnitName(UnitVar)+".")
 else
 call AnnouncePlayerGotHero(PlayerVar,GetObjectName(MSG_ANNOUNCE_HASCHOSEN)+" "+GetUnitName(UnitVar)+".")
 endif
 endif
+endif
 if udg_OneHero then
 if udg_ModeRV then
 call RemoveAPUnits(RVPlayer)
 else
 call RemoveAPUnits(PlayerVar)
 endif
 endif
 if(udg_ModeRD or udg_ModeCD)and udg_OneHero then
 call RemoveAPUnits(PlayerVar)
 endif
 call ShowCOP(PlayerVar)
 if(GetUnitTypeId(UnitVar)==1160785973)then
 call DisplayTimedTextToPlayer(PlayerVar,0,udg_TextY,60.00," ")
 call DisplayTimedTextToPlayer(PlayerVar,0,udg_TextY,60.00,"|c00ff0303"+GetObjectName(MSG_LUNA1)+GetObjectName(MSG_LUNA1B)+" "+GetObjectName(MSG_LUNA2)+"|r")
 elseif GetUnitTypeId(UnitVar)==1328558154 or GetUnitTypeId(UnitVar)==1311781174 or GetUnitTypeId(UnitVar)==1430468913 or GetUnitTypeId(UnitVar)==1162032181 then
@@ -14739,84 +15118,84 @@
 endif
 return false
 endfunction
 function InitTrig_Cooldown_Tracker takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer i
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function CooldownTracker_Main))
 set i=0
 loop
 exitwhen(i>13)
 set CTimer[i]=CreateTimer()
 set i=i+1
 endloop
 set hash_abilities=InitHashtable()
-call SaveInteger(hash_abilities,(abilityid_ghostship),(1),(90))
-call SaveInteger(hash_abilities,(abilityid_ghostship),(2),(80))
-call SaveInteger(hash_abilities,(abilityid_ghostship),(3),(70))
+call SaveInteger(hash_abilities,(abilityid_ghostship),(1),(60))
+call SaveInteger(hash_abilities,(abilityid_ghostship),(2),(50))
+call SaveInteger(hash_abilities,(abilityid_ghostship),(3),(40))
 call SaveInteger(hash_abilities,(abilityid_primalroar),(1),(80))
 call SaveInteger(hash_abilities,(abilityid_primalroar),(2),(75))
 call SaveInteger(hash_abilities,(abilityid_primalroar),(3),(70))
 call SaveInteger(hash_abilities,(abilityid_primalroar_upgrade),(1),(45))
 call SaveInteger(hash_abilities,(abilityid_primalroar_upgrade),(2),(45))
 call SaveInteger(hash_abilities,(abilityid_primalroar_upgrade),(3),(45))
 call SaveInteger(hash_abilities,(abilityid_echoslam),(1),(150))
 call SaveInteger(hash_abilities,(abilityid_echoslam),(2),(130))
 call SaveInteger(hash_abilities,(abilityid_echoslam),(3),(110))
 call SaveInteger(hash_abilities,(1093750594),(1),(150))
 call SaveInteger(hash_abilities,(1093750594),(2),(130))
 call SaveInteger(hash_abilities,(1093750594),(3),(110))
 call SaveInteger(hash_abilities,(1093682514),(1),(150))
 call SaveInteger(hash_abilities,(1093682514),(2),(150))
 call SaveInteger(hash_abilities,(1093682514),(3),(150))
 call SaveInteger(hash_abilities,(1093684561),(1),(180))
 call SaveInteger(hash_abilities,(1093684561),(2),(160))
 call SaveInteger(hash_abilities,(1093684561),(3),(140))
 call SaveInteger(hash_abilities,(1093747254),(1),(160))
 call SaveInteger(hash_abilities,(1093747254),(2),(140))
 call SaveInteger(hash_abilities,(1093747254),(3),(120))
 call SaveInteger(hash_abilities,(abilityid_godstrength),(1),(80))
 call SaveInteger(hash_abilities,(abilityid_godstrength),(2),(80))
 call SaveInteger(hash_abilities,(abilityid_godstrength),(3),(80))
 call SaveInteger(hash_abilities,(abilityid_earthsplitter),(1),(100))
 call SaveInteger(hash_abilities,(abilityid_earthsplitter),(2),(100))
 call SaveInteger(hash_abilities,(abilityid_earthsplitter),(3),(100))
-call SaveInteger(hash_abilities,(abilityid_overgrowth),(1),(115))
-call SaveInteger(hash_abilities,(abilityid_overgrowth),(2),(105))
-call SaveInteger(hash_abilities,(abilityid_overgrowth),(3),(95))
+call SaveInteger(hash_abilities,(abilityid_overgrowth),(1),(70))
+call SaveInteger(hash_abilities,(abilityid_overgrowth),(2),(70))
+call SaveInteger(hash_abilities,(abilityid_overgrowth),(3),(70))
 call SaveInteger(hash_abilities,(1095656306),(1),(45))
 call SaveInteger(hash_abilities,(1095656306),(2),(45))
 call SaveInteger(hash_abilities,(1095656306),(3),(45))
 call SaveInteger(hash_abilities,(abilityid_hookshot),(1),(70))
 call SaveInteger(hash_abilities,(abilityid_hookshot),(2),(55))
 call SaveInteger(hash_abilities,(abilityid_hookshot),(3),(40))
-call SaveInteger(hash_abilities,(abilityid_hookshotupgrade),(1),(15))
-call SaveInteger(hash_abilities,(abilityid_hookshotupgrade),(2),(15))
-call SaveInteger(hash_abilities,(abilityid_hookshotupgrade),(3),(15))
+call SaveInteger(hash_abilities,(abilityid_hookshotupgrade),(1),(12))
+call SaveInteger(hash_abilities,(abilityid_hookshotupgrade),(2),(12))
+call SaveInteger(hash_abilities,(abilityid_hookshotupgrade),(3),(12))
 call SaveInteger(hash_abilities,(1093677895),(1),(115))
 call SaveInteger(hash_abilities,(1093677895),(2),(115))
 call SaveInteger(hash_abilities,(1093677895),(3),(115))
 call SaveInteger(hash_abilities,(abilityid_reversepolarity),(1),(120))
 call SaveInteger(hash_abilities,(abilityid_reversepolarity),(2),(110))
 call SaveInteger(hash_abilities,(abilityid_reversepolarity),(3),(100))
 call SaveInteger(hash_abilities,(abilityid_souleater),(1),(45))
 call SaveInteger(hash_abilities,(abilityid_souleater),(2),(30))
 call SaveInteger(hash_abilities,(abilityid_souleater),(3),(15))
-call SaveInteger(hash_abilities,(abilityid_souleaterupgrade),(1),(24))
-call SaveInteger(hash_abilities,(abilityid_souleaterupgrade),(2),(16))
-call SaveInteger(hash_abilities,(abilityid_souleaterupgrade),(3),(8))
+call SaveInteger(hash_abilities,(abilityid_souleaterupgrade),(1),(4))
+call SaveInteger(hash_abilities,(abilityid_souleaterupgrade),(2),(4))
+call SaveInteger(hash_abilities,(abilityid_souleaterupgrade),(3),(4))
 call SaveInteger(hash_abilities,(abilityid_epicenter),(1),(140))
 call SaveInteger(hash_abilities,(abilityid_epicenter),(2),(120))
 call SaveInteger(hash_abilities,(abilityid_epicenter),(3),(100))
 call SaveInteger(hash_abilities,(abilityid_epicenterupgrade),(1),(120))
 call SaveInteger(hash_abilities,(abilityid_epicenterupgrade),(2),(100))
 call SaveInteger(hash_abilities,(abilityid_epicenterupgrade),(3),(80))
 call SaveInteger(hash_abilities,(abilityid_netherstrike),(1),(75))
 call SaveInteger(hash_abilities,(abilityid_netherstrike),(2),(75))
 call SaveInteger(hash_abilities,(abilityid_netherstrike),(3),(75))
 call SaveInteger(hash_abilities,(abilityid_netherstrikeupgrade),(1),(20))
 call SaveInteger(hash_abilities,(abilityid_netherstrikeupgrade),(2),(20))
 call SaveInteger(hash_abilities,(abilityid_netherstrikeupgrade),(3),(20))
 call SaveInteger(hash_abilities,(abilityid_ravage),(1),(150))
 call SaveInteger(hash_abilities,(abilityid_ravage),(2),(150))
 call SaveInteger(hash_abilities,(abilityid_ravage),(3),(150))
@@ -14911,32 +15290,32 @@
 call SaveInteger(hash_abilities,(1093750089),(2),(45))
 call SaveInteger(hash_abilities,(1093750089),(3),(45))
 call SaveInteger(hash_abilities,(1093747023),(1),(80))
 call SaveInteger(hash_abilities,(1093747023),(2),(70))
 call SaveInteger(hash_abilities,(1093747023),(3),(60))
 call SaveInteger(hash_abilities,(1093752150),(1),(80))
 call SaveInteger(hash_abilities,(1093752150),(2),(70))
 call SaveInteger(hash_abilities,(1093752150),(3),(60))
 call SaveInteger(hash_abilities,(1093750341),(1),(180))
 call SaveInteger(hash_abilities,(1093750341),(2),(160))
 call SaveInteger(hash_abilities,(1093750341),(3),(140))
 call SaveInteger(hash_abilities,(1093814599),(1),(180))
 call SaveInteger(hash_abilities,(1093814599),(2),(160))
 call SaveInteger(hash_abilities,(1093814599),(3),(140))
 call SaveInteger(hash_abilities,(1093747028),(1),(140))
-call SaveInteger(hash_abilities,(1093747028),(2),(110))
-call SaveInteger(hash_abilities,(1093747028),(3),(80))
+call SaveInteger(hash_abilities,(1093747028),(2),(100))
+call SaveInteger(hash_abilities,(1093747028),(3),(60))
 call SaveInteger(hash_abilities,(1093685840),(1),(11))
 call SaveInteger(hash_abilities,(1093685840),(2),(9))
 call SaveInteger(hash_abilities,(1093685840),(3),(7))
 call SaveInteger(hash_abilities,(1093684291),(1),(25))
 call SaveInteger(hash_abilities,(1093684291),(2),(25))
 call SaveInteger(hash_abilities,(1093684291),(3),(25))
 call SaveInteger(hash_abilities,(1093683534),(1),(45))
 call SaveInteger(hash_abilities,(1093683534),(2),(45))
 call SaveInteger(hash_abilities,(1093683534),(3),(45))
 call SaveInteger(hash_abilities,(1093747031),(1),(10))
 call SaveInteger(hash_abilities,(1093747031),(2),(10))
 call SaveInteger(hash_abilities,(1093747031),(3),(10))
 call SaveInteger(hash_abilities,(1093684296),(1),(70))
 call SaveInteger(hash_abilities,(1093684296),(2),(60))
 call SaveInteger(hash_abilities,(1093684296),(3),(50))
@@ -14970,60 +15349,60 @@
 call SaveInteger(hash_abilities,(1093679152),(1),(80))
 call SaveInteger(hash_abilities,(1093679152),(2),(50))
 call SaveInteger(hash_abilities,(1093679152),(3),(30))
 call SaveInteger(hash_abilities,(1093677906),(1),(150))
 call SaveInteger(hash_abilities,(1093677906),(2),(120))
 call SaveInteger(hash_abilities,(1093677906),(3),(90))
 call SaveInteger(hash_abilities,(1093681494),(1),(150))
 call SaveInteger(hash_abilities,(1093681494),(2),(120))
 call SaveInteger(hash_abilities,(1093681494),(3),(90))
 call SaveInteger(hash_abilities,(1093686072),(1),(85))
 call SaveInteger(hash_abilities,(1093686072),(2),(85))
 call SaveInteger(hash_abilities,(1093686072),(3),(85))
 call SaveInteger(hash_abilities,(1093751120),(1),(85))
 call SaveInteger(hash_abilities,(1093751120),(2),(85))
 call SaveInteger(hash_abilities,(1093751120),(3),(85))
-call SaveInteger(hash_abilities,(1093684308),(1),(120))
-call SaveInteger(hash_abilities,(1093684308),(2),(120))
+call SaveInteger(hash_abilities,(1093684308),(1),(140))
+call SaveInteger(hash_abilities,(1093684308),(2),(130))
 call SaveInteger(hash_abilities,(1093684308),(3),(120))
 call SaveInteger(hash_abilities,(1093747539),(1),(30))
 call SaveInteger(hash_abilities,(1093747539),(2),(30))
 call SaveInteger(hash_abilities,(1093747539),(3),(30))
 call SaveInteger(hash_abilities,(1093742932),(1),(80))
 call SaveInteger(hash_abilities,(1093742932),(2),(70))
 call SaveInteger(hash_abilities,(1093742932),(3),(60))
 call SaveInteger(hash_abilities,(1093752632),(1),(90))
 call SaveInteger(hash_abilities,(1093752632),(2),(75))
 call SaveInteger(hash_abilities,(1093752632),(3),(60))
 call SaveInteger(hash_abilities,(1093752633),(1),(90))
 call SaveInteger(hash_abilities,(1093752633),(2),(75))
 call SaveInteger(hash_abilities,(1093752633),(3),(60))
-call SaveInteger(hash_abilities,(1093810503),(1),(120))
-call SaveInteger(hash_abilities,(1093810503),(2),(120))
-call SaveInteger(hash_abilities,(1093810503),(3),(120))
-call SaveInteger(hash_abilities,(1093810504),(1),(120))
-call SaveInteger(hash_abilities,(1093810504),(2),(120))
-call SaveInteger(hash_abilities,(1093810504),(3),(120))
-call SaveInteger(hash_abilities,(1093684275),(1),(160))
-call SaveInteger(hash_abilities,(1093684275),(2),(160))
-call SaveInteger(hash_abilities,(1093684275),(3),(160))
-call SaveInteger(hash_abilities,(1093677392),(1),(120))
-call SaveInteger(hash_abilities,(1093677392),(2),(90))
-call SaveInteger(hash_abilities,(1093677392),(3),(55))
-call SaveInteger(hash_abilities,(1093679450),(1),(120))
-call SaveInteger(hash_abilities,(1093679450),(2),(90))
-call SaveInteger(hash_abilities,(1093679450),(3),(55))
+call SaveInteger(hash_abilities,(1093810503),(1),(90))
+call SaveInteger(hash_abilities,(1093810503),(2),(90))
+call SaveInteger(hash_abilities,(1093810503),(3),(90))
+call SaveInteger(hash_abilities,(1093810504),(1),(90))
+call SaveInteger(hash_abilities,(1093810504),(2),(90))
+call SaveInteger(hash_abilities,(1093810504),(3),(90))
+call SaveInteger(hash_abilities,(1093684275),(1),(140))
+call SaveInteger(hash_abilities,(1093684275),(2),(140))
+call SaveInteger(hash_abilities,(1093684275),(3),(140))
+call SaveInteger(hash_abilities,(1093677392),(1),(70))
+call SaveInteger(hash_abilities,(1093677392),(2),(60))
+call SaveInteger(hash_abilities,(1093677392),(3),(50))
+call SaveInteger(hash_abilities,(1093679450),(1),(70))
+call SaveInteger(hash_abilities,(1093679450),(2),(60))
+call SaveInteger(hash_abilities,(1093679450),(3),(50))
 call SaveInteger(hash_abilities,(1093743184),(1),(60))
 call SaveInteger(hash_abilities,(1093743184),(2),(60))
 call SaveInteger(hash_abilities,(1093743184),(3),(60))
 call SaveInteger(hash_abilities,(1093747766),(1),(15))
 call SaveInteger(hash_abilities,(1093747766),(2),(15))
 call SaveInteger(hash_abilities,(1093747766),(3),(15))
 call SaveInteger(hash_abilities,(1093744975),(1),(90))
 call SaveInteger(hash_abilities,(1093744975),(2),(70))
 call SaveInteger(hash_abilities,(1093744975),(3),(50))
 call SaveInteger(hash_abilities,(1093681483),(1),(10))
 call SaveInteger(hash_abilities,(1093681483),(2),(10))
 call SaveInteger(hash_abilities,(1093681483),(3),(10))
 call SaveInteger(hash_abilities,(1093748313),(1),(10))
 call SaveInteger(hash_abilities,(1093748313),(2),(10))
 call SaveInteger(hash_abilities,(1093748313),(3),(10))
@@ -15044,66 +15423,66 @@
 call SaveInteger(hash_abilities,(1093747778),(1),(40))
 call SaveInteger(hash_abilities,(1093747778),(2),(40))
 call SaveInteger(hash_abilities,(1093747778),(3),(40))
 call SaveInteger(hash_abilities,(1093677128),(1),(110))
 call SaveInteger(hash_abilities,(1093677128),(2),(110))
 call SaveInteger(hash_abilities,(1093677128),(3),(110))
 call SaveInteger(hash_abilities,(1093681457),(1),(110))
 call SaveInteger(hash_abilities,(1093681457),(2),(110))
 call SaveInteger(hash_abilities,(1093681457),(3),(110))
 call SaveInteger(hash_abilities,(1093685045),(1),(60))
 call SaveInteger(hash_abilities,(1093685045),(2),(60))
 call SaveInteger(hash_abilities,(1093685045),(3),(60))
 call SaveInteger(hash_abilities,(1093747249),(1),(60))
 call SaveInteger(hash_abilities,(1093747249),(2),(60))
 call SaveInteger(hash_abilities,(1093747249),(3),(60))
-call SaveInteger(hash_abilities,(1093684820),(1),(90))
-call SaveInteger(hash_abilities,(1093684820),(2),(90))
-call SaveInteger(hash_abilities,(1093684820),(3),(90))
-call SaveInteger(hash_abilities,(1093684824),(1),(90))
-call SaveInteger(hash_abilities,(1093684824),(2),(90))
-call SaveInteger(hash_abilities,(1093684824),(3),(90))
+call SaveInteger(hash_abilities,(1093684820),(1),(80))
+call SaveInteger(hash_abilities,(1093684820),(2),(80))
+call SaveInteger(hash_abilities,(1093684820),(3),(80))
+call SaveInteger(hash_abilities,(1093684824),(1),(80))
+call SaveInteger(hash_abilities,(1093684824),(2),(80))
+call SaveInteger(hash_abilities,(1093684824),(3),(80))
 call SaveInteger(hash_abilities,(1093677649),(1),(100))
 call SaveInteger(hash_abilities,(1093677649),(2),(100))
 call SaveInteger(hash_abilities,(1093677649),(3),(100))
 call SaveInteger(hash_abilities,(1093747769),(1),(100))
 call SaveInteger(hash_abilities,(1093747769),(2),(100))
 call SaveInteger(hash_abilities,(1093747769),(3),(100))
 call SaveInteger(hash_abilities,(1093685579),(1),(100))
 call SaveInteger(hash_abilities,(1093685579),(2),(100))
 call SaveInteger(hash_abilities,(1093685579),(3),(100))
 call SaveInteger(hash_abilities,(1093678899),(1),(100))
 call SaveInteger(hash_abilities,(1093678899),(2),(100))
 call SaveInteger(hash_abilities,(1093678899),(3),(100))
 call SaveInteger(hash_abilities,(1093677898),(1),(100))
 call SaveInteger(hash_abilities,(1093677898),(2),(100))
 call SaveInteger(hash_abilities,(1093677898),(3),(100))
 call SaveInteger(hash_abilities,(1093678154),(1),(100))
 call SaveInteger(hash_abilities,(1093678154),(2),(100))
 call SaveInteger(hash_abilities,(1093678154),(3),(100))
 call SaveInteger(hash_abilities,(1093678157),(1),(100))
 call SaveInteger(hash_abilities,(1093678157),(2),(100))
 call SaveInteger(hash_abilities,(1093678157),(3),(100))
 call SaveInteger(hash_abilities,(1093678158),(1),(100))
 call SaveInteger(hash_abilities,(1093678158),(2),(100))
 call SaveInteger(hash_abilities,(1093678158),(3),(100))
-call SaveInteger(hash_abilities,(1093679413),(1),(150))
-call SaveInteger(hash_abilities,(1093679413),(2),(90))
-call SaveInteger(hash_abilities,(1093679413),(3),(55))
-call SaveInteger(hash_abilities,(1093679447),(1),(150))
-call SaveInteger(hash_abilities,(1093679447),(2),(90))
-call SaveInteger(hash_abilities,(1093679447),(3),(50))
+call SaveInteger(hash_abilities,(1093679413),(1),(160))
+call SaveInteger(hash_abilities,(1093679413),(2),(100))
+call SaveInteger(hash_abilities,(1093679413),(3),(40))
+call SaveInteger(hash_abilities,(1093679447),(1),(160))
+call SaveInteger(hash_abilities,(1093679447),(2),(100))
+call SaveInteger(hash_abilities,(1093679447),(3),(40))
 call SaveInteger(hash_abilities,(1093747288),(1),(200))
 call SaveInteger(hash_abilities,(1093747288),(2),(190))
 call SaveInteger(hash_abilities,(1093747288),(3),(180))
 call SaveInteger(hash_abilities,(1093678420),(1),(145))
 call SaveInteger(hash_abilities,(1093678420),(2),(115))
 call SaveInteger(hash_abilities,(1093678420),(3),(60))
 call SaveInteger(hash_abilities,(1093679176),(1),(145))
 call SaveInteger(hash_abilities,(1093679176),(2),(115))
 call SaveInteger(hash_abilities,(1093679176),(3),(60))
 call SaveInteger(hash_abilities,(1093678647),(1),(100))
 call SaveInteger(hash_abilities,(1093678647),(2),(85))
 call SaveInteger(hash_abilities,(1093678647),(3),(70))
 call SaveInteger(hash_abilities,(1093679184),(1),(70))
 call SaveInteger(hash_abilities,(1093679184),(2),(70))
 call SaveInteger(hash_abilities,(1093679184),(3),(70))
@@ -15149,30 +15528,39 @@
 call SaveInteger(hash_abilities,(abilityid_walruspunch),(1),(30))
 call SaveInteger(hash_abilities,(abilityid_walruspunch),(2),(24))
 call SaveInteger(hash_abilities,(abilityid_walruspunch),(3),(18))
 call SaveInteger(hash_abilities,(abilityid_spellsteal),(1),(20))
 call SaveInteger(hash_abilities,(abilityid_spellsteal),(2),(18))
 call SaveInteger(hash_abilities,(abilityid_spellsteal),(3),(16))
 call SaveInteger(hash_abilities,(1093812807),(1),(60))
 call SaveInteger(hash_abilities,(1093812807),(2),(40))
 call SaveInteger(hash_abilities,(1093812807),(3),(20))
 call SaveInteger(hash_abilities,(1093813065),(1),(50))
 call SaveInteger(hash_abilities,(1093813065),(2),(50))
 call SaveInteger(hash_abilities,(1093813065),(3),(50))
 call SaveInteger(hash_abilities,(1093813557),(1),(8))
 call SaveInteger(hash_abilities,(1093813557),(2),(8))
 call SaveInteger(hash_abilities,(1093813557),(3),(8))
+call SaveInteger(hash_abilities,(1093815600),(1),(65))
+call SaveInteger(hash_abilities,(1093815600),(2),(60))
+call SaveInteger(hash_abilities,(1093815600),(3),(55))
+call SaveInteger(hash_abilities,(1093687856),(1),(90))
+call SaveInteger(hash_abilities,(1093687856),(2),(80))
+call SaveInteger(hash_abilities,(1093687856),(3),(70))
+call SaveInteger(hash_abilities,(1093816118),(1),(120))
+call SaveInteger(hash_abilities,(1093816118),(2),(90))
+call SaveInteger(hash_abilities,(1093816118),(3),(60))
 endfunction
 function ReliableGold_Main takes nothing returns boolean
 local player p
 local integer i
 local integer id
 local integer TotalGold
 set i=1
 loop
 exitwhen i>5
 set p=udg_SentPlayers[i]
 set id=GetPlayerId(p)
 set TotalGold=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
 if TotalGold<ReliableGold[id]then
 set ReliableGold[id]=TotalGold
 endif
@@ -15602,39 +15990,50 @@
 call CustomHeroRevive_Revive(i)
 endif
 if CustomHeroRevive_Time[i]!=0 and IsDead(CustomHeroRevive_Hero[i])==false then
 call CustomHeroRevive_RemoveSlot(i)
 endif
 set i=i+1
 endloop
 return false
 endfunction
 function InitTrig_CustomHeroRevive takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterTimerEvent(t,0.5,true)
 call TriggerAddCondition(t,Condition(function CustomHeroRevive_Iterate))
 set t=null
 endfunction
+function ModeTT_FixGold takes unit DeadHero,integer GoldPenalty returns nothing
+local unit OtherHero=(LoadUnitHandle(hash_main,(GetHandleId(DeadHero)),(788)))
+local integer OtherBank=(LoadInteger(hash_main,(GetHandleId(OtherHero)),(787)))
+call SaveInteger(hash_main,(GetHandleId(OtherHero)),(787),(IMaxBJ(OtherBank-GoldPenalty,0)))
+set OtherHero=null
+endfunction
 function Techies_FixXP takes unit Techies,unit Dying returns nothing
 if DistanceBetweenUnits(Techies,Dying)>1200 or(IsDead(Techies)and GetUnitTypeId(Techies)==1211117643)then
 call AddHeroXP(Techies,GetHeroXPBounty(Dying),true)
 endif
 endfunction
+function Bloodstone_IncrementChanges takes nothing returns nothing
+if FindItemOfType(GetEnumUnit(),Item_Real[indexid_bloodstone])!=null then
+call SetItemCharges(FindItemOfType(GetEnumUnit(),Item_Real[indexid_bloodstone]),GetItemCharges(FindItemOfType(GetEnumUnit(),Item_Real[indexid_bloodstone]))+1)
+endif
+endfunction
 function Bloodstone_FindNearbyHeroes takes nothing returns boolean
 if(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetFilterUnit())==false then
 if IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(bloodstone_tempdeadhero))and FindItemOfType(GetFilterUnit(),Item_Real[indexid_bloodstone])!=null then
-call SetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_bloodstone]),GetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_bloodstone]))+1)
+return true
 endif
 endif
 return false
 endfunction
 function StaffOfHealing_FindNearbyHeroes takes nothing returns boolean
 local item i
 local integer charges
 if staffofhealing_count==0 and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(staffofhealing_tempdeadhero))then
 if FindItemOfType(GetFilterUnit(),Item_Real[indexid_staffofhealing])!=null then
 set staffofhealing_count=staffofhealing_count+1
 set charges=GetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_staffofhealing]))
 if charges==0 then
 set charges=2
 else
 set charges=charges+1
@@ -15645,34 +16044,38 @@
 return false
 endfunction
 function AncientJangoo_FindNearbyHeroes takes nothing returns boolean
 local item i
 local integer charges
 if ancientjangoo_count==0 and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(staffofhealing_tempdeadhero))then
 if FindItemOfType(GetFilterUnit(),Item_Real[indexid_ancientjangoo])!=null then
 set ancientjangoo_count=ancientjangoo_count+1
 set charges=GetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_ancientjangoo]))
 set charges=IMinBJ(charges+1,5)
 call SetItemCharges(FindItemOfType(GetFilterUnit(),Item_Real[indexid_ancientjangoo]),charges)
 endif
 endif
 return false
 endfunction
-function Bloodstone_HeroDied takes unit u returns nothing
+function Bloodstone_HeroDied takes unit u,unit Killer returns nothing
 local group g=GetAvailableGroup()
 set bloodstone_tempdeadhero=u
 call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),1625,Condition(function Bloodstone_FindNearbyHeroes))
+if IsUnitAlly(u,GetOwningPlayer(Killer))==false then
+call GroupAddUnit(g,Killer)
+endif
+call ForGroup(g,function Bloodstone_IncrementChanges)
 call KillGroup(g)
 set g=null
 endfunction
 function BladeOfTheReaper_Image_AI takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Image=(LoadUnitHandle(hash_main,(Cache),(335)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local real x
 local real y
 local real a
 if GetTriggerEventId()==EVENT_WIDGET_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 if GetTriggerUnit()!=Image then
@@ -15860,89 +16263,89 @@
 endfunction
 function IsWeb takes nothing returns boolean
 if GetUnitTypeId(GetFilterUnit())==1865429043 then
 call KillUnit(GetFilterUnit())
 return true
 endif
 return false
 endfunction
 function RemoveAllWebs takes nothing returns nothing
 local boolexpr CondVar=Condition(function IsWeb)
 local group GroupVar=GetAvailableGroup()
 call GroupEnumUnitsInRect(GroupVar,GetPlayableMapRect(),CondVar)
 call KillGroup(GroupVar)
 endfunction
 function Deathtrigger_Condition takes nothing returns boolean
-if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true then
+if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and GetUnitTypeId(GetTriggerUnit())!=unitid_tempestdouble then
 if GetUnitTypeId(GetTriggerUnit())==1211117642 and Deathtrigger_KoboldHasAegis(GetTriggerUnit())then
 return false
 endif
 return true
 endif
 return false
 endfunction
-function Deathtrigger_IsSuicide takes player DeadPlayer,player KillPlayer returns boolean
-return GetKillingUnit()==null or(IsSent(DeadPlayer)and IsSent(KillPlayer))or(IsScourge(DeadPlayer)and IsScourge(KillPlayer))
+function Deathtrigger_IsSuicide takes player DeadPlayer,player KillPlayer,unit KillHero returns boolean
+return KillHero==null or GetKillingUnit()==null or(IsSent(DeadPlayer)and IsSent(KillPlayer))or(IsScourge(DeadPlayer)and IsScourge(KillPlayer))
 endfunction
 function GiveBonusXPGold_Count takes nothing returns nothing
-if(GetUnitTypeId((GetEnumUnit()))==1211117642)==false then
+if IsGlobalHeroDummy(GetUnitTypeId(GetEnumUnit()))==false then
 set Bonus_Count_XP=Bonus_Count_XP+1
 if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then
 set Bonus_Count_Gold=Bonus_Count_Gold+1
 endif
 endif
 endfunction
 function GiveBonusXPGold_Give takes nothing returns nothing
-if(GetUnitTypeId((GetEnumUnit()))==1211117642)==false then
+if(GetUnitTypeId((GetEnumUnit()))==1211117642)==false and IsGlobalHeroDummy(GetUnitTypeId(GetFilterUnit()))==false then
 call AddHeroXP(GetEnumUnit(),bonusgoldxp_xp,true)
 set Bonus_XP[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=Bonus_XP[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_xp
 if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then
 set Bonus_Gold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=Bonus_Gold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_gold
 set ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_gold
 call GiveGoldWithAnimation(GetOwningPlayer(GetEnumUnit()),bonusgoldxp_gold,GetEnumUnit())
 endif
 endif
 endfunction
 function GiveBonusXPGold takes nothing returns boolean
 local integer Level
 local integer BonusXP=0
 local integer BonusGold=0
 local group g
-if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetTriggerUnit())==false and(GetUnitTypeId((GetTriggerUnit()))==1211117642)==false then
+if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetTriggerUnit())==false and(GetUnitTypeId((GetTriggerUnit()))==1211117642)==false and IsGlobalHeroDummy(GetUnitTypeId(GetTriggerUnit()))==false then
 set Level=GetHeroLevel(GetTriggerUnit())
 set bonusgoldxp_xp=0
 set bonusgoldxp_gold=0
 set g=GetAvailableGroup()
 set Bonus_Count_XP=0
 set Bonus_Count_Gold=0
 call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),1025,Condition(function GenericCondition_EnemyHeroes))
 call ForGroup(g,function GiveBonusXPGold_Count)
 if Bonus_Count_XP==1 then
 set BonusXP=20*Level+120
 elseif Bonus_Count_XP==2 then
 set BonusXP=15*Level+90
 elseif Bonus_Count_XP==3 then
 set BonusXP=7*Level+30
 elseif Bonus_Count_XP==4 then
 set BonusXP=6*Level+15
 elseif Bonus_Count_XP==5 then
 set BonusXP=5*Level+10
 endif
 if Bonus_Count_Gold==1 then
-set BonusGold=9*Level+95
+set BonusGold=12*Level+125
 elseif Bonus_Count_Gold==2 then
-set BonusGold=8*Level+20
+set BonusGold=10*Level+40
 elseif Bonus_Count_Gold==3 then
 set BonusGold=6*Level
 elseif Bonus_Count_Gold==4 then
 set BonusGold=6*Level
 elseif Bonus_Count_Gold==5 then
 set BonusGold=6*Level
 endif
 if udg_ModeEM then
 endif
 set bonusgoldxp_xp=BonusXP
 set bonusgoldxp_gold=BonusGold
 call ForGroup(g,function GiveBonusXPGold_Give)
 call KillGroup(g)
 set g=null
 endif
@@ -15969,41 +16372,46 @@
 local string GoldText
 local boolean QuickRevive=false
 local real RespawnTimeModifier1=1
 local real RespawnTimeModifier2=1
 local real RespawnTimeModifier3=1
 local real RespawnTimeModifier4=1
 local real RespawnTimeModifier_Constant=0
 local trigger t
 local integer TotalRespawnTime
 local integer AssistCount
 local integer id
 local integer CurrentGold=GetPlayerState(DeadPlayer,PLAYER_STATE_RESOURCE_GOLD)
 local integer UnreliableGold=CurrentGold-ReliableGold[GetPlayerId(DeadPlayer)]
 local unit RealKillHero
 local unit RealDeadHero
+local boolean PreventBuyback=reaperscythe_hit
 call GiveBonusXPGold()
 if KillHero==null and GetUnitTypeId(DeadHero)==1315988077 then
 set KillHero=primalsplit_killer
 set KillPlayer=GetOwningPlayer(KillHero)
 endif
+if IsPlayerAlly(KillPlayer,DeadPlayer)==true and((LoadInteger(hash_main,(GetHandleId((KillHero))),((4328))))==HERO_STATE_ON)==true and curse_source!=null then
+set KillHero=curse_source
+set KillPlayer=GetOwningPlayer(KillHero)
+endif
 set AssistCount=Assist_GetCount(DeadHero,KillHero)
 if KillHero!=null then
 set id=GetUnitTypeId(KillHero)
 call Techies_FixXP(udg_Hero[GetPlayerId(GetOwningPlayer(KillHero))],DeadHero)
 endif
-if Deathtrigger_IsSuicide(DeadPlayer,KillPlayer)==false and AssistCount==1 and IsRealPlayer(KillPlayer)==false and KillPlayer!=udg_NeutralHostile then
+if Deathtrigger_IsSuicide(DeadPlayer,KillPlayer,KillHero)==false and AssistCount==1 and IsRealPlayer(KillPlayer)==false and KillPlayer!=udg_NeutralHostile then
 call Assist_GetPlayers(DeadHero,KillHero)
 set KillPlayer=AssistPlayers[1]
 set KillHero=udg_Hero[GetPlayerId(KillPlayer)]
 endif
 if IsSent(GetOwningPlayer(DeadHero))then
 if GetOwningPlayer(DeadHero)!=udg_SentPlayers[1]then
 endif
 if GetOwningPlayer(DeadHero)!=udg_SentPlayers[2]then
 endif
 if GetOwningPlayer(DeadHero)!=udg_SentPlayers[3]then
 endif
 if GetOwningPlayer(DeadHero)!=udg_SentPlayers[4]then
 endif
 if GetOwningPlayer(DeadHero)!=udg_SentPlayers[5]then
 endif
@@ -16043,51 +16451,57 @@
 set suicide=true
 if(KillPlayer==DeadPlayer)then
 call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,(udg_Colors[GetPlayerId(DeadPlayer)]+(PlayerNames[GetPlayerId((DeadPlayer))])+"|r "+GetObjectName(MSG_SUICIDE)))
 else
 call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,GetString_HeroDenied(DeadPlayer,KillPlayer))
 endif
 elseif IsScourge(KillPlayer)then
 set EnemyDeath=true
 set udg_LBDeaths[GetPlayerId(udg_SentPlayers[0])]=udg_LBDeaths[GetPlayerId(udg_SentPlayers[0])]+1
 set udg_LBKills[GetPlayerId(udg_ScourgePlayers[0])]=udg_LBKills[GetPlayerId(udg_ScourgePlayers[0])]+1
 set udg_TeamOwnage[2]=udg_TeamOwnage[2]+1
 set udg_TeamOwnage[1]=0
 if KillPlayer!=udg_ScourgePlayers[0]then
 set udg_LBKills[GetPlayerId(KillPlayer)]=udg_LBKills[GetPlayerId(KillPlayer)]+1
 set udg_Killsinarow[GetPlayerId(KillPlayer)]=udg_Killsinarow[GetPlayerId(KillPlayer)]+1
+set udg_Deathsinarow[GetPlayerId(KillPlayer)]=0
 endif
+set udg_Killsinarow[GetPlayerId(DeadPlayer)]=0
+set udg_Deathsinarow[GetPlayerId(DeadPlayer)]=udg_Deathsinarow[GetPlayerId(DeadPlayer)]+1
 endif
 endif
 if IsScourge(DeadPlayer)then
 if IsScourge(KillPlayer)then
 set suicide=true
 if(KillPlayer==DeadPlayer)then
 call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,(udg_Colors[GetPlayerId(DeadPlayer)]+(PlayerNames[GetPlayerId((DeadPlayer))])+"|r "+GetObjectName(MSG_SUICIDE)))
 else
 call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,GetString_HeroDenied(DeadPlayer,KillPlayer))
 endif
 elseif IsSent(KillPlayer)then
 set EnemyDeath=true
 set udg_LBDeaths[GetPlayerId(udg_ScourgePlayers[0])]=udg_LBDeaths[GetPlayerId(udg_ScourgePlayers[0])]+1
 set udg_LBKills[GetPlayerId(udg_SentPlayers[0])]=udg_LBKills[GetPlayerId(udg_SentPlayers[0])]+1
 set udg_TeamOwnage[1]=udg_TeamOwnage[1]+1
 set udg_TeamOwnage[2]=0
 if KillPlayer!=udg_SentPlayers[0]then
 set udg_LBKills[GetPlayerId(KillPlayer)]=udg_LBKills[GetPlayerId(KillPlayer)]+1
 set udg_Killsinarow[GetPlayerId(KillPlayer)]=udg_Killsinarow[GetPlayerId(KillPlayer)]+1
+set udg_Deathsinarow[GetPlayerId(KillPlayer)]=0
 endif
+set udg_Killsinarow[GetPlayerId(DeadPlayer)]=0
+set udg_Deathsinarow[GetPlayerId(DeadPlayer)]=udg_Deathsinarow[GetPlayerId(DeadPlayer)]+1
 endif
 endif
 if KillPlayer==udg_NeutralHostile then
 set EnemyDeath=false
 if GetUnitTypeId(KillHero)==1848651852 then
 call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,(udg_Colors[GetPlayerId(DeadPlayer)]+(PlayerNames[GetPlayerId((DeadPlayer))])+"|r "+GetObjectName(MSG_KILLED_BY_ROSHAN)))
 else
 call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,(udg_Colors[GetPlayerId(DeadPlayer)]+(PlayerNames[GetPlayerId((DeadPlayer))])+"|r "+GetObjectName(MSG_KILLED_BY_NEUTRAL)))
 endif
 set suicide=true
 endif
 if remoteminekill then
 call PlaySoundAtPos(gg_snd_GoblinSapperYesAttack1,GetUnitX(DeadHero),GetUnitY(DeadHero))
 endif
 call Traffic_RegisterData("Hero"+I2S(GetPlayerId(DeadPlayer)),GetPlayerId(KillPlayer))
@@ -16115,67 +16529,69 @@
 set GoldReward=350
 set DeathStreakText="|c00ff0000"+GetObjectName(MSG_GODLIKE)+"|r"
 else
 set GoldReward=400
 set DeathStreakText="|c00ff8000"+GetObjectName(MSG_BEYOND_GODLIKE)+"|r"
 endif
 endif
 set x=udg_Killsinarow[GetPlayerId(KillPlayer)]
 if x>LongestSpree[GetPlayerId(KillPlayer)]then
 set LongestSpree[GetPlayerId(KillPlayer)]=x
 endif
 set RealKillHero=KillHero
 if IsUnitType(RealKillHero,UNIT_TYPE_HERO)==false then
 set RealKillHero=udg_Hero[GetPlayerId(GetOwningPlayer(RealKillHero))]
 endif
-if x>2 and GetUnitTypeId(RealKillHero)!=1429221446 and nohat_setting[GetPlayerId(GetOwningPlayer(RealKillHero))]==0 then
+if udg_Killsinarow[GetPlayerId(KillPlayer)]>2 and GetUnitTypeId(RealKillHero)!=1429221446 and nohat_setting[GetPlayerId(GetOwningPlayer(RealKillHero))]==0 then
+call UnitAddAbility2(RealKillHero,1093815114)
 endif
-set RealDeadHero=DeadHero
-if IsUnitType(RealDeadHero,UNIT_TYPE_HERO)==false then
-set RealDeadHero=udg_Hero[GetPlayerId(GetOwningPlayer(RealDeadHero))]
+if udg_Deathsinarow[GetPlayerId(DeadPlayer)]>2 and GetUnitTypeId(DeadHero)!=1429221446 and nohat_setting[GetPlayerId(GetOwningPlayer(DeadHero))]==0 then
+call UnitAddAbility2(DeadHero,1093816141)
 endif
 if suicide==false and EnemyDeath==true then
+call UnitRemoveAbility(DeadHero,1093815114)
+call UnitRemoveAbility(RealKillHero,1093816141)
 endif
 if x>2 and suicide==false then
 if x==3 then
 call PlaySoundEx(gg_snd_KillingSpree)
 set KillStreakText=" "+GetObjectName(MSG_IS_ON_A)+" |c0000ff40"+GetObjectName(MSG_KILLING_SPREE)+"|r"+GetObjectName(MSG_EXCLAMATION)
 elseif x==4 then
 call PlaySoundEx(gg_snd_Dominating)
 set KillStreakText=" "+GetObjectName(MSG_IS)+" |c00400080"+GetObjectName(MSG_DOMINATING)+"|r"+GetObjectName(MSG_EXCLAMATION)
 elseif x==5 then
 call PlaySoundEx(gg_snd_MegaKill)
 set KillStreakText=" "+GetObjectName(MSG_HAS_A)+" |c00ff0080"+GetObjectName(MSG_MEGA_KILL)+"|r"+GetObjectName(MSG_EXCLAMATION)
 elseif x==6 then
 call PlaySoundEx(gg_snd_Unstoppable)
 set KillStreakText=" "+GetObjectName(MSG_IS)+" |c00ff8000"+GetObjectName(MSG_UNSTOPPABLE)+"|r"+GetObjectName(MSG_EXCLAMATION2)
 elseif x==7 then
 call PlaySoundEx(gg_snd_WhickedSick)
 set KillStreakText=" "+GetObjectName(MSG_IS)+" |c00808000"+GetObjectName(MSG_WICKED_SICK)+"|r"+GetObjectName(MSG_EXCLAMATION2)
 elseif x==8 then
 call PlaySoundEx(gg_snd_MonsterKill)
 set KillStreakText=" "+GetObjectName(MSG_HAS_A)+" |c00ff80ff"+GetObjectName(MSG_MONSTER_KILL)+"|r"+GetObjectName(MSG_EXCLAMATION2)
 elseif x==9 then
 call PlaySoundEx(gg_snd_GodLike)
 set KillStreakText=" "+GetObjectName(MSG_IS)+" |c00ff0000"+GetObjectName(MSG_GODLIKE)+"|r"+GetObjectName(MSG_EXCLAMATION3)
 else
 call PlaySoundEx(gg_snd_HolyShit)
 set KillStreakText=" "+GetObjectName(MSG_IS)+" |c00ff8000"+GetObjectName(MSG_BEYOND_GODLIKE)+"|r. "+GetObjectName(MSG_SOMEONE_KILL_HIM)+GetObjectName(MSG_EXCLAMATION3)
 endif
 endif
 if suicide==false then
-set GoldReward=GoldReward+100+GetHeroLevel(DeadHero)*5+100
+set GoldReward=GoldReward+100+GetHeroLevel(DeadHero)*9+100
 set DeadPlayerString=udg_Colors[GetPlayerId(DeadPlayer)]+(PlayerNames[GetPlayerId((DeadPlayer))])+"|r"
 set KillPlayerString=udg_Colors[GetPlayerId(KillPlayer)]+(PlayerNames[GetPlayerId((KillPlayer))])+"|r"
 set GoldText="|c00FFDC00"+I2S(GoldReward)+"|r"
 if KillPlayer==udg_SentPlayers[0]or KillPlayer==udg_ScourgePlayers[0]then
 if AssistCount==0 then
 if KillPlayer==udg_SentPlayers[0]then
 set DeathText=KillPlayerString+" "+GetObjectName(MSG_PAWNED)+" "+DeadPlayerString+GetObjectName(MSG_S_HEAD)+GetObjectName(MSG_EXCLAMATION)+" "+GoldText+" "+GetObjectName(MSG_GOLD_IS_SPLIT)+"."
 call DeathShareGold(KillPlayer,GoldReward)
 elseif KillPlayer==udg_ScourgePlayers[0]then
 set DeathText=KillPlayerString+" "+GetObjectName(MSG_PAWNED)+" "+DeadPlayerString+GetObjectName(MSG_S_HEAD)+GetObjectName(MSG_EXCLAMATION)+" "+GoldText+" "+GetObjectName(MSG_GOLD_IS_SPLIT)+"."
 call DeathShareGold(KillPlayer,GoldReward)
 endif
 elseif AssistCount>1 then
 set DeathText=KillPlayerString+" "+GetObjectName(MSG_PAWNED)+" "+DeadPlayerString+GetObjectName(MSG_S_HEAD)+GetObjectName(MSG_EXCLAMATION)+" "+GoldText+" "+GetObjectName(MSG_GOLD_IS_SPLIT)+"."
 call Assist_SplitGold(DeadHero,KillHero,GoldReward)
@@ -16204,36 +16620,37 @@
 endif
 if udg_TeamOwnage[2]>4 then
 call Deathtrigger_OwnageMsg(1)
 endif
 endif
 set GoldPenalty=GetHeroLevel(DeadHero)*30
 if FindItemOfType(DeadHero,Item_Real[indexid_bloodstone])!=null then
 if GetItemCharges(FindItemOfType(DeadHero,Item_Real[indexid_bloodstone]))>0 then
 set RespawnTimeModifier_Constant=-1*(4*GetItemCharges(FindItemOfType(DeadHero,Item_Real[indexid_bloodstone])))
 set GoldPenalty=IMaxBJ(R2I(GoldPenalty-25*GetItemCharges(FindItemOfType(DeadHero,Item_Real[indexid_bloodstone]))),0)
 endif
 endif
 if GoldPenalty>UnreliableGold then
 set GoldPenalty=UnreliableGold
 endif
-call Bloodstone_HeroDied(DeadHero)
+call Bloodstone_HeroDied(DeadHero,RealKillHero)
 call StaffOfHealing_HeroDied(DeadHero)
 call BladeOfTheReaper_HeroDied(DeadHero)
 if QuickRevive==false then
 set GoldLost[GetPlayerId(DeadPlayer)]=GoldLost[GetPlayerId(DeadPlayer)]+GoldPenalty
 call TakeGoldWithAnimation(DeadHero,GoldPenalty)
+call ModeTT_FixGold(DeadHero,GoldPenalty)
 endif
 call SaveInteger(hash_main,(400+GetPlayerId(KillPlayer)),(450+GetPlayerId(DeadPlayer)),((LoadInteger(hash_main,(400+GetPlayerId(KillPlayer)),(450+GetPlayerId(DeadPlayer))))+1))
 call SaveInteger(hash_main,(400+GetPlayerId(DeadPlayer)),(500+GetPlayerId(KillPlayer)),((LoadInteger(hash_main,(400+GetPlayerId(DeadPlayer)),(500+GetPlayerId(KillPlayer))))+1))
 call StartTimerBJ(udg_KillTimer[GetPlayerId(KillPlayer)],false,18)
 if suicide==false and KillPlayer!=udg_SentPlayers[0]and KillPlayer!=udg_ScourgePlayers[0]and KillPlayer!=udg_NeutralHostile then
 set udg_KillInt[GetPlayerId(KillPlayer)]=udg_KillInt[GetPlayerId(KillPlayer)]+1
 if udg_KillInt[GetPlayerId(KillPlayer)]==2 then
 set NumOfDoubleKills[GetPlayerId(KillPlayer)]=NumOfDoubleKills[GetPlayerId(KillPlayer)]+1
 call Deathtrigger_ExtraKillMsg(udg_Colors[GetPlayerId(KillPlayer)]+(PlayerNames[GetPlayerId((KillPlayer))])+"|r "+GetObjectName(MSG_JUST_GOT_A)+" |c000000ff"+GetObjectName(MSG_DOUBLE_KILL)+"|r"+GetObjectName(MSG_EXCLAMATION),SOUND_DOUBLEKILL)
 endif
 if udg_KillInt[GetPlayerId(KillPlayer)]==3 then
 set NumOfTrippleKills[GetPlayerId(KillPlayer)]=NumOfTrippleKills[GetPlayerId(KillPlayer)]+1
 call Deathtrigger_ExtraKillMsg(udg_Colors[GetPlayerId(KillPlayer)]+(PlayerNames[GetPlayerId((KillPlayer))])+"|r "+GetObjectName(MSG_JUST_GOT_A)+" |c0000ff40"+GetObjectName(MSG_TRIPLE_KILL)+"|r"+GetObjectName(MSG_EXCLAMATION3),SOUND_TRIPLEKILL)
 endif
 if udg_KillInt[GetPlayerId(KillPlayer)]==4 then
@@ -16294,30 +16711,56 @@
 set tt_deathunit=DeadHero
 call ExecuteFunc("RemoveAllFeral")
 elseif GetUnitTypeId(DeadHero)==1432580716 then
 set tt_deathunit=DeadHero
 call ExecuteFunc("RemoveAllGrow")
 endif
 endif
 endfunction
 function InitTrig_Deathtrigger takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Deathtrigger_Condition))
 call TriggerAddAction(t,function Deathtrigger_Action)
 set gg_trg_Deathtrigger=t
 endfunction
+function ImageEnters_Main takes nothing returns boolean
+local unit Image=GetSummonedUnit()
+local integer x
+if IsUnitIllusion(Image)==true then
+set x=udg_Killsinarow[GetPlayerId(GetOwningPlayer(Image))]
+if x>2 and nohat_setting[GetPlayerId(GetOwningPlayer(Image))]==0 then
+call UnitAddAbility2(Image,1093815114)
+else
+call UnitRemoveAbility(Image,1093815114)
+endif
+set x=udg_Deathsinarow[GetPlayerId(GetOwningPlayer(Image))]
+if x>2 and nohat_setting[GetPlayerId(GetOwningPlayer(Image))]==0 then
+call UnitAddAbility2(Image,1093816141)
+else
+call UnitRemoveAbility(Image,1093816141)
+endif
+endif
+set Image=null
+return false
+endfunction
+function InitTrig_Image_Enters takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
+call TriggerAddCondition(t,Condition(function ImageEnters_Main))
+set t=null
+endfunction
 function FirstBlood takes nothing returns nothing
 local trigger t=GetTriggeringTrigger()
 local player KillPlayer=GetOwningPlayer(GetKillingUnit())
 local player DeadPlayer=GetOwningPlayer(GetTriggerUnit())
 local string msg
 local integer AssistCount=Assist_GetCount(GetTriggerUnit(),GetKillingUnit())
 if KillPlayer==udg_SentPlayers[0]or KillPlayer==udg_ScourgePlayers[0]then
 call Assist_SplitGold(GetTriggerUnit(),GetKillingUnit(),200)
 set msg=Assist_GetString(GetTriggerUnit(),GetKillingUnit())+" "+GetObjectName(MSG_JUST_DREW)+" |c00ff0303"+GetObjectName(MSG_FIRST_BLOOD)+GetObjectName(MSG_EXCLAMATION)+"|r "
 if AssistCount>1 then
 set msg=msg+"(+200 "+GetObjectName(MSG_GOLD_IS_SPLIT)+")"
 else
 set msg=msg+"(+200 "+GetObjectName(MSG_GOLD)+")"
 endif
 else
@@ -16380,38 +16823,38 @@
 return false
 endfunction
 function Roshan_Register takes unit u returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterUnitEvent(t,u,EVENT_UNIT_DEATH)
 call TriggerRegisterTimerEvent(t,10,true)
 call TriggerAddCondition(t,Condition(function Roshan_CheckArea))
 call SaveUnitHandle(hash_main,(Cache),(53),(u))
 call SaveBoolean(hash_main,(Cache),(91),(true))
 set t=null
 endfunction
 function RoshanTimer_Iterate takes nothing returns boolean
 local item Item
 local integer Count=GetTriggerEvalCount(GetTriggeringTrigger())
-if Count==600 then
+if Count==aegis_reclaim then
 call CleanTrigger(GetTriggeringTrigger())
 endif
-if Count==420 or Count==540 then
+if Count==aegis_reclaim-180 or Count==aegis_reclaim-60 then
 if aegisholder!=null then
 set Item=FindItemOfType(aegisholder,Item_Real[indexid_aegis])
 if Item!=null then
-if Count==420 then
+if Count==aegis_reclaim-180 then
 if IsSent(GetOwningPlayer(aegisholder))then
 call DisplayTimedTextToForceEx(udg_ForceSent,15,GetObjectName(MSG_ROSHAN_RECLAIM)+" |c00ff0303"+GetObjectName(MSG_ROSHAN_MSG1)+"|r")
 else
 call DisplayTimedTextToForceEx(udg_ForceScourge,15,GetObjectName(MSG_ROSHAN_RECLAIM)+" |c00ff0303"+GetObjectName(MSG_ROSHAN_MSG1)+"|r")
 endif
 else
 if IsSent(GetOwningPlayer(aegisholder))then
 call DisplayTimedTextToForceEx(udg_ForceSent,15,GetObjectName(MSG_ROSHAN_RECLAIM)+" |c00ff0303"+GetObjectName(MSG_ROSHAN_MSG2)+"|r")
 else
 call DisplayTimedTextToForceEx(udg_ForceScourge,15,GetObjectName(MSG_ROSHAN_RECLAIM)+" |c00ff0303"+GetObjectName(MSG_ROSHAN_MSG2)+"|r")
 endif
 endif
 endif
 endif
 endif
@@ -16464,49 +16907,51 @@
 local string s=GetObjectName(MSG_SPECIAL_ROSHAN_KILLED)
 set s=StringReplace(s,"$team",teama)
 set s=StringReplace(s,"$team",teamb)
 return s
 endfunction
 function Trig_RoshanDies_Conditions takes nothing returns boolean
 return GetUnitTypeId(GetDyingUnit())==1848651852
 endfunction
 function IsHero takes nothing returns boolean
 return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true
 endfunction
 function Roshan_Respawn takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local location PointVar
 local real scale
-if GetTriggerEvalCount(t)==600 or force_roshan_respawn then
+if GetTriggerEvalCount(t)==roshan_respawn or force_roshan_respawn then
 set force_roshan_respawn=false
 set PointVar=GetRectCenter(gg_rct_Roshan)
 call Roshan_RemoveOtherAegis()
 set RoshanUpgrade=RoshanUpgrade+1
 set udg_Roshan=CreateUnitAtLoc(Player(PLAYER_NEUTRAL_AGGRESSIVE),1848651852,PointVar,bj_UNIT_FACING)
 call SetUnitAcquireRange(udg_Roshan,150)
 call Roshan_Register(udg_Roshan)
 call UnitAddAbility(udg_Roshan,1093743666)
 call SetPlayerTechResearched(GetOwningPlayer(udg_Roshan),1378889798,roshan_upgradelevel)
 call SetUnitAbilityLevel(udg_Roshan,1093743666,roshan_upgradelevel+1)
 call RemoveLocation(PointVar)
 if RoshanUpgrade>1 then
 call UnitRemoveAbility(udg_Roshan,1093684018)
 call UnitAddAbility(udg_Roshan,1093685558)
 call UnitAddItem(udg_Roshan,CreateItem(Item_Real[indexid_cheese],0,0))
 endif
 call UnitAddItem(udg_Roshan,CreateItem(Item_Real[indexid_aegis],0,0))
 call CleanTrigger(t)
+elseif GetTriggerEvalCount(t)==aegis_reclaim then
+call Roshan_RemoveOtherAegis()
 endif
 set t=null
 return false
 endfunction
 function Trig_RoshanDies_Actions takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerAddCondition(t,Condition(function Roshan_Respawn))
 set force_roshan_respawn=false
 call Roshan_AegisTimer()
 set AegisMSG_Disabled=false
 if(IsSent(GetOwningPlayer(GetKillingUnit())))then
 call Traffic_RegisterData("Roshan",0)
 call DisplayTimedTextToForceEx(GetPlayersAll(),10.00,GetString_RoshanKilled("|c00ff0000"+GetObjectName(MSG_SENT)+"|r",GetObjectName(MSG_SENT)))
 call AdjustPlayerStateBJ(200,udg_SentPlayers[1],PLAYER_STATE_RESOURCE_GOLD)
@@ -17352,30 +17797,38 @@
 set Item_Real[Item_Max]=1227901494
 set Item_Unit[Item_Max]=1747990579
 set Item_Mute[Item_Max]=1227901496
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNAmulet.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_talismanofevasion=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227901514
 set Item_Real[Item_Max]=1227901513
 set Item_Unit[Item_Max]=1747990583
 set Item_Mute[Item_Max]=1227901515
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNGreenStaff.blp"
 set Item_Cooldown[Item_Max]=30
 set indexid_ghostscepter=Item_Max
 set Item_Max=Item_Max+1
+set Item_Dummy[Item_Max]=1227903033
+set Item_Real[Item_Max]=1227903042
+set Item_Unit[Item_Max]=1747993929
+set Item_Mute[Item_Max]=1227903041
+set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNPendantOfMana.blp"
+set Item_Cooldown[Item_Max]=0
+set indexid_shadowamulet=Item_Max
+set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227902273
 set Item_Real[Item_Max]=1227902265
 set Item_Unit[Item_Max]=1747993421
 set Item_Mute[Item_Max]=1227902274
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNOrbOfVenom.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_orbofvenom=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227902276
 set Item_Real[Item_Max]=1227902277
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227902275
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNOrbOfVenom.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_orbofvenomranged=Item_Max
@@ -17674,31 +18127,31 @@
 set indexid_diffusalbladeempty=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227901507
 set Item_Real[Item_Max]=1227901505
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227901509
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNDiffusal2.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_diffusalbladelevel2empty=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896917
 set Item_Real[Item_Max]=1227896916
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227895348
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNINV_Helmet_13.blp"
-set Item_Cooldown[Item_Max]=300
+set Item_Cooldown[Item_Max]=60
 set indexid_helmofthedominator=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896919
 set Item_Real[Item_Max]=1227896918
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227899727
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNINV_Helmet_13.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_helmofthedominatorcourier=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896920
 set Item_Real[Item_Max]=1227896921
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227895349
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNHelmOfValor.blp"
@@ -17797,30 +18250,38 @@
 set Item_Real[Item_Max]=1227897156
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227900738
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNRodOfNecromancy.blp"
 set Item_Cooldown[Item_Max]=60
 set indexid_blackkingbar06=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227900724
 set Item_Real[Item_Max]=1227900721
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227900737
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNRodOfNecromancy.blp"
 set Item_Cooldown[Item_Max]=55
 set indexid_blackkingbar05=Item_Max
 set Item_Max=Item_Max+1
+set Item_Dummy[Item_Max]=1227903030
+set Item_Real[Item_Max]=1227903032
+set Item_Unit[Item_Max]=0
+set Item_Mute[Item_Max]=1227903031
+set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNRodOfNecromancy.blp"
+set Item_Cooldown[Item_Max]=50
+set indexid_blackkingbar04=Item_Max
+set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227899224
 set Item_Real[Item_Max]=1227899223
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=0
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNArcaniteArmor.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_aegis=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227897159
 set Item_Real[Item_Max]=1227897158
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227895365
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNINV_ThrowingAxe_02.blp"
 set Item_Cooldown[Item_Max]=35
 set indexid_mantastyle=Item_Max
@@ -18304,31 +18765,31 @@
 set indexid_ironboots=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227902794
 set Item_Real[Item_Max]=1227902793
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227902795
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNTranquilBoots.blp"
 set Item_Cooldown[Item_Max]=30
 set indexid_ironboots_disabled=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227902797
 set Item_Real[Item_Max]=1227902796
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227902798
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNWitchDoctorMaster.blp"
-set Item_Cooldown[Item_Max]=20
+set Item_Cooldown[Item_Max]=16
 set indexid_cripplingstaff=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227902800
 set Item_Real[Item_Max]=1227902799
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227902801
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNPendantOfMana.blp"
 set Item_Cooldown[Item_Max]=20
 set indexid_moonshard=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227902805
 set Item_Real[Item_Max]=1227902806
 set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227902807
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNHalberd.blp"
@@ -18559,31 +19020,31 @@
 set Item_Mute[Item_Max]=1227900227
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_blackkingbar=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896633
 set Item_Real[Item_Max]=1227896665
 set Item_Unit[Item_Max]=1747989302
 set Item_Mute[Item_Max]=1227900228
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_mantastyle=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896641
 set Item_Real[Item_Max]=1227896666
-set Item_Unit[Item_Max]=1747989303
+set Item_Unit[Item_Max]=0
 set Item_Mute[Item_Max]=1227900229
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_lotharsedge=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896642
 set Item_Real[Item_Max]=1227896880
 set Item_Unit[Item_Max]=1747989304
 set Item_Mute[Item_Max]=1227900230
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_dagon=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896643
 set Item_Real[Item_Max]=1227896881
@@ -18753,30 +19214,38 @@
 set Item_Real[Item_Max]=1227900983
 set Item_Unit[Item_Max]=1747990355
 set Item_Mute[Item_Max]=1227900985
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_magicwand=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227900996
 set Item_Real[Item_Max]=1227900998
 set Item_Unit[Item_Max]=1747990356
 set Item_Mute[Item_Max]=1227900997
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_forcestaff=Item_Max
 set Item_Max=Item_Max+1
+set Item_Dummy[Item_Max]=1227903044
+set Item_Real[Item_Max]=1227903045
+set Item_Unit[Item_Max]=0
+set Item_Mute[Item_Max]=1227903046
+set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
+set Item_Cooldown[Item_Max]=0
+set indexid_recipe_cripplingstaff=Item_Max
+set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227901016
 set Item_Real[Item_Max]=1227901018
 set Item_Unit[Item_Max]=1747990360
 set Item_Mute[Item_Max]=1227901017
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_pipeofinsight=Item_Max
 set Item_Max=Item_Max+1
 set Item_Dummy[Item_Max]=1227896652
 set Item_Real[Item_Max]=1227901774
 set Item_Unit[Item_Max]=1747989328
 set Item_Mute[Item_Max]=1227901775
 set Item_Icon[Item_Max]="ReplaceableTextures\\CommandButtons\\BTNSnazzyScroll.blp"
 set Item_Cooldown[Item_Max]=0
 set indexid_recipe_mjollnir=Item_Max
@@ -19119,33 +19588,32 @@
 set Recipe_Component_1[Recipe_Max]=indexid_bladesofattack
 set Recipe_Component_2[Recipe_Max]=indexid_broadsword
 set Recipe_Component_3[Recipe_Max]=indexid_recipe_crystalys
 set Recipe_Result[Recipe_Max]=indexid_crystalys
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_mithrilhammer
 set Recipe_Component_2[Recipe_Max]=indexid_ogreaxe
 set Recipe_Component_3[Recipe_Max]=indexid_recipe_blackkingbar
 set Recipe_Result[Recipe_Max]=indexid_blackkingbar10
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_yasha
 set Recipe_Component_2[Recipe_Max]=indexid_ultimateorb
 set Recipe_Component_3[Recipe_Max]=indexid_recipe_mantastyle
 set Recipe_Result[Recipe_Max]=indexid_mantastyleranged
 set Recipe_Max=Recipe_Max+1
-set Recipe_Component_1[Recipe_Max]=indexid_quarterstaff
-set Recipe_Component_2[Recipe_Max]=indexid_claymore
-set Recipe_Component_3[Recipe_Max]=indexid_recipe_lotharsedge
+set Recipe_Component_1[Recipe_Max]=indexid_claymore
+set Recipe_Component_2[Recipe_Max]=indexid_shadowamulet
 set Recipe_Result[Recipe_Max]=indexid_lotharsedge
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_staffofwizardry
 set Recipe_Component_2[Recipe_Max]=indexid_nulltalisman
 set Recipe_Component_3[Recipe_Max]=indexid_recipe_dagon
 set Recipe_Result[Recipe_Max]=indexid_dagonlevel1
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_dagonlevel1
 set Recipe_Component_2[Recipe_Max]=indexid_recipe_dagon
 set Recipe_Result[Recipe_Max]=indexid_dagonlevel2
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_dagonlevel2
 set Recipe_Component_2[Recipe_Max]=indexid_recipe_dagon
 set Recipe_Result[Recipe_Max]=indexid_dagonlevel3
 set Recipe_Max=Recipe_Max+1
@@ -19314,32 +19782,32 @@
 set Recipe_Component_3[Recipe_Max]=indexid_recipe_orchidmalevolence
 set Recipe_Result[Recipe_Max]=indexid_orchidmalevolence
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_bootsofspeed
 set Recipe_Component_2[Recipe_Max]=indexid_bladesofattack
 set Recipe_Component_3[Recipe_Max]=indexid_bladesofattack
 set Recipe_Result[Recipe_Max]=indexid_phaseboots
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_magicstick
 set Recipe_Component_2[Recipe_Max]=indexid_ironwoodbranch
 set Recipe_Component_3[Recipe_Max]=indexid_ironwoodbranch
 set Recipe_Component_4[Recipe_Max]=indexid_ironwoodbranch
 set Recipe_Component_5[Recipe_Max]=indexid_recipe_magicwand
 set Recipe_Result[Recipe_Max]=indexid_magicwand
 set Recipe_Max=Recipe_Max+1
-set Recipe_Component_1[Recipe_Max]=indexid_quarterstaff
-set Recipe_Component_2[Recipe_Max]=indexid_staffofwizardry
+set Recipe_Component_1[Recipe_Max]=indexid_staffofwizardry
+set Recipe_Component_2[Recipe_Max]=indexid_ringofregeneration
 set Recipe_Component_3[Recipe_Max]=indexid_recipe_forcestaff
 set Recipe_Result[Recipe_Max]=indexid_forcestaff
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_hoodofdefiance
 set Recipe_Component_2[Recipe_Max]=indexid_headdressofrejuvenation
 set Recipe_Component_3[Recipe_Max]=indexid_recipe_pipeofinsight
 set Recipe_Result[Recipe_Max]=indexid_pipeofinsight
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_stoutshield
 set Recipe_Component_2[Recipe_Max]=indexid_slippersofagility
 set Recipe_Component_3[Recipe_Max]=indexid_slippersofagility
 set Recipe_Result[Recipe_Max]=indexid_poormanshield
 set Recipe_Max=Recipe_Max+1
 set Recipe_Component_1[Recipe_Max]=indexid_stoutshieldranged
 set Recipe_Component_2[Recipe_Max]=indexid_slippersofagility
@@ -19835,39 +20303,39 @@
 endfunction
 function DeliverItems_GoHome takes unit Source returns nothing
 local real x
 local real y
 if IsSent(GetOwningPlayer(Source))then
 set x=GetRectCenterX(gg_rct_Hero_Creation_NE)
 set y=GetRectCenterY(gg_rct_Hero_Creation_NE)
 else
 set x=GetRectCenterX(gg_rct_Hero_Creation_UD)
 set y=GetRectCenterY(gg_rct_Hero_Creation_UD)
 endif
 call IssuePointOrder(Source,"move",x,y)
 endfunction
 function DeliverItems_Search takes nothing returns nothing
 local item Item=GetEnumItem()
-if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==deliveritems_player and deliveritems_count==0 then
+if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==deliveritems_player and deliveritems_count==0 and IsItemVisible(Item)==true then
 set deliveritems_count=deliveritems_count+1
 call UnitAddItem(deliveritems_source,Item)
 endif
 set Item=null
 endfunction
 function DeliverItems_GiveBack takes nothing returns nothing
 local item Item=GetEnumItem()
-if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==deliveritems_player then
+if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==deliveritems_player and IsItemVisible(Item)==true then
 call UnitAddItem(deliveritems_courier,Item)
 endif
 set Item=null
 endfunction
 function DeliverItems_Giving takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Courier=(LoadUnitHandle(hash_main,(Cache),(92)))
 local player p=(LoadPlayerHandle(hash_main,(Cache),(54)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local rect r=Rect(x-300,y-300,x+300,y+300)
 if GetTriggerEventId()==EVENT_WIDGET_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
@@ -20034,31 +20502,31 @@
 call TriggerRegisterUnitEvent(t,Courier,EVENT_UNIT_ISSUED_TARGET_ORDER)
 call TriggerRegisterUnitEvent(t,Courier,EVENT_UNIT_ISSUED_POINT_ORDER)
 call TriggerRegisterTimerEvent(t,0.2,true)
 call TriggerAddCondition(t,Condition(function DeliverItems_Iterate))
 call SaveUnitHandle(hash_main,(Cache),(2),(Hero))
 call SaveUnitHandle(hash_main,(Cache),(92),(Courier))
 endif
 set t=null
 set Courier=null
 endfunction
 function CollectItems_Pickup takes nothing returns nothing
 local item Item=GetEnumItem()
 local unit u=pickupallitems_unit
 local player p=GetOwningPlayer(u)
 local integer id=GetPlayerId(p)
-if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==p then
+if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==p and IsItemVisible(Item)==true then
 call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
 call UnitAddItem(collectitems_courier,Item)
 endif
 set Item=null
 set u=null
 set p=null
 endfunction
 function CollectItems_Delayed takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit u=(LoadUnitHandle(hash_main,(Cache),(53)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 set pickupallitems_unit=u
 set collectitems_courier=Source
 if IsSent(GetOwningPlayer(pickupallitems_unit))then
@@ -20729,30 +21197,33 @@
 elseif indexId==indexid_sentrywards then
 set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
 set ItemStats_Wards[i]=ItemStats_Wards[i]+2
 elseif indexId==indexid_scrolloftownportal then
 set ItemStats_Consumables[i]=ItemStats_Consumables[i]+1
 elseif indexId==indexid_dustofappearance then
 set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
 elseif indexId==indexid_ghostpotion then
 set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
 elseif indexId==indexid_wandofillusions then
 set ItemStats_Consumables[i]=ItemStats_Consumables[i]+2
 endif
 endfunction
 function UnitItem_RestrictBuying takes unit store,unit buyer returns boolean
 local integer indexId
+if GetUnitTypeId(buyer)==unitid_tempestdouble then
+return true
+endif
 if(store==ScourgeBuilding_ShopGraveyard or store==ScourgeBuilding_ShopGateway)and IsUnitAlly(buyer,udg_ScourgePlayers[0])then
 return false
 elseif(store==SentinelBuilding_ShopChimaera or store==SentinelBuilding_ShopCache)and IsUnitAlly(buyer,udg_SentPlayers[0])then
 return false
 endif
 set indexId=UnitToIndex(buyer)
 if indexId==indexid_observerwards or indexId==indexid_gemoftruesight or indexId==indexid_smokeofdeceit then
 return true
 endif
 return false
 endfunction
 function UnitItem_GetBestX takes unit sellingUnit,unit soldUnit returns real
 if sellingUnit==SentinelBuilding_ShopCache or sellingUnit==SentinelBuilding_ShopWeapon or sellingUnit==SentinelBuilding_ShopAccessorizer or sellingUnit==SentinelBuilding_ShopChimaera or sellingUnit==SentinelBuilding_Shop1 or sellingUnit==SentinelBuilding_Shop2 or sellingUnit==SentinelBuilding_Shop3 or sellingUnit==SentinelBuilding_Shop4 or sellingUnit==SentinelBuilding_Shop5 or sellingUnit==SentinelBuilding_Shop6 then
 return ItemSpawnX[GetPlayerId(GetOwningPlayer(soldUnit))]
 elseif sellingUnit==ScourgeBuilding_ShopGateway or sellingUnit==ScourgeBuilding_ShopWeapon or sellingUnit==ScourgeBuilding_ShopAccessorizer or sellingUnit==ScourgeBuilding_ShopGraveyard or sellingUnit==ScourgeBuilding_Shop1 or sellingUnit==ScourgeBuilding_Shop2 or sellingUnit==ScourgeBuilding_Shop3 or sellingUnit==ScourgeBuilding_Shop4 or sellingUnit==ScourgeBuilding_Shop5 or sellingUnit==ScourgeBuilding_Shop6 then
@@ -21336,30 +21807,44 @@
 endif
 call SetItemPlayer(tt_item1,tt_player1,false)
 call SetItemUserData(tt_item1,1)
 set result=true
 endif
 endif
 set whichItem=null
 return result
 endfunction
 function CourierFakedItems_Main takes unit Hero,item Item returns boolean
 if CourierFakedItems_IsFlagged(ItemToIndex(Item))or CourierFakedItems_IsFlaggedSecondary(ItemToMuteId(Item))then
 return CourierFakedItems(Hero,Item)
 endif
 return false
 endfunction
+function ModeTT_ItemHack_End takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local integer id=(LoadInteger(hash_main,(Cache),(34)))
+set TT_DisableTracker[id]=false
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=null
+return false
+endfunction
+function ModeTT_ItemHack takes unit u returns nothing
+local integer id=GetPlayerId(GetOwningPlayer(u))
+set TT_DisableTracker[id]=true
+endfunction
 function ManipulateItem_Delayed takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Unit=(LoadUnitHandle(hash_main,(Cache),(26)))
 local integer EventType=(LoadInteger(hash_main,(Cache),(97)))
 local integer indexId=(LoadInteger(hash_main,(Cache),(93)))
 local boolean temporary=(LoadBoolean(hash_main,(Cache),(95)))
 local item Item
 local player p=GetOwningPlayer(Unit)
 local player owner
 local integer charges
 local boolean consumable=false
 local item newItem
 local integer scepter_indexid
 local integer scepter_abilityid
@@ -21542,31 +22027,31 @@
 call DisableTrigger(t_manipulateitem)
 call TriggerRegisterTimerEvent(t,0,false)
 call TriggerAddCondition(t,Condition(function DelayTrigger_Expire))
 set t=null
 endfunction
 function ManipulateItem takes nothing returns boolean
 local item Item
 local integer EventType
 local unit Unit=GetTriggerUnit()
 local trigger t
 local integer Cache
 local integer scepter_indexid
 local integer scepter_abilityid
 local integer id
 set id=GetPlayerId(GetOwningPlayer(Unit))
-if(IsUnitType(Unit,UNIT_TYPE_HERO)==true or IsSpiritBear(Unit))and IsUnitIllusion(Unit)==false then
+if(IsUnitType(Unit,UNIT_TYPE_HERO)==true or IsSpiritBear(Unit))and IsUnitIllusion(Unit)==false and GetUnitTypeId(Unit)!=1311788365 then
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
 if GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_javelin]then
 set TotalCount_Javelin=TotalCount_Javelin+1
 set HasItem_Javelin[id]=HasItem_Javelin[id]+1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_kelensdagger]then
 set TotalCount_Dagger=TotalCount_Dagger+1
 set HasItem_Dagger[id]=HasItem_Dagger[id]+1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_bloodstone]then
 set TotalCount_Bloodstone=TotalCount_Bloodstone+1
 set HasItem_Bloodstone[id]=HasItem_Bloodstone[id]+1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_craniumbasher]or GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_annihilator]then
 set TotalCount_CraniumBasher=TotalCount_CraniumBasher+1
 set HasItem_CraniumBasher[id]=HasItem_CraniumBasher[id]+1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_heartoftarrasque]then
 set TotalCount_Heart=TotalCount_Heart+1
@@ -21580,67 +22065,70 @@
 set HasItem_SangeAndYasha[id]=HasItem_SangeAndYasha[id]+1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_sange]then
 set TotalCount_Sange=TotalCount_Sange+1
 set HasItem_Sange[id]=HasItem_Sange[id]+1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_prudence]then
 set TotalCount_Prudence=TotalCount_Prudence+1
 set HasItem_Prudence[id]=HasItem_Prudence[id]+1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_ironboots]then
 set TotalCount_IronBoots=TotalCount_IronBoots+1
 set HasItem_IronBoots[id]=HasItem_IronBoots[id]+1
 endif
 elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM then
 if GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_javelin]then
 set HasItem_Javelin[id]=HasItem_Javelin[id]-1
 set TotalCount_Javelin=TotalCount_Javelin-1
-elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_kelensdagger]then
+elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_kelensdagger]and GetUnitTypeId(Unit)!=1311788365 then
 set HasItem_Dagger[id]=HasItem_Dagger[id]-1
 set TotalCount_Dagger=TotalCount_Dagger-1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_ironboots]then
 set HasItem_IronBoots[id]=HasItem_IronBoots[id]-1
 set TotalCount_IronBoots=TotalCount_IronBoots-1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_bloodstone]then
 set HasItem_Bloodstone[id]=HasItem_Bloodstone[id]-1
 set TotalCount_Bloodstone=TotalCount_Bloodstone-1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_craniumbasher]or GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_annihilator]then
 set TotalCount_CraniumBasher=TotalCount_CraniumBasher-1
 set HasItem_CraniumBasher[id]=HasItem_CraniumBasher[id]-1
 if HasItem_CraniumBasher[id]<1 or FindItemOfTypeEx(Unit,Item_Real[indexid_craniumbasher],GetManipulatedItem())==null or FindItemOfTypeEx(Unit,Item_Real[indexid_annihilator],GetManipulatedItem())==null then
 call UnitRemoveAbility(Unit,abilityid_craniumbasher)
 endif
-elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_heartoftarrasque]then
+elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_heartoftarrasque]and GetUnitTypeId(Unit)!=1311788365 then
 set HasItem_Heart[id]=HasItem_Heart[id]-1
 set TotalCount_Heart=TotalCount_Heart-1
 elseif GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_linkenssphere]or GetItemTypeId(GetManipulatedItem())==Item_Mute[indexid_linkenssphere]then
 set TotalCount_LinkenSphere=IMaxBJ(TotalCount_LinkenSphere-1,0)
 set HasItem_LinkenSphere[id]=IMaxBJ(HasItem_LinkenSphere[id]-1,0)
 call UnitRemoveAbility(Unit,buffid_linkensphere)
 endif
 endif
 endif
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_PAWN_ITEM then
 set Item=GetSoldItem()
 call SetItemUserData(Item,-2)
 set scepter_indexid=GetScepterIndexId(Unit)
 set scepter_abilityid=GetScepterAbilityId(Unit)
 if FindItemOfTypeEx(Unit,Item_Real[scepter_indexid],Item)==null and GetUnitAbilityLevel(Unit,scepter_abilityid)>0 then
 call UnitRemoveAbility(Unit,scepter_abilityid)
 if GetUnitTypeId(Unit)==1215130471 then
 set tt_unit1=Unit
 call ExecuteFunc("Aghanim_Fireblast_Remove")
 endif
 endif
+if udg_ModeTT==true then
+call ModeTT_ItemHack(Unit)
+endif
 elseif GetItemTypeId(GetManipulatedItem())!=1227894853 and GetItemTypeId(GetManipulatedItem())!=1227895373 then
 set Item=GetManipulatedItem()
 if IsUnitIllusion(Unit)or GetItemUserData(Item)==-2 then
 set Item=null
 set Unit=null
 set t=null
 return false
 endif
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
 set EventType=1
 else
 set EventType=2
 endif
 if(EventType==1 or(EventType==2 and IsItemTemporary(Item)==false and GetWidgetLife(Item)>0))and GetUnitTypeId(Unit)!=1211117642 then
 set t=CreateTrigger()
@@ -21839,31 +22327,31 @@
 endif
 endif
 else
 if not(GetUnitAbilityLevel(Source,gem_real)==0 and GetUnitAbilityLevel(Source,gem_fake)==0)then
 call UnitRemoveAbility(Source,gem_fake)
 call UnitRemoveAbility(Source,gem_real)
 call RemoveSavedHandle(hash_main,(Cache),(670))
 endif
 endif
 endif
 endfunction
 function ItemTraffic_Main takes nothing returns boolean
 local unit Hero=GetTriggerUnit()
 local item Item=GetManipulatedItem()
 local integer id=GetItemTypeId(Item)
-if Item==null or IsUnitIllusion(Hero)==true or IsUnitType(Hero,UNIT_TYPE_HERO)==false or GetUnitTypeId(Hero)==1211117642 or GetItemTypeId(Item)==1227894853 or GetItemTypeId(Item)==1227895373 then
+if Item==null or IsUnitIllusion(Hero)==true or IsUnitType(Hero,UNIT_TYPE_HERO)==false or IsGlobalHeroDummy(GetUnitTypeId(Hero))or GetItemTypeId(Item)==1227894853 or GetItemTypeId(Item)==1227895373 then
 set Hero=null
 set Item=null
 return false
 endif
 if(GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM and GetItemType(Item)!=ITEM_TYPE_PURCHASABLE)or GetTriggerEventId()==EVENT_PLAYER_UNIT_PAWN_ITEM then
 call CustomPickupDrop_Main(Item,Hero,false)
 call Traffic_RegisterData("DRI_"+I2S(GetPlayerId(GetOwningPlayer(Hero))),Item_Real[FindRealIndexId(GetIndex(Item))])
 elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
 call CustomPickupDrop_Main(Item,Hero,true)
 call Traffic_RegisterData("PUI_"+I2S(GetPlayerId(GetOwningPlayer(Hero))),Item_Real[FindRealIndexId(GetIndex(Item))])
 endif
 set Hero=null
 set Item=null
 return false
 endfunction
@@ -22143,30 +22631,39 @@
 set newItem=CreateItem(Item_Dummy[indexid_sange],x,y)
 call SetItemPlayer(newItem,tt_player1,false)
 call SetItemUserData(newItem,1)
 set newItem=CreateItem(Item_Dummy[indexid_yasha],x,y)
 call SetItemPlayer(newItem,tt_player1,false)
 call SetItemUserData(newItem,1)
 elseif indexId==indexid_ringofaquila or indexId==indexid_ringofaquilaheroes then
 set tt_player1=GetItemPlayer(Item)
 call RemoveItem(Item)
 set newItem=CreateItem(Item_Dummy[indexid_wraithband],x,y)
 call SetItemPlayer(newItem,tt_player1,false)
 call SetItemUserData(newItem,1)
 set newItem=CreateItem(Item_Dummy[indexid_ringofbasilius],x,y)
 call SetItemPlayer(newItem,tt_player1,false)
 call SetItemUserData(newItem,1)
+elseif indexId==indexid_annihilator then
+set tt_player1=GetItemPlayer(Item)
+call RemoveItem(Item)
+set newItem=CreateItem(Item_Dummy[indexid_sacredrelic],x,y)
+call SetItemPlayer(newItem,tt_player1,false)
+call SetItemUserData(newItem,1)
+set newItem=CreateItem(Item_Dummy[indexid_craniumbasher],x,y)
+call SetItemPlayer(newItem,tt_player1,false)
+call SetItemUserData(newItem,1)
 endif
 set i=i+1
 endloop
 call EnableTrigger(t_manipulateitem)
 set u=null
 set Item=null
 set newItem=null
 endfunction
 function Dissassemble_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_disassemble or GetSpellAbilityId()==abilityid_disassemble_courier then
 call Disassemble()
 endif
 return false
 endfunction
 function InitTrig_Disassemble takes nothing returns nothing
@@ -22202,31 +22699,31 @@
 function Bloodstone_RemoveFromAllHeroes takes nothing returns nothing
 local integer x=1
 local player p
 loop
 exitwhen x>16
 if FindItemOfType(udg_Hero[x],Item_Real[indexid_bloodstone])!=null then
 call RemoveUnit(BloodstoneCaster[GetPlayerId(GetOwningPlayer(udg_Hero[x]))])
 endif
 set x=x+1
 endloop
 endfunction
 function Bloodstone_ItemCondition takes nothing returns boolean
 return GetItemTypeId(GetManipulatedItem())==Item_Real[indexid_bloodstone]and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true
 endfunction
 function Bloodstone_Condition takes nothing returns boolean
-return IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and GetUnitTypeId(GetTriggerUnit())!=1211117642 and FindItemOfType(GetTriggerUnit(),Item_Real[indexid_bloodstone])!=null
+return IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsGlobalHeroDummy(GetUnitTypeId(GetFilterUnit()))==false and FindItemOfType(GetTriggerUnit(),Item_Real[indexid_bloodstone])!=null
 endfunction
 function Bloodstone_WhichToHeal takes nothing returns boolean
 return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),1093678162)!=1 and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1
 endfunction
 function Bloodstone_Heal takes nothing returns nothing
 call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)+udg_TempReal)
 call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\BloodstoneHealTarget.mdx",GetEnumUnit(),"origin"))
 endfunction
 function Bloodstone_RegisterUnit takes nothing returns nothing
 call AddHeroState(GetEnumUnit(),4254,40)
 endfunction
 function Bloodstone_HealAction takes nothing returns nothing
 local group g=GetAvailableGroup()
 call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),1700,Condition(function Bloodstone_WhichToHeal))
 set udg_TempReal=400+30*GetItemCharges(FindItemOfType(GetTriggerUnit(),Item_Real[indexid_bloodstone]))
@@ -22353,31 +22850,31 @@
 set Item=UnitItemInSlot(u,i)
 if Item!=null and GetItemPlayer(Item)==p then
 call UnitRemoveItem(u,Item)
 call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
 endif
 set i=i+1
 endloop
 set u=null
 set Item=null
 endfunction
 function PickupAllItems_Pickup takes nothing returns nothing
 local item Item=GetEnumItem()
 local unit u=pickupallitems_unit
 local player p=GetOwningPlayer(u)
 local integer id=GetPlayerId(p)
-if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==p then
+if GetWidgetLife(Item)>0 and GetItemPlayer(Item)==p and IsItemVisible(Item)==true then
 call SetItemPosition(Item,ItemSpawnX[id],ItemSpawnY[id])
 call UnitAddItem(COP[id],Item)
 endif
 set Item=null
 set u=null
 set p=null
 endfunction
 function PickupAllItems_Delayed takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit u=(LoadUnitHandle(hash_main,(Cache),(53)))
 set pickupallitems_unit=u
 if IsSent(GetOwningPlayer(pickupallitems_unit))then
 call EnumItemsInRect(gg_rct_Recreate1,Condition(function GenericCondition_True),function PickupAllItems_Pickup)
 else
@@ -22440,44 +22937,44 @@
 call RemoveRegion(r)
 set u=null
 set r=null
 endfunction
 function DropAllItems_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_dropallitems1 or GetSpellAbilityId()==abilityid_dropallitems2 then
 call DropAllItems()
 endif
 endfunction
 function IronBoots_ShouldDisable takes unit Source returns boolean
 local integer Cache=GetHandleId(Source)
 local integer i=0
 local real Time=(TimerGetElapsed(udg_GameTimer))
 local real Buffer=10
 loop
-exitwhen i>3
+exitwhen i>2
 if(LoadReal(hash_main,(Cache),(730+i)))<Time-Buffer then
 return false
 endif
 set i=i+1
 endloop
 return true
 endfunction
 function IronBoots_DamageTracker takes unit Source returns nothing
 local integer Cache=GetHandleId(Source)
 local integer LastUsedIndex=(LoadInteger(hash_main,(Cache),(729)))
 call SaveReal(hash_main,(Cache),(730+LastUsedIndex),(((TimerGetElapsed(udg_GameTimer)))*1.0))
 set LastUsedIndex=LastUsedIndex+1
-if LastUsedIndex==4 then
+if LastUsedIndex==3 then
 set LastUsedIndex=0
 endif
 call SaveInteger(hash_main,(Cache),(729),(LastUsedIndex))
 endfunction
 function IronBoots_Update takes unit Hero returns nothing
 local integer i=0
 local item IronBoots
 local integer indexId
 local boolean DisableBoots=false
 if IronBoots_ShouldDisable(Hero)then
 set DisableBoots=true
 endif
 loop
 exitwhen i>5
 set IronBoots=UnitItemInSlot(Hero,i)
@@ -22502,31 +22999,31 @@
 endif
 set i=i+1
 endloop
 set Hero=null
 set IronBoots=null
 endfunction
 function Heart_Update takes unit Hero returns nothing
 local integer i=0
 local item Heart
 local integer indexId
 local boolean DisableHeart=false
 local real time=4
 if IsUnitType(Hero,UNIT_TYPE_MELEE_ATTACKER)==false then
 set time=6
 endif
-if BlinkDamaged_Time[GetPlayerId(GetOwningPlayer(Hero))]+time>(TimerGetElapsed(udg_GameTimer))then
+if(LoadReal(hash_main,(GetHandleId(Hero)),(785)))+time>(TimerGetElapsed(udg_GameTimer))then
 set DisableHeart=true
 endif
 loop
 exitwhen i>5
 set Heart=UnitItemInSlot(Hero,i)
 set indexId=ItemToIndex(Heart)
 if indexId==indexid_heartoftarrasque and DisableHeart==true then
 call DisableTrigger(t_manipulateitem)
 set tt_player1=GetItemPlayer(Heart)
 call RemoveItem(Heart)
 set tt_item1=SafeUnitAddItemToSlotById(Hero,Item_Real[indexid_heartoftarrasquedisabled],i)
 call SetItemPlayer(tt_item1,tt_player1,false)
 call SetItemUserData(tt_item1,1)
 call EnableTrigger(t_manipulateitem)
 endif
@@ -22535,103 +23032,110 @@
 set tt_player1=GetItemPlayer(Heart)
 call RemoveItem(Heart)
 set tt_item1=SafeUnitAddItemToSlotById(Hero,Item_Real[indexid_heartoftarrasque],i)
 call SetItemPlayer(tt_item1,tt_player1,false)
 call SetItemUserData(tt_item1,1)
 call EnableTrigger(t_manipulateitem)
 endif
 set i=i+1
 endloop
 set Hero=null
 set Heart=null
 endfunction
 function BlinkDagger_Damaged takes nothing returns nothing
 if GetEventDamage()>2 and GetEventDamageSource()!=GetTriggerUnit()and(IsRealPlayer(GetOwningPlayer(GetEventDamageSource()))or GetUnitTypeId(GetEventDamageSource())==1848651852)then
 if safedamage_urn[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]==false then
-set BlinkDamaged_Time[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]=(TimerGetElapsed(udg_GameTimer))
+call SaveReal(hash_main,(GetHandleId(GetTriggerUnit())),(785),(((TimerGetElapsed(udg_GameTimer)))*1.0))
 if GetEventDamage()>20 then
 call IronBoots_DamageTracker(GetTriggerUnit())
 endif
 endif
 endif
 endfunction
 function BlinkDagger_Update takes unit Hero returns nothing
 local integer i=0
 local item Dagger
 local integer indexId
 local boolean DisableDagger=false
-if BlinkDamaged_Time[GetPlayerId(GetOwningPlayer(Hero))]+3>(TimerGetElapsed(udg_GameTimer))then
+if(LoadReal(hash_main,(GetHandleId(Hero)),(785)))+3>(TimerGetElapsed(udg_GameTimer))then
 set DisableDagger=true
 endif
 loop
 exitwhen i>5
 set Dagger=UnitItemInSlot(Hero,i)
 set indexId=ItemToIndex(Dagger)
 if indexId==indexid_kelensdagger and DisableDagger==true then
 call DisableTrigger(t_manipulateitem)
 set tt_player1=GetItemPlayer(Dagger)
 call RemoveItem(Dagger)
 set tt_item1=SafeUnitAddItemToSlotById(Hero,Item_Real[indexid_kelensdaggerdisabled],i)
 call SetItemPlayer(tt_item1,tt_player1,false)
 call SetItemUserData(tt_item1,1)
 call EnableTrigger(t_manipulateitem)
 endif
 if indexId==indexid_kelensdaggerdisabled and DisableDagger==false then
 call DisableTrigger(t_manipulateitem)
 set tt_player1=GetItemPlayer(Dagger)
 call RemoveItem(Dagger)
 set tt_item1=SafeUnitAddItemToSlotById(Hero,Item_Real[indexid_kelensdagger],i)
 call SetItemPlayer(tt_item1,tt_player1,false)
 call SetItemUserData(tt_item1,1)
 call EnableTrigger(t_manipulateitem)
 endif
 set i=i+1
 endloop
 set Hero=null
 set Dagger=null
 endfunction
-function BlinkDagger_Main takes nothing returns boolean
-local integer i=1
-local unit Hero
-local integer id
-if TotalCount_Dagger>0 or TotalCount_Heart>0 or TotalCount_IronBoots>0 then
-loop
-exitwhen i>5
-set id=GetPlayerId(udg_SentPlayers[i])
-set Hero=udg_Hero[id]
+function BlinkDagger_Main_Helper takes nothing returns nothing
+local unit Hero=GetEnumUnit()
+local integer id=GetPlayerId(GetOwningPlayer(Hero))
 if HasItem_Dagger[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
 call BlinkDagger_Update(Hero)
 endif
 if HasItem_Heart[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
 call Heart_Update(Hero)
 endif
 if HasItem_IronBoots[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
 call IronBoots_Update(Hero)
 endif
+set Hero=null
+endfunction
+function BlinkDagger_CollectHeroes takes nothing returns boolean
+return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and GetUnitTypeId(GetFilterUnit())!=1211117642 and GetUnitTypeId(GetFilterUnit())!=1211122232
+endfunction
+function BlinkDagger_Main takes nothing returns boolean
+local integer i=1
+local unit Hero
+local integer id
+local group g
+if TotalCount_Dagger>0 or TotalCount_Heart>0 or TotalCount_IronBoots>0 then
+set g=GetAvailableGroup()
+call GroupEnumUnitsInRange(g,0,0,9999,Condition(function BlinkDagger_CollectHeroes))
+loop
+exitwhen i>5
+set id=GetPlayerId(udg_SentPlayers[i])
+set Hero=udg_Hero[id]
+call GroupAddUnit(g,Hero)
 set id=GetPlayerId(udg_ScourgePlayers[i])
 set Hero=udg_Hero[id]
-if HasItem_Dagger[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
-call BlinkDagger_Update(Hero)
-endif
-if HasItem_Heart[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
-call Heart_Update(Hero)
-endif
-if HasItem_IronBoots[id]>0 and Hero!=null and GetUnitTypeId(Hero)>1 and IsUnitType(Hero,UNIT_TYPE_DEAD)==false then
-call IronBoots_Update(Hero)
-endif
+call GroupAddUnit(g,Hero)
 set i=i+1
 endloop
+call ForGroup(g,function BlinkDagger_Main_Helper)
+call KillGroup(g)
+set g=null
 endif
 set Hero=null
 return false
 endfunction
 function InitTrig_Blink_Dagger takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterTimerEvent(t,0.33,true)
 call TriggerAddCondition(t,Condition(function BlinkDagger_Main))
 set t=null
 endfunction
 function FountainBottle_Update takes nothing returns nothing
 local unit Hero=GetFilterUnit()
 local integer i=0
 local item Item
 local integer indexId
@@ -23003,53 +23507,53 @@
 return false
 endfunction
 function InitTrig_Euls_Movement takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
 call TriggerAddCondition(t,Condition(function Euls_Add))
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DROP_ITEM)
 call TriggerAddCondition(t,Condition(function Euls_Remove))
 set t=null
 endfunction
 function Armlet takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_DROP_ITEM then
 if ItemToIndex(GetManipulatedItem())==indexid_armletofmordiggianoff then
-call UnitRemoveAbility(Hero,1093682520)
+call UnitRemoveAbility(Hero,armlet_hpregen)
 endif
 if ItemToIndex(GetManipulatedItem())==indexid_satanic then
 call UnitRemoveAbility(Hero,1093747287)
 endif
 if ItemToIndex(GetManipulatedItem())==indexid_armletofmordiggianon then
-call UnitRemoveAbility(Hero,1093682520)
+call UnitRemoveAbility(Hero,armlet_hpregen)
 call UnitRemoveAbility(Hero,1093686339)
 call UnitRemoveAbility(Hero,1093686603)
 endif
 endif
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_PICKUP_ITEM then
 if ItemToIndex(GetManipulatedItem())==indexid_armletofmordiggianoff then
-call UnitAddAbility(Hero,1093682520)
-call UnitMakeAbilityPermanent(Hero,true,1093682520)
+call UnitAddAbility(Hero,armlet_hpregen)
+call UnitMakeAbilityPermanent(Hero,true,armlet_hpregen)
 endif
 if ItemToIndex(GetManipulatedItem())==indexid_satanic then
 call UnitAddAbility(Hero,1093747287)
 call UnitMakeAbilityPermanent(Hero,true,1093747287)
 endif
 if ItemToIndex(GetManipulatedItem())==indexid_armletofmordiggianon then
-call UnitAddAbility(Hero,1093682520)
-call UnitMakeAbilityPermanent(Hero,true,1093682520)
+call UnitAddAbility(Hero,armlet_hpregen)
+call UnitMakeAbilityPermanent(Hero,true,armlet_hpregen)
 call UnitAddAbility(Hero,1093686339)
 call UnitMakeAbilityPermanent(Hero,true,1093686339)
 call UnitAddAbility(Hero,1093686603)
 call UnitMakeAbilityPermanent(Hero,true,1093686603)
 endif
 endif
 set Hero=null
 endfunction
 function Armlet_Main takes nothing returns boolean
 if GetItemType(GetManipulatedItem())==ITEM_TYPE_PERMANENT and(ItemToIndex(GetManipulatedItem())==indexid_armletofmordiggianon or ItemToIndex(GetManipulatedItem())==indexid_armletofmordiggianoff or ItemToIndex(GetManipulatedItem())==indexid_satanic)then
 call Armlet()
 endif
 return false
 endfunction
 function InitTrig_Armlet takes nothing returns nothing
@@ -23074,30 +23578,31 @@
 endif
 set t=null
 set Hero=null
 set Item=null
 return false
 endfunction
 function ArmletDrain takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DROP_ITEM)
 call TriggerAddCondition(t,Condition(function ArmletDrain_Execute))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call SaveItemHandle(hash_main,(Cache),(96),(GetManipulatedItem()))
+call TriggerEvaluate(t)
 set t=null
 set Hero=null
 endfunction
 function ArmletDrain_Main takes nothing returns boolean
 if GetItemType(GetManipulatedItem())==ITEM_TYPE_PERMANENT and ItemToIndex(GetManipulatedItem())==indexid_armletofmordiggianon then
 call ArmletDrain()
 endif
 return false
 endfunction
 function InitTrig_Armlet_Life_Drain takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_PICKUP_ITEM)
 call TriggerAddCondition(t,Condition(function ArmletDrain_Main))
 set t=null
 endfunction
@@ -24591,102 +25096,154 @@
 set UnitFX_From=null
 set UnitFX_To=null
 set l=null
 set t=null
 set Splat=null
 endfunction
 function ScrollOfTeleporation_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_scrollofteleportation and IsCourier(GetTriggerUnit())==false then
 call ScrollOfTeleporation()
 endif
 if GetSpellAbilityId()==abilityid_bootsoftravel then
 call BootsOfTravel()
 endif
 endfunction
 function NecronomiconLimit_Remove takes nothing returns nothing
+if necromarker_id==(LoadInteger(hash_main,(GetHandleId(GetEnumUnit())),(784)))then
 call KillUnit(GetEnumUnit())
+endif
 endfunction
 function NecronomiconLimit_Find takes nothing returns boolean
 local integer i=GetUnitTypeId(GetFilterUnit())
 return i==unitid_necrounit1 or i==unitid_necrounit2 or i==unitid_necrounit3 or i==unitid_necrounit4 or i==unitid_necrounit5 or i==unitid_necrounit6
 endfunction
 function NecronomiconLimit takes nothing returns nothing
-local group g=GetAvailableGroup()
+local unit Source=GetTriggerUnit()
+local unit Necro1
+local unit Necro2
+local integer id1
+local integer id2
+local group g=GetAvailableGroup()
+local real a=GetUnitFacing(Source)*bj_DEGTORAD
+local real x1=GetUnitX(Source)+50*Cos(a)
+local real y1=GetUnitY(Source)+50*Sin(a)
+local real x2=GetUnitX(Source)+50*Cos(a)
+local real y2=GetUnitY(Source)+50*Sin(a)
+if GetSpellAbilityId()==abilityid_necronomicon1 then
+set id1=unitid_necrounit1
+set id2=unitid_necrounit4
+elseif GetSpellAbilityId()==abilityid_necronomicon2 then
+set id1=unitid_necrounit2
+set id2=unitid_necrounit5
+elseif GetSpellAbilityId()==abilityid_necronomicon3 then
+set id1=unitid_necrounit3
+set id2=unitid_necrounit6
+endif
+set necromarker_id=GetUnitTypeId(Source)
 call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(GetTriggerUnit()),Condition(function NecronomiconLimit_Find))
 call ForGroup(g,function NecronomiconLimit_Remove)
 call KillGroup(g)
+set Necro1=CreateUnit(GetOwningPlayer(Source),id1,x1,y1,GetUnitFacing(Source))
+call SaveInteger(hash_main,(GetHandleId(Necro1)),(784),(necromarker_id))
+call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",Necro1,"origin"))
+call UnitApplyTimedLife(Necro1,1112820806,35)
+set Necro2=CreateUnit(GetOwningPlayer(Source),id2,x2,y2,GetUnitFacing(Source))
+call SaveInteger(hash_main,(GetHandleId(Necro2)),(784),(necromarker_id))
+call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",Necro2,"origin"))
+call UnitApplyTimedLife(Necro2,1112820806,35)
 set g=null
+set Necro1=null
+set Necro2=null
+set Source=null
 endfunction
 function NecronomiconLimit_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_necronomicon1 or GetSpellAbilityId()==abilityid_necronomicon2 or GetSpellAbilityId()==abilityid_necronomicon3 then
 call NecronomiconLimit()
 endif
 endfunction
 function Satanic_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_satanic then
 call TimedLifeUnitEffect("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl",GetTriggerUnit(),"origin",3.5)
 call AddTimedAbility(GetTriggerUnit(),abilityid_satanicbonus,1,3.5)
 endif
 endfunction
+function HelmOfTheDominator_Find takes nothing returns boolean
+return((LoadInteger(hash_main,(GetHandleId((GetFilterUnit()))),((4323))))==HERO_STATE_ON)
+endfunction
 function HelmOfTheDominator takes nothing returns nothing
+local group g
+local unit u
 if GetSpellAbilityId()==abilityid_helmofthedominator then
-call UnitApplyTimedLife(GetSpellTargetUnit(),1112820806,1200)
+set g=GetAvailableGroup()
+call GroupEnumUnitsOfPlayer(g,GetOwningPlayer(GetTriggerUnit()),Condition(function HelmOfTheDominator_Find))
+set u=FirstOfGroup(g)
+call KillGroup(g)
+if u!=null then
+call KillUnit(u)
+endif
+call SaveInteger(hash_main,(GetHandleId((GetSpellTargetUnit()))),((4323)),(HERO_STATE_ON))
 call UnitAddAbility(GetSpellTargetUnit(),1097167976)
 call UnitAddAbility(GetSpellTargetUnit(),1094939243)
 call SetUnitMaxMana(GetSpellTargetUnit())
 endif
 endfunction
 function BKB_GetAbility takes integer i returns integer
 if i==abilityid_bkbitem10 then
 return abilityid_bkbavatar10
 endif
 if i==abilityid_bkbitem09 then
 return abilityid_bkbavatar09
 endif
 if i==abilityid_bkbitem08 then
 return abilityid_bkbavatar08
 endif
 if i==abilityid_bkbitem07 then
 return abilityid_bkbavatar07
 endif
 if i==abilityid_bkbitem06 then
 return abilityid_bkbavatar06
 endif
 if i==abilityid_bkbitem05 then
 return abilityid_bkbavatar05
 endif
+if i==abilityid_bkbitem04 then
+return abilityid_bkbavatar04
+endif
 return 0
 endfunction
 function BKB_GetDuration takes integer i returns integer
 if i==abilityid_bkbitem10 then
 return 10
 endif
 if i==abilityid_bkbitem09 then
 return 9
 endif
 if i==abilityid_bkbitem08 then
 return 8
 endif
 if i==abilityid_bkbitem07 then
 return 7
 endif
 if i==abilityid_bkbitem06 then
 return 6
 endif
 if i==abilityid_bkbitem05 then
 return 5
 endif
+if i==abilityid_bkbitem04 then
+return 4
+endif
 return 0
 endfunction
 function BKB_FixVisual takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 if IsDead(Hero)==false and Hero!=null then
 call SetUnitScale(Hero,GetUnitScale(Hero)*GLOBALSCALE,GetUnitScale(Hero)*GLOBALSCALE,GetUnitScale(Hero)*GLOBALSCALE)
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Hero=null
 return false
 endfunction
@@ -24782,31 +25339,31 @@
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local real Damage=(LoadReal(hash_main,(Cache),(20)))
 if GetTriggerEventId()!=EVENT_UNIT_DAMAGED or GetUnitAbilityLevel(GetTriggerUnit(),abilityid_orchidbuff)==0 then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set amp_allow=true
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Damage)
 set amp_allow=false
 if Damage>0 then
 call TextTagOnUnitEx("+"+I2S(R2I(Damage)),1,Target,0.023,255,0,0,216)
 endif
 elseif GetEventDamage()>1 then
-call SaveReal(hash_main,(Cache),(20),((Damage+GetEventDamage()*0.25)*1.0))
+call SaveReal(hash_main,(Cache),(20),((Damage+GetEventDamage()*0.3)*1.0))
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function Orchid_Delayed takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
@@ -25123,31 +25680,31 @@
 function FortifyBuildings_Armor takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Tower=GetEnumUnit()
 local string s
 call UnitAddAbility(Tower,abilityid_fortify_armor)
 call UnitAddAbility(Tower,abilityid_fortify_magic)
 if IsSent(fortify_player)then
 set s="effects\\GlyphSent.mdx"
 else
 set s="effects\\GlyphScourge.mdx"
 endif
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(s,Tower,"origin")))
 call SaveUnitHandle(hash_main,(Cache),(134),(Tower))
 call TriggerRegisterUnitEvent(t,Tower,EVENT_UNIT_DEATH)
-call TriggerRegisterTimerEvent(t,4,false)
+call TriggerRegisterTimerEvent(t,fortify_duration,false)
 call TriggerAddCondition(t,Condition(function FortifyBuildings_Finish))
 set t=null
 set Tower=null
 endfunction
 function FortifyBuildings_DisableRest takes unit cop,player p returns nothing
 local integer i
 if IsSent(p)then
 set i=1
 if cop!=COP[i]then
 call IssueImmediateOrder(COP[i],"coldarrows")
 endif
 set i=2
 if cop!=COP[i]then
 call IssueImmediateOrder(COP[i],"coldarrows")
 endif
@@ -25240,55 +25797,55 @@
 set blademail_flag=true
 call DamageTarget(GetTriggerUnit(),udg_Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))],DAMAGE_PURE,GetEventDamage())
 set blademail_flag=false
 call EnableTrigger(t)
 endif
 endif
 endif
 set t=null
 return false
 endfunction
 function Blademail takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
-call TriggerRegisterTimerEvent(t,4,false)
+call TriggerRegisterTimerEvent(t,4.5,false)
 call TriggerAddCondition(t,Condition(function Blademail_Damaged))
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\SpikeBarrier\\SpikeBarrier.mdl",Source,"chest")))
 set t=null
 set Source=null
 endfunction
 function Blademail_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_blademail then
 call Blademail()
 endif
 endfunction
 function ForceStaff_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local real a=(LoadReal(hash_main,(Cache),(137)))
 local real d=(LoadReal(hash_main,(Cache),(138)))
 local real x=SafeX(GetUnitX(Target)+d/10*Cos(a*bj_DEGTORAD))
 local real y=SafeY(GetUnitY(Target)+d/10*Sin(a*bj_DEGTORAD))
-if GetTriggerEvalCount(t)==11 or GetTriggerEventId()==EVENT_UNIT_DEATH then
+if GetTriggerEvalCount(t)==11 or GetTriggerEventId()==EVENT_UNIT_DEATH or((LoadInteger(hash_main,(GetHandleId((Target))),((4260))))==HERO_STATE_ON)==true then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\FlakCannons\\FlakTarget.mdl",x,y))
-if((LoadInteger(hash_main,(GetHandleId((Target))),((4306))))==HERO_STATE_ON)==false and GetUnitAbilityLevel(Target,buffid_blackhole)==0 then
+if((LoadInteger(hash_main,(GetHandleId((Target))),((4306))))==HERO_STATE_ON)==false and((LoadInteger(hash_main,(GetHandleId((Target))),((4324))))==HERO_STATE_ON)==false and GetUnitAbilityLevel(Target,buffid_blackhole)==0 then
 call KillTrees(x,y,150)
 call SetUnitX(Target,x)
 call SetUnitY(Target,y)
 endif
 endif
 set Target=null
 set t=null
 return false
 endfunction
 function ForceStaff takes nothing returns nothing
 local unit Target=GetSpellTargetUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local real x
 local real y
@@ -25368,62 +25925,73 @@
 set Source=null
 set t=null
 endfunction
 function EtherBlast_AddToEnemies takes nothing returns nothing
 call EtherBlast_Add(GetEnumUnit())
 endfunction
 function EtherBlast_DamageEnemies takes nothing returns nothing
 call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_MAGICAL,etherblast_damage)
 endfunction
 function EtherBlast_Process takes nothing returns nothing
 local integer Cache=GetHandleId(GetTriggeringTrigger())
 local unit Source=tt_unit1
 local unit Target=tt_unit2
 local real Damage=(LoadReal(hash_main,(Cache),(20)))
 local trigger t
-if Source!=Target then
+if IsPlayerAlly(GetOwningPlayer(Target),GetOwningPlayer(Source))==true and Source!=Target then
+call EtherBlast_Add(Target)
+elseif Source!=Target then
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Target),etherblast_ms,false)
 call UnitAddAbility(Target,etherblast_ms)
 call UnitMakeAbilityPermanent(Target,true,etherblast_ms)
 call TriggerRegisterTimerEvent(t,0.1,true)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function EtherBlast_EndMS))
 call SaveUnitHandle(hash_main,(Cache),(2),(Target))
 call EtherBlast_Add(Target)
 call TextTagOnUnitEx("+"+I2S(R2I(Damage)),2,Target,0.027,3,216,120,216)
 set amp_allow=true
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Damage)
 set amp_allow=false
 endif
 call EtherBlast_Add(Source)
 set Source=null
 set Target=null
 endfunction
 function EtherBlast takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local trigger t2=CreateProjectileToUnit(Source,Target,1747993171,"EtherBlast_Process",1000)
 local integer Cache2=GetHandleId(t2)
-call SaveReal(hash_main,(Cache2),(20),((GetHeroAgi(Source,true)*2.0+75)*1.0))
+local integer Type=GetHeroType(Source)
+local real Attribute
+if Type==HEROTYPE_AGI then
+set Attribute=GetHeroAgi(Source,true)
+elseif Type==HEROTYPE_STR then
+set Attribute=GetHeroStr(Source,true)
+elseif Type==HEROTYPE_INT then
+set Attribute=GetHeroInt(Source,true)
+endif
+call SaveReal(hash_main,(Cache2),(20),((Attribute*2.0+75)*1.0))
 set Source=null
 set Target=null
 set t2=null
 endfunction
 function EtherBlast_Main takes nothing returns nothing
-if GetSpellAbilityId()==abilityid_etherblast and(GetSpellTargetUnit()==GetTriggerUnit()or IsBlocked(GetSpellTargetUnit())==false)then
+if GetSpellAbilityId()==abilityid_etherblast and(IsPlayerAlly(GetOwningPlayer(GetSpellTargetUnit()),GetOwningPlayer(GetTriggerUnit()))==true or IsBlocked(GetSpellTargetUnit())==false)then
 call EtherBlast()
 endif
 endfunction
 function GhostPotion_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 if GetTriggerEvalCount(t)>40 or GetTriggerEventId()==EVENT_UNIT_DEATH or IsMagicImmune(Source)or((LoadInteger(hash_main,(GetHandleId((Source))),((4256))))==HERO_STATE_ON)then
 call UnitRemoveAbility(Source,1097167980)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set Source=null
 set t=null
 return false
@@ -25697,32 +26265,36 @@
 call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),925,Condition(function GenericCondition_AlliedPlayerUnits))
 call ForGroup(g,function AncientJangoo_Hit)
 call KillGroup(g)
 set g=null
 set Source=null
 endfunction
 function AncientJangoo_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_ancientjangoo then
 call AncientJangoo()
 endif
 endfunction
 function IsFakeHeroBuilding takes unit u returns boolean
 local integer unitid=GetUnitTypeId(u)
 return unitid==1211122232 or unitid==1848657482 or unitid==1848657481 or unitid==1848657462 or unitid==1848657480 or unitid==1966092371
 endfunction
+function IsSmokeException takes unit u returns boolean
+local integer id=GetUnitTypeId(u)
+return PrimalSplit_IsPanda(id)
+endfunction
 function SmokeOfDeceit_Find takes nothing returns boolean
-return IsUnitEnemy(GetFilterUnit(),smokeofdeceit_player)and IsDead(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true or IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==true)and IsFakeHeroBuilding(GetFilterUnit())==false
+return IsUnitEnemy(GetFilterUnit(),smokeofdeceit_player)and IsDead(GetFilterUnit())==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true or IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==true or IsSmokeException(GetFilterUnit()))and IsFakeHeroBuilding(GetFilterUnit())==false
 endfunction
 function SmokeOfDeceit_IsNearby takes unit Source returns boolean
 local group g=GetAvailableGroup()
 local boolean found
 set smokeofdeceit_player=GetOwningPlayer(Source)
 call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1050,Condition(function SmokeOfDeceit_Find))
 set found=FirstOfGroup(g)!=null
 call KillGroup(g)
 return found
 endfunction
 function SmokeOfDeceit_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local group g
@@ -25819,31 +26391,31 @@
 endfunction
 function InitTrig_Smoke_of_Deceit takes nothing returns nothing
 call SetAltMinimapIcon("war3mapImported\\black.blp")
 endfunction
 function VeilOfDiscord_Hit takes nothing returns nothing
 if IsRealSummoned(GetEnumUnit())==false then
 call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()),veilofdiscord,false)
 call AddTimedAbilityAndRemove(GetEnumUnit(),veilofdiscord,1,veilofdiscord_duration,veilofdiscord_buffid)
 endif
 endfunction
 function VeilOfDiscord takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local group g=GetAvailableGroup()
 local real x=GetSpellTargetX()
 local real y=GetSpellTargetY()
-call GroupEnumUnitsInRange(g,x,y,525,Condition(function GenericCondition_EnemyUnits))
+call GroupEnumUnitsInRange(g,x,y,575,Condition(function GenericCondition_EnemyUnits))
 call ForGroup(g,function VeilOfDiscord_Hit)
 call KillGroup(g)
 call DestroyEffect(AddSpecialEffect(veilofdiscord_fx,x,y))
 set Source=null
 set g=null
 endfunction
 function VeilOfDiscord_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_veilofdiscord then
 call VeilOfDiscord()
 endif
 endfunction
 function CripplingStaff_Remove takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
@@ -25933,30 +26505,108 @@
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterDeathEvent(t,Source)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
 call TriggerAddCondition(t,Condition(function TranquilBoots_Heal))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveInteger(hash_main,(Cache),(34),(0))
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\TranquilBootsHeal.mdx",Source,"origin")))
 set Source=null
 set t=null
 endfunction
 function TranquilBoots_Main takes nothing returns nothing
 if GetSpellAbilityId()==abilityid_tranquilboots then
 call TranquilBoots()
 endif
 endfunction
+function ShadowAmulet_Check takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local real x=(LoadReal(hash_main,(Cache),(6)))
+local real y=(LoadReal(hash_main,(Cache),(7)))
+local unit Caster
+if GetUnitX(Source)!=x or GetUnitY(Source)!=y or(GetUnitAbilityLevel(Source,shadowamulet_buffid2)==0 and GetTriggerEvalCount(t)>R2I(shadowamulet_fadetime/.05))then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call SaveInteger(hash_main,(GetHandleId((Source))),((4330)),(HERO_STATE_OFF))
+call UnitRemoveAbility(Source,shadowamulet_buffid1)
+call UnitRemoveAbility(Source,shadowamulet_buffid2)
+elseif GetTriggerEvalCount(t)==R2I(shadowamulet_fadetime/.05)then
+set Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Source),GetUnitY(Source),0)
+call UnitAddAbility(Caster,1093815861)
+call IssueTargetOrder(Caster,"invisibility",Source)
+call SaveInteger(hash_main,(GetHandleId((Source))),((4330)),(HERO_STATE_OFF))
+set Caster=null
+endif
+set t=null
+set Source=null
+return false
+endfunction
+function ShadowAmulet_InitialCheck takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local real x=(LoadReal(hash_main,(Cache),(6)))
+local real y=(LoadReal(hash_main,(Cache),(7)))
+local integer OtherCache=(LoadInteger(hash_main,(Cache),(375)))
+local integer id=GetUnitCurrentOrder(Source)
+if GetUnitX(Source)!=x or GetUnitY(Source)!=y then
+call IssueImmediateOrder(Source,"holdposition")
+call SaveReal(hash_main,(OtherCache),(6),((GetUnitX(Source))*1.0))
+call SaveReal(hash_main,(OtherCache),(7),((GetUnitY(Source))*1.0))
+elseif id==0 or id==851973 or id==851983 or id==851971 then
+call IssueImmediateOrder(Source,"holdposition")
+endif
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=null
+set Source=null
+return false
+endfunction
+function ShadowAmulet takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local trigger t2=CreateTrigger()
+local integer Cache2=GetHandleId(t2)
+local string fxpath=shadowamulet_castfx
+if GetLocalPlayer()!=GetOwningPlayer(Source)then
+set fxpath=""
+endif
+call SaveInteger(hash_main,(GetHandleId((Source))),((4330)),(HERO_STATE_ON))
+call DestroyEffect(AddSpecialEffectTarget(fxpath,Source,"chest"))
+call DestroyEffect(AddSpecialEffectTarget(fxpath,Source,"hand left"))
+call DestroyEffect(AddSpecialEffectTarget(fxpath,Source,"hand right"))
+call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerAddCondition(t,Condition(function ShadowAmulet_Check))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveReal(hash_main,(Cache),(6),((GetUnitX(Source))*1.0))
+call SaveReal(hash_main,(Cache),(7),((GetUnitY(Source))*1.0))
+call TriggerRegisterTimerEvent(t2,0.01,false)
+call TriggerAddCondition(t2,Condition(function ShadowAmulet_InitialCheck))
+call SaveUnitHandle(hash_main,(Cache2),(2),(Source))
+call SaveReal(hash_main,(Cache2),(6),((GetUnitX(Source))*1.0))
+call SaveReal(hash_main,(Cache2),(7),((GetUnitY(Source))*1.0))
+call SaveInteger(hash_main,(Cache2),(375),(Cache))
+set Source=null
+set t=null
+endfunction
+function ShadowAmulet_Main takes nothing returns nothing
+if GetSpellAbilityId()==1093815857 and((LoadInteger(hash_main,(GetHandleId((GetTriggerUnit()))),((4330))))==HERO_STATE_ON)==false then
+call ShadowAmulet()
+endif
+endfunction
 function Prudence takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local unit Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
 local integer Level=2
 if IsUnitType(Target,UNIT_TYPE_MELEE_ATTACKER)==true then
 set Level=1
 endif
 call UnitAddAbility(Caster,1093815093)
 call SetUnitAbilityLevel(Caster,1093815093,Level)
 call IssueTargetOrder(Caster,"drunkenhaze",Target)
 set Source=null
 set Target=null
 set Caster=null
 endfunction
@@ -26226,30 +26876,31 @@
 call EtherBlast_Main()
 call Euls_Main()
 call ArcaneBoots_Main()
 call HandOfMidas_Main()
 call Regeneration_SelfClick_Main()
 call MedallionOfCourage_Main()
 call Corruptor_Main()
 call AncientJangoo_Main()
 call SmokeOfDeceit_Main()
 call VeilOfDiscord_Main()
 call CripplingStaff_Main()
 call BladeOfTheReaper_Main()
 call Dagon_Main()
 call TranquilBoots_Main()
 call Prudence_Main()
+call ShadowAmulet_Main()
 if GetSpellAbilityId()==1093815095 and IsBlocked(GetSpellTargetUnit())==false then
 call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\LevelerStunFX.mdx",GetSpellTargetUnit(),"head"))
 endif
 return false
 endfunction
 function InitTrig_Cast_Item takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function CastItem_Main))
 call SetPlayerAbilityAvailable(udg_SentPlayers[1],1093752406,false)
 call SetPlayerAbilityAvailable(udg_SentPlayers[2],1093752406,false)
 call SetPlayerAbilityAvailable(udg_SentPlayers[3],1093752406,false)
 call SetPlayerAbilityAvailable(udg_SentPlayers[4],1093752406,false)
 call SetPlayerAbilityAvailable(udg_SentPlayers[5],1093752406,false)
 call SetPlayerAbilityAvailable(udg_ScourgePlayers[1],1093752406,false)
@@ -32051,33 +32702,34 @@
 set Hero=null
 set l=null
 endfunction
 function TeleportationEffect_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_bootsoftravel then
 call TeleportationEffect()
 endif
 return false
 endfunction
 function InitTrig_Teleportation_Effect takes nothing returns nothing
 endfunction
 function RestrictHeroes takes nothing returns nothing
 call TechHeroForAll(1160786502)
 call TechHeroForAll(1311780946)
 call TechHeroForAll(1311788336)
-call TechHeroForAll(1160786738)
 call TechHeroForAll(1160786507)
-call TechHeroForAll(1211122767)
+call TechHeroForAll(1311788343)
+call TechHeroForAll(1311788363)
+call TechHeroForAll(1211117616)
 endfunction
 function KillCourier_Sent takes nothing returns nothing
 if IsCourier(GetEnumUnit())and IsUnitAlly(GetEnumUnit(),udg_SentPlayers[0])==false and GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)>0.5 then
 call UnitRemoveAbility(GetEnumUnit(),1110456392)
 call DamageTarget(SentinelBuilding_Well,GetEnumUnit(),DAMAGE_PHYSICAL,500)
 endif
 endfunction
 function KillCourier_Scourge takes nothing returns nothing
 if IsCourier(GetEnumUnit())and IsUnitAlly(GetEnumUnit(),udg_ScourgePlayers[0])==false and GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)>0.5 then
 call UnitRemoveAbility(GetEnumUnit(),1110456392)
 call DamageTarget(ScourgeBuilding_Well,GetEnumUnit(),DAMAGE_PHYSICAL,500)
 endif
 endfunction
 function KillCourier takes nothing returns boolean
 local group g=GetAvailableGroup()
@@ -32285,34 +32937,34 @@
 call TriggerAddAction(gt_scourgewin,function EndGameCode_Scourge)
 endfunction
 function AntiTK_Percent takes real value returns boolean
 return(100*GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)/GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE))<value
 endfunction
 function AntiTK_Building takes nothing returns boolean
 return AntiTK_Percent(10)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==true and GetUnitTypeId(GetTriggerUnit())!=1702129516 and GetUnitTypeId(GetTriggerUnit())!=1970172012
 endfunction
 function AntiTK_Hero takes nothing returns boolean
 return AntiTK_Percent(25)and(GetUnitAbilityLevel(GetTriggerUnit(),1112433775)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1111847784)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110454321)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110458705)>0 or GetUnitAbilityLevel(GetTriggerUnit(),buffid_shadowword_damage)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455620)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455629)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455630)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455631)>0)
 endfunction
 function AntiTK_Creep takes nothing returns boolean
 return AntiTK_Percent(50)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false and(IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false or GetUnitTypeId(GetTriggerUnit())==1700946284 or GetUnitTypeId(GetTriggerUnit())==1697657398 or GetUnitTypeId(GetTriggerUnit())==1970107511 or GetUnitTypeId(GetTriggerUnit())==1966092370)
 endfunction
 function AntiTK_Exception takes nothing returns boolean
-return GetUnitTypeId(GetTriggerUnit())==1966092371 or GetUnitTypeId(GetTriggerUnit())==1865429334
+return GetUnitTypeId(GetTriggerUnit())==1966092371 or GetUnitTypeId(GetTriggerUnit())==1865429334 or((LoadInteger(hash_main,(GetHandleId((GetAttacker()))),((4328))))==HERO_STATE_ON)==true
 endfunction
 function AntiTK_Main takes nothing returns nothing
-if not((AntiTK_Percent(10)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==true and GetUnitTypeId(GetTriggerUnit())!=1702129516 and GetUnitTypeId(GetTriggerUnit())!=1970172012)or(AntiTK_Percent(25)and(GetUnitAbilityLevel(GetTriggerUnit(),1112433775)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1111847784)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110454321)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110458705)>0 or GetUnitAbilityLevel(GetTriggerUnit(),buffid_shadowword_damage)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455620)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455629)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455630)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455631)>0))or(AntiTK_Percent(50)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false and(IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false or GetUnitTypeId(GetTriggerUnit())==1700946284 or GetUnitTypeId(GetTriggerUnit())==1697657398 or GetUnitTypeId(GetTriggerUnit())==1970107511 or GetUnitTypeId(GetTriggerUnit())==1966092370))or(GetUnitTypeId(GetTriggerUnit())==1966092371 or GetUnitTypeId(GetTriggerUnit())==1865429334))then
+if not((AntiTK_Percent(10)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==true and GetUnitTypeId(GetTriggerUnit())!=1702129516 and GetUnitTypeId(GetTriggerUnit())!=1970172012)or(AntiTK_Percent(25)and(GetUnitAbilityLevel(GetTriggerUnit(),1112433775)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1111847784)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110454321)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110458705)>0 or GetUnitAbilityLevel(GetTriggerUnit(),buffid_shadowword_damage)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455620)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455629)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455630)>0 or GetUnitAbilityLevel(GetTriggerUnit(),1110455631)>0))or(AntiTK_Percent(50)and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==false and(IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false or GetUnitTypeId(GetTriggerUnit())==1700946284 or GetUnitTypeId(GetTriggerUnit())==1697657398 or GetUnitTypeId(GetTriggerUnit())==1970107511 or GetUnitTypeId(GetTriggerUnit())==1966092370))or(GetUnitTypeId(GetTriggerUnit())==1966092371 or GetUnitTypeId(GetTriggerUnit())==1865429334 or((LoadInteger(hash_main,(GetHandleId((GetAttacker()))),((4328))))==HERO_STATE_ON)==true))then
 call IssueImmediateOrder(GetAttacker(),"stop")
 endif
 endfunction
 function AntiTK takes nothing returns boolean
 if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))then
 call AntiTK_Main()
 elseif IsUnitType(GetAttacker(),UNIT_TYPE_HERO)==true or IsSpiritBear(GetAttacker())then
 set antitk_playerid=GetPlayerId(GetOwningPlayer(GetAttacker()))
 if HasItem_Javelin[antitk_playerid]>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(GetTriggerUnit())!=1848651852 and IsUnitIllusion(GetAttacker())==false and UnitHasItemOfType(GetAttacker(),Item_Real[indexid_javelin])==true then
 call Javelin()
 endif
 if HasItem_CraniumBasher[antitk_playerid]>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(GetAttacker())==false and(UnitHasItemOfType(GetAttacker(),Item_Real[indexid_craniumbasher])==true or UnitHasItemOfType(GetAttacker(),Item_Real[indexid_annihilator])==true)then
 call CraniumBasher_Main()
 endif
 if HasItem_SangeAndYasha[antitk_playerid]>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitIllusion(GetAttacker())==false and UnitHasItemOfType(GetAttacker(),Item_Real[indexid_sangeandyasha])==true then
@@ -32382,30 +33034,33 @@
 call SaveBoolean(hash_main,(GetHandleId(Hero)),(140),(false))
 call SaveInteger(hash_main,(GetHandleId((Hero))),((4259)),(HERO_STATE_ON))
 call UnitAddAbility(Hero,1093678162)
 call SetUnitInvulnerable2(Hero,true)
 call PauseUnit(Hero,true)
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call SaveReal(hash_main,(Cache),(6),((GetUnitX(Hero))*1.0))
 call SaveReal(hash_main,(Cache),(7),((GetUnitY(Hero))*1.0))
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function ShieldLeaver_Unfreeze))
 set t=null
 set Hero=null
 endfunction
 function ShieldLeaver takes nothing returns boolean
+if udg_ModeTT==true then
+return false
+endif
 if GetSpellAbilityId()==abilityid_shieldleaverfreeze and(GetPlayerSlotState(GetOwningPlayer((GetSpellTargetUnit())))==PLAYER_SLOT_STATE_LEFT)and((LoadInteger(hash_main,(GetHandleId((GetSpellTargetUnit()))),((4259))))==HERO_STATE_ON)==false then
 call ShieldLeaver_Freeze()
 elseif(GetSpellAbilityId()==abilityid_shieldleaverunfreeze or GetSpellAbilityId()==abilityid_shieldleaverfreeze)and(GetPlayerSlotState(GetOwningPlayer((GetSpellTargetUnit())))==PLAYER_SLOT_STATE_LEFT)==false then
 call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName(MSG_TARGET_LEAVERS))
 endif
 return false
 endfunction
 function InitTrig_Shield_Leaver takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function ShieldLeaver))
 set t=null
 endfunction
 function TreeRespawn_IsNearUnits takes destructable d returns boolean
 local real x=GetDestructableX(d)
@@ -33471,48 +34126,52 @@
 call ForGroup(g,function HeroAI_AddAttackers)
 call KillGroup(g)
 call TimerStart((LoadTimerHandle(hash_main,(Cache),(141))),2,false,function HeroAI_TimerExpire)
 set Defenders=null
 set PreviousAttacker=null
 set g=null
 endfunction
 function HeroAI_IssuedOrder_Main takes nothing returns boolean
 local unit Hero=GetTriggerUnit()
 local unit Target=GetOrderTargetUnit()
 local integer order_id=GetIssuedOrderId()
 local integer AttackIndex
 if IsUnitType(Target,UNIT_TYPE_HERO)==true and IsUnitIllusion(Target)==false and(order_id==851983 or order_id==851971)and IsUnitEnemy(Target,GetOwningPlayer(Hero))and IsUnitVisible(Hero,GetOwningPlayer(Target))then
 set AttackIndex=(LoadInteger(hash_main,(GetHandleId(Target)),(143)))
 if HeroAI_Attackers[AttackIndex]==null or HeroAI_Attackers[AttackIndex]==Target or IsDead(HeroAI_Attackers[AttackIndex])then
+if AttackIndex!=0 then
 call HeroAI_Defend(Target,Hero)
 endif
 endif
+endif
 set Hero=null
 set Target=null
 return false
 endfunction
 function HeroAI_Attacked_Main takes nothing returns boolean
 local unit Hero=GetAttacker()
 local unit Target=GetTriggerUnit()
 local integer order_id=GetIssuedOrderId()
 local integer AttackIndex
 if IsCreep(Hero)==false then
 set AttackIndex=(LoadInteger(hash_main,(GetHandleId(Target)),(143)))
 if HeroAI_Attackers[AttackIndex]==null or HeroAI_Attackers[AttackIndex]==Target or IsDead(HeroAI_Attackers[AttackIndex])then
+if AttackIndex!=0 then
 call HeroAI_Defend(Target,Hero)
 endif
 endif
+endif
 set Hero=null
 set Target=null
 return false
 endfunction
 function HeroAI_Create takes unit Hero returns nothing
 local group g
 local trigger t
 local timer tm
 local integer Cache=GetHandleId(Hero)
 set heroai_maxindex=heroai_maxindex+1
 call SaveBoolean(hash_main,(Cache),(142),(true))
 call SaveInteger(hash_main,(Cache),(143),(heroai_maxindex))
 set g=GetAvailableGroup()
 call SaveGroupHandle(hash_main,(Cache),(144),(g))
 set t=CreateTrigger()
@@ -36769,32 +37428,49 @@
 if UnlockedBool[GetPlayerId(udg_SentPlayers[switch_choice])]==false then
 call Switch_Process(GetTriggerPlayer(),udg_SentPlayers[switch_choice])
 else
 call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,GetObjectName(1848658009))
 endif
 endif
 endif
 endif
 endfunction
 function Command_NoSwitch takes nothing returns nothing
 if udg_Elapsed15==false and switch_enabled and GetTriggerPlayer()==udg_Host then
 set switch_enabled=false
 call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10,GetObjectName(MSG_SWITCH_15))
 endif
 endfunction
+function CommandSleep_Main takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+set t=null
+return false
+endfunction
 function Command_Sleep takes nothing returns nothing
-call SetUnitAnimation(udg_Hero[GetPlayerId(GetTriggerPlayer())],"sleep")
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=udg_Hero[GetPlayerId(GetTriggerPlayer())]
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Sleep\\SleepTarget.mdl",Source,"overhead")))
+call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_ORDER)
+call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_TARGET_ORDER)
+call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_POINT_ORDER)
+call TriggerAddCondition(t,Condition(function CommandSleep_Main))
+call SetUnitAnimation(Source,"sleep")
+set t=null
+set Source=null
 endfunction
 function Command_Calm takes nothing returns nothing
 call SetUnitAnimationByIndex(udg_Hero[GetPlayerId(GetTriggerPlayer())],23)
 endfunction
 function Command_NoHat takes nothing returns nothing
 if udg_Hero[GetPlayerId(GetTriggerPlayer())]!=null then
 set nohat_setting[GetPlayerId(GetTriggerPlayer())]=1
 call UnitRemoveAbility(udg_Hero[GetPlayerId(GetTriggerPlayer())],1093815114)
 endif
 endfunction
 function Command_Tips takes nothing returns nothing
 if tips_enabled[GetPlayerId(GetTriggerPlayer())]==false then
 set tips_enabled[GetPlayerId(GetTriggerPlayer())]=true
 if GetObjectName(1848657992)=="Language: English"then
 call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,0,10,"You have activated the -tips system.")
@@ -37267,30 +37943,31 @@
 local boolean XL
 local boolean SD
 local boolean PM
 local boolean OI
 local boolean MI
 local boolean CM
 local boolean FR
 local boolean MO
 local boolean RO
 local boolean ER
 local boolean CD
 local boolean RS
 local boolean CP
 local boolean ZM
 local boolean UB
+local boolean TT
 set LongModeArray[1]="allpick"
 set ShortModeArray[1]="ap"
 set LongModeArray[2]="allrandom"
 set ShortModeArray[2]="ar"
 set LongModeArray[3]="leaguemode"
 set ShortModeArray[3]="lm"
 set LongModeArray[4]="mirrormatch"
 set ShortModeArray[4]="mm"
 set LongModeArray[5]="teamrandom"
 set ShortModeArray[5]="tr"
 set LongModeArray[6]="deathmatch"
 set ShortModeArray[6]="dm"
 set LongModeArray[7]="moderandom"
 set ShortModeArray[7]="mr"
 set LongModeArray[8]="shuffleplayers"
@@ -37351,31 +38028,33 @@
 set ShortModeArray[35]="mo"
 set LongModeArray[36]="rangeonly"
 set ShortModeArray[36]="ro"
 set LongModeArray[37]="experimentalrunes"
 set ShortModeArray[37]="er"
 set LongModeArray[38]="randomside"
 set ShortModeArray[38]="rs"
 set LongModeArray[39]="switchon"
 set ShortModeArray[39]="so"
 set LongModeArray[40]="zoommode"
 set ShortModeArray[40]="zm"
 set LongModeArray[41]="capturepoint"
 set ShortModeArray[41]="cp"
 set LongModeArray[42]="unban"
 set ShortModeArray[42]="ub"
-set NumModes=42
+set LongModeArray[43]="tagteam"
+set ShortModeArray[43]="tt"
+set NumModes=43
 set x=-1
 loop
 exitwhen x==Length-1
 set x=x+1
 set y=x
 loop
 exitwhen y==Length
 set y=y+1
 set z=1
 loop
 exitwhen z>NumModes
 if LongModeArray[z]==SubString(ChatString,x,y)then
 set GameModeArray[z]=true
 set z=NumModes+1
 set ChatString=StripString(ChatString,x,y)
@@ -37442,102 +38121,107 @@
 set CD=GameModeArray[28]
 set SD=GameModeArray[29]
 set PM=GameModeArray[30]
 set OI=GameModeArray[31]
 set MI=GameModeArray[32]
 set CM=GameModeArray[33]
 set FR=GameModeArray[34]
 set MO=GameModeArray[35]
 set RO=GameModeArray[36]
 set ER=GameModeArray[37]
 set RS=GameModeArray[38]
 set SO=GameModeArray[39]
 set ZM=GameModeArray[40]
 set CP=GameModeArray[41]
 set UB=GameModeArray[42]
+set TT=GameModeArray[43]
 if ChatString!=""or IsGameCommand(ModeString)then
 return
 endif
-if(AR and(CM or AP or TR or LM or MR or RV or RD or CD or SD))or(AP and(TR or MR))or(TR and(LM or MR))or(LM and MR)or(MM and SH)then
+if(AR and(CM or AP or TR or LM or MR or RV or RD or CD or SD or TT))or(AP and(TR or MR))or(TR and(LM or MR))or(LM and MR)or(MM and SH)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
 if(AA and(AI or AS or DM))or(AS and(AI or DM))or(AI and DM)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
 if(RO and(MO or DM))or(MO and DM)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
-if RV and(CM or AR or TR or MR or LM or DM or SH)then
+if RV and(CM or AR or TR or MR or LM or DM or SH or TT)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
-if(DM and(CM or TR or LM or MR or SH or RV or RD or CD or SD))or(MM and DM)or(SH and DM)then
+if(DM and(CM or TR or LM or MR or SH or RV or RD or CD or SD or TT))or(MM and DM)or(SH and DM)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_DM))
 return
 endif
-if LM and(CM or AP or RD or CD or AR or SD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or XL or MO or RO)then
+if LM and(TT or CM or AP or RD or CD or AR or SD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or XL or MO or RO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_LM))
 return
 endif
-if XL and(CM or AP or RD or CD or AR or SD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or LM or RO or MO)then
+if XL and(TT or CM or AP or RD or CD or AR or SD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or LM or RO or MO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_XL))
 return
 endif
-if CM and(SP or XL or AP or RD or CD or AR or SD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or LM or MO or RO)then
+if CM and(TT or SP or XL or AP or RD or CD or AR or SD or MM or TR or DM or MR or AA or AI or AS or ID or NP or SC or EM or DU or SH or RV or OM or NB or NM or NT or LM or MO or RO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_XL))
 return
 endif
-if RD and(CD or CM or AP or LM or AR or SD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
+if RD and(TT or CD or CM or AP or LM or AR or SD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
+call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
+return
+endif
+if CD and(TT or RD or CM or AP or LM or AR or SD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
-if CD and(RD or CM or AP or LM or AR or SD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
+if MR and(TT or CM or AP or LM or AR or SD or MM or TR or DM or AA or AI or AS or SH or RV or RO or MO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
-if MR and(CM or AP or LM or AR or SD or MM or TR or DM or AA or AI or AS or SH or RV or RO or MO)then
+if SD and(TT or CM or AP or LM or AR or RD or CD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
-if SD and(CM or AP or LM or AR or RD or CD or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
+if VR and(TT or CM or LM or RD or CD or SD or AR or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
-if VR and(CM or LM or RD or CD or SD or AR or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
+if TT and(SO or VR or CM or LM or RD or CD or SD or AR or MM or TR or DM or MR or AA or AI or AS or SH or RV or RO or MO)then
 call Error(udg_Host,GetObjectName(MSG_INVALID_MODE))
 return
 endif
 if MM and CountRealPlayersInForce(udg_ForceSent)!=CountRealPlayersInForce(udg_ForceScourge)then
 call Error(udg_Host,GetObjectName(MSG_MM_EVEN))
 return
 endif
 if VR and CountRealPlayersInForce(udg_ForceSent)!=CountRealPlayersInForce(udg_ForceScourge)then
 call Error(udg_Host,GetObjectName(MSG_MM_EVEN))
 return
 endif
 if RV and CountRealPlayersInForce(udg_ForceSent)!=CountRealPlayersInForce(udg_ForceScourge)then
 call Error(udg_Host,GetObjectName(MSG_MM_EVEN))
 return
 endif
 if LM and not(IsPlayer(udg_SentPlayers[1])and IsPlayer(udg_SentPlayers[2])and IsPlayer(udg_SentPlayers[3])and IsPlayer(udg_SentPlayers[4])and IsPlayer(udg_SentPlayers[5])and IsPlayer(udg_ScourgePlayers[1])and IsPlayer(udg_ScourgePlayers[2])and IsPlayer(udg_ScourgePlayers[3])and IsPlayer(udg_ScourgePlayers[4])and IsPlayer(udg_ScourgePlayers[5]))then
 endif
 if XL and not(IsPlayer(udg_SentPlayers[1])and IsPlayer(udg_SentPlayers[2])and IsPlayer(udg_SentPlayers[3])and IsPlayer(udg_SentPlayers[4])and IsPlayer(udg_SentPlayers[5])and IsPlayer(udg_ScourgePlayers[1])and IsPlayer(udg_ScourgePlayers[2])and IsPlayer(udg_ScourgePlayers[3])and IsPlayer(udg_ScourgePlayers[4])and IsPlayer(udg_ScourgePlayers[5]))then
 endif
-if ZM or CP or FR or CM or AP or AR or LM or MM or TR or DM or MR or SP or AA or AI or AS or ID or NP or SC or DU or EM or SH or VR or RV or RD or CD or OM or NB or NM or NT or NS or NR or XL or SD or PM or OI or MI or MO or RO or ER or RS or SO then
+if TT or ZM or CP or FR or CM or AP or AR or LM or MM or TR or DM or MR or SP or AA or AI or AS or ID or NP or SC or DU or EM or SH or VR or RV or RD or CD or OM or NB or NM or NT or NS or NR or XL or SD or PM or OI or MI or MO or RO or ER or RS or SO then
 call DisableTrigger(t_gamemode)
 else
 return
 endif
 if CM==false then
 call Trig_display_leaderboard_Actions()
 call CreateObsBoard()
 endif
 if LM==false and XL==false then
 call DOnOff_Main()
 endif
 set GameMode=CleanString(ModeString)
 if isHCL then
 call Traffic_RegisterData("Mode"+GameMode,0)
 else
@@ -37560,34 +38244,39 @@
 set udg_MultiboardMode=GetObjectName(1848658243)
 elseif AP then
 set udg_MultiboardMode=GetObjectName(1848658244)
 elseif AR then
 set udg_MultiboardMode=GetObjectName(1848658231)
 elseif TR then
 set udg_MultiboardMode=GetObjectName(1848658230)
 elseif MR then
 set udg_MultiboardMode=GetObjectName(1848658250)
 elseif VR then
 set udg_MultiboardMode=GetObjectName(1848658229)
 elseif SD then
 set udg_MultiboardMode=GetObjectName(1848658228)
 elseif CM then
 set udg_MultiboardMode=GetObjectName(1848658247)
+elseif TT then
+set udg_MultiboardMode=GetObjectName(1848659280)
 endif
 if CM then
 call AddModeString(GetObjectName(1848658251))
 endif
+if TT then
+call AddModeString(GetObjectName(1848659281))
+endif
 if LM then
 call AddModeString(GetObjectName(1848658227))
 endif
 if XL then
 call AddModeString(GetObjectName(1848658226))
 endif
 if RD then
 call AddModeString(GetObjectName(1848658246))
 endif
 if CD then
 call AddModeString(GetObjectName(1848658225))
 endif
 if DM then
 call AddModeString(GetObjectName(1848658241))
 endif
@@ -37737,30 +38426,31 @@
 call ExecuteOnTrue("ModeOM",OM)
 call ExecuteOnTrue("ModeNB",NB)
 call ExecuteOnTrue("ModeNT",NT)
 call ExecuteOnTrue("ModeNM",NM)
 call ExecuteOnTrue("ModeSO",SO)
 call ExecuteOnTrue("ModeNS",NS)
 call ExecuteOnTrue("ModeNR",NR)
 call ExecuteOnTrue("ModePM",PM)
 call ExecuteOnTrue("ModeOI",OI)
 call ExecuteOnTrue("ModeMI",MI)
 call ExecuteOnTrue("ModeFR",FR)
 call ExecuteOnTrue("ModeER",ER)
 call ExecuteOnTrue("ModeCD",CD)
 call ExecuteOnTrue("ModeZM",ZM)
 call ExecuteOnTrue("ModeCP",CP)
+call ExecuteOnTrue("ModeTT",TT)
 set ModeCreated=true
 call SetTime(0,0,false)
 if udg_ModeCM==false and udg_ModeCD==false then
 call ModePicked()
 endif
 call UpdateCSBoard()
 if SO==false then
 set UnlockedBool[0]=true
 set UnlockedBool[1]=true
 set UnlockedBool[2]=true
 set UnlockedBool[3]=true
 set UnlockedBool[4]=true
 set UnlockedBool[5]=true
 set UnlockedBool[6]=true
 set UnlockedBool[7]=true
@@ -39823,57 +40513,53 @@
 call ShowUnit(IntTavern4,false)
 call ShowUnit(StrTavern1,false)
 call ShowUnit(StrTavern2,false)
 call ShowUnit(StrTavern3,false)
 call ShowUnit(StrTavern4,false)
 call ShowUnit(AgiTavern1,false)
 call ShowUnit(AgiTavern2,false)
 call ShowUnit(AgiTavern3,false)
 call ShowUnit(AgiTavern4,false)
 set i=1
 loop
 exitwhen i>RD_COUNT
 set Rand=GiveRandomHeroNumber(true,true)
 if Rigged1 then
 set Rigged1=false
-set Rand=50
+set Rand=91
 elseif Rigged2 then
 set Rigged2=false
 set Rand=51
 elseif Rigged3 then
 set Rigged3=false
-set Rand=104
+set Rand=99
 elseif Rigged4 then
 set Rigged4=false
+if GetRandomInt(1,2)==1 then
+set Rand=104
+else
 set Rand=65
+endif
 elseif Rigged5 then
 set Rigged5=false
-set Rand=49
+set Rand=109
 elseif Rigged6 then
 set Rigged6=false
-if GetRandomInt(1,2)==1 then
-set Rand=16
-else
-set Rand=86
-endif
+set Rand=15
 elseif Rigged7 then
 set Rigged7=false
-if GetRandomInt(1,2)==1 then
-set Rand=73
-else
-set Rand=83
-endif
+set Rand=110
 elseif Rigged8 then
 set Rigged8=false
 elseif Rigged9 then
 set Rigged9=false
 endif
 if Given[Rand]==false and((Rand)!=23)then
 set Given[Rand]=true
 set RD_HeroPool[i]=Rand
 set i=i+1
 endif
 endloop
 set RD_VisionUnits[1]=CreateUnit(udg_SentPlayers[0],1848656963,RD_CenterX_Sent,RD_CenterY_Sent,0)
 set RD_VisionUnits[2]=CreateUnit(udg_SentPlayers[1],1848656963,RD_CenterX_Sent,RD_CenterY_Sent,0)
 set RD_VisionUnits[3]=CreateUnit(udg_SentPlayers[2],1848656963,RD_CenterX_Sent,RD_CenterY_Sent,0)
 set RD_VisionUnits[4]=CreateUnit(udg_SentPlayers[3],1848656963,RD_CenterX_Sent,RD_CenterY_Sent,0)
@@ -43760,84 +44446,492 @@
 set t=null
 return false
 endfunction
 function ModeCP_Preload takes nothing returns nothing
 local trigger t
 if udg_ModeCP then
 set t=CreateTrigger()
 call TriggerRegisterTimerEvent(t,modecp_delay,false)
 call TriggerAddCondition(t,Condition(function ModeCP_Start))
 set t=null
 endif
 endfunction
 function ModeCP takes nothing returns nothing
 set udg_ModeCP=true
 endfunction
-function Trig_timer1_Actions takes nothing returns nothing
-set udg_KillInt[1]=0
+function ModeTT_ProcessItems takes nothing returns nothing
+local integer indexId=GetIndex(GetEnumItem())
+if GetWidgetLife(GetEnumItem())>0 and GetItemPlayer(GetEnumItem())==tt_itemplayer and indexId!=indexid_aegis and indexId!=indexid_divinerapier and indexId!=indexid_divinerapierfree and indexId!=indexid_gemoftruesight and indexId!=indexid_gemoftruesightcourier then
+if IsItemVisible(GetEnumItem())then
+call SetItemVisible(GetEnumItem(),false)
+else
+call SetItemVisible(GetEnumItem(),true)
+endif
+endif
 endfunction
-function InitTrig_timer1 takes nothing returns nothing
-set gg_trg_timer1=CreateTrigger()
-call TriggerRegisterTimerExpireEventBJ(gg_trg_timer1,udg_KillTimer[1])
-call TriggerAddAction(gg_trg_timer1,function Trig_timer1_Actions)
+function ModeTT_DropItems takes nothing returns nothing
+local player p=tt_itemplayer
+local region r=CreateRegion()
+local unit u=GetEnumUnit()
+local integer indexId
+local integer i=0
+local item Item
+local integer id
+local real x
+local real y
+if IsSent(p)then
+call RegionAddRect(r,gg_rct_Recreate1)
+set x=GetRectCenterX(gg_rct_Recreate1)
+set y=GetRectCenterY(gg_rct_Recreate1)
+else
+call RegionAddRect(r,gg_rct_Recreate2)
+set x=GetRectCenterX(gg_rct_Recreate2)
+set y=GetRectCenterY(gg_rct_Recreate2)
+endif
+loop
+exitwhen i>5
+set Item=UnitItemInSlot(u,i)
+set indexId=GetIndex(Item)
+if GetItemPlayer(Item)==tt_itemplayer and indexId!=indexid_aegis and indexId!=indexid_divinerapier and indexId!=indexid_divinerapierfree and indexId!=indexid_gemoftruesight and indexId!=indexid_gemoftruesightcourier then
+call UnitRemoveItemFromSlot(u,i)
+set id=GetPlayerId(GetItemPlayer(Item))
+call SetItemPosition(Item,x,y)
+endif
+set i=i+1
+endloop
+call RemoveRegion(r)
+set u=null
+set r=null
 endfunction
-function Trig_timer2_Actions takes nothing returns nothing
-set udg_KillInt[2]=0
+function ModeTT_SearchItems takes nothing returns boolean
+return(GetUnitTypeId(GetFilterUnit())==1852010352 or IsCourier(GetFilterUnit())or(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and GetOwningPlayer(GetFilterUnit())!=tt_itemplayer and GetOwningPlayer(GetFilterUnit())!=udg_SentPlayers[0]and GetOwningPlayer(GetFilterUnit())!=udg_ScourgePlayers[0]))and IsUnitAlly(GetFilterUnit(),tt_itemplayer)==true
 endfunction
-function InitTrig_timer2 takes nothing returns nothing
-set gg_trg_timer2=CreateTrigger()
-call TriggerRegisterTimerExpireEventBJ(gg_trg_timer2,udg_KillTimer[2])
-call TriggerAddAction(gg_trg_timer2,function Trig_timer2_Actions)
+function ModeTT_DropAllItems takes player p returns nothing
+local integer i=0
+local item Item
+local integer id=GetPlayerId(p)
+local group g=GetAvailableGroup()
+set tt_itemplayer=p
+call GroupEnumUnitsInRange(g,0,0,99999,Condition(function ModeTT_SearchItems))
+call ForGroup(g,function ModeTT_DropItems)
+call KillGroup(g)
 endfunction
-function Trig_timer3_Actions takes nothing returns nothing
-set udg_KillInt[3]=0
+function ModeTT_ToggleItemStates takes player p returns nothing
+set tt_itemplayer=p
+call EnumItemsInRectBJ(bj_mapInitialPlayableArea,function ModeTT_ProcessItems)
+endfunction
+function ModeTT_RespawnHero takes unit u returns nothing
+local unit DeadHero=u
+local player DeadPlayer=GetOwningPlayer(u)
+local location RespawnLoc
+if IsScourge(DeadPlayer)then
+set RespawnLoc=GetRectCenter(gg_rct_Hero_Creation_UD)
+else
+set RespawnLoc=GetRectCenter(gg_rct_Hero_Creation_NE)
+endif
+if udg_GameOver==false and IsDead(DeadHero)then
+call ReviveCamera(DeadHero,DeadPlayer,GetLocationX(RespawnLoc),GetLocationY(RespawnLoc),true)
+if Deathtrigger_IsKobold(DeadHero)==false or GetUnitAbilityLevel(DeadHero,1093684567)==0 then
+call ReviveHeroLoc(DeadHero,RespawnLoc,true)
+else
+call Deathtrigger_ReviveKobold(DeadHero,RespawnLoc)
+endif
+endif
+call RemoveLocation(RespawnLoc)
+set DeadHero=null
+set DeadPlayer=null
+set RespawnLoc=null
 endfunction
-function InitTrig_timer3 takes nothing returns nothing
-set gg_trg_timer3=CreateTrigger()
-call TriggerRegisterTimerExpireEventBJ(gg_trg_timer3,udg_KillTimer[3])
-call TriggerAddAction(gg_trg_timer3,function Trig_timer3_Actions)
+function ModeTT_SyncHeroes takes unit HeroA,unit HeroB returns nothing
+local player p=GetOwningPlayer(HeroB)
+local integer id=GetPlayerId(p)
+call SetHeroXP(HeroB,GetHeroXP(HeroA),true)
+call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,(LoadInteger(hash_main,(GetHandleId(HeroB)),(787)))+TT_GoldBank[id])
+set TT_PreviousGold[id]=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
+set TT_GoldBank[id]=0
 endfunction
-function Trig_timer4_Actions takes nothing returns nothing
-set udg_KillInt[4]=0
+function ModeTT_CompareTypes takes integer id,unit Original returns boolean
+return GetHeroTypeById(HeroID[id])!=GetHeroType(Original)
 endfunction
-function InitTrig_timer4 takes nothing returns nothing
-set gg_trg_timer4=CreateTrigger()
-call TriggerRegisterTimerExpireEventBJ(gg_trg_timer4,udg_KillTimer[4])
-call TriggerAddAction(gg_trg_timer4,function Trig_timer4_Actions)
+function GetHeroDefaultColors_R takes unit u returns integer
+return 255
 endfunction
-function Trig_timer5_Actions takes nothing returns nothing
-set udg_KillInt[5]=0
+function GetHeroDefaultColors_G takes unit u returns integer
+return 255
 endfunction
-function InitTrig_timer5 takes nothing returns nothing
-set gg_trg_timer5=CreateTrigger()
-call TriggerRegisterTimerExpireEventBJ(gg_trg_timer5,udg_KillTimer[5])
-call TriggerAddAction(gg_trg_timer5,function Trig_timer5_Actions)
+function GetHeroDefaultColors_B takes unit u returns integer
+return 255
 endfunction
-function Trig_timer7_Actions takes nothing returns nothing
-set udg_KillInt[7]=0
+function ModeTT_DisableHero takes unit u,integer id,player p returns nothing
+local player p1=GetOwningPlayer(u)
+local player p2
+local integer i
+local item TempItem
+if IsSent(GetOwningPlayer(u))then
+set p2=udg_SentPlayers[0]
+else
+set p2=udg_ScourgePlayers[0]
+endif
+call SaveInteger(hash_main,(GetHandleId(u)),(787),(GetPlayerState(GetOwningPlayer(u),PLAYER_STATE_RESOURCE_GOLD)))
+call SaveBoolean(hash_main,(GetHandleId(u)),(140),(false))
+call SaveInteger(hash_main,(GetHandleId((u))),((4259)),(HERO_STATE_ON))
+call UnitAddAbility(u,1093678162)
+call SetUnitInvulnerable2(u,true)
+call PauseUnit(u,true)
+call SetUnitVertexColor(u,GetHeroDefaultColors_R(u),GetHeroDefaultColors_G(u),GetHeroDefaultColors_B(u),150)
+call SelectUnitRemoveForPlayer(u,GetOwningPlayer(u))
+call SetUnitOwner(u,p2,false)
+call SetUnitPathing(u,false)
+call SetUnitX(u,GetUnitX(COP[id]))
+call SetUnitY(u,GetUnitY(COP[id]))
+set i=0
+loop
+exitwhen i>5
+if UnitItemInSlot(u,i)==null then
+set TempItem=CreateItem(1227895373,GetUnitX(u),GetUnitY(u))
+call UnitAddItem(u,TempItem)
+endif
+set i=i+1
+endloop
+set p1=null
+set p2=null
 endfunction
-function InitTrig_timer7 takes nothing returns nothing
-set gg_trg_timer7=CreateTrigger()
-call TriggerRegisterTimerExpireEventBJ(gg_trg_timer7,udg_KillTimer[7])
-call TriggerAddAction(gg_trg_timer7,function Trig_timer7_Actions)
+function ModeTT_EnableHero takes unit u,integer id,player p returns nothing
+local integer i
+set udg_Hero[id]=u
+call SaveBoolean(hash_main,(GetHandleId(u)),(140),(false))
+call SaveInteger(hash_main,(GetHandleId((u))),((4259)),(HERO_STATE_OFF))
+call UnitRemoveAbility(u,1093678162)
+call SetUnitInvulnerable2(u,false)
+call PauseUnit(u,false)
+call SetUnitVertexColor(u,GetHeroDefaultColors_R(u),GetHeroDefaultColors_G(u),GetHeroDefaultColors_B(u),255)
+call SelectUnitAddForPlayer(u,GetOwningPlayer(u))
+call SetUnitOwner(u,p,false)
+call SetUnitPathing(u,true)
+if IsSent(Player(id))==true then
+call SetUnitPosition(u,GetRectCenterX(gg_rct_Hero_Creation_NE),GetRectCenterY(gg_rct_Hero_Creation_NE))
+else
+call SetUnitPosition(u,GetRectCenterX(gg_rct_Hero_Creation_UD),GetRectCenterY(gg_rct_Hero_Creation_UD))
+endif
+set i=0
+loop
+exitwhen i>5
+if GetItemTypeId(UnitItemInSlot(u,i))==1227895373 then
+call DestroyItem(UnitItemInSlot(u,i))
+endif
+set i=i+1
+endloop
 endfunction
-function Trig_timer8_Actions takes nothing returns nothing
-set udg_KillInt[8]=0
+function ModeTT_AreHeroesInFountain takes integer id returns boolean
+local region r=CreateRegion()
+local boolean result=false
+if IsSent(Player(id))==true then
+call RegionAddRect(r,gg_rct_SpawnSent)
+else
+call RegionAddRect(r,gg_rct_SpawnUD)
+endif
+if IsUnitInRegion(r,TT_HeroA[id])and IsUnitInRegion(r,TT_HeroB[id])then
+set result=true
+endif
+call RemoveRegion(r)
+return result or IsDead(TT_HeroA[id])or IsDead(TT_HeroB[id])
 endfunction
-function InitTrig_timer8 takes nothing returns nothing
-set gg_trg_timer8=CreateTrigger()
-call TriggerRegisterTimerExpireEventBJ(gg_trg_timer8,udg_KillTimer[8])
+function ModeTT_RequestSwap_Logic takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local integer id=(LoadInteger(hash_main,(Cache),(34)))
+local integer Stage=GetTriggerEvalCount(t)
+local player p=Player(id)
+if Stage==1 then
+call ModeTT_DropAllItems(p)
+elseif Stage==2 then
+call ModeTT_ToggleItemStates(p)
+elseif Stage==3 then
+if udg_Hero[id]==TT_HeroA[id]then
+call ModeTT_RespawnHero(TT_HeroA[id])
+call ModeTT_DisableHero(TT_HeroA[id],id,p)
+call ModeTT_EnableHero(TT_HeroB[id],id,p)
+call ModeTT_SyncHeroes(TT_HeroA[id],TT_HeroB[id])
+else
+call ModeTT_RespawnHero(TT_HeroB[id])
+call ModeTT_DisableHero(TT_HeroB[id],id,p)
+call ModeTT_EnableHero(TT_HeroA[id],id,p)
+call ModeTT_SyncHeroes(TT_HeroB[id],TT_HeroA[id])
+endif
+else
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+return false
+endfunction
+function ModeTT_RequestSwap takes nothing returns boolean
+local integer id=GetPlayerId(GetTriggerPlayer())
+local real CurrentTime=(TimerGetElapsed(udg_GameTimer))
+local trigger t
+local integer Cache
+if(CurrentTime-TT_LastTag[id])<tt_tagcooldown then
+call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,udg_TextY,10,GetObjectName(1848659282)+": "+I2S(R2I(tt_tagcooldown-(CurrentTime-TT_LastTag[id]))))
+elseif ModeTT_AreHeroesInFountain(id)==false then
+call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,udg_TextY,10,GetObjectName(1848659283))
+else
+set TT_LastTag[id]=CurrentTime
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0.2,true)
+call TriggerAddCondition(t,Condition(function ModeTT_RequestSwap_Logic))
+call SaveInteger(hash_main,(Cache),(34),(id))
+set t=null
+endif
+return false
+endfunction
+function ModeTT_MonitorGold takes nothing returns boolean
+local integer i=1
+local integer id
+local integer Delta
+local integer CurrentGold
+local player p
+loop
+exitwhen i>5
+set p=udg_SentPlayers[i]
+set id=GetPlayerId(p)
+set CurrentGold=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
+if TT_PreviousGold[id]<CurrentGold and TT_DisableTracker[id]==false then
+set TT_GoldBank[id]=TT_GoldBank[id]+CurrentGold-TT_PreviousGold[id]
+endif
+set TT_PreviousGold[id]=CurrentGold
+if TT_DisableTracker[id]==true then
+set TT_DisableTracker[id]=false
+endif
+set p=udg_ScourgePlayers[i]
+set id=GetPlayerId(p)
+set CurrentGold=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
+if TT_PreviousGold[id]<CurrentGold and TT_DisableTracker[id]==false then
+set TT_GoldBank[id]=TT_GoldBank[id]+CurrentGold-TT_PreviousGold[id]
+endif
+set TT_PreviousGold[id]=CurrentGold
+if TT_DisableTracker[id]==true then
+set TT_DisableTracker[id]=false
+endif
+set i=i+1
+endloop
+return false
+endfunction
+function ModeTT_AssignHeroes takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local integer Index=(LoadInteger(hash_main,(Cache),(55)))
+local player p
+local integer Rand
+local location SpawnSent=GetRectCenter(gg_rct_Hero_Creation_NE)
+local location SpawnScourge=GetRectCenter(gg_rct_Hero_Creation_UD)
+local integer id
+if Index<6 then
+set p=udg_SentPlayers[Index]
+set id=GetPlayerId(p)
+elseif Index<11 then
+set p=udg_ScourgePlayers[Index-5]
+set id=GetPlayerId(p)
+endif
+if Index>10 then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call TriggerRegisterTimerEvent(tt_t_tracker,0.1,true)
+call TriggerAddCondition(tt_t_tracker,Condition(function ModeTT_MonitorGold))
+elseif Index<6 then
+call SaveInteger(hash_main,(Cache),(55),(Index+1))
+set udg_Hero[GetPlayerId(p)]=null
+if IsPlayer(p)then
+loop
+exitwhen udg_Hero[GetPlayerId(p)]!=null
+set Rand=GetSetElement()
+if udg_HeroFlags[Rand]==false then
+if not udg_ModeDU then
+set udg_HeroFlags[Rand]=true
+endif
+set udg_Hero[id]=CreateUnitAtLoc(p,HeroID[Rand],SpawnSent,bj_UNIT_FACING)
+set TT_HeroA[id]=udg_Hero[id]
+call ModeTT_DisableHero(udg_Hero[id],id,p)
+endif
+endloop
+endif
+elseif Index<11 then
+call SaveInteger(hash_main,(Cache),(55),(Index+1))
+set udg_Hero[GetPlayerId(p)]=null
+if IsPlayer(p)then
+loop
+exitwhen udg_Hero[id]!=null
+set Rand=GetSetElement()
+if udg_HeroFlags[Rand]==false then
+if not udg_ModeDU then
+set udg_HeroFlags[Rand]=true
+endif
+set udg_Hero[id]=CreateUnitAtLoc(p,HeroID[Rand],SpawnScourge,bj_UNIT_FACING)
+set TT_HeroA[id]=udg_Hero[id]
+call ModeTT_DisableHero(udg_Hero[id],id,p)
+endif
+endloop
+endif
+endif
+if Index<6 then
+set p=udg_SentPlayers[Index]
+elseif Index<11 then
+set p=udg_ScourgePlayers[Index-5]
+endif
+if Index<6 then
+call SaveInteger(hash_main,(Cache),(55),(Index+1))
+set udg_Hero[GetPlayerId(p)]=null
+if IsPlayer(p)then
+loop
+exitwhen udg_Hero[id]!=null
+set Rand=GetSetElement()
+if udg_HeroFlags[Rand]==false and ModeTT_CompareTypes(Rand,TT_HeroA[id])then
+if not udg_ModeDU then
+set udg_HeroFlags[Rand]=true
+endif
+set udg_Hero[id]=CreateUnitAtLoc(p,HeroID[Rand],SpawnSent,bj_UNIT_FACING)
+set TT_HeroB[id]=udg_Hero[id]
+set TT_PreviousGold[id]=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
+call ModeTT_EnableHero(udg_Hero[id],id,p)
+call SaveUnitHandle(hash_main,(GetHandleId(TT_HeroB[id])),(788),(TT_HeroA[id]))
+call SaveUnitHandle(hash_main,(GetHandleId(TT_HeroA[id])),(788),(TT_HeroB[id]))
+endif
+endloop
+endif
+elseif Index<11 then
+call SaveInteger(hash_main,(Cache),(55),(Index+1))
+set udg_Hero[id]=null
+if IsPlayer(p)then
+loop
+exitwhen udg_Hero[id]!=null
+set Rand=GetSetElement()
+if udg_HeroFlags[Rand]==false and ModeTT_CompareTypes(Rand,TT_HeroA[id])then
+if not udg_ModeDU then
+set udg_HeroFlags[Rand]=true
+endif
+set udg_Hero[id]=CreateUnitAtLoc(p,HeroID[Rand],SpawnScourge,bj_UNIT_FACING)
+set TT_HeroB[id]=udg_Hero[id]
+set TT_PreviousGold[id]=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)
+call ModeTT_EnableHero(udg_Hero[id],id,p)
+call SaveUnitHandle(hash_main,(GetHandleId(TT_HeroB[id])),(788),(TT_HeroA[id]))
+call SaveUnitHandle(hash_main,(GetHandleId(TT_HeroA[id])),(788),(TT_HeroB[id]))
+endif
+endloop
+endif
+endif
+call RemoveLocation(SpawnSent)
+call RemoveLocation(SpawnScourge)
+set SpawnSent=null
+set SpawnScourge=null
+set p=null
+set t=null
+return false
+endfunction
+function ModeTT takes nothing returns nothing
+local integer i=1
+local integer id
+local real CurrentTime=(TimerGetElapsed(udg_GameTimer))
+local trigger t
+set udg_ModeTT=true
+set udg_Allow_Repick=false
+set AllowSwap=false
+call TechHeroForAll(1211117641)
+call TechHeroForAll(1328558160)
+call TechHeroForAll(1211117653)
+loop
+exitwhen i>5
+set id=GetPlayerId(udg_SentPlayers[i])
+set TT_DisableTracker[id]=false
+set TT_LastTag[id]=CurrentTime-tt_tagcooldown
+set TT_GoldBank[id]=0
+set id=GetPlayerId(udg_ScourgePlayers[i])
+set TT_DisableTracker[id]=false
+set TT_LastTag[id]=CurrentTime-tt_tagcooldown
+set TT_GoldBank[id]=0
+set i=i+1
+endloop
+set t=CreateTrigger()
+call TriggerRegisterTimerEvent(t,.5,true)
+call TriggerAddCondition(t,Condition(function ModeTT_AssignHeroes))
+call SaveInteger(hash_main,(GetHandleId(t)),(55),(1))
+set t=CreateTrigger()
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[1],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[2],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[3],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[4],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[5],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[1],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[2],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[3],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[4],"-tt",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[5],"-tt",true)
+call TriggerAddCondition(t,Condition(function ModeTT_RequestSwap))
+set t=null
+endfunction
+function Trig_timer1_Actions takes nothing returns nothing
+set udg_KillInt[1]=0
+endfunction
+function InitTrig_timer1 takes nothing returns nothing
+set gg_trg_timer1=CreateTrigger()
+call TriggerRegisterTimerExpireEventBJ(gg_trg_timer1,udg_KillTimer[1])
+call TriggerAddAction(gg_trg_timer1,function Trig_timer1_Actions)
+endfunction
+function Trig_timer2_Actions takes nothing returns nothing
+set udg_KillInt[2]=0
+endfunction
+function InitTrig_timer2 takes nothing returns nothing
+set gg_trg_timer2=CreateTrigger()
+call TriggerRegisterTimerExpireEventBJ(gg_trg_timer2,udg_KillTimer[2])
+call TriggerAddAction(gg_trg_timer2,function Trig_timer2_Actions)
+endfunction
+function Trig_timer3_Actions takes nothing returns nothing
+set udg_KillInt[3]=0
+endfunction
+function InitTrig_timer3 takes nothing returns nothing
+set gg_trg_timer3=CreateTrigger()
+call TriggerRegisterTimerExpireEventBJ(gg_trg_timer3,udg_KillTimer[3])
+call TriggerAddAction(gg_trg_timer3,function Trig_timer3_Actions)
+endfunction
+function Trig_timer4_Actions takes nothing returns nothing
+set udg_KillInt[4]=0
+endfunction
+function InitTrig_timer4 takes nothing returns nothing
+set gg_trg_timer4=CreateTrigger()
+call TriggerRegisterTimerExpireEventBJ(gg_trg_timer4,udg_KillTimer[4])
+call TriggerAddAction(gg_trg_timer4,function Trig_timer4_Actions)
+endfunction
+function Trig_timer5_Actions takes nothing returns nothing
+set udg_KillInt[5]=0
+endfunction
+function InitTrig_timer5 takes nothing returns nothing
+set gg_trg_timer5=CreateTrigger()
+call TriggerRegisterTimerExpireEventBJ(gg_trg_timer5,udg_KillTimer[5])
+call TriggerAddAction(gg_trg_timer5,function Trig_timer5_Actions)
+endfunction
+function Trig_timer7_Actions takes nothing returns nothing
+set udg_KillInt[7]=0
+endfunction
+function InitTrig_timer7 takes nothing returns nothing
+set gg_trg_timer7=CreateTrigger()
+call TriggerRegisterTimerExpireEventBJ(gg_trg_timer7,udg_KillTimer[7])
+call TriggerAddAction(gg_trg_timer7,function Trig_timer7_Actions)
+endfunction
+function Trig_timer8_Actions takes nothing returns nothing
+set udg_KillInt[8]=0
+endfunction
+function InitTrig_timer8 takes nothing returns nothing
+set gg_trg_timer8=CreateTrigger()
+call TriggerRegisterTimerExpireEventBJ(gg_trg_timer8,udg_KillTimer[8])
 call TriggerAddAction(gg_trg_timer8,function Trig_timer8_Actions)
 endfunction
 function Trig_timer9_Actions takes nothing returns nothing
 set udg_KillInt[9]=0
 endfunction
 function InitTrig_timer9 takes nothing returns nothing
 set gg_trg_timer9=CreateTrigger()
 call TriggerRegisterTimerExpireEventBJ(gg_trg_timer9,udg_KillTimer[9])
 call TriggerAddAction(gg_trg_timer9,function Trig_timer9_Actions)
 endfunction
 function Trig_timer10_Actions takes nothing returns nothing
 set udg_KillInt[10]=0
 endfunction
 function InitTrig_timer10 takes nothing returns nothing
 set gg_trg_timer10=CreateTrigger()
@@ -44408,33 +45502,31 @@
 set Target=null
 set t=null
 set Phase2=null
 endfunction
 function GhostShip_WhichUnits takes nothing returns boolean
 if(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and IsUnitInGroup(GetFilterUnit(),ghostship_alreadyhit)==false then
 call GroupAddUnit(ghostship_alreadyhit,GetFilterUnit())
 return true
 endif
 return false
 endfunction
 function GhostShip_Explode takes nothing returns nothing
 local unit Source=ghostship_source
 local unit Target=GetEnumUnit()
 local integer Level=ghostship_level
-local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Target),GetUnitY(Target),0)
-call UnitAddAbility2(Caster,ghostship_stun)
-call IssueTargetOrder(Caster,"thunderbolt",Target)
+call Stun(Source,Target,1.4)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,200+100*Level)
 set Source=null
 set Target=null
 endfunction
 function GhostShip_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
 local unit Projectile2
 local real Angle=(LoadReal(hash_main,(Cache),(13)))
 local real SourceX=GetUnitX(Projectile)
 local real SourceY=GetUnitY(Projectile)
 local real TargetX=(LoadReal(hash_main,(Cache),(66)))
 local real TargetY=(LoadReal(hash_main,(Cache),(67)))
 local integer Count=GetTriggerEvalCount(t)
@@ -44460,31 +45552,31 @@
 call ForGroup(g,function GhostShip_Hit)
 call KillGroup(g)
 call SetUnitX(Projectile,NewX)
 call SetUnitY(Projectile,NewY)
 if Count==140 then
 set Projectile2=(LoadUnitHandle(hash_main,(Cache),(186)))
 call KillUnit(Projectile2)
 elseif Count<140 then
 set Projectile2=(LoadUnitHandle(hash_main,(Cache),(186)))
 call SetUnitX(Projectile2,NewX)
 call SetUnitY(Projectile2,NewY)
 endif
 if Count==150 then
 set g=GetAvailableGroup()
 set tt_unit1=Projectile
-call GroupEnumUnitsInRange(g,NewX,NewY,425,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupEnumUnitsInRange(g,NewX,NewY,425+25,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function GhostShip_Explode)
 call KillGroup(g)
 call KillUnit(Projectile)
 call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Projectile=null
 set Projectile2=null
 set AlreadyHit=null
 set g=null
 return false
 endfunction
 function GhostShip takes nothing returns nothing
@@ -44546,65 +45638,54 @@
 set l=null
 endfunction
 function GhostShip_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_ghostship then
 call GhostShip()
 endif
 return false
 endfunction
 function Register_GhostShip takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function GhostShip_Main))
 call PreloadAbility(ghostship_slow)
 set t=null
 endfunction
-function UnstableConcoction_Hit takes unit u,real x,real y returns nothing
-if u!=null then
-call DamageTarget(unstableconcoction_source,u,DAMAGE_PHYSICAL,unstableconcoction_damage)
-call IssueTargetOrder(unstableconcoction_caster,"thunderbolt",u)
-endif
+function UnstableConcoction_Hit takes nothing returns nothing
+call DamageTarget(unstableconcoction_source,GetEnumUnit(),DAMAGE_PHYSICAL,unstableconcoction_damage)
+call Stun(unstableconcoction_source,GetEnumUnit(),unstableconcoction_stun)
 endfunction
 function UnstableConcoction_Explode takes unit Source,unit Target,real Elapsed returns nothing
 local group g
 local integer Level=GetUnitAbilityLevel(Source,abilityid_unstableconcoction)
 local real x
 local real y
 set unstableconcoction_source=Source
-set unstableconcoction_damage=(60+70*Level)*Elapsed/unstableconcoction_maxcharge
+set unstableconcoction_damage=(80+70*Level)*Elapsed/unstableconcoction_maxcharge
 set unstableconcoction_stun=(1+0.75*Level)*Elapsed/unstableconcoction_maxcharge
 set unstableconcoction_caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Target),GetUnitY(Target),0)
 call UnitAddAbility2(unstableconcoction_caster,abilityid_genericstun)
 call SetUnitAbilityLevel(unstableconcoction_caster,abilityid_genericstun,Stun_GetLevel(unstableconcoction_stun))
 set tt_unit1=Source
-if Source==Target then
-call UnstableConcoction_Hit(Target,GetUnitX(Target),GetUnitY(Target))
-elseif GetUnitTypeId(Target)!=unitid_unstableconcoction then
-call UnstableConcoction_Hit(Target,GetUnitX(Target),GetUnitY(Target))
-else
-set x=GetUnitX(Target)
-set y=GetUnitY(Target)
 set g=GetAvailableGroup()
-call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),200,Condition(function GenericCondition_EnemyUnitsEx))
-set Target=FirstOfGroup(g)
-call KillGroup(g)
-call UnstableConcoction_Hit(Target,x,y)
-set g=null
+call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),175+25,Condition(function GenericCondition_EnemyUnitsEx))
+if GetUnitTypeId(Target)!=unitid_unstableconcoction then
+call GroupAddUnit(g,Target)
 endif
-if Target!=null then
+call ForGroup(g,function UnstableConcoction_Hit)
+call KillGroup(g)
 call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl",GetUnitX(Target),GetUnitY(Target)))
-endif
 endfunction
 function UnstableConcoction_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
 local real Elapsed=(LoadReal(hash_main,(Cache),(444)))
 local real OriginalTime=(LoadReal(hash_main,(Cache),(445)))
 local real Angle=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),GetUnitX(Target),GetUnitY(Target))
 local real x=GetUnitX(Projectile)+18*Cos(Angle*bj_DEGTORAD)
 local real y=GetUnitY(Projectile)+18*Sin(Angle*bj_DEGTORAD)
 call SetUnitX(Projectile,x)
 call SetUnitY(Projectile,y)
 if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<=18 then
@@ -44635,31 +45716,31 @@
 call SaveReal(hash_main,(Cache),(445),((OriginalTime)*1.0))
 call TriggerRegisterTimerEvent(t,0.02,true)
 call TriggerAddCondition(t,Condition(function UnstableConcoction_Move))
 set t=null
 set Projectile=null
 endfunction
 function UnstableConcoction_TextTag takes string text,unit Target,unit Hero returns nothing
 local texttag tt=CreateTextTag()
 call SetTextTagText(tt,text,0.033)
 call SetTextTagPosUnit(tt,Target,64)
 call SetTextTagColor(tt,255,0,0,255)
 call SetTextTagVelocity(tt,0,0.0355)
 call SetTextTagFadepoint(tt,0.15)
 call SetTextTagPermanent(tt,false)
 call SetTextTagLifespan(tt,0.65)
-if IsUnitVisible(Hero,GetLocalPlayer())or IsObserver(GetLocalPlayer())then
+if IsUnitAlly(Hero,GetLocalPlayer())or IsObserver(GetLocalPlayer())then
 call SetTextTagVisibility(tt,true)
 else
 call SetTextTagVisibility(tt,false)
 endif
 set tt=null
 endfunction
 function UnstableConcoction_GetString takes real Duration returns string
 if Duration>4.5 then
 return"5.0"
 elseif Duration>4.0 then
 return"4.5"
 elseif Duration>3.5 then
 return"4.0"
 elseif Duration>3.0 then
 return"3.5"
@@ -44678,30 +45759,31 @@
 else
 return"0.0"
 endif
 return" "
 endfunction
 function UnstableConcoction_Charge takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real OriginalTime=(LoadReal(hash_main,(Cache),(442)))
 local real Time=(TimerGetElapsed(udg_GameTimer))
 local real Remaining=unstableconcoction_maxcharge-(Time-OriginalTime)
 local real Total=RMin(Time-OriginalTime,unstableconcoction_maxcharge)
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))+1
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
+call UnstableConcoction_Explode(Source,Source,unstableconcoction_maxcharge)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_unstableconcoction then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_unstableconcoction,true)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_unstableconcoction_helper,false)
 call SetUnitVertexColor(Source,255,255,255,255)
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
 if GetSpellAbilityId()==abilityid_unstableconcoction_helper then
 if IsBlocked(GetSpellTargetUnit())==false then
 call UnstableConcoction_Launch(Source,GetSpellTargetUnit(),Total,OriginalTime)
 endif
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_unstableconcoction then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_unstableconcoction,true)
@@ -44784,37 +45866,37 @@
 local integer Cache=GetHandleId(t)
 local unit u=(LoadUnitHandle(hash_main,(Cache),(26)))
 call SaveInteger(hash_main,(GetHandleId(u)),(27),((LoadInteger(hash_main,(GetHandleId(u)),(27)))-1))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set u=null
 set t=null
 return false
 endfunction
 function GoblinsGreed_Action takes nothing returns nothing
 local unit UnitVar=GetKillingUnit()
 local unit DeadUnit=GetTriggerUnit()
 local integer Cache=GetHandleId(UnitVar)
 local integer PreviousKills=(LoadInteger(hash_main,(Cache),(27)))
 local integer Level=GetUnitAbilityLevel(UnitVar,1093685043)
-local integer ExtraBonusGold=PreviousKills*2
-local integer TotalBonusGold=IMin(ExtraBonusGold+Level*2,26)
+local integer ExtraBonusGold=PreviousKills*Level
+local integer TotalBonusGold=IMin(ExtraBonusGold+Level*2+2,30)
 local texttag tt=CreateTextTag()
 local player p=GetOwningPlayer(UnitVar)
 local trigger t=CreateTrigger()
 set GG_Bonus[GetPlayerId(p)]=GG_Bonus[GetPlayerId(p)]+TotalBonusGold
-call TriggerRegisterTimerEvent(t,20,false)
+call TriggerRegisterTimerEvent(t,25,false)
 call TriggerAddCondition(t,Condition(function GoblinsGreed_Decrement))
 call SaveUnitHandle(hash_main,(GetHandleId(t)),(26),(UnitVar))
 call SaveInteger(hash_main,(Cache),(27),(PreviousKills+1))
 call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,TotalBonusGold+GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD))
 call SetTextTagText(tt,"+"+I2S(TotalBonusGold),0.025)
 call SetTextTagPosUnit(tt,DeadUnit,0)
 call SetTextTagColor(tt,255,220,0,255)
 call SetTextTagVelocity(tt,0,0.03)
 if GetLocalPlayer()==p then
 call SetTextTagVisibility(tt,true)
 else
 call SetTextTagVisibility(tt,false)
 endif
 call SetTextTagFadepoint(tt,2)
 call SetTextTagLifespan(tt,3)
@@ -44877,31 +45959,31 @@
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local integer Counter=(LoadInteger(hash_main,(Cache),(28)))
 local real x=GetUnitX(Caster)
 local real y=GetUnitY(Caster)
 local boolexpr CondVar
 local group GroupVar
 if Counter>16 then
 call KillUnit(Caster)
 call PauseTimer(t)
 call FlushChildHashtable(hash_main,(Cache))
 call DestroyTimer(t)
 else
 set udg_TempUnit=Hero
-set udg_TempReal=GetUnitAbilityLevel(Hero,(1093683532))*8
+set udg_TempReal=8+GetUnitAbilityLevel(Hero,(1093683532))*6
 set CondVar=Condition(function AcidSpray_WhichUnits)
 set GroupVar=GetAvailableGroup()
 call GroupEnumUnitsInRange(GroupVar,x,y,650,CondVar)
 call ForGroup(GroupVar,function AcidSpray_DealDamage)
 call KillGroup(GroupVar)
 set Counter=Counter+1
 call SaveInteger(hash_main,(Cache),(28),(Counter))
 endif
 endfunction
 function AcidSpray_Action takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local location PointVar=GetSpellTargetLoc()
 local real x=GetLocationX(PointVar)
 local real y=GetLocationY(PointVar)
 local unit Caster=CreateUnit(GetOwningPlayer(Hero),1697657157,x,y,0)
@@ -46068,69 +47150,69 @@
 call GroupEnumUnitsOfPlayer(g,p,Condition(function Warpath_FindCaster))
 call ForGroup(g,function Warpath_RemoveCaster)
 call KillGroup(g)
 set g=null
 endfunction
 function Warpath_Decrement takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local unit Hero=(LoadUnitHandle(hash_main,(GetHandleId(t)),(14)))
 local integer Cache=GetHandleId(Hero)
 local integer Level=GetUnitAbilityLevel(Hero,(1093682774))
 local integer WarpathLevel=(LoadInteger(hash_main,(Cache),(315)))-1
 local integer EffectiveWarpathLevel=IBound(WarpathLevel,0,5)
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(316)))
 local integer DamageBonus
 if Level==1 then
-set DamageBonus=10+EffectiveWarpathLevel*10-10
+set DamageBonus=EffectiveWarpathLevel*20
 elseif Level==2 then
-set DamageBonus=20+EffectiveWarpathLevel*15-15
+set DamageBonus=EffectiveWarpathLevel*25
 elseif Level==3 then
-set DamageBonus=30+EffectiveWarpathLevel*20-20
+set DamageBonus=EffectiveWarpathLevel*30
 endif
 if WarpathLevel==0 then
 set DamageBonus=0
 endif
 call AddDamageBonus(Hero,DamageBonus)
 if GetUnitTypeId(Caster)==1697656920 then
 call SetUnitAbilityLevel(Caster,(1093682502),Warpath_GetCasterLevel(Level,EffectiveWarpathLevel))
 call SaveInteger(hash_main,(Cache),(315),(WarpathLevel))
 else
 call Warpath_FindAndRemove((LoadPlayerHandle(hash_main,(GetHandleId(t)),(54))))
 endif
 call FlushChildHashtable(hash_main,(GetHandleId(t)))
 call CleanTrigger(t)
 set t=null
 set Hero=null
 set Caster=null
 return false
 endfunction
 function Warpath_CastAction takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local integer Cache=GetHandleId(Hero)
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(316)))
 local integer Level=GetUnitAbilityLevel(Hero,(1093682774))
 local integer WarpathLevel=(LoadInteger(hash_main,(Cache),(315)))+1
 local integer EffectiveWarpathLevel=IBound(WarpathLevel,0,5)
 local integer CasterLevel=Warpath_GetCasterLevel(Level,EffectiveWarpathLevel)
 local trigger t=CreateTrigger()
 local integer DamageBonus
 if Level==1 then
-set DamageBonus=10+EffectiveWarpathLevel*10-10
+set DamageBonus=EffectiveWarpathLevel*20
 elseif Level==2 then
-set DamageBonus=20+EffectiveWarpathLevel*15-15
+set DamageBonus=EffectiveWarpathLevel*25
 elseif Level==3 then
-set DamageBonus=30+EffectiveWarpathLevel*20-20
+set DamageBonus=EffectiveWarpathLevel*30
 endif
 call AddDamageBonus(Hero,DamageBonus)
 call SetUnitAbilityLevel(Caster,(1093682502),CasterLevel)
 call SaveInteger(hash_main,(Cache),(315),(WarpathLevel))
 call SaveUnitHandle(hash_main,(GetHandleId(t)),(14),(Hero))
 call SavePlayerHandle(hash_main,(GetHandleId(t)),(54),(GetOwningPlayer(Hero)))
 call TriggerRegisterTimerEvent(t,10,false)
 call TriggerAddCondition(t,Condition(function Warpath_Decrement))
 set t=null
 endfunction
 function Warpath_LearnCondition takes nothing returns boolean
 return GetLearnedSkill()==(1093682774)and GetUnitAbilityLevel(GetTriggerUnit(),(1093682774))==1 and IsUnitIllusion(GetTriggerUnit())==false
 endfunction
 function Warpath_LearnAction takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
@@ -46149,31 +47231,31 @@
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function Warpath_LearnCondition))
 call TriggerAddAction(t,function Warpath_LearnAction)
 call PreloadAbility((1093682502))
 endfunction
 function QuillSpray_Conditions takes nothing returns boolean
 return GetSpellAbilityId()==1093683024
 endfunction
 function QuillSpray_Filter takes nothing returns boolean
 return IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and GetUnitAbilityLevel(GetFilterUnit(),1093678162)!=1
 endfunction
 function QuillSpray_Damage takes nothing returns nothing
 local integer TargetCache=GetHandleId(GetEnumUnit())
 local integer NumberOfQuills=(LoadInteger(hash_main,(quillcache),(TargetCache)))
-local real Damage=RMin(udg_TempReal+NumberOfQuills*30,220)
+local real Damage=RMin(udg_TempReal+NumberOfQuills*30,400)
 call UnitDamageTarget(udg_TempUnit,GetEnumUnit(),Damage,false,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
 call SaveInteger(hash_main,(quillcache),(TargetCache),(NumberOfQuills+1))
 endfunction
 function QuillSpray_RemoveCounter takes nothing returns nothing
 local integer TargetCache=GetHandleId(GetEnumUnit())
 local integer NumberOfQuills=(LoadInteger(hash_main,(quillcache),(TargetCache)))
 call SaveInteger(hash_main,(quillcache),(TargetCache),(NumberOfQuills-1))
 endfunction
 function QuillSpray_Decrement takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit UnitVar=(LoadUnitHandle(hash_main,(Cache),(221)))
 local group GroupVar=(LoadGroupHandle(hash_main,(Cache),(317)))
 set quillcache=GetHandleId(UnitVar)
 call ForGroup(GroupVar,function QuillSpray_RemoveCounter)
@@ -46272,31 +47354,31 @@
 if(IsUnitType(GetEventDamageSource(),UNIT_TYPE_STRUCTURE)==true)then
 return false
 endif
 return true
 endfunction
 function Bristleback_CastQuillSpray takes unit Hero returns nothing
 local unit Caster=CreateUnit(GetOwningPlayer(Hero),1697656901,GetUnitX(Hero),GetUnitY(Hero),0)
 call UnitAddAbility2(Caster,1093683024)
 call SetUnitAbilityLevel(Caster,1093683024,GetUnitAbilityLevel(Hero,1093683024))
 call IssueImmediateOrder(Caster,"fanofknives")
 set Caster=null
 endfunction
 function Bristleback_DamageStack takes unit Hero,real Damage returns nothing
 local integer Cache=GetHandleId(Hero)
 local real Stack=(LoadReal(hash_main,(Cache),(278)))
-if Stack>250 then
+if Stack+Damage>250 then
 call SaveReal(hash_main,(Cache),(278),((0)*1.0))
 call Bristleback_CastQuillSpray(Hero)
 else
 call SaveReal(hash_main,(Cache),(278),((Stack+Damage)*1.0))
 endif
 endfunction
 function Bristleback_DamageActions takes nothing returns nothing
 local unit Defender=GetTriggerUnit()
 local unit Attacker=GetEventDamageSource()
 local real att=AngleBetweenUnits(Attacker,Defender)
 local real def=GetUnitFacing(Defender)
 local real rel
 local real Damage=GetEventDamage()
 local real PreventedDamage
 local real Angle
@@ -46345,64 +47427,176 @@
 local unit Source=GetTriggerUnit()
 local unit Target=GetAttacker()
 local integer Level=GetUnitAbilityLevel(Source,1093677142)
 local integer STR=GetHeroStr(Source,true)
 local real Damage=(14+2*Level)+(0.18+0.08*Level)*STR
 call DamageTarget(Source,Target,DAMAGE_PHYSICAL,Damage)
 set Source=null
 set Target=null
 endfunction
 function Return takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
 call TriggerAddCondition(t,Condition(function Return_Conditions))
 call TriggerAddAction(t,function Return_Actions)
 endfunction
+function DoubleEdge_Hit takes nothing returns nothing
+call DamageTarget(doubleedge_source,GetEnumUnit(),DAMAGE_MAGICAL,doubleedge_damage)
+endfunction
 function DoubleEdge takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_doubleedge)
 local real selfDamage
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,100+Level*75)
-set selfDamage=100+Level*75
+local group g=GetAvailableGroup()
+set doubleedge_damage=100+Level*75
+set doubleedge_source=Source
+set tt_unit1=Source
+call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),190+25,Condition(function GenericCondition_EnemyUnitsNoImmune))
+call ForGroup(g,function DoubleEdge_Hit)
+set selfDamage=doubleedge_damage
 if GetUnitState(Source,UNIT_STATE_LIFE)<=selfDamage*0.75 then
 set selfDamage=GetUnitState(Source,UNIT_STATE_LIFE)/0.75-10
 endif
 call DamageTarget(Source,Source,DAMAGE_MAGICAL,selfDamage)
 call DestroyEffect(AddSpecialEffect(doubleedge_fx_impact,GetUnitX(Target),GetUnitY(Target)))
 set Source=null
 set Target=null
 endfunction
 function DoubleEdge_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_doubleedge then
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_EFFECT then
 call DoubleEdge()
 else
 call DestroyEffect(AddSpecialEffectTarget(doubleedge_fx_cast,GetTriggerUnit(),"hand, right"))
 endif
 endif
 return false
 endfunction
 function Register_DoubleEdge takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function DoubleEdge_Main))
 set t=null
 endfunction
+function Stampede_Hit takes nothing returns nothing
+local integer Factor
+if IsMagicImmune(GetEnumUnit())==false and((LoadInteger(hash_main,(GetHandleId((GetEnumUnit()))),((4332))))==HERO_STATE_ON)==false then
+call AddHeroState(GetEnumUnit(),4332,stampede_duration)
+set Factor=stampede_level
+call DamageTarget(stampede_daamgesource,GetEnumUnit(),DAMAGE_MAGICAL,(Factor)*GetHeroStr(stampede_source,true))
+call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()),stampede_slow,false)
+call UnitAddAbility2(GetEnumUnit(),stampede_slow)
+call AddTimedAbilityAndRemove(GetEnumUnit(),stampede_slow,1,1.25,buffid_stampede)
+endif
+endfunction
+function Stampede_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+local integer Level=(LoadInteger(hash_main,(Cache),(5)))
+local group g
+if GetTriggerEvalCount(t)>=R2I(20*stampede_duration)or GetTriggerEventId()==EVENT_WIDGET_DEATH then
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(175))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(176))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call SetUnitPathing(Source,true)
+call UnitRemoveAbility(Source,stampede_haste)
+call UnitRemoveAbility(Source,stampede_haste_buffid)
+else
+set g=GetAvailableGroup()
+set tt_unit1=Source
+set stampede_source=Caster
+set stampede_daamgesource=Source
+set stampede_level=Level
+call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),105+25,Condition(function GenericCondition_EnemyUnitsEx))
+call ForGroup(g,function Stampede_Hit)
+call KillGroup(g)
+endif
+set t=null
+set Source=null
+set g=null
+return false
+endfunction
+function Stampede_Empower takes nothing returns nothing
+local unit Source=GetEnumUnit()
+local integer Level=GetUnitAbilityLevel(stampede_source,abilityid_stampede)
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call SetUnitPathing(Source,false)
+call UnitAddAbility2(Source,stampede_haste)
+call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerRegisterDeathEvent(t,Source)
+call TriggerAddCondition(t,Condition(function Stampede_Loop))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(19),(stampede_source))
+call SaveInteger(hash_main,(Cache),(5),(Level))
+call SaveEffectHandle(hash_main,(Cache),(175),(AddSpecialEffectTarget("war3mapImported\\SandBreathDamageSmall.mdx",Source,"foot, left")))
+call SaveEffectHandle(hash_main,(Cache),(176),(AddSpecialEffectTarget("war3mapImported\\SandBreathDamageSmall.mdx",Source,"foot, right")))
+set Source=null
+set t=null
+endfunction
+function Stampede_Delayed takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local group g=GetAvailableGroup()
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set stampede_source=Source
+set tt_unit1=Source
+call GroupEnumUnitsInRange(g,0,0,99999,Condition(function GenericCondition_AlliedPlayerUnitsEx))
+call ForGroup(g,function Stampede_Empower)
+call KillGroup(g)
+set t=null
+set Source=null
+set g=null
+return false
+endfunction
+function Stampede takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local sound SoundVar=CreateSound("abilities\\Spells\\Other\\Stampede\\StampedeCaster1.wav",false,false,false,10,10,"DefaultEAXON")
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call StartSound(SoundVar)
+call KillSoundWhenDone(SoundVar)
+call TriggerRegisterTimerEvent(t,0,false)
+call TriggerAddCondition(t,Condition(function Stampede_Delayed))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+set Source=null
+set SoundVar=null
+endfunction
+function Stampede_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_stampede then
+call Stampede()
+endif
+return false
+endfunction
+function Register_Stampede takes nothing returns nothing
+local trigger t=CreateTrigger()
+call PreloadAbility(stampede_haste)
+call PreloadAbility(abilityid_genericstun)
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function Stampede_Main))
+call CreateSound("abilities\\Spells\\Other\\Stampede\\StampedeCaster1.wav",false,false,false,10,10,"DefaultEAXON")
+set t=null
+endfunction
 function Trig_Preservation_Conditions takes nothing returns boolean
-return GetSpellAbilityId()==1093684310
+return GetSpellAbilityId()==1093684310 or GetSpellAbilityId()==abilityid_testoffath_allied
 endfunction
 function Perservation_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Chen=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit u=(LoadUnitHandle(hash_main,(Cache),(26)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 if(LoadBoolean(hash_main,(GetHandleId(u)),(80)))==false and GetUnitAbilityLevel(u,1093678162)==0 then
 call AddHeroState(u,4409,1)
 call SetUnitPosition(u,x,y)
 endif
 if(LoadBoolean(hash_main,(GetHandleId(u)),(80)))==true then
 call Error(GetOwningPlayer(Chen),GetObjectName(MSG_TEST_GRAPLE))
@@ -46452,44 +47646,54 @@
 set fx=AddSpecialEffectTargetUnitBJ("chest",Target,"Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl")
 call DestroyEffect(fx)
 endif
 else
 if(IsUnitType(Target,UNIT_TYPE_HERO)==true)then
 if((LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(Target))),(139)))==false)then
 call Preservation_PortUnit(Target,Chen,level,GetLocationX(TargetLoc),GetLocationY(TargetLoc))
 endif
 elseif(IsUnitOwnedByPlayer(Target,GetOwningPlayer(Chen))==true)then
 call SetUnitPositionLoc(Target,TargetLoc)
 endif
 endif
 call RemoveLocation(PointVar)
 call RemoveLocation(TargetLoc)
 endfunction
+function TestOfFaith_Learned takes nothing returns boolean
+if GetLearnedSkill()==1093684310 and IsUnitIllusion(GetTriggerUnit())==false then
+call UnitAddAbility2(GetTriggerUnit(),abilityid_testoffath_allied)
+call SetUnitAbilityLevel(GetTriggerUnit(),abilityid_testoffath_allied,GetUnitAbilityLevel(GetTriggerUnit(),1093684310))
+endif
+return false
+endfunction
 function TestOfFaith takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Trig_Preservation_Conditions))
 call TriggerAddAction(t,function Trig_Preservation_Actions)
+set t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerAddCondition(t,Condition(function TestOfFaith_Learned))
 endfunction
 function Penitence_Damage takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local real ExtraDamage
 if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 if GetEventDamage()>10 then
-set ExtraDamage=GetEventDamage()*0.07*Level
+set ExtraDamage=GetEventDamage()*0.08*Level
 call DisableTrigger(t)
 call DamageTarget(GetEventDamageSource(),GetTriggerUnit(),DAMAGE_PHYSICAL,ExtraDamage)
 call EnableTrigger(t)
 endif
 else
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 return false
 endfunction
 function Penitence takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=GetSpellTargetUnit()
@@ -46865,58 +48069,64 @@
 elseif PowerCog_IsSmallest2(d8,d2,d3,d4,d5,d6,d7,d1)then
 return Cog8
 endif
 return null
 endfunction
 function PowerCog_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local real Angle=(LoadReal(hash_main,(Cache),(13)))
 local real x=GetUnitX(Target)
 local real y=GetUnitY(Target)
 local real Rate=12
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
-local integer ShockDamage=30+30*Level
+local integer ShockDamage=40+40*Level
 if GetTriggerEvalCount(t)>21 then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call SaveInteger(hash_main,(GetHandleId((Target))),((4260)),(HERO_STATE_OFF))
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,I2R(ShockDamage))
 call SetUnitState(Target,UNIT_STATE_MANA,RMax(GetUnitState(Target,UNIT_STATE_MANA)-ShockDamage,0))
 else
 call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",x,y))
 call KillTrees(x,y,150)
 if((LoadInteger(hash_main,(GetHandleId((Target))),((4261))))==HERO_STATE_ON)==false then
 call SetUnitPosition(Target,x+Rate*Cos(Angle*bj_DEGTORAD),y+Rate*Sin(Angle*bj_DEGTORAD))
 endif
 endif
 set t=null
 set Target=null
 return false
 endfunction
 function PowerCog_Pushback takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=GetEnumUnit()
 local real x=tt_real1
 local real y=tt_real2
 local real d=tt_real3
 local real Angle=PowerCog_GetAngle(Target,x,y,d)
+local real buffer=200
+local real diff=d-DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),x,y)+buffer/2
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",Target,"chest"))
 call SaveInteger(hash_main,(GetHandleId((Target))),((4260)),(HERO_STATE_ON))
+if diff>0 then
+call SetUnitX(Target,GetUnitX(Target)+diff*Cos(Angle*bj_DEGTORAD))
+call SetUnitY(Target,GetUnitY(Target)+diff*Sin(Angle*bj_DEGTORAD))
+endif
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveReal(hash_main,(Cache),(13),((Angle)*1.0))
 call SaveInteger(hash_main,(Cache),(5),(tt_int1))
 call SaveUnitHandle(hash_main,(Cache),(2),(tt_unit1))
 call TriggerRegisterTimerEvent(t,0.04,true)
 call TriggerAddCondition(t,Condition(function PowerCog_Move))
 set t=null
 set Target=null
 endfunction
 function PowerCog_IsNearestUsable takes unit u,integer Cache returns boolean
 local unit Nearest=PowerCog_GetClosestUnit(u,Cache)
 local boolean result=true
 if IsDead(Nearest)or(LoadInteger(hash_main,(GetHandleId(Nearest)),(156)))==1 then
 set result=false
 endif
@@ -47027,57 +48237,57 @@
 set Cog6=null
 set Cog7=null
 set Cog8=null
 endfunction
 function PowerCog_RegisterCog takes unit Cog,integer Cache,integer index,player p returns nothing
 if IsUnitVisible(Cog,p)then
 call SaveBoolean(hash_main,(Cache),(155),(true))
 endif
 call SaveUnitHandle(hash_main,(Cache),(1100+index),(Cog))
 endfunction
 function PowerCog_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local real Duration=(LoadReal(hash_main,(Cache),(57)))
 local integer Count=GetTriggerEvalCount(t)
-if Count>R2I(Duration*10)then
+if Count>R2I(Duration*100)then
 call PowerCog_EndCogs(Cache,(LoadReal(hash_main,(Cache),(6))),(LoadReal(hash_main,(Cache),(7))),(LoadBoolean(hash_main,(Cache),(155))),(LoadPlayerHandle(hash_main,(Cache),(154))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 call PowerCog_Shock(t,(LoadUnitHandle(hash_main,(Cache),(14))),(LoadReal(hash_main,(Cache),(6))),(LoadReal(hash_main,(Cache),(7))),(LoadReal(hash_main,(Cache),(138))),(LoadInteger(hash_main,(Cache),(5))))
 endif
 set t=null
 return false
 endfunction
 function PowerCog_MoveToCenter takes nothing returns nothing
 call SetUnitX(GetEnumUnit(),GetUnitX(tt_unit1))
 call SetUnitY(GetEnumUnit(),GetUnitY(tt_unit1))
 endfunction
 function PowerCog_Delayed takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_powercog)
 local integer ID=unitid_powercog
 local real x1=GetUnitX(Hero)
 local real y1=GetUnitY(Hero)
 local real x2
 local real y2
 local real d=125
 local unit Cog
-local real Duration=2+Level
+local real Duration=4+Level
 local real BufferDuration=5
 local group g
 local rect rec
 local player enemy
 if IsSent(GetOwningPlayer(Hero))then
 set enemy=udg_ScourgePlayers[0]
 else
 set enemy=udg_SentPlayers[0]
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call SaveBoolean(hash_main,(Cache),(155),(false))
 set x2=x1+d
@@ -47108,31 +48318,31 @@
 set x2=x1-d
 set y2=y1-d
 set Cog=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
 call SetUnitPosition(Cog,x2,y2)
 call PowerCog_RegisterCog(Cog,Cache,6,enemy)
 set x2=x1
 set y2=y1-d
 set Cog=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
 call SetUnitPosition(Cog,x2,y2)
 call PowerCog_RegisterCog(Cog,Cache,7,enemy)
 set x2=x1+d
 set y2=y1-d
 set Cog=CreateUnit(GetOwningPlayer(Hero),ID,x2,y2,0)
 call SetUnitPosition(Cog,x2,y2)
 call PowerCog_RegisterCog(Cog,Cache,8,enemy)
-call TriggerRegisterTimerEvent(t,0.1,true)
+call TriggerRegisterTimerEvent(t,0.01,true)
 call TriggerAddCondition(t,Condition(function PowerCog_Iterate))
 call SaveReal(hash_main,(Cache),(57),((Duration)*1.0))
 call SaveReal(hash_main,(Cache),(6),((x1)*1.0))
 call SaveReal(hash_main,(Cache),(7),((y1)*1.0))
 call SaveReal(hash_main,(Cache),(138),((d)*1.0))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 call SavePlayerHandle(hash_main,(Cache),(154),(enemy))
 set d=d+110
 set g=GetAvailableGroup()
 set rec=Rect(x1-d,y1-d,x1+d,y1+d)
 set tt_unit1=Hero
 call GroupEnumUnitsInRect(g,rec,Condition(function GenericCondition_EnemyHeroesEx))
 call ForGroup(g,function PowerCog_MoveToCenter)
 call KillGroup(g)
@@ -47290,31 +48500,31 @@
 set NewLink=null
 set Retract=null
 set g=null
 set Target=null
 return false
 endfunction
 function Hookshot takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=GetTriggerUnit()
 local location l=GetSpellTargetLoc()
 local real Angle=AngleBetweenXY(GetUnitX(Hero),GetUnitY(Hero),GetLocationX(l),GetLocationY(l))
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_hookshot)
 local integer MaxRange
 local integer MaxCount
-local boolean Scepter=false
+local boolean Scepter=true
 local trigger RetractTrigger=CreateTrigger()
 if Level==0 then
 set Level=GetUnitAbilityLevel(Hero,abilityid_hookshotupgrade)
 set Scepter=true
 endif
 set MaxRange=1500+500*Level
 set MaxCount=MaxRange/50
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 call SaveReal(hash_main,(Cache),(13),((Angle)*1.0))
 call SaveInteger(hash_main,(Cache),(12),(MaxCount))
 call SaveTriggerHandle(hash_main,(Cache),(11),(RetractTrigger))
 call SaveBoolean(hash_main,(Cache),(15),(Scepter))
 call TriggerRegisterTimerEvent(t,0.5/MaxCount,true)
 call TriggerAddCondition(t,Condition(function Hookshot_Extend))
@@ -47349,45 +48559,45 @@
 call DestroyEffect(AddSpecialEffectTarget(fx_batteryassault,Source,"origin"))
 if Target!=null then
 call UnitAddAbility2(Caster,abilityid_batteryassaultstun)
 call SetUnitAbilityLevel(Caster,abilityid_batteryassaultstun,Level)
 call IssueTargetOrder(Caster,"thunderbolt",Target)
 endif
 set g=null
 set Target=null
 set Caster=null
 endfunction
 function BatteryAssault_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Count=GetTriggerEvalCount(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
-if Count>14 or GetTriggerEventId()==EVENT_UNIT_DEATH then
+if Count>15 or GetTriggerEventId()==EVENT_UNIT_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 call BatteryAssault_Attack(Hero)
 endif
 set t=null
 set Hero=null
 return false
 endfunction
 function BatteryAssault takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=GetTriggerUnit()
-call TriggerRegisterTimerEvent(t,.75,true)
+call TriggerRegisterTimerEvent(t,.7,true)
 call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function BatteryAssault_Iterate))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call TriggerEvaluate(t)
 set t=null
 set Hero=null
 endfunction
 function BatteryAssault_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_batteryassault then
 call BatteryAssault()
 endif
 return false
 endfunction
 function Register_BatteryAssault takes nothing returns nothing
 local trigger t=CreateTrigger()
@@ -47486,54 +48696,88 @@
 endif
 return false
 endfunction
 function Register_FreezingField takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function FreezingField_Main))
 call PreloadAbility(abilityid_freezingfieldcast)
 set t=null
 endfunction
 function CrystalNova takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local location l=GetSpellTargetLoc()
 local real x=GetLocationX(l)
 local real y=GetLocationY(l)
-local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656899,x,y,0)
+local unit Caster=CreateUnit(GetOwningPlayer(Source),1697657656,x,y,0)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_crystalnova)
 call UnitAddAbility2(Caster,crystalnova_nuke)
 call SetUnitAbilityLevel(Caster,crystalnova_nuke,Level)
 call IssueTargetOrder(Caster,"frostnova",Caster)
 call RemoveLocation(l)
 call UnitAddAbility2(Caster,1097625443)
 call UnitApplyTimedLife(Caster,1112820806,2)
 set Source=null
 set Caster=null
 set l=null
 endfunction
 function CrystalNova_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_crystalnova then
 call CrystalNova()
 endif
 return false
 endfunction
 function Register_CrystalNova takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function CrystalNova_Main))
 set t=null
 endfunction
+function BrillianceAura_Think takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_brillianceaura)
+if IsDead(Source)then
+call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+0.5*Level*0.25)
+endif
+set Source=null
+set t=null
+return false
+endfunction
+function BrillianceAura takes nothing returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=GetTriggerUnit()
+call TriggerRegisterTimerEvent(t,0.25,true)
+call TriggerAddCondition(t,Condition(function BrillianceAura_Think))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+set t=null
+set Source=null
+endfunction
+function BrillianceAura_Main takes nothing returns boolean
+if GetLearnedSkill()==abilityid_brillianceaura and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_brillianceaura)==1 then
+call BrillianceAura()
+endif
+return false
+endfunction
+function Register_BrillianceAura takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerAddCondition(t,Condition(function BrillianceAura_Main))
+set t=null
+endfunction
 function EmberDies_TakeTwo takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 call SetUnitAnimationByIndex(Source,8)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Source=null
 return false
 endfunction
 function EmberDies takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
@@ -48605,55 +49849,55 @@
 function Register_Enchant takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Enchant_Main))
 set t=null
 endfunction
 function Trig_Midnight_Pulse_Conditions takes nothing returns boolean
 if(not(GetSpellAbilityId()==1093681713))then
 return false
 endif
 return true
 endfunction
 function Trig_Midnight_Pulse_Actions takes nothing returns nothing
 local location tempa=GetUnitLoc(GetTriggerUnit())
 local location tempb=GetSpellTargetLoc()
-call CreateNUnitsAtLocFacingLocBJ(1,1697656901,GetOwningPlayer(GetTriggerUnit()),tempa,tempb)
+call CreateNUnitsAtLocFacingLocBJ(1,1697656901,GetOwningPlayer(GetTriggerUnit()),tempb,tempb)
 call ShowUnitHide(GetLastCreatedUnit())
 call UnitApplyTimedLifeBJ(8.00,1112820806,GetLastCreatedUnit())
 call UnitAddAbilityBJ(1093681714,GetLastCreatedUnit())
 call SetUnitAbilityLevelSwapped(1093681714,GetLastCreatedUnit(),GetUnitAbilityLevelSwapped(1093681713,GetTriggerUnit()))
 call IssuePointOrderLocBJ(GetLastCreatedUnit(),"deathanddecay",tempb)
 call RemoveLocation(tempa)
 call RemoveLocation(tempb)
 endfunction
 function Register_Midnight takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Trig_Midnight_Pulse_Conditions))
 call TriggerAddAction(t,function Trig_Midnight_Pulse_Actions)
 endfunction
 function Malefice_Stun takes unit Source,unit Target,integer Level returns nothing
 local real Damage
 if Level==1 then
-set Damage=30
+set Damage=40
 elseif Level==2 then
 set Damage=40
 elseif Level==3 then
 set Damage=65
 else
-set Damage=80
+set Damage=65
 endif
 call Stun(Target,Target,1)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Damage)
 endfunction
 function Malefice_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 call Malefice_Stun(Source,Target,Level)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Source=null
@@ -48778,32 +50022,36 @@
 return limit
 endif
 return x
 endfunction
 function ReallySafeY takes real y returns real
 local real limit=GetRectMinY(bj_mapInitialPlayableArea)+150
 if(y<limit)then
 return limit
 endif
 set limit=GetRectMaxY(bj_mapInitialPlayableArea)-150
 if(y>limit)then
 return limit
 endif
 return y
 endfunction
+function Enigma_IsPrimalSplit takes unit u returns boolean
+local integer id=GetUnitTypeId(u)
+return id==1852862003 or id==1852862006 or id==1848652080 or id==1848657754 or id==1852862001 or id==1852862004 or id==1848652081 or id==1848657968 or id==1852862002 or id==1852862005 or id==1848652082 or id==1848657969
+endfunction
 function BlackHole_SuckGroupCondition takes nothing returns boolean
-return GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())or GetUnitTypeId(GetFilterUnit())==1848651861 or GetUnitTypeId(GetFilterUnit())==1848651865 or GetUnitTypeId(GetFilterUnit())==1848651866 or GetUnitTypeId(GetFilterUnit())==1848658773 or GetUnitTypeId(GetFilterUnit())==1848658774 or GetUnitTypeId(GetFilterUnit())==1848658775 or Gargolye_IsFamiliar(GetUnitTypeId(GetFilterUnit())))and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(318)))))==true
+return GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or Enigma_IsPrimalSplit(GetFilterUnit())or GenericCondition_IsBear(GetFilterUnit())or GetUnitTypeId(GetFilterUnit())==1848651861 or GetUnitTypeId(GetFilterUnit())==1848651865 or GetUnitTypeId(GetFilterUnit())==1848651866 or GetUnitTypeId(GetFilterUnit())==1848658773 or GetUnitTypeId(GetFilterUnit())==1848658774 or GetUnitTypeId(GetFilterUnit())==1848658775 or Gargolye_IsFamiliar(GetUnitTypeId(GetFilterUnit())))and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(318)))))==true
 endfunction
 function BlackHole_SuckAction takes nothing returns nothing
 local location Point1=GetUnitLoc(GetEnumUnit())
 local location Point2=GetUnitLoc((LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(318))))
 local location FinalPoint=PolarProjectionBJ(Point2,DistanceBetweenPoints(Point2,Point1)-2,AngleBetweenPoints(Point2,Point1))
 call SetUnitFacing(GetEnumUnit(),AngleBetweenPoints(Point2,Point1))
 call SetUnitPositionLoc(GetEnumUnit(),FinalPoint)
 call RemoveLocation(Point1)
 call RemoveLocation(Point2)
 call RemoveLocation(FinalPoint)
 endfunction
 function BlackHole_Suck takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local group GroupVar
 local integer Cache=GetHandleId(t)
@@ -48912,31 +50160,31 @@
 function WanningRift_Damage takes nothing returns nothing
 call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_MAGICAL,tt_real1)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationTarget.mdx",GetEnumUnit(),"chest"))
 endfunction
 function WanningRift takes nothing returns nothing
 local group g=GetAvailableGroup()
 local unit Hero=GetTriggerUnit()
 local real x=GetUnitX(Hero)
 local real y=GetUnitY(Hero)
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_wanningrift)
 local unit Caster=CreateUnit(GetOwningPlayer(Hero),1697656901,x,y,0)
 call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\StaffOfPurification\\PurificationCaster.mdx",x,y))
 call UnitAddAbility2(Caster,abilityid_wanningrifthelper)
 call SetUnitAbilityLevel(Caster,abilityid_wanningrifthelper,Level)
 call IssuePointOrder(Caster,"silence",x,y)
-set tt_real1=Level*60
+set tt_real1=Level*70
 call GroupEnumUnitsInRange(g,x,y,425,Condition(function GenericCondition_EnemyUnitsWithAncients))
 call ForGroup(g,function WanningRift_Damage)
 call KillGroup(g)
 set Caster=null
 set g=null
 set Hero=null
 endfunction
 function WanningRift_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_wanningrift then
 call WanningRift()
 endif
 return false
 endfunction
 function Register_WanningRift takes nothing returns nothing
 local trigger t=CreateTrigger()
@@ -48961,123 +50209,129 @@
 function PrismaticPrison_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer Type=(LoadInteger(hash_main,(Cache),(152)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local lightning Light=(LoadLightningHandle(hash_main,(Cache),(196)))
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call DestroyLightning(Light)
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
-call MoveLightning(Light,true,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
+call MoveLightning(Light,false,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
 if DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))>600 then
 call DestroyLightning(Light)
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call PrismaticPrison_MainStun(Source,Target,Level,Type)
 endif
 endif
 set t=null
 set Source=null
 set Target=null
 set Light=null
 return false
 endfunction
 function PrismaticPrison_BindUnits takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-local lightning Light=AddLightning("HWPB",true,GetUnitX(dreamcoil_source),GetUnitY(dreamcoil_source),GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()))
+local lightning Light=AddLightning("HWPB",false,GetUnitX(dreamcoil_source),GetUnitY(dreamcoil_source),GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()))
 call SetLightningColor(Light,0,.7,1,1)
 call SaveLightningHandle(hash_main,(Cache),(196),(Light))
 call SaveUnitHandle(hash_main,(Cache),(2),(dreamcoil_source))
 call SaveInteger(hash_main,(Cache),(30),(TI_AddUnit(GetEnumUnit())))
 call SaveInteger(hash_main,(Cache),(5),(dreamcoil_level))
 call SaveInteger(hash_main,(Cache),(152),(dreamcoil_type))
 call TriggerRegisterTimerEvent(t,0.03,true)
 call TriggerRegisterUnitEvent(t,GetEnumUnit(),EVENT_UNIT_DEATH)
 call TriggerRegisterUnitEvent(t,dreamcoil_source,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function PrismaticPrison_Iterate))
 call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_MAGICAL,dreamcoil_damage)
 call PrismaticPrison_MiniStun(GetTriggerUnit(),GetEnumUnit())
 set t=null
 set Light=null
 endfunction
 function PrismaticPrison takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local location l=GetSpellTargetLoc()
 local real x=GetLocationX(l)
 local real y=GetLocationY(l)
 local unit Caster=CreateUnit(GetOwningPlayer(Hero),unitid_prismaticprison,x,y,0)
 local group g=GetAvailableGroup()
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_prismaticprison)
-local real Duration=5
+local real Duration=6
 local integer Type=1
 if Level==0 then
 set Level=GetUnitAbilityLevel(Hero,abilityid_prismaticprison_upgrade)
-set Duration=7
+set Duration=8
 set Type=2
 endif
 call RemoveLocation(l)
 call SetUnitAnimation(Caster,"channel")
 call RemoveUnitTimedAndKill(Caster,Duration)
 set dreamcoil_source=Caster
 set dreamcoil_duration=Duration
 set dreamcoil_damage=Level*50+50
 set dreamcoil_level=Level
 set dreamcoil_type=Type
-call GroupEnumUnitsInRange(g,x,y,400,Condition(function GenericCondition_EnemyHeroesVisible))
+set tt_unit1=Hero
+call GroupEnumUnitsInRange(g,x,y,400,Condition(function GenericCondition_EnemyUnitsExHeroesNoDotaInvis2))
 call ForGroup(g,function PrismaticPrison_BindUnits)
 call KillGroup(g)
 set g=null
 set Caster=null
 set Hero=null
 set l=null
 endfunction
 function PrismaticPrison_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_prismaticprison or GetSpellAbilityId()==abilityid_prismaticprison_upgrade then
 call PrismaticPrison()
 endif
 return false
 endfunction
 function Register_PrismaticPrison takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function PrismaticPrison_Main))
 set t=null
 endfunction
 function PhaseShift_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local integer Level
 local integer Counter
+local integer MaxCount
 if(GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER and GetIssuedOrderId()!=String2OrderIdBJ("phaseshift"))or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER or GetTriggerEventId()==EVENT_UNIT_DEATH then
 call SetUnitInvulnerable(Hero,false)
 call UnitRemoveAbility(Hero,1093678162)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set Level=(LoadInteger(hash_main,(Cache),(5)))
 set Counter=(LoadInteger(hash_main,(Cache),(28)))+1
 call SaveInteger(hash_main,(Cache),(28),(Counter))
-if Counter>3*Level or DistanceBetweenXY(GetUnitX(Hero),GetUnitY(Hero),(LoadReal(hash_main,(Cache),(6))),(LoadReal(hash_main,(Cache),(7))))>125 then
+set MaxCount=3*Level
+if Level==4 then
+set MaxCount=MaxCount+1
+endif
+if Counter>MaxCount or DistanceBetweenXY(GetUnitX(Hero),GetUnitY(Hero),(LoadReal(hash_main,(Cache),(6))),(LoadReal(hash_main,(Cache),(7))))>125 then
 call SetUnitInvulnerable(Hero,false)
 call UnitRemoveAbility(Hero,1093678162)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 endif
 set t=null
 set Hero=null
 return false
 endfunction
 function PhaseShift takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call SetUnitInvulnerable(Hero,true)
@@ -49162,31 +50416,31 @@
 call CleanTrigger(t)
 elseif GetTriggerEvalCount(t)>120 then
 set IllusoryOrb_Caster[GetPlayerId(GetOwningPlayer(Caster))]=null
 call KillGroup(g)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call SetUnitScale(Caster,2.5,2.5,2.5)
 call KillUnit(Caster)
 else
 set x=GetUnitX(Caster)
 set y=GetUnitY(Caster)
 set TempGroup=GetAvailableGroup()
 set tt_group1=g
 set tt_unit1=Caster
 set tt_real1=Level*70
-call GroupEnumUnitsInRange(TempGroup,x,y,225,Condition(function GenericCondition_EnemyUnitsWithAncientsEx))
+call GroupEnumUnitsInRange(TempGroup,x,y,225+25,Condition(function GenericCondition_EnemyUnitsWithAncientsEx))
 call ForGroup(TempGroup,function IllusoryOrb_Damage)
 call KillGroup(TempGroup)
 call SetUnitX(Caster,SafeX(x+15*Cos(Angle*bj_DEGTORAD)))
 call SetUnitY(Caster,SafeY(y+15*Sin(Angle*bj_DEGTORAD)))
 endif
 set t=null
 set g=null
 set TempGroup=null
 set Caster=null
 return false
 endfunction
 function IllusoryOrb takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local group g=GetAvailableGroup()
@@ -49597,31 +50851,31 @@
 endfunction
 function Register_InnerVitality takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function InnerVitality))
 endfunction
 function BurningSpear_DealDamage takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Cache2
 local integer key
 local integer NumOfSpears
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
-if GetTriggerEvalCount(t)>6 or IsDead(Target)then
+if GetTriggerEvalCount(t)>7 or IsDead(Target)then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(31))))
 call FlushChildHashtable(hash_main,(Cache))
 set Cache2=GetHandleId(Source)
 set key=6000+GetHandleId(Target)
 set NumOfSpears=(LoadInteger(hash_main,(Cache2),(key)))
 set NumOfSpears=NumOfSpears-1
 if NumOfSpears==0 then
 call SaveInteger(hash_main,(Cache2),(key),(0))
 else
 call SaveInteger(hash_main,(Cache2),(key),(NumOfSpears))
 endif
 call TI_ClearUnit(TargetIndex)
 call CleanTrigger(t)
 else
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,4*GetUnitAbilityLevel(Source,abilityid_burningspear))
@@ -49894,32 +51148,32 @@
 set t=null
 set Source=null
 set Target=null
 endfunction
 function LiquidFire_Hit takes unit Source,unit Target returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_liquidfire)
 local real x=GetUnitX(Target)
 local real y=GetUnitY(Target)
 local group g=GetAvailableGroup()
 local group g2=GetAvailableGroup()
 set liquidfire_level=Level
 set liquidfire_source=Source
 set tt_unit1=Source
-call GroupEnumUnitsInRange(g,x,y,200,Condition(function GenericCondition_EnemyUnitsAndStructureEx))
-call GroupEnumUnitsInRange(g2,x,y,200,Condition(function GenericCondition_EnemySiegeEx))
+call GroupEnumUnitsInRange(g,x,y,300+25,Condition(function GenericCondition_EnemyUnitsAndStructureEx))
+call GroupEnumUnitsInRange(g2,x,y,300+25,Condition(function GenericCondition_EnemySiegeEx))
 call GroupAddGroup(g2,g)
 call ForGroup(g,function LiquidFire_Register)
 call KillGroup(g)
 call KillGroup(g2)
 set t=null
 set g=null
 set g2=null
 endfunction
 function LiquidFire_UnitDamaged takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
@@ -50008,117 +51262,157 @@
 set Hero=null
 set t=null
 endfunction
 function LiquidFire_Main takes nothing returns boolean
 if GetLearnedSkill()==abilityid_liquidfire and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_liquidfire)==1 and IsUnitIllusion(GetTriggerUnit())==false then
 call LiquidFire_Learned()
 endif
 return false
 endfunction
 function Register_LiquidFire takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function LiquidFire_Main))
 set t=null
 endfunction
-function IP_RawAbil takes nothing returns integer
-return 1093685046
-endfunction
-function IP_RawStunAbil takes nothing returns integer
-return 1093685062
-endfunction
-function IceDeath_Check takes nothing returns boolean
-return((IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetDyingUnit())))and(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false)and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0))
-endfunction
-function Ice_Path_IceDeath_Cond takes nothing returns boolean
-return GetUnitTypeId(GetDyingUnit())==1697657173
+function IcePath_Hit takes nothing returns nothing
+local unit Source=icepath_source
+local unit Target=GetEnumUnit()
+local unit Dummy
+if IsUnitInGroup(Target,icepath_alreadyhit)==false then
+call GroupAddUnit(icepath_alreadyhit,Target)
+call Stun(Source,Target,icepath_stunduration)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,25*icepath_level)
+call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",GetUnitX(Target),GetUnitY(Target)))
+endif
 endfunction
-function Ice_Path_IceDeath_Act takes nothing returns nothing
-local unit u=GetDyingUnit()
-local integer level=GetUnitUserData(u)
+function IcePath_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local real x0=(LoadReal(hash_main,(Cache),(6)))
+local real y0=(LoadReal(hash_main,(Cache),(7)))
+local real a=(LoadReal(hash_main,(Cache),(137)))
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local integer Count=GetTriggerEvalCount(t)
+local real x
+local real y
 local group g
-local unit Dummy
-local unit enum
-set g=GetAvailableGroup()
-call GroupEnumUnitsInRange(g,GetUnitX(u),GetUnitY(u),175,Condition(function IceDeath_Check))
+local integer i
+local group AlreadyHit=(LoadGroupHandle(hash_main,(Cache),(187)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_icepath)
+set i=0
 loop
-set enum=FirstOfGroup(g)
-exitwhen(enum==null)
-call GroupRemoveUnit(g,enum)
-set Dummy=CreateUnit(GetOwningPlayer(u),1697656901,GetUnitX(enum),GetUnitY(enum),0)
-call UnitAddAbility2(Dummy,(1093685062))
-call SetUnitAbilityLevel(Dummy,(1093685062),level)
-call IssueTargetOrder(Dummy,"thunderbolt",enum)
-call UnitApplyTimedLife(Dummy,1112820806,1)
-call UnitAddAbility2(Dummy,1097625443)
-endloop
+exitwhen i>10
+set x=x0+100*i*Cos(a*bj_DEGTORAD)
+set y=y0+100*i*Sin(a*bj_DEGTORAD)
+if ModuloInteger(Count,10)==0 then
+endif
+set tt_unit1=Source
+set icepath_source=Source
+set icepath_alreadyhit=AlreadyHit
+set icepath_stunduration=(0.6+0.4*Level)-(Count*0.05)
+set icepath_level=Level
+set g=GetAvailableGroup()
+call GroupEnumUnitsInRange(g,x,y,150+25,Condition(function GenericCondition_EnemyUnitsEx))
+call ForGroup(g,function IcePath_Hit)
 call KillGroup(g)
-call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",GetUnitX(u),GetUnitY(u)))
+set i=i+1
+endloop
+if Count==20*(0.6+0.4*Level)then
+call KillGroup(AlreadyHit)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+set t=null
+set Source=null
+set g=null
+set AlreadyHit=null
+return false
 endfunction
-function Trig_Ice_Path_Create takes nothing returns nothing
-local timer t=GetExpiredTimer()
+function IcePath_AnimateStart takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
-local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
-local integer Level=GetUnitAbilityLevel(Hero,(1093685046))
-local real x=(LoadReal(hash_main,(Cache),(321)))
-local real y=(LoadReal(hash_main,(Cache),(322)))
-local real Angle=(LoadReal(hash_main,(Cache),(323)))
-local unit Dummy
-local integer Counter=(LoadInteger(hash_main,(Cache),(324)))
-set x=x+100*Cos(Angle*bj_DEGTORAD)
-set y=y+100*Sin(Angle*bj_DEGTORAD)
-call SaveReal(hash_main,(Cache),(321),((x)*1.0))
-call SaveReal(hash_main,(Cache),(322),((y)*1.0))
-set Dummy=CreateUnit(GetOwningPlayer(Hero),1697657173,x,y,GetRandomReal(0,359))
-call UnitApplyTimedLife(Dummy,1112820806,0.5)
-call SetUnitUserData(Dummy,Level)
-call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",x,y))
-set Counter=Counter+1
-call SaveInteger(hash_main,(Cache),(324),(Counter))
-if Counter>=10 then
-call PauseTimer(t)
+local real x0=(LoadReal(hash_main,(Cache),(6)))
+local real y0=(LoadReal(hash_main,(Cache),(7)))
+local real a=(LoadReal(hash_main,(Cache),(137)))
+local integer Count=GetTriggerEvalCount(t)
+local real x=x0+100*Count*Cos(a*bj_DEGTORAD)
+local real y=y0+100*Count*Sin(a*bj_DEGTORAD)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_icepath)
+local ubersplat Splat
+local integer i
+if Count<10 then
+call SaveEffectHandle(hash_main,(Cache),(609+Count),(AddSpecialEffect("effects\\IcePath.mdx",x,y)))
+set Splat=CreateUbersplat(x,y,"IPTH",255,255,255,255,false,false)
+call SetUbersplatRenderAlways(Splat,true)
+call SaveUbersplatHandle(hash_main,(Cache),(760+Count),(Splat))
+endif
+if Count==10 then
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerAddCondition(t,Condition(function IcePath_Loop))
+call SaveReal(hash_main,(Cache),(6),((x0)*1.0))
+call SaveReal(hash_main,(Cache),(7),((y0)*1.0))
+call SaveReal(hash_main,(Cache),(137),((a)*1.0))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveGroupHandle(hash_main,(Cache),(187),(GetAvailableGroup()))
+call TriggerEvaluate(t)
+elseif Count>=(0.4+0.6+0.4*Level)/.05 then
+set i=0
+loop
+exitwhen i==10
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(609+i))))
+call DestroyUbersplat((LoadUbersplatHandle(hash_main,(Cache),(760+i))))
+set i=i+1
+endloop
 call FlushChildHashtable(hash_main,(Cache))
-call DestroyTimer(t)
+call CleanTrigger(t)
 endif
+set t=null
+set Source=null
+return false
 endfunction
-function Trig_Ice_Path_Conditions takes nothing returns boolean
-return GetSpellAbilityId()==(1093685046)
-endfunction
-function Trig_Ice_Path_Actions takes nothing returns nothing
-local timer t=CreateTimer()
-local unit Hero=GetTriggerUnit()
-local location TargetLoc=GetSpellTargetLoc()
-local location HeroLoc=GetUnitLoc(Hero)
+function IcePath takes nothing returns nothing
+local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
-call SaveReal(hash_main,(Cache),(321),((GetUnitX(Hero))*1.0))
-call SaveReal(hash_main,(Cache),(322),((GetUnitY(Hero))*1.0))
-call SaveReal(hash_main,(Cache),(323),((AngleBetweenPoints(HeroLoc,TargetLoc))*1.0))
-call SaveInteger(hash_main,(Cache),(324),(0))
-call RemoveLocation(HeroLoc)
-call RemoveLocation(TargetLoc)
-call TimerStart(t,0.05,true,function Trig_Ice_Path_Create)
+local unit Source=GetTriggerUnit()
+local real x=GetUnitX(Source)
+local real y=GetUnitY(Source)
+local real a=AngleBetweenXY(x,y,GetSpellTargetX(),GetSpellTargetY())
+call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerAddCondition(t,Condition(function IcePath_AnimateStart))
+call SaveReal(hash_main,(Cache),(6),((x)*1.0))
+call SaveReal(hash_main,(Cache),(7),((y)*1.0))
+call SaveReal(hash_main,(Cache),(137),((a)*1.0))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call TriggerEvaluate(t)
+set t=null
+set Source=null
 endfunction
-function RegisterIce_Path takes nothing returns nothing
-local trigger Ice_Path_IceDeath=CreateTrigger()
+function IcePath_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_icepath then
+call IcePath()
+endif
+return false
+endfunction
+function Register_IcePath takes nothing returns nothing
 local trigger t=CreateTrigger()
-call TriggerRegisterAnyUnitEvent(Ice_Path_IceDeath,EVENT_PLAYER_UNIT_DEATH)
-call TriggerAddCondition(Ice_Path_IceDeath,Condition(function Ice_Path_IceDeath_Cond))
-call TriggerAddAction(Ice_Path_IceDeath,function Ice_Path_IceDeath_Act)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
-call TriggerAddCondition(t,Condition(function Trig_Ice_Path_Conditions))
-call TriggerAddAction(t,function Trig_Ice_Path_Actions)
+call TriggerAddCondition(t,Condition(function IcePath_Main))
+set t=null
 endfunction
 function DualBreath_IsPointInTriangle takes real x1,real y1,real x2,real y2,real x3,real y3,real x,real y returns boolean
 local real calc1=(y-y1)*(x2-x1)-(x-x1)*(y2-y1)
 local real calc2=(y-y3)*(x1-x3)-(x-x3)*(y1-y3)
 local real calc3=(y-y2)*(x3-x2)-(x-x2)*(y3-y2)
 return(calc1*calc2>0)and(calc3*calc2>0)
 endfunction
 function DualBreath_FindTargets takes nothing returns boolean
 local real pt1=tt_real1
 local real pt2=tt_real2
 local real pt3=tt_real3
 local real pt4=tt_real4
 local real pt5=tt_real5
 local real pt6=tt_real6
 return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and DualBreath_IsPointInTriangle(pt1,pt2,pt3,pt4,pt5,pt6,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
@@ -50230,30 +51524,33 @@
 call TriggerAddCondition(t,Condition(function DualBreath_Main))
 call PreloadAbility(abilityid_dualbreathfrost)
 call PreloadAbility(abilityid_dualbreathfire)
 call PreloadAbility(abilityid_dualbreathfrosteffect)
 set t=null
 endfunction
 function Omnislash_Effect takes unit Hero,unit Target returns nothing
 local real a=GetRandomReal(0,360)
 local real x=GetUnitX(Target)+50*Cos(a*bj_DEGTORAD)
 local real y=GetUnitY(Target)+50*Sin(a*bj_DEGTORAD)
 local real dmg=GetRandomReal(175,250)
 call SetUnitPosition(Hero,x,y)
 call SetUnitFacing(Hero,bj_RADTODEG*Atan2(GetUnitY(Target)-GetUnitY(Hero),GetUnitX(Target)-GetUnitX(Hero)))
 call SetUnitAnimation(Hero,"Attack")
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl",Hero,"chest"))
+if IsRealPlayer(GetOwningPlayer(Target))==false and IsUnitType(Target,UNIT_TYPE_ANCIENT)==false then
+set dmg=99999
+endif
 call DamageTarget(Hero,Target,DAMAGE_PHYSICAL,dmg)
 call IssueTargetOrder(Hero,"attack",Target)
 endfunction
 function Omnislash_FirstTime takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 call Omnislash_Effect(Hero,Target)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Hero=null
 set Target=null
 return false
@@ -51138,31 +52435,35 @@
 function LagunaBlade_Main takes nothing returns boolean
 if(GetSpellAbilityId()==abilityid_lagunablade or GetSpellAbilityId()==abilityid_lagunablade_upgrade)and IsMagicImmune(GetSpellTargetUnit())then
 call InterruptUnit(GetTriggerUnit())
 call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName(1848659026))
 endif
 return false
 endfunction
 function Register_LagunaBlade takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function LagunaBlade_Main))
 set t=null
 endfunction
 function LunaLearn_Main takes nothing returns boolean
 if GetLearnedSkill()==1093678129 then
+if GetUnitAbilityLevel(GetTriggerUnit(),1093678129)==4 then
+call SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),1382378855,5)
+else
 call SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),1382378855,GetUnitAbilityLevel(GetTriggerUnit(),1093678129))
+endif
 elseif GetLearnedSkill()==1093678642 then
 call SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),1378889801,1)
 endif
 return false
 endfunction
 function Glaive takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function LunaLearn_Main))
 set t=null
 endfunction
 function Eclipse_WhichUnits takes nothing returns boolean
 if(GetUnitTypeId((GetFilterUnit()))==1966092345)or(IsMagicImmune(GetFilterUnit())==false and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))then
 if(LoadInteger(hash_main,(eclipsehash),(GetHandleId(GetFilterUnit()))))<tt_int1 then
 return true
@@ -51252,31 +52553,31 @@
 function Register_Eclipse takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Eclipse_Main))
 set t=null
 endfunction
 function Starfall_Visual takes nothing returns nothing
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl",GetEnumUnit(),"origin"))
 endfunction
 function Starfall_Second_Helper takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
-call DamageTarget(Hero,Target,DAMAGE_MAGICAL,GetUnitAbilityLevel(Hero,abilityid_starfall)*37.5)
+call DamageTarget(Hero,Target,DAMAGE_MAGICAL,0.75*GetUnitAbilityLevel(Hero,abilityid_starfall)*75)
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Hero=null
 set Target=null
 return false
 endfunction
 function Starfall_Second takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local group g=GetAvailableGroup()
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
@@ -51392,31 +52693,31 @@
 endfunction
 function MoonlightShadow_EndDuration takes nothing returns nothing
 local timer t=GetExpiredTimer()
 local integer Cache=GetHandleId(t)
 local group GroupVar=(LoadGroupHandle(hash_main,(Cache),(220)))
 call ForGroup(GroupVar,function MoonlightShadow_RemoveInvisibility)
 call KillGroup(GroupVar)
 call KillTimer(t)
 endfunction
 function MoonlightShadow_Action takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local group GroupVar=GetAvailableGroup()
 local timer t=CreateTimer()
 local integer Cache=GetHandleId(t)
 local integer Level=GetUnitAbilityLevel(Hero,(1093684053))
-local real Duration=11
+local real Duration=15
 set udg_TempInt=Level
 call GroupEnumUnitsInRange(GroupVar,0,0,9999,Condition(function MoonlightShadow_AlliedHeroes))
 call ForGroup(GroupVar,function MoonlightShadow_AddInvisibility)
 call SaveGroupHandle(hash_main,(Cache),(220),(GroupVar))
 call TimerStart(t,Duration,false,function MoonlightShadow_EndDuration)
 endfunction
 function RegisterMoonlightShadow takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function MoonlightShadow_Condition))
 call TriggerAddAction(t,function MoonlightShadow_Action)
 endfunction
 constant function Leap_RawCode takes nothing returns integer
 return 1093684302
 endfunction
@@ -51728,103 +53029,104 @@
 local unit FilterUnit=GetFilterUnit()
 if IsUnitInGroup(FilterUnit,udg_TempGroup)then
 return false
 endif
 if IsUnitEnemy(FilterUnit,GetOwningPlayer(udg_TempUnit))and GetUnitAbilityLevel(FilterUnit,1093678162)!=1 and GetUnitState(FilterUnit,UNIT_STATE_LIFE)>0 and IsUnitType(FilterUnit,UNIT_TYPE_STRUCTURE)==false then
 return true
 endif
 return false
 endfunction
 function Waveform_Damage takes nothing returns nothing
 call UnitDamageTarget(udg_TempUnit,GetEnumUnit(),udg_TempReal,true,true,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_MAGIC,WEAPON_TYPE_WHOKNOWS)
 endfunction
 function Waveform_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
-local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local unit UnitVar=(LoadUnitHandle(hash_main,(Cache),(221)))
 local real Angle=(LoadReal(hash_main,(Cache),(13)))
 local integer Remaining=(LoadInteger(hash_main,(Cache),(194)))
 local group AlreadyDamaged=(LoadGroupHandle(hash_main,(Cache),(133)))
 local real CurrentX=GetUnitX(UnitVar)
 local real CurrentY=GetUnitY(UnitVar)
 local real LastX=(LoadReal(hash_main,(Cache),(23)))
 local real LastY=(LoadReal(hash_main,(Cache),(24)))
 local real NewX=LastX+1000*0.05*Cos(Angle)
 local real NewY=LastY+1000*0.05*Sin(Angle)
 local group GroupVar=GetAvailableGroup()
+local unit Dummy=(LoadUnitHandle(hash_main,(Cache),(239)))
 call SaveReal(hash_main,(Cache),(23),((NewX)*1.0))
 call SaveReal(hash_main,(Cache),(24),((NewY)*1.0))
 set udg_TempUnit=UnitVar
 set udg_TempReal=GetUnitAbilityLevel(UnitVar,1093682766)*75+25
 set udg_TempGroup=AlreadyDamaged
-call GroupEnumUnitsInRange(GroupVar,CurrentX,CurrentY,280,Condition(function Waveform_WhichToDamage))
+call GroupEnumUnitsInRange(GroupVar,CurrentX,CurrentY,200+25,Condition(function Waveform_WhichToDamage))
 call ForGroup(GroupVar,function Waveform_Damage)
 call GroupAddGroup(GroupVar,AlreadyDamaged)
 call KillGroup(GroupVar)
 set Remaining=Remaining-1
 call SaveInteger(hash_main,(Cache),(194),(Remaining))
 call SetUnitX(UnitVar,SafeX(NewX))
 call SetUnitY(UnitVar,SafeY(NewY))
-call SetUnitPosition(Caster,NewX,NewY)
+call SetUnitX(Dummy,GetUnitX(UnitVar))
+call SetUnitY(Dummy,GetUnitY(UnitVar))
+call IssueTargetOrder(Dummy,"thunderbolt",UnitVar)
 call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",CurrentX,CurrentY))
 if Remaining==0 then
-call RemoveUnit(Caster)
+call RemoveUnit(Dummy)
 call SetUnitVertexColor(UnitVar,255,255,255,255)
 call SaveBoolean(hash_main,(GetHandleId(UnitVar)),(225),(false))
 call SetUnitInvulnerable(UnitVar,false)
 call SetUnitPathing(UnitVar,true)
 call KillGroup(AlreadyDamaged)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set UnitVar=null
-set Caster=null
 set AlreadyDamaged=null
 set GroupVar=null
 set t=null
 return false
 endfunction
 function Waveform_Actions takes nothing returns nothing
 local unit UnitVar=GetTriggerUnit()
 local real SourceX=GetUnitX(UnitVar)
 local real SourceY=GetUnitY(UnitVar)
 local location TargetLoc=GetSpellTargetLoc()
 local real TargetX=GetLocationX(TargetLoc)
 local real TargetY=GetLocationY(TargetLoc)
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local group AlreadyDamaged=GetAvailableGroup()
-local unit Caster=CreateUnit(GetOwningPlayer(UnitVar),1865429063,SourceX,SourceY,0)
 local integer pid=GetPlayerId(GetOwningPlayer(UnitVar))
+local unit Dummy=CreateUnit(GetOwningPlayer(UnitVar),1697656901,SourceX,SourceY,0)
+call UnitAddAbility(Dummy,1093815860)
 call RemoveLocation(TargetLoc)
 if GetSpellTargetUnit()!=null then
 set TargetX=GetUnitX(GetSpellTargetUnit())
 set TargetY=GetUnitY(GetSpellTargetUnit())
 endif
 call SetUnitVertexColor(UnitVar,255,255,255,0)
 call SaveBoolean(hash_main,(GetHandleId(UnitVar)),(225),(true))
 call SetUnitInvulnerable(UnitVar,true)
 call SetUnitPathing(UnitVar,false)
-call SetUnitPathing(Caster,false)
 call SaveUnitHandle(hash_main,(Cache),(221),(UnitVar))
-call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 call SaveReal(hash_main,(Cache),(23),((SourceX)*1.0))
 call SaveReal(hash_main,(Cache),(24),((SourceY)*1.0))
 call SaveGroupHandle(hash_main,(Cache),(133),(AlreadyDamaged))
 call SaveReal(hash_main,(Cache),(13),((Atan2(TargetY-SourceY,TargetX-SourceX))*1.0))
 call SaveInteger(hash_main,(Cache),(194),(IMax(R2I(SquareRoot((TargetX-SourceX)*(TargetX-SourceX)+(TargetY-SourceY)*(TargetY-SourceY))/50),1)))
+call SaveUnitHandle(hash_main,(Cache),(239),(Dummy))
 call TriggerRegisterTimerEvent(t,0.04,true)
 call TriggerAddCondition(t,Condition(function Waveform_Move))
 call ShowUnit(UnitVar,false)
 call ShowUnit(UnitVar,true)
 call SelectUnitAddForPlayer(UnitVar,GetOwningPlayer(UnitVar))
 set t=null
 endfunction
 function RegisterWaveform takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Waveform_Conditions))
 call TriggerAddAction(t,function Waveform_Actions)
 endfunction
 constant function ReplicateAbilityId takes nothing returns integer
 return 1093683000
@@ -51971,64 +53273,64 @@
 call TriggerAddCondition(t,Condition(function ReplicateOnCastConditions))
 call TriggerAddAction(t,function ReplicateOnCast)
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
 call TriggerAddCondition(t,Condition(function ReplicateOnSummonConditions))
 call TriggerAddAction(t,function ReplicateOnSummon)
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function ReplicateOnMorphConditions))
 call TriggerAddAction(t,function ReplicateOnMorph)
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function Replicate_Restriction))
 set t=null
 endfunction
-function Morph_Attribute takes unit Hero,integer whichAttribute,integer rate returns nothing
+function Morph_Attribute takes unit Hero,integer whichAttribute,real rate returns nothing
 local integer CurrentAgi=GetHeroAgi(Hero,false)
 local integer CurrentStr=GetHeroStr(Hero,false)
 local real CurrentMana=GetUnitState(Hero,UNIT_STATE_MANA)
 if whichAttribute==bj_HEROSTAT_STR then
 if CurrentMana>=rate and CurrentAgi>2 and IsDead(Hero)==false then
 call SetUnitState(Hero,UNIT_STATE_MANA,CurrentMana-rate)
 call SetHeroAgi(Hero,CurrentAgi-2,true)
 call SetHeroStr(Hero,CurrentStr+2,true)
 endif
 elseif whichAttribute==bj_HEROSTAT_AGI then
 if CurrentMana>=rate and CurrentStr>2 and IsDead(Hero)==false then
 call SetUnitState(Hero,UNIT_STATE_MANA,CurrentMana-rate)
 call SetHeroAgi(Hero,CurrentAgi+2,true)
 call SetHeroStr(Hero,CurrentStr-2,true)
 endif
 endif
 endfunction
 function Morph_Agility takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_morph)
-call Morph_Attribute(Hero,bj_HEROSTAT_AGI,20/Level)
+call Morph_Attribute(Hero,bj_HEROSTAT_AGI,30.0/Level)
 set t=null
 set Hero=null
 return false
 endfunction
 function Morph_Strength takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_morph)
-call Morph_Attribute(Hero,bj_HEROSTAT_STR,20/Level)
+call Morph_Attribute(Hero,bj_HEROSTAT_STR,30.0/Level)
 set t=null
 set Hero=null
 return false
 endfunction
 function Morph_Order takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=GetTriggerUnit()
 local trigger Iterate=(LoadTriggerHandle(hash_main,(Cache),(226)))
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_morph)
 local integer LastOrder=(LoadInteger(hash_main,(Cache),(227)))
 local real Interval=1.0/Level
 if GetIssuedOrderId()==orderid_morphon_agi then
 if Iterate!=null then
 call FlushChildHashtable(hash_main,(GetHandleId(Iterate)))
@@ -52062,33 +53364,33 @@
 endif
 call SaveTriggerHandle(hash_main,(Cache),(226),(null))
 call SaveInteger(hash_main,(Cache),(227),(GetIssuedOrderId()))
 call UnitRemoveAbility(Hero,fx_morph_agi)
 call UnitRemoveAbility(Hero,fx_morph_str)
 elseif GetIssuedOrderId()==orderid_morphoff_str then
 if Iterate!=null then
 call FlushChildHashtable(hash_main,(GetHandleId(Iterate)))
 call CleanTrigger(Iterate)
 endif
 call SaveTriggerHandle(hash_main,(Cache),(226),(null))
 call SaveInteger(hash_main,(Cache),(227),(GetIssuedOrderId()))
 call UnitRemoveAbility(Hero,fx_morph_agi)
 call UnitRemoveAbility(Hero,fx_morph_str)
 elseif GetIssuedOrderId()==orderid_morph_agi and LastOrder!=orderid_morphon_str and LastOrder!=orderid_morphon_str then
-call Morph_Attribute(Hero,bj_HEROSTAT_AGI,20/Level)
+call Morph_Attribute(Hero,bj_HEROSTAT_AGI,30./Level)
 elseif GetIssuedOrderId()==orderid_morph_str and LastOrder!=orderid_morphon_str and LastOrder!=orderid_morphon_str then
-call Morph_Attribute(Hero,bj_HEROSTAT_STR,20/Level)
+call Morph_Attribute(Hero,bj_HEROSTAT_STR,30./Level)
 endif
 set t=null
 set Hero=null
 set Iterate=null
 return false
 endfunction
 function Morph takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local trigger t
 local integer Cache
 local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),abilityid_morph)
 if Level==1 then
 call SetHeroAgi(Hero,GetHeroAgi(Hero,false)+3,true)
 call SetHeroStr(Hero,GetHeroStr(Hero,false)+3,true)
 else
@@ -52809,35 +54111,35 @@
 set abilityid=spiritlance_image2
 elseif Level==3 then
 set abilityid=spiritlance_image3
 else
 set abilityid=spiritlance_image4
 endif
 call UnitAddAbility2(Caster,abilityid)
 call IssueTargetOrderById(Caster,852274,udg_Hero[GetPlayerId(p)])
 set Caster=null
 endfunction
 function SpiritLance_Damage takes player p,unit Target,integer Level,boolean Primary,boolean DealDamage returns nothing
 local real Damage=50+50*Level
 local unit Caster
 local integer abilityid
 if DealDamage then
-set Caster=CreateUnit(p,1697656901,GetUnitX(Target),GetUnitY(Target),0)
+set Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
 call UnitAddAbility2(Caster,spiritlance_slow)
 call SetUnitAbilityLevel(Caster,spiritlance_slow,Level)
 call IssueTargetOrder(Caster,"cripple",Target)
-call DamageTarget(Caster,Target,DAMAGE_MAGICAL,Damage)
+call DamageTarget(udg_Hero[GetPlayerId(p)],Target,DAMAGE_MAGICAL,Damage)
 if Primary then
 call SpiritLance_CreateImage(p,Target,Level)
 endif
 endif
 call DestroyEffect(AddSpecialEffectTarget(spiritlance_fx,Target,spiritlance_fx_attach))
 set Caster=null
 endfunction
 function SpiritLance_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local player p=(LoadPlayerHandle(hash_main,(Cache),(54)))
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local boolean damage=(LoadBoolean(hash_main,(Cache),(302)))
@@ -53452,161 +54754,147 @@
 set Source=null
 set Caster=null
 endfunction
 function Sentinel_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_sentinel then
 call Sentinel()
 endif
 return false
 endfunction
 function Register_Sentinel takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Sentinel_Main))
 set t=null
 endfunction
+function LivingArmor_FindTarget takes nothing returns nothing
+local unit Target=GetEnumUnit()
+local real d=DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),livingarmor_x,livingarmor_y)
+if d<livingarmor_distance and IsUnitVisible(Target,GetOwningPlayer(livingarmor_source))==true and(IsUnitType(Target,UNIT_TYPE_HERO)==true or(IsUnitType(Target,UNIT_TYPE_STRUCTURE)==true and IsTowerOrRax(Target)))then
+set livingarmor_target=GetEnumUnit()
+set livingarmor_distance=d
+endif
+set Target=null
+endfunction
 function LivingArmor_Think takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
-local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
-local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
-local integer Level
-local player p
-if Source==null or IsDead(Source)then
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor_structure)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp_structure)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor_global)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp_global)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor_structure_global)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp_structure_global)
-else
-if(IsSent(GetOwningPlayer(Source))==true and IsSent(GetOwningPlayer(Caster))==false)or(IsSent(GetOwningPlayer(Source))==false and IsSent(GetOwningPlayer(Caster))==true)then
-if IsSent(GetOwningPlayer(Source))then
-set p=udg_SentPlayers[0]
-else
-set p=udg_ScourgePlayers[0]
-endif
-call SetUnitOwner(Caster,p,false)
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Count=(LoadInteger(hash_main,(Cache),(34)))
+if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
+if GetEventDamage()>5 then
+set Count=Count+1
+call SaveInteger(hash_main,(Cache),(34),(Count))
 endif
-set Level=GetUnitAbilityLevel(Source,abilityid_livingarmor)
-if IsDay()then
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor_structure)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp_structure)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_hp_global)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_armor_global)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_hp_structure_global)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_armor_structure_global)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_hp_global,Level)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_armor_global,Level)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_hp_structure_global,Level)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_armor_structure_global,Level)
-else
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor_global)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp_global)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_armor_structure_global)
-call UnitRemoveAbility(Caster,abilityid_livingarmor_aura_hp_structure_global)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_hp)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_armor)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_hp_structure)
-call UnitAddAbility(Caster,abilityid_livingarmor_aura_armor_structure)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_hp,Level)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_armor,Level)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_hp_structure,Level)
-call SetUnitAbilityLevel(Caster,abilityid_livingarmor_aura_armor_structure,Level)
 endif
-call SetUnitX(Caster,GetUnitX(Source))
-call SetUnitY(Caster,GetUnitY(Source))
+if GetTriggerEventId()!=EVENT_UNIT_DAMAGED or Count>6 then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call UnitRemoveAbility(Target,livingarmor_damageblock_1)
+call UnitRemoveAbility(Target,livingarmor_damageblock_2)
+call UnitRemoveAbility(Target,livingarmor_damageblock_3)
+call UnitRemoveAbility(Target,livingarmor_damageblock_4)
+call UnitRemoveAbility(Target,livingarmor_buffid)
 endif
 set t=null
-set Source=null
-set Caster=null
+set Target=null
 return false
 endfunction
 function LivingArmor takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local unit Target=GetSpellTargetUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-local unit Source=GetTriggerUnit()
-local player p
-local unit Caster
-if IsSent(GetOwningPlayer(Source))then
-set p=udg_SentPlayers[0]
-else
-set p=udg_ScourgePlayers[0]
+local integer abilid=livingarmor_damageblock_1
+local integer Level=GetUnitAbilityLevel(Source,abilityid_livingarmor)
+local group g
+if Target==null then
+set livingarmor_target=null
+set livingarmor_source=Source
+set livingarmor_distance=999999
+set livingarmor_x=GetSpellTargetX()
+set livingarmor_y=GetSpellTargetY()
+set tt_unit1=Source
+set g=GetAvailableGroup()
+call GroupEnumUnitsInRange(g,0,0,9999,Condition(function GenericCondition_AlliedUnitsAndStructureEx))
+call ForGroup(g,function LivingArmor_FindTarget)
+call KillGroup(g)
+set Target=livingarmor_target
+set g=null
 endif
-set Caster=CreateUnit(p,1697657174,0,0,0)
-call UnitAddAbility2(Source,abilityid_livingarmor_fx)
-call TriggerRegisterTimerEvent(t,0.1,true)
+if Level==2 then
+set abilid=livingarmor_damageblock_2
+elseif Level==3 then
+set abilid=livingarmor_damageblock_3
+elseif Level==4 then
+set abilid=livingarmor_damageblock_4
+endif
+call UnitAddAbility2(Target,abilid)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilid,false)
+call TriggerRegisterTimerEvent(t,15,false)
+call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
 call TriggerAddCondition(t,Condition(function LivingArmor_Think))
-call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
-call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveInteger(hash_main,(Cache),(34),(0))
 set t=null
 set Source=null
-set Caster=null
 endfunction
 function LivingArmor_Main takes nothing returns boolean
-if GetLearnedSkill()==abilityid_livingarmor and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_livingarmor)==1 and IsUnitIllusion(GetTriggerUnit())==false then
+if GetSpellAbilityId()==abilityid_livingarmor then
 call LivingArmor()
 endif
 return false
 endfunction
 function Register_LivingArmor takes nothing returns nothing
 local trigger t=CreateTrigger()
-call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function LivingArmor_Main))
-call PreloadAbility(abilityid_livingarmor_aura_hp)
-call PreloadAbility(abilityid_livingarmor_aura_hp_structure)
-call PreloadAbility(abilityid_livingarmor_aura_hp_global)
-call PreloadAbility(abilityid_livingarmor_aura_hp_structure_global)
-call PreloadAbility(abilityid_livingarmor_aura_armor)
-call PreloadAbility(abilityid_livingarmor_aura_armor_structure)
-call PreloadAbility(abilityid_livingarmor_aura_armor_global)
-call PreloadAbility(abilityid_livingarmor_aura_armor_structure_global)
 set t=null
 endfunction
 function LeechSeed_Hit takes nothing returns nothing
 local integer Cache=GetHandleId(GetTriggeringTrigger())
 local unit Source=tt_unit1
 local unit Target=tt_unit2
 local real Heal=(LoadReal(hash_main,(Cache),(21)))
 call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+Heal)
 set Source=null
 set Target=null
 endfunction
 function LeechSeed_Process takes nothing returns nothing
 local trigger t=CreateProjectileToUnit(leechseed_target,GetEnumUnit(),unitid_leechseed,"LeechSeed_Hit",400)
 local integer Cache=GetHandleId(t)
 call SaveReal(hash_main,(Cache),(21),((leechseed_amount)*1.0))
 set t=null
 endfunction
 function LeechSeed_Think takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local group g
+local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 if GetTriggerEventId()==EVENT_WIDGET_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call UnitRemoveAbility(Target,leechseed_slow)
 call UnitRemoveAbility(Target,leechseed_slow_buffid)
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 else
-if GetTriggerEvalCount(t)>3 then
+set Count=Count+1
+call SaveInteger(hash_main,(Cache),(34),(Count))
+if Count>3 then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call UnitRemoveAbility(Target,leechseed_slow)
 call UnitRemoveAbility(Target,leechseed_slow_buffid)
 endif
 call DestroyEffect(AddSpecialEffectTarget(leechseed_pulse,Target,"origin"))
 set tt_unit1=Source
 set g=GetAvailableGroup()
 call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),525,Condition(function GenericCondition_AlliedUnitsEx))
 set leechseed_target=Target
 set leechseed_amount=15+15*Level
 call ForGroup(g,function LeechSeed_Process)
 call KillGroup(g)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,leechseed_amount)
 endif
@@ -53620,189 +54908,268 @@
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_leechseed)
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call UnitAddAbility2(Target,leechseed_slow)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Target),leechseed_slow,false)
 call TriggerRegisterDeathEvent(t,Target)
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterTimerEvent(t,0,false)
 call TriggerAddCondition(t,Condition(function LeechSeed_Think))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(442),(((TimerGetElapsed(udg_GameTimer)))*1.0))
 call SaveInteger(hash_main,(Cache),(5),(Level))
+call SaveInteger(hash_main,(Cache),(34),(0))
 set t=null
 set Source=null
 endfunction
 function LeechSeed takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 call CreateProjectileToUnit(Source,Target,unitid_leechseed_projectile,"LeechSeed_Start",600)
 set Source=null
 set Target=null
 endfunction
 function LeechSeed_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_leechseed and IsBlocked(GetSpellTargetUnit())==false then
 call LeechSeed_Start()
 endif
 return false
 endfunction
 function Register_LeechSeed takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function LeechSeed_Main))
 set t=null
 endfunction
 function LastWord_Damage takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_lastword)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
-if IsDead(Source)==false and IsDead(Target)==false then
-endif
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,100+50*Level)
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function LastWord_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
-local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Target),GetUnitY(Target),0)
+local unit Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_lastword)
+local boolean SpecialEnd=(LoadBoolean(hash_main,(Cache),(95)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
-if IsDead(Source)==false and IsDead(Target)==false then
 call UnitAddAbility2(Caster,1093684307)
 call SetUnitAbilityLevel(Caster,1093684307,Level)
 call IssueTargetOrder(Caster,"soulburn",Target)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerAddCondition(t,Condition(function LastWord_Damage))
 call TriggerRegisterTimerEvent(t,0.01,false)
 call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(Source))
 call SaveUnitHandle(hash_main,(GetHandleId(t)),(17),(Target))
 call SaveInteger(hash_main,(GetHandleId(t)),(5),(Level))
+if SpecialEnd then
+call DestroyEffect(AddSpecialEffectTarget(lastword_fx_end_forced,Target,"overhead"))
 endif
 set t=null
 set Source=null
 set Target=null
 set Caster=null
 return false
 endfunction
 function IsAttackOrb takes integer id returns boolean
 return id==1093682265 or id==1093752642 or id==1093677622 or id==1093679446 or id==1095263841 or id==1093684314 or id==1093685582 or id==1093685065
 endfunction
 function LastWord_Cast takes nothing returns boolean
-local unit Target=GetTriggerUnit()
-local unit Source=(LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(2)))
-local trigger t
-if GetUnitAbilityLevel(GetTriggerUnit(),1110455638)>0 and GetUnitAbilityLevel(GetTriggerUnit(),1093678162)==0 and IsGlobalSpellIgnore(GetSpellAbilityId())==false and GetSpellAbilityId()!=1095328363 and GetSpellAbilityId()!=1093678426 and GetSpellAbilityId()!=1093682768 and GetSpellAbilityId()!=1093685593 and GetSpellAbilityId()!=1093678680 and GetSpellAbilityId()!=1093681489 and GetSpellAbilityId()!=abilityid_wex and GetSpellAbilityId()!=abilityid_quas and GetSpellAbilityId()!=abilityid_exort and GetSpellAbilityId()!=1093743191 and GetSpellAbilityId()!=1093678667 and GetSpellAbilityId()!=1097163124 and GetSpellAbilityId()!=1093683801 and GetSpellAbilityId()!=1093682767 and GetSpellAbilityId()!=abilityid_unstableconcoction and GetSpellAbilityId()!=abilityid_iceblast and GetSpellAbilityId()!=1093751096 and GetSpellAbilityId()!=1093751361 and GetSpellAbilityId()!=1093751126 and GetSpellAbilityId()!=abilityid_invoke and GetSpellAbilityId()!=abilityid_invokeupgrade and GetSpellAbilityId()!=abilityid_sunray and IsAttackOrb(GetSpellAbilityId())==false then
-if IsUnitEnemy(Target,GetOwningPlayer(Source))==true and IsItemAbility(GetSpellAbilityId())==false then
-if((LoadInteger(hash_main,(GetHandleId((Target))),((4305))))==HERO_STATE_ON)==false then
-set t=CreateTrigger()
-call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_ENDCAST)
-call TriggerAddCondition(t,Condition(function LastWord_End))
-call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(Source))
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local unit Caster
+local integer Level=GetUnitAbilityLevel(Source,abilityid_lastword)
+if GetTriggerEventId()==EVENT_WIDGET_DEATH then
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+call UnitRemoveAbility(Target,lastword_visual)
+call UnitRemoveAbility(Target,lastword_visual_buffid)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+elseif GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT then
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+call UnitRemoveAbility(Target,lastword_visual)
+call UnitRemoveAbility(Target,lastword_visual_buffid)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerAddCondition(t,Condition(function LastWord_End))
+call TriggerRegisterTimerEvent(t,0.01,false)
+call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(Source))
 call SaveUnitHandle(hash_main,(GetHandleId(t)),(17),(Target))
-set t=null
+call SaveInteger(hash_main,(GetHandleId(t)),(5),(Level))
+call SaveBoolean(hash_main,(Cache),(95),(false))
+set Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
+call UnitAddAbility2(Caster,1093815895)
+call SetUnitAbilityLevel(Caster,1093815895,Level)
+call IssueTargetOrder(Caster,"drunkenhaze",Target)
+call DestroyEffect(AddSpecialEffectTarget(lastword_fx_end_natural,Target,"overhead"))
+set Caster=null
+elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and IsItemAbility(GetSpellAbilityId())==false and IsGlobalSpellIgnore(GetSpellAbilityId())==false and GetSpellAbilityId()!=1095328363 and GetSpellAbilityId()!=1093678426 and GetSpellAbilityId()!=1093682768 and GetSpellAbilityId()!=1093685593 and GetSpellAbilityId()!=1093678680 and GetSpellAbilityId()!=1093681489 and GetSpellAbilityId()!=abilityid_wex and GetSpellAbilityId()!=abilityid_quas and GetSpellAbilityId()!=abilityid_exort and GetSpellAbilityId()!=1093743191 and GetSpellAbilityId()!=1093678667 and GetSpellAbilityId()!=1097163124 and GetSpellAbilityId()!=1093683801 and GetSpellAbilityId()!=1093682767 and GetSpellAbilityId()!=abilityid_unstableconcoction and GetSpellAbilityId()!=abilityid_iceblast and GetSpellAbilityId()!=1093751096 and GetSpellAbilityId()!=1093751361 and GetSpellAbilityId()!=1093751126 and GetSpellAbilityId()!=abilityid_invoke and GetSpellAbilityId()!=abilityid_invokeupgrade and GetSpellAbilityId()!=abilityid_sunray and IsAttackOrb(GetSpellAbilityId())==false then
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+call UnitRemoveAbility(Target,lastword_visual)
+call UnitRemoveAbility(Target,lastword_visual_buffid)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+if GetSpellAbilityId()==1093685846 or GetSpellAbilityId()==1093684302 then
+call TriggerRegisterTimerEvent(t,0.01,false)
+else
+call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_ENDCAST)
 endif
+call TriggerAddCondition(t,Condition(function LastWord_End))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveBoolean(hash_main,(Cache),(95),(true))
 endif
+set Target=null
+set Source=null
+set t=null
+return false
+endfunction
+function LastWord_Vision takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+if GetUnitAbilityLevel(Target,lastword_visual)==0 or GetTriggerEvalCount(t)>250 then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call KillUnit(Caster)
+else
+call SetUnitX(Caster,GetUnitX(Target))
+call SetUnitY(Caster,GetUnitY(Target))
 endif
+set t=null
+set Caster=null
 set Target=null
+return false
+endfunction
+function LastWord takes nothing returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=GetTriggerUnit()
+local unit Target=GetSpellTargetUnit()
+local unit Caster=CreateUnit(GetOwningPlayer(Source),1865429305,GetUnitX(Target),GetUnitY(Target),0)
+call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_SPELL_EFFECT)
+call TriggerRegisterTimerEvent(t,5,false)
+call TriggerRegisterDeathEvent(t,Target)
+call TriggerAddCondition(t,Condition(function LastWord_Cast))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call UnitAddAbility2(Target,lastword_visual)
+call UnitMakeAbilityPermanent(Target,true,1093815894)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),lastword_visual,false)
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(lastword_fx,Target,"overhead")))
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0.02,true)
+call TriggerAddCondition(t,Condition(function LastWord_Vision))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 set Source=null
+set Target=null
+set t=null
+endfunction
+function LastWord_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_lastword and IsBlocked(GetSpellTargetUnit())==false then
+call LastWord()
+endif
 return false
 endfunction
 function LastWord_Process takes nothing returns nothing
 local integer Cache=GetHandleId(GetTriggeringTrigger())
 local unit Source=tt_unit2
 local real Damage=(LoadReal(hash_main,(Cache),(20)))
 call SetHeroInt(Source,GetHeroInt(Source,false)+1,true)
 call TextTagOnUnitEx("+1 "+GetObjectName(1848658512),3,Source,0.023,0,255,0,230)
 set Source=null
 endfunction
 function LastWord_Process2 takes nothing returns nothing
 local integer Cache=GetHandleId(GetTriggeringTrigger())
 local unit Source=tt_unit2
 local real Damage=(LoadReal(hash_main,(Cache),(20)))
 call SetHeroInt(Source,GetHeroInt(Source,false)+2,true)
 call TextTagOnUnitEx("+2 "+GetObjectName(1848658512),3,Source,0.023,0,255,0,230)
 set Source=null
 endfunction
 function LastWord_Death takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Dying=GetTriggerUnit()
-if IsUnitType(Dying,UNIT_TYPE_HERO)==true and GetUnitTypeId(Dying)!=1211117642 and IsUnitIllusion(Dying)==false and IsUnitInRange(Source,Dying,850)and IsDead(Source)==false and IsUnitAlly(Source,GetOwningPlayer(Dying))==false then
-if Source==GetKillingUnit()then
+if IsUnitType(Dying,UNIT_TYPE_HERO)==true and IsGlobalHeroDummy(GetUnitTypeId(Dying))==false and IsUnitIllusion(Dying)==false and(IsUnitInRange(Source,Dying,900)or GetOwningPlayer(Source)==GetOwningPlayer(GetKillingUnit()))and IsDead(Source)==false and IsUnitAlly(Source,GetOwningPlayer(Dying))==false then
 set LastWord_Stolen[GetPlayerId(GetOwningPlayer(Source))]=LastWord_Stolen[GetPlayerId(GetOwningPlayer(Source))]+2
 call TextTagOnUnitEx("-2 "+GetObjectName(1848658512),3,Dying,0.023,255,0,0,230)
 call SetHeroInt(Dying,GetHeroInt(Dying,false)-2,true)
 call CreateProjectileToUnit(Dying,Source,1747993424,"LastWord_Process2",450)
-else
-set LastWord_Stolen[GetPlayerId(GetOwningPlayer(Source))]=LastWord_Stolen[GetPlayerId(GetOwningPlayer(Source))]+1
-call TextTagOnUnitEx("-1 "+GetObjectName(1848658512),3,Dying,0.023,255,0,0,230)
-call SetHeroInt(Dying,GetHeroInt(Dying,false)-1,true)
-call CreateProjectileToUnit(Dying,Source,1747993424,"LastWord_Process",450)
-endif
 endif
 set t=null
 set Source=null
 set Dying=null
 return false
 endfunction
-function LastWord takes nothing returns nothing
+function LastWord_RegisterDeath takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
-call TriggerAddCondition(t,Condition(function LastWord_Cast))
-call SaveUnitHandle(hash_main,(Cache),(2),(Source))
-set t=CreateTrigger()
-set Cache=GetHandleId(t)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function LastWord_Death))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 set Source=null
 set t=null
 endfunction
-function LastWord_Main takes nothing returns boolean
-if GetLearnedSkill()==abilityid_lastword and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_lastword)==1 then
-call LastWord()
+function LastWord_Learn takes nothing returns boolean
+if GetLearnedSkill()==abilityid_glaivesofwisdom and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_glaivesofwisdom)==1 then
+call LastWord_RegisterDeath()
 endif
 return false
 endfunction
 function Int_Command takes nothing returns boolean
 local integer Total=LastWord_Stolen[GetPlayerId(GetTriggerPlayer())]
 if GetUnitTypeId(udg_Hero[GetPlayerId(GetTriggerPlayer())])==1311781185 and Total>0 then
 call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,udg_TextY,10.00,GetObjectName(1848657997)+" "+I2S(Total))
 endif
 return false
 endfunction
 function Register_LastWord takes nothing returns nothing
 local trigger t=CreateTrigger()
-call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function LastWord_Main))
 set t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerAddCondition(t,Condition(function LastWord_Learn))
+set t=CreateTrigger()
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[1],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[2],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[3],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[4],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[5],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[1],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[2],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[3],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[4],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[5],"-stats",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[1],"-st",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[2],"-st",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[3],"-st",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[4],"-st",true)
 call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[5],"-st",true)
@@ -53913,36 +55280,36 @@
 return false
 endfunction
 function RegisterGlaivesOfWisdom takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function GlaivesOfWisdom))
 set t=null
 endfunction
 function CurseOfTheSilent_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
-if GetTriggerEventId()!=EVENT_UNIT_DEATH and GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT and Count<(4+Level)then
+if GetTriggerEventId()!=EVENT_UNIT_DEATH and GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT and Count<(6)then
 set Count=Count+1
 call SaveInteger(hash_main,(Cache),(34),(Count))
-call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-5-5*Level)
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,10+10*Level)
-elseif Count>=(4+Level)or GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()!=abilityid_phaseboots and GetSpellAbilityId()!=1093682767 and GetSpellAbilityId()!=1093750095 and GetSpellAbilityId()!=1093747504 and GetSpellAbilityId()!=1093753417 and GetSpellAbilityId()!=1093810265 and IsGlobalSpellIgnore(GetSpellAbilityId())==false and(IsRealSpellWithItems(GetSpellAbilityId())or GetSpellAbilityId()==1093678667))then
+call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-8*Level)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,5+15*Level)
+elseif Count>=(6)or GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()!=abilityid_phaseboots and GetSpellAbilityId()!=1093682767 and GetSpellAbilityId()!=1093750095 and GetSpellAbilityId()!=1093747504 and GetSpellAbilityId()!=1093753417 and GetSpellAbilityId()!=1093810265 and IsGlobalSpellIgnore(GetSpellAbilityId())==false and(IsRealSpellWithItems(GetSpellAbilityId())or GetSpellAbilityId()==1093678667))then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call UnitRemoveAbility(Target,curseofthesilent_icon)
 call UnitRemoveAbility(Target,curseofthesilent_icon_buff)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function CurseOfTheSilent_Hit takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetEnumUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_curseofthesilent)
@@ -54010,46 +55377,46 @@
 endfunction
 function Shrapnel_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local group g=GetAvailableGroup()
 local real d
 local real a
 local real x2
 local real y2
 set tt_unit1=Source
-call GroupEnumUnitsInRange(g,x,y,375,Condition(function GenericCondition_EnemyUnitsAndStructureEx))
+call GroupEnumUnitsInRange(g,x,y,360+25,Condition(function GenericCondition_EnemyUnitsAndStructureEx))
 set shrapnel_source=Source
 set shrapnel_damage=Level*12
 set shrapnel_caster=Caster
 call ForGroup(g,function Shrapnel_Hit)
 call KillGroup(g)
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(309))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(175))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(176))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(177))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(178))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(179))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(180))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(330))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(331))))
-if GetTriggerEvalCount(t)==8 then
+if GetTriggerEvalCount(t)==9 then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set d=0
 set a=0
 set x2=x+d*Cos(a*bj_DEGTORAD)
 set y2=y+d*Sin(a*bj_DEGTORAD)
 call SaveEffectHandle(hash_main,(Cache),(309),(AddSpecialEffect(fx_shrapnel,x2,y2)))
 set d=150
 set a=45
 set x2=x+d*Cos(a*bj_DEGTORAD)
 set y2=y+d*Sin(a*bj_DEGTORAD)
 call SaveEffectHandle(hash_main,(Cache),(175),(AddSpecialEffect(fx_shrapnel,x2,y2)))
 set d=275
 set a=90
@@ -54135,30 +55502,31 @@
 call TriggerAddCondition(t,Condition(function Shrapnel_Iterate))
 call TriggerEvaluate(t)
 endif
 set Source=null
 set Caster=null
 set t=null
 return false
 endfunction
 function Shrapnel_Delay takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local location l=GetSpellTargetLoc()
 local real x=GetLocationX(l)
 local real y=GetLocationY(l)
+call TimedReveal(GetOwningPlayer(Source),9.4,x,y,360)
 call TriggerRegisterTimerEvent(t,0.4,true)
 call TriggerAddCondition(t,Condition(function Shrapnel))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(6),((x)*1.0))
 call SaveReal(hash_main,(Cache),(7),((y)*1.0))
 call RemoveLocation(l)
 set t=null
 set Source=null
 set l=null
 endfunction
 function Shrapnel_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_shrapnel then
 call Shrapnel_Delay()
 endif
 return false
@@ -54346,48 +55714,48 @@
 if GetUnitAbilityLevel(GetAttacker(),abilityid_backstab)>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))==false then
 call Backstab()
 endif
 return false
 endfunction
 function Register_Backstab takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
 call TriggerAddCondition(t,Condition(function Backstab_Main))
 set t=null
 endfunction
 function Warcry_Add takes nothing returns nothing
 if IsRealSummoned(GetEnumUnit())then
 return
 endif
-call AddTimedAbilityAndRemove(GetEnumUnit(),warcry_abilityid,1,8,1110458966)
+call AddTimedAbilityAndRemove(GetEnumUnit(),warcry_abilityid,1,7,1110458966)
 call UnitMakeAbilityPermanent(GetEnumUnit(),true,warcry_abilityid)
 call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()),warcry_abilityid,false)
 endfunction
 function Warcry takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_warcry)
 local group g=GetAvailableGroup()
 if Level==1 then
 set warcry_abilityid=warcry_abilityid_1
 elseif Level==2 then
 set warcry_abilityid=warcry_abilityid_2
 elseif Level==3 then
 set warcry_abilityid=warcry_abilityid_3
 elseif Level==4 then
 set warcry_abilityid=warcry_abilityid_4
 endif
-call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),725,Condition(function GenericCondition_AlliedUnits))
+call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),925,Condition(function GenericCondition_AlliedUnits))
 call ForGroup(g,function Warcry_Add)
 call KillGroup(g)
 call DestroyEffect(AddSpecialEffectTarget(warcry_fx,Source,"overhead"))
 set Source=null
 set g=null
 endfunction
 function Warcry_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_warcry then
 call Warcry()
 endif
 return false
 endfunction
 function Register_Warcry takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
@@ -54438,38 +55806,38 @@
 set Hero=null
 endfunction
 function GodStrength_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_godstrength and GetUnitTypeId(GetTriggerUnit())==1211117617 then
 call GodStrength()
 endif
 return false
 endfunction
 function Register_GodStrength takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function GodStrength_Main))
 set t=null
 endfunction
 function StormBolt_Stun takes nothing returns nothing
-call IssueTargetOrder(stormbolt_caster,"thunderbolt",GetEnumUnit())
+call Stun(stormbolt_caster,GetEnumUnit(),2)
+call DamageTarget(stormbolt_caster,GetEnumUnit(),DAMAGE_MAGICAL,stormbolt_level*75+25)
 endfunction
 function StormBolt_Hit takes player p,unit Target,integer Level returns nothing
 local unit Caster=CreateUnit(p,1697656901,GetUnitX(Target),GetUnitY(Target),0)
 local integer abilityid
 local group g=GetAvailableGroup()
-call UnitAddAbility2(Caster,stormbolt_stun)
-call SetUnitAbilityLevel(Caster,stormbolt_stun,Level)
+set stormbolt_level=Level
 set tt_unit1=udg_Hero[GetPlayerId(p)]
 call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),280,Condition(function GenericCondition_EnemyUnitsEx))
 call GroupAddUnit(g,Target)
 set stormbolt_caster=Caster
 call ForGroup(g,function StormBolt_Stun)
 call KillGroup(g)
 call DestroyEffect(AddSpecialEffectTarget(stormbolt_fx,Target,stormbolt_fx_attach))
 call DestroyEffect(AddSpecialEffectTarget(stormbolt_fx,Target,stormbolt_fx_attach))
 set Caster=null
 set g=null
 endfunction
 function StormBolt_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local player p=(LoadPlayerHandle(hash_main,(Cache),(54)))
@@ -54606,35 +55974,37 @@
 local integer Cache=GetHandleId(t)
 local unit Bear=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real LastHit
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 if GetEventDamage()>2 and GetEventDamageSource()!=GetTriggerUnit()and IsRealPlayer(GetOwningPlayer(GetEventDamageSource()))then
 call SaveReal(hash_main,(Cache),(714),(((TimerGetElapsed(udg_GameTimer)))*1.0))
 endif
 endif
 set LastHit=(LoadReal(hash_main,(Cache),(714)))
 if LastHit+3<(TimerGetElapsed(udg_GameTimer))then
 if(LoadInteger(hash_main,(Cache),(34)))==2 then
 call SaveInteger(hash_main,(Cache),(34),(1))
+call SaveInteger(hash_main,(GetHandleId((Bear))),((4327)),(HERO_STATE_OFF))
 call SetPlayerAbilityAvailable(GetOwningPlayer(Bear),1093681463,true)
 endif
 else
 if(LoadInteger(hash_main,(Cache),(34)))==1 then
 call SaveInteger(hash_main,(Cache),(34),(2))
+call SaveInteger(hash_main,(GetHandleId((Bear))),((4327)),(HERO_STATE_ON))
 call SetPlayerAbilityAvailable(GetOwningPlayer(Bear),1093681463,false)
 endif
 endif
 set t=null
 set Bear=null
 return false
 endfunction
 function BearLogic_Register takes unit Bear returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,0.2,true)
 call TriggerRegisterUnitEvent(t,Bear,EVENT_UNIT_DAMAGED)
 call TriggerRegisterUnitEvent(t,Bear,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function BearLogic_Loop))
 call SaveUnitHandle(hash_main,(Cache),(2),(Bear))
@@ -54835,44 +56205,51 @@
 call RemoveLocation(PointVar)
 set UnitVar=null
 set PlayerVar=null
 set PointVar=null
 set GroupVar=null
 endfunction
 function Trig_Summon_Spirit_Bear_PreActions takes nothing returns nothing
 local unit UnitVar=GetTriggerUnit()
 local player PlayerVar=GetOwningPlayer(UnitVar)
 local location PointVar=GetUnitLoc(UnitVar)
 local boolexpr CondVar=Condition(function FindBear)
 local group GroupVar=GetAvailableGroup()
 local integer Level=GetUnitAbilityLevel(UnitVar,1093681461)
 local integer Cache=GetHandleId(PlayerVar)
 local boolean NoBear
+local unit Bear
 call GroupEnumUnitsOfPlayer(GroupVar,GetOwningPlayer(UnitVar),CondVar)
-set NoBear=CountUnitsInGroup(GroupVar)==0
-if NoBear==false then
+if CountUnitsInGroup(GroupVar)!=0 then
+set Bear=FirstOfGroup(GroupVar)
+if Bear!=null and((LoadInteger(hash_main,(GetHandleId((Bear))),((4327))))==HERO_STATE_ON)==true then
 call InterruptUnit(UnitVar)
-call Error(PlayerVar,GetObjectName(MSG_SPIRIT_HERE))
+call Error(PlayerVar,GetObjectName(1848659278))
+endif
 endif
 call KillGroup(GroupVar)
 call RemoveLocation(PointVar)
 endfunction
 function Summon takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Trig_Summon_Spirit_Bear_Conditions))
 call TriggerAddAction(t,function Trig_Summon_Spirit_Bear_Actions)
+set t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
+call TriggerAddCondition(t,Condition(function Trig_Summon_Spirit_Bear_Conditions))
+call TriggerAddAction(t,function Trig_Summon_Spirit_Bear_PreActions)
 endfunction
 function Trig_Return_Bear_Conditions takes nothing returns boolean
 return GetSpellAbilityId()==1093681463
 endfunction
 function Trig_Return_Bear_Actions takes nothing returns nothing
 local unit Bear=GetTriggerUnit()
 local unit BearOwner=udg_Hero[GetPlayerId(GetOwningPlayer(Bear))]
 call SetUnitX(Bear,GetUnitX(BearOwner)+GetRandomReal(25,50)*Cos(GetRandomReal(0,360)))
 call SetUnitY(Bear,GetUnitY(BearOwner)+GetRandomReal(25,50)*Sin(GetRandomReal(0,360)))
 endfunction
 function ReturnBear takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Trig_Return_Bear_Conditions))
 call TriggerAddAction(t,function Trig_Return_Bear_Actions)
@@ -55056,30 +56433,31 @@
 call UnitApplyTimedLife(Caster,1112820806,2)
 set Caster=CreateUnit(GetOwningPlayer(Source),1697656901,x,y,0)
 call UnitAddAbility2(Caster,greatstomp_stun)
 call SetUnitAbilityLevel(Caster,greatstomp_stun,GetUnitAbilityLevel(Source,abilityid_greatstomp))
 call IssueImmediateOrder(Caster,"stomp")
 call GroupEnumUnitsInRange(g,x,y,500,Condition(function GenericCondition_EnemyUnits))
 set greatstomp_type=2
 call ForGroup(g,function GreatStomp_Damage)
 call TriggerRegisterTimerEvent(t,0.65,false)
 call TriggerAddCondition(t,Condition(function GreatStomp_Iterate))
 call SaveReal(hash_main,(Cache),(6),((x)*1.0))
 call SaveReal(hash_main,(Cache),(7),((y)*1.0))
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 set u=(ancestralcharge_image[GetPlayerId(GetOwningPlayer((Source)))])
+call IssueImmediateOrder(u,"stop")
 set x=GetUnitX(u)
 set y=GetUnitY(u)
 set Caster=CreateUnit(GetOwningPlayer(Source),unitid_greatstomp,x,y,0)
 call SetUnitTimeScale(Caster,2.5)
 call UnitApplyTimedLife(Caster,1112820806,2)
 set Caster=CreateUnit(GetOwningPlayer(Source),1697656901,x,y,0)
 call UnitAddAbility2(Caster,greatstomp_stun)
 call SetUnitAbilityLevel(Caster,greatstomp_stun,GetUnitAbilityLevel(Source,abilityid_greatstomp))
 call IssueImmediateOrder(Caster,"stomp")
 call GroupEnumUnitsInRange(g,x,y,500,Condition(function GenericCondition_EnemyUnits))
 set greatstomp_type=3
 call ForGroup(g,function GreatStomp_Damage)
 call KillGroup(g)
 call TriggerRegisterTimerEvent(t,0.65,false)
 call TriggerAddCondition(t,Condition(function GreatStomp_Iterate))
@@ -55092,81 +56470,87 @@
 set Caster=null
 set g=null
 endfunction
 function GreatStomp_AnimEnd takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Image=(LoadUnitHandle(hash_main,(Cache),(335)))
 local boolean KillStompImage=(LoadBoolean(hash_main,(Cache),(336)))
 if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
 call SaveInteger(hash_main,(GetHandleId((Source))),((4269)),(HERO_STATE_OFF))
 call SaveBoolean(hash_main,(GetHandleId(Image)),(337),(true))
 if KillStompImage then
 call ShowUnit(Image,false)
 call KillUnit(Image)
+else
+call ShowUnit(Image,false)
+call UnitRemoveAbility(Image,1097625443)
+call ShowUnit(Image,true)
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 if KillStompImage then
 call SetUnitFacing(Image,GetUnitFacing(Source))
 endif
 endif
 set t=null
 set Image=null
 return false
 endfunction
 function GreatStomp_Anim takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local unit Image
 local boolean KillImage
 call SaveBoolean(hash_main,(Cache),(336),(false))
 if((LoadInteger(hash_main,(GetHandleId((Source))),((4270))))==HERO_STATE_ON)==false then
 call SaveBoolean(hash_main,(Cache),(336),(true))
 set Image=CreateUnit(GetOwningPlayer(Source),unitid_ancestralcharge,GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
 call UnitAddAbility2(Image,1097625443)
 call UnitAddAbility2(Image,1097167980)
 call SetUnitPosition(Image,GetUnitX(Source),GetUnitY(Source))
 call SetUnitScale(Image,1.4,1.4,1.4)
 else
 set Image=(ancestralcharge_image[GetPlayerId(GetOwningPlayer((Source)))])
+call UnitAddAbility(Image,1097625443)
 endif
 call IssueImmediateOrder(Image,"stop")
 call SaveInteger(hash_main,(GetHandleId((Source))),((4269)),(HERO_STATE_ON))
 call SetUnitAnimation(Image,"spell slam")
 call QueueUnitAnimation(Image,"spell slam")
 call SaveUnitHandle(hash_main,(Cache),(335),(Image))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call TriggerRegisterTimerEvent(t,0.1,true)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
 call TriggerAddCondition(t,Condition(function GreatStomp_AnimEnd))
 call SaveUnitHandle(hash_main,(Cache),(335),(Image))
 set t=null
 set Source=null
 set Image=null
 endfunction
 function GreatStomp_Main takes nothing returns boolean
 local integer rand
 if GetSpellAbilityId()==abilityid_greatstomp then
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_FINISH then
 call GreatStomp()
-endif
+else
 call GreatStomp_Anim()
 endif
+endif
 return false
 endfunction
 function Register_GreatStomp takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_FINISH)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function GreatStomp_Main))
 set t=null
 endfunction
 function NaturalOrder_Remove takes nothing returns nothing
 if IsRealSummoned(GetEnumUnit())then
 return
 endif
 if GetUnitAbilityLevel(GetEnumUnit(),naturalorder_bonus1)>0 then
 call UnitRemoveAbility(GetEnumUnit(),naturalorder_bonus1)
@@ -55314,39 +56698,40 @@
 call DamageTarget(earthsplitter_source,GetEnumUnit(),DAMAGE_PHYSICAL,dmg)
 endfunction
 function EarthSplitter_Implode takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real x0=(LoadReal(hash_main,(Cache),(282)))
 local real y0=(LoadReal(hash_main,(Cache),(283)))
 local real a0=(LoadReal(hash_main,(Cache),(341)))
 local integer i=0
 local real x
 local real y
 local group g=GetAvailableGroup()
 local group AlreadyHit=GetAvailableGroup()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_earthsplitter)
+local integer MaxCount=(LoadInteger(hash_main,(Cache),(34)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set tt_unit1=Source
 set earthsplitter_source=Source
 set earthsplitter_caster=CreateUnit(GetOwningPlayer(Source),1697656901,x0,y0,0)
 call UnitAddAbility2(earthsplitter_caster,earthsplitter_slow)
 call SetUnitAbilityLevel(earthsplitter_caster,earthsplitter_slow,Level)
 loop
-exitwhen i>11
+exitwhen i>MaxCount
 set x=x0+i*200*Cos(a0)
 set y=y0+i*200*Sin(a0)
 call TimedLifeEffect(earthsplitter_fx2,x,y,1.6)
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,x,y-250))
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,x,y))
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,x+250,y))
 call KillTrees(x,y,300)
 call GroupEnumUnitsInRange(g,x,y,325,Condition(function GenericCondition_EnemyUnitsEx))
 call GroupAddGroup(g,AlreadyHit)
 call GroupClear(g)
 set i=i+1
 endloop
 set earthspliter_x0=x0
 set earthspliter_y0=y0
 set earthspliter_x1=x
@@ -55370,104 +56755,129 @@
 local real fy_0
 local real fx_1
 local real fy_1
 local real fx_2
 local real fy_2
 local real fx_3
 local real fy_3
 local real fx_4
 local real fy_4
 local real fx_5
 local real fy_5
 local real x
 local real y
 local ubersplat Splat
 local integer Count=GetTriggerEvalCount(t)
+local integer MaxCount=(LoadInteger(hash_main,(Cache),(34)))
 set x=x0+200*Count*Cos(a)
 set y=y0+200*Count*Sin(a)
 set Splat=CreateUbersplat(x,y,"THNE",255,255,255,255,false,false)
 call SetUbersplatRenderAlways(Splat,true)
 set fx_0=x+250*Cos(bj_DEGTORAD*(a*bj_RADTODEG-45))
 set fy_0=y+250*Sin(bj_DEGTORAD*(a*bj_RADTODEG-45))
 set fx_1=x+250*Cos(bj_DEGTORAD*(a*bj_RADTODEG+45))
 set fy_1=y+250*Sin(bj_DEGTORAD*(a*bj_RADTODEG+45))
 set fx_2=x-125*Cos(bj_DEGTORAD*(a*bj_RADTODEG-45))
 set fy_2=y-125*Sin(bj_DEGTORAD*(a*bj_RADTODEG-45))
 set fx_3=x-125*Cos(bj_DEGTORAD*(a*bj_RADTODEG+45))
 set fy_3=y-125*Sin(bj_DEGTORAD*(a*bj_RADTODEG+45))
 set fx_4=x
 set fy_4=y
 set fx_5=x
 set fy_5=y
 call TimedReveal(GetOwningPlayer(Source),4,x,y,500)
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,fx_0,fy_0))
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,fx_1,fy_1))
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,fx_2,fy_2))
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,fx_3,fy_3))
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,fx_4,fy_4))
 call DestroyEffect(AddSpecialEffect(earthsplitter_fx3,fx_5,fy_5))
-if GetTriggerEvalCount(t)>11 then
+if GetTriggerEvalCount(t)>MaxCount then
 set x0=(LoadReal(hash_main,(Cache),(282)))
 set y0=(LoadReal(hash_main,(Cache),(283)))
 set a0=(LoadReal(hash_main,(Cache),(341)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,0.5,false)
 call TriggerAddCondition(t,Condition(function EarthSplitter_Implode))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(282),((x0)*1.0))
 call SaveReal(hash_main,(Cache),(283),((y0)*1.0))
 call SaveReal(hash_main,(Cache),(341),((a0)*1.0))
+call SaveInteger(hash_main,(Cache),(34),(MaxCount))
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function EarthSplitter takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local location l=GetSpellTargetLoc()
 local real x=GetLocationX(l)
 local real y=GetLocationY(l)
 local real a=Atan2(y-GetUnitY(Source),x-GetUnitX(Source))
+local real d=DistanceBetweenXY(x,y,GetUnitX(Source),GetUnitY(Source))
+local integer MaxCount=11
 call TriggerRegisterTimerEvent(t,0.22,true)
 call TriggerAddCondition(t,Condition(function EarthSplitter_Iterate))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(6),((GetUnitX(Source))*1.0))
 call SaveReal(hash_main,(Cache),(7),((GetUnitY(Source))*1.0))
 call SaveReal(hash_main,(Cache),(137),((a)*1.0))
 call SaveReal(hash_main,(Cache),(282),((GetUnitX(Source))*1.0))
 call SaveReal(hash_main,(Cache),(283),((GetUnitY(Source))*1.0))
 call SaveReal(hash_main,(Cache),(341),((a)*1.0))
+call SaveInteger(hash_main,(Cache),(34),(MaxCount))
 set t=null
 set Source=null
 endfunction
 function EarthSplitter_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_earthsplitter then
 call EarthSplitter()
 endif
 return false
 endfunction
 function Register_EarthSplitter takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function EarthSplitter_Main))
 set t=null
 endfunction
+function AncestralCharge_FixShit_End takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+call UnitRemoveAbility(Source,abilityid_ancestralcharge_end)
+call UnitAddAbility(Source,abilityid_ancestralcharge_end)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=null
+set Source=null
+return false
+endfunction
+function AncestralCharge_FixShit takes unit Source returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0,false)
+call TriggerAddCondition(t,Condition(function AncestralCharge_FixShit_End))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+set t=null
+endfunction
 function AncestralCharge_Expire takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call AddDamageBonus(Source,0)
 set t=null
 set Source=null
 return false
 endfunction
 function AncestralCharge_Collide takes unit Source,unit Image,integer AttackBonus,integer MovementBonus returns nothing
 local trigger t
 local integer Cache
@@ -55612,152 +57022,161 @@
 local real LastMoved=(LoadReal(hash_main,(Cache),(342)))
 local real Time=(TimerGetElapsed(udg_GameTimer))
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call ShowUnit(Image,false)
 call KillUnit(Image)
 call SaveInteger(hash_main,(GetHandleId((Source))),((4270)),(HERO_STATE_OFF))
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_ancestralcharge then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_ancestralcharge,true)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_ancestralcharge_end,false)
 elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
 if GetSpellAbilityId()==abilityid_ancestralcharge_end then
+call IssueImmediateOrder(Image,"stop")
 call SaveBoolean(hash_main,(Cache),(249),(true))
 call SetUnitAnimationByIndex(Image,3)
+call AncestralCharge_FixShit(GetTriggerUnit())
+elseif GetSpellAbilityId()==abilityid_image_echostomp then
+if IssueImmediateOrder(Source,"charm")then
+call UnitRemoveAbility(Image,abilityid_image_echostomp)
+endif
 endif
 elseif DistanceBetweenXY(x1,y1,x2,y2)<100 then
 call AncestralCharge_Collide(Source,Image,(LoadInteger(hash_main,(Cache),(344))),(LoadInteger(hash_main,(Cache),(345))))
 call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_ancestralcharge then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_ancestralcharge,true)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_ancestralcharge_end,false)
 elseif GetTriggerEvalCount(t)>400 or(LoadBoolean(hash_main,(Cache),(249)))==true then
+call UnitAddAbility2(Image,1097625443)
 if GetTriggerEvalCount(t)==401 and(LoadBoolean(hash_main,(Cache),(249)))==false then
+call IssueImmediateOrder(Image,"stop")
 call SetUnitAnimationByIndex(Image,3)
 endif
 set g=GetAvailableGroup()
 set ancestralcharge_level=Level
 set ancestralcharge_attackbonus=(LoadInteger(hash_main,(Cache),(344)))
 set ancestralcharge_movementbonus=(LoadInteger(hash_main,(Cache),(345)))
 set ancestralcharge_damage=80+40*Level
 set ancestralcharge_source=Source
 set tt_unit1=Source
 set ancestralcharge_group=AlreadyHit
 call GroupEnumUnitsInRange(g,GetUnitX(Image),GetUnitY(Image),300,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function AncestralCharge_MagicalHit)
 call KillGroup(g)
 set g=null
 call SaveInteger(hash_main,(Cache),(344),(ancestralcharge_attackbonus))
 call SaveInteger(hash_main,(Cache),(345),(ancestralcharge_movementbonus))
 if((LoadInteger(hash_main,(GetHandleId((Source))),((4269))))==HERO_STATE_ON)==false then
 set a=Atan2(y1-y2,x1-x2)
 call SetUnitFacing(Image,a*bj_RADTODEG)
 set x3=GetUnitX(Image)+12*Cos(a)
 set y3=GetUnitY(Image)+12*Sin(a)
 call SetUnitX(Image,SafeX(x3))
 call SetUnitY(Image,SafeY(y3))
 call SaveReal(hash_main,(Cache),(282),((x1)*1.0))
 call SaveReal(hash_main,(Cache),(283),((y1)*1.0))
 endif
 else
+call SetUnitMoveSpeed(Image,GetUnitMoveSpeed(Source))
+call UnitRemoveAbility(Image,1097625443)
 set g=GetAvailableGroup()
 set ancestralcharge_level=Level
 set ancestralcharge_attackbonus=(LoadInteger(hash_main,(Cache),(344)))
 set ancestralcharge_movementbonus=(LoadInteger(hash_main,(Cache),(345)))
 set ancestralcharge_damage=80+40*Level
 set ancestralcharge_source=Source
 set tt_unit1=Source
 set ancestralcharge_group=AlreadyHit
 call GroupEnumUnitsInRange(g,GetUnitX(Image),GetUnitY(Image),300,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function AncestralCharge_MagicalHit)
 call KillGroup(g)
 set g=null
 call SaveInteger(hash_main,(Cache),(344),(ancestralcharge_attackbonus))
 call SaveInteger(hash_main,(Cache),(345),(ancestralcharge_movementbonus))
 if x0!=x1 or y0!=y1 then
 set LastMoved=Time
 call SaveReal(hash_main,(Cache),(342),((LastMoved)*1.0))
 endif
 if((LoadInteger(hash_main,(GetHandleId((Source))),((4269))))==HERO_STATE_ON)==false then
 if LastMoved==Time then
 set x3=GetReflectionAngle_X(x0,y0,x1,y1,x2,y2)
 set y3=GetReflectionAngle_Y(x0,y0,x1,y1,x2,y2)
 set a=Atan2(y3-y2,x3-x2)*bj_RADTODEG
-call SetUnitFacing(Image,a)
-call SetUnitX(Image,SafeX(x3))
-call SetUnitY(Image,SafeY(y3))
 call SaveReal(hash_main,(Cache),(282),((x1)*1.0))
 call SaveReal(hash_main,(Cache),(283),((y1)*1.0))
 endif
 if(LastMoved+0.3)<Time then
 call SaveInteger(hash_main,(Cache),(343),(1))
-call SetUnitAnimationByIndex(Image,2)
 elseif(LastMoved+0.3)>Time and(LoadInteger(hash_main,(Cache),(343)))==1 then
 call SaveInteger(hash_main,(Cache),(343),(2))
-call SetUnitAnimationByIndex(Image,3)
 elseif(LoadInteger(hash_main,(Cache),(343)))==3 then
-call SetUnitAnimationByIndex(Image,2)
 call SaveInteger(hash_main,(Cache),(343),(1))
 endif
 else
 call SaveInteger(hash_main,(Cache),(343),(3))
 endif
 endif
 set t=null
 set Source=null
 set Image=null
 set AlreadyHit=null
 return false
 endfunction
 function AncestralCharge takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local real x0=GetUnitX(Source)
 local real y0=GetUnitY(Source)
 local location l=GetSpellTargetLoc()
 local real lx=GetLocationX(l)
 local real ly=GetLocationY(l)
 local real a=Atan2(ly-y0,lx-x0)
 local real d=RMax(DistanceBetweenXY(x0,y0,lx,ly),300)
 local real x1=SafeX(x0+d*Cos(a))
 local real y1=SafeY(y0+d*Sin(a))
 local unit Image=CreateUnit(GetOwningPlayer(Source),unitid_ancestralcharge,x1,y1,(a*bj_RADTODEG)-180)
+call SetUnitMoveSpeed(Image,GetUnitMoveSpeed(Source))
 call DestroyEffect(AddSpecialEffectTarget(ancestralcharge_fx,Image,"chest"))
 if GetUnitAbilityLevel(Source,abilityid_naturalorder)>0 then
 call UnitAddAbility2(Image,naturalorder_aura)
 endif
+if GetUnitAbilityLevel(Source,abilityid_greatstomp)==0 then
+call UnitRemoveAbility(Image,abilityid_image_echostomp)
+endif
 call UnitAddAbility(Source,abilityid_ancestralcharge_end)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_ancestralcharge,false)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_ancestralcharge_end,true)
 call RemoveLocation(l)
 set ancestralcharge_image[GetPlayerId(GetOwningPlayer(Source))]=Image
 call SaveInteger(hash_main,(GetHandleId((Source))),((4270)),(HERO_STATE_ON))
-call UnitAddAbility2(Image,1097625443)
+call UnitAddAbility2(Image,1098282348)
 call UnitAddAbility2(Image,1097167980)
 if(LoadBoolean(hash_main,(GetHandleId(Source)),(339)))==true then
 call TriggerEvaluate((LoadTriggerHandle(hash_main,(Cache),(338))))
 endif
 call TriggerRegisterTimerEvent(t,0.02,true)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
+call TriggerRegisterUnitEvent(t,Image,EVENT_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function AncestralCharge_Iterate))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(335),(Image))
 call SaveReal(hash_main,(Cache),(282),((x0)*1.0))
 call SaveReal(hash_main,(Cache),(283),((y0)*1.0))
 call SaveGroupHandle(hash_main,(Cache),(187),(GetAvailableGroup()))
 call SaveInteger(hash_main,(Cache),(343),(2))
 call SaveReal(hash_main,(Cache),(342),(((TimerGetElapsed(udg_GameTimer))-5)*1.0))
 call SaveBoolean(hash_main,(Cache),(249),(false))
 set t=null
 set Source=null
 set Image=null
 endfunction
 function AncestralCharge_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_ancestralcharge then
@@ -56041,31 +57460,31 @@
 return true
 endif
 if((GetUnitTypeId(GetFilterUnit())==1848651856))then
 return true
 endif
 if((GetUnitTypeId(GetFilterUnit())==1848651857))then
 return true
 endif
 if((GetUnitTypeId(GetFilterUnit())==1848651854))then
 return true
 endif
 endif
 return false
 endfunction
 function LandMine_TripHeroes takes nothing returns boolean
-return(GetUnitTypeId(GetFilterUnit())==1211117637 or GetUnitTypeId(GetFilterUnit())==1211117639 or GetUnitTypeId(GetFilterUnit())==1211117638 or GetUnitTypeId(GetFilterUnit())==1160786000 or GetUnitTypeId(GetFilterUnit())==1311780930 or GetUnitTypeId(GetFilterUnit())==1430468144 or GetUnitTypeId(GetFilterUnit())==1162032951 or GetUnitTypeId(GetFilterUnit())==1429221456 or GetUnitTypeId(GetFilterUnit())==1160786510 or GetUnitTypeId(GetFilterUnit())==1160786511 or GetUnitTypeId(GetFilterUnit())==1328558390 or GetUnitTypeId(GetFilterUnit())==1328558391 or GetUnitTypeId(GetFilterUnit())==1160786502 or GetUnitTypeId(GetFilterUnit())==1211122767)and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(tt_unit1))
+return(GetUnitTypeId(GetFilterUnit())==1211117637 or GetUnitTypeId(GetFilterUnit())==1211117639 or GetUnitTypeId(GetFilterUnit())==1211117638 or GetUnitTypeId(GetFilterUnit())==1160786000 or GetUnitTypeId(GetFilterUnit())==1311780930 or GetUnitTypeId(GetFilterUnit())==1430468144 or GetUnitTypeId(GetFilterUnit())==1162032951 or GetUnitTypeId(GetFilterUnit())==1429221456 or GetUnitTypeId(GetFilterUnit())==1160786510 or GetUnitTypeId(GetFilterUnit())==1160786511 or GetUnitTypeId(GetFilterUnit())==1328558390 or GetUnitTypeId(GetFilterUnit())==1328558391 or GetUnitTypeId(GetFilterUnit())==1160786502 or GetUnitTypeId(GetFilterUnit())==1211122767 or GetUnitTypeId(GetFilterUnit())==1311788343 or GetUnitTypeId(GetFilterUnit())==1311788354 or GetUnitTypeId(GetFilterUnit())==1311788355 or GetUnitTypeId(GetFilterUnit())==1311788367 or GetUnitTypeId(GetFilterUnit())==1311788353)and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(tt_unit1))
 endfunction
 function LandMine_Scan takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Mine=(LoadUnitHandle(hash_main,(Cache),(347)))
 local group g
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call DestroyEffect(AddSpecialEffect("war3mapImported\\NewGroundEX.mdx",GetUnitX(Mine),GetUnitY(Mine)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set g=GetAvailableGroup()
 set tt_unit1=Mine
 call GroupEnumUnitsInRange(g,GetUnitX(Mine),GetUnitY(Mine),200,Condition(function LandMine_TripHeroes))
 if FirstOfGroup(g)!=null then
@@ -56733,40 +58152,40 @@
 endfunction
 function Avalanche_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_avalanche then
 call Avalanche()
 endif
 return false
 endfunction
 function Register_Avalanche takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Avalanche_Main))
 set t=null
 endfunction
 function Rampage_Add takes nothing returns nothing
 if GetEnumUnit()==GetTriggerUnit()then
-call AddTimedAbilityAndRemove(GetEnumUnit(),abilityid_rampagebonus,rampage_level,rampage_duration*2,1110454338)
+call AddTimedAbilityAndRemove(GetEnumUnit(),abilityid_rampagebonus,rampage_level,rampage_duration,1110454338)
 else
 call AddTimedAbilityAndRemove(GetEnumUnit(),abilityid_rampagebonus,rampage_level,rampage_duration,1110454338)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()),abilityid_rampagebonus,false)
 endfunction
 function Rampage takes nothing returns nothing
 local group g=GetAvailableGroup()
 set rampage_level=GetUnitAbilityLevel(GetTriggerUnit(),abilityid_rampage)
-set rampage_duration=5
+set rampage_duration=10
 call GroupEnumUnitsInRange(g,0,0,9999,Condition(function GenericCondition_AlliedHeroesNoImages))
 call ForGroup(g,function Rampage_Add)
 call KillGroup(g)
 set g=null
 endfunction
 function Rampage_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_rampage then
 call Rampage()
 endif
 return false
 endfunction
 function Register_Rampage takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Rampage_Main))
@@ -57331,56 +58750,56 @@
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
 call TriggerAddCondition(t,Condition(function EnrageFix_Main))
 set t=null
 endfunction
 function TerrorWave_Cast takes unit Caster,real x,real y,integer Level returns nothing
 call SetUnitPosition(Caster,x,y)
 call IssueImmediateOrder(Caster,"howlofterror")
 call DestroyEffect(AddSpecialEffect(terrorwave_fx,x,y))
 set Caster=null
 endfunction
 function TerrorWave_Which takes nothing returns boolean
 if(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and IsUnitInGroup(GetFilterUnit(),terrorwave_group)==false then
 call GroupAddUnit(terrorwave_group,GetFilterUnit())
 if GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>terrorwave_damage then
-call SetUnitState(GetFilterUnit(),UNIT_STATE_LIFE,GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)-(terrorwave_damage*0.75))
+call SetUnitState(GetFilterUnit(),UNIT_STATE_LIFE,GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)-(terrorwave_damage))
 else
-call DamageTarget(terrorwave_source,GetFilterUnit(),DAMAGE_MAGICAL,terrorwave_damage)
+call DamageTarget(terrorwave_source,GetFilterUnit(),DAMAGE_MAGICAL,terrorwave_damage*1.33)
 endif
 endif
 return false
 endfunction
 function TerrorWave_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local real Angle=(LoadReal(hash_main,(Cache),(13)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local group AlreadyDamaged=(LoadGroupHandle(hash_main,(Cache),(133)))
 local group g
 if GetTriggerEvalCount(t)>10 then
 call KillGroup(AlreadyDamaged)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set terrorwave_group=AlreadyDamaged
 set terrorwave_source=Source
-set terrorwave_damage=Level*25
+set terrorwave_damage=Level*20+10
 set tt_unit1=Source
 set g=GetAvailableGroup()
 call GroupEnumUnitsInRange(g,x,y,325,Condition(function TerrorWave_Which))
 call KillGroup(g)
 set g=null
 call TerrorWave_Cast(Caster,x,y,Level)
 if ModuloInteger(GetTriggerEvalCount(t),2)==0 then
 call KillUnit(CreateUnit(GetOwningPlayer(Source),1697657409,x,y,0))
 endif
 set x=SafeX(x+200*Cos(Angle*bj_DEGTORAD))
 set y=SafeY(y+200*Sin(Angle*bj_DEGTORAD))
 call SaveReal(hash_main,(Cache),(6),((x)*1.0))
 call SaveReal(hash_main,(Cache),(7),((y)*1.0))
 endif
 set t=null
@@ -57545,65 +58964,80 @@
 call SaveInteger(hash_main,(Cache),(7000+x),((LoadInteger(hash_main,(Cache),(7000+x+1)))))
 set x=x+1
 endloop
 set i=TrapMax
 endif
 set i=i+1
 endloop
 call SaveInteger(hash_main,(Cache),(348),(TrapMax-1))
 set trap=null
 set Hero=null
 endfunction
 function WardenTrap_AddTrap takes unit u returns nothing
 local unit Hero=udg_Hero[GetPlayerId(GetOwningPlayer(u))]
 local integer Cache=GetHandleId(Hero)
 local integer TrapMax=(LoadInteger(hash_main,(Cache),(348)))
+call SaveReal(hash_main,(GetHandleId(u)),(786),(((TimerGetElapsed(udg_GameTimer)))*1.0))
 set TrapMax=TrapMax+1
 call SaveInteger(hash_main,(Cache),(7000+TrapMax),(TI_AddUnit(u)))
 call SaveInteger(hash_main,(Cache),(348),(TrapMax))
 if ControlBool[GetPlayerId(GetOwningPlayer(Hero))]then
 call SelectUnitAddForPlayer(u,GetOwningPlayer(Hero))
 endif
 set Hero=null
 endfunction
 function WardenTrap_DeathMain takes nothing returns nothing
 call WardenTrap_RemoveTrap(GetTriggerUnit())
 endfunction
 function WardenTrap_IsTooMany takes unit u returns nothing
 local integer LevelMax=GetUnitAbilityLevel(u,abilityid_wardentrap)*3+2
 local integer Cache=GetHandleId(u)
 local integer TrapMax=(LoadInteger(hash_main,(Cache),(348)))
 local integer TrapIndex=(LoadInteger(hash_main,(Cache),(7000+1)))
 local unit trap=TI_GetUnit(TrapIndex)
 if TrapMax>=LevelMax then
 call WardenTrap_RemoveTrap(trap)
 call RemoveUnit(trap)
 endif
 set trap=null
 endfunction
 function WardenTrap_SlowUnits takes nothing returns nothing
 local unit Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),1697656901,GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
 call UnitAddAbility2(Caster,abilityid_wardentrapslow)
+call SetUnitAbilityLevel(Caster,abilityid_wardentrapslow,wardentrapslow_level)
 call IssueTargetOrder(Caster,"slow",GetEnumUnit())
 call UnitAddAbility2(Caster,abilityid_wardentrapburn)
 set Caster=null
 endfunction
 function WardenTrap_ActivateMain takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local real x=GetUnitX(Source)
 local real y=GetUnitY(Source)
 local group g=GetAvailableGroup()
+local real Time=(LoadReal(hash_main,(GetHandleId(Source)),(786)))
+local real Delta=(TimerGetElapsed(udg_GameTimer))-Time
+local integer Level=1
+if Delta>4 then
+set Level=5
+elseif Delta>3 then
+set Level=4
+elseif Delta>2 then
+set Level=3
+elseif Delta>1 then
+set Level=2
+endif
+set wardentrapslow_level=Level
 call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl",x,y))
 call GroupEnumUnitsInRange(g,x,y,400,Condition(function GenericCondition_EnemyUnits))
 call ForGroup(g,function WardenTrap_SlowUnits)
 call KillGroup(g)
 call WardenTrap_RemoveTrap(Source)
 call RemoveUnit(Source)
 set g=null
 set Source=null
 endfunction
 function WardenTrap_FindMyTraps takes nothing returns boolean
 return GetOwningPlayer(GetFilterUnit())==tt_player1 and GetUnitTypeId(GetFilterUnit())==unitid_wardentrap
 endfunction
 function WardenTrap_FindClosest takes nothing returns nothing
 local real mydist=GetDist(GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),tt_real1,tt_real2)
 local real bestdist=GetDist(GetUnitX(tt_unit1),GetUnitY(tt_unit1),tt_real1,tt_real2)
@@ -57716,31 +59150,31 @@
 endif
 call GroupRemoveUnit(g,uPicked)
 set uPicked=FirstOfGroup(g)
 endloop
 call KillGroup(g)
 set uPicked=null
 set g=null
 endfunction
 function VorpalBlade_UnitDamaged takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
-if GetEventDamageSource()==Source and GetEventDamage()>1 then
+if GetEventDamageSource()==Source and GetEventDamage()>1 and IsUnitIllusion(Target)==false then
 call DisableTrigger(t)
 call VorpalBlade_SuccessfulAttack(Source,Target,GetEventDamage(),(LoadReal(hash_main,(Cache),(349))),(LoadReal(hash_main,(Cache),(350))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 else
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function VorpalBlade_Attack_Child takes nothing returns nothing
@@ -58479,31 +59913,31 @@
 set t=null
 endfunction
 function FocusFire_Main takes nothing returns boolean
 if(GetSpellAbilityId()==abilityid_focusfire or GetSpellAbilityId()==abilityid_focusfireupgrade)and IsBlocked(GetSpellTargetUnit())==false then
 call FocusFire()
 endif
 return false
 endfunction
 function Register_FocusFire takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function FocusFire_Main))
 set t=null
 endfunction
 function ThundergodWrath_Filter takes nothing returns boolean
-return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and GetUnitTypeId(GetFilterUnit())!=1211117642 and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(thundergodwrath_source))==true
+return IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsGlobalHeroDummy(GetUnitTypeId(GetFilterUnit()))==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(thundergodwrath_source))==true
 endfunction
 function ThundergodWrath_Enum takes nothing returns nothing
 local real x=GetUnitX(GetEnumUnit())
 local real y=GetUnitY(GetEnumUnit())
 local unit caster=CreateUnit(GetOwningPlayer(thundergodwrath_source),1697656880,x,y,0)
 call UnitAddAbility(caster,abilityid_thundergodwrath_effect)
 call SetUnitAbilityLevel(caster,abilityid_thundergodwrath_effect,thundergodwrath_level)
 call IssueTargetOrder(caster,"chainlightning",GetEnumUnit())
 call UnitApplyTimedLife(caster,1112820806,3)
 call UnitAddAbility(caster,1097625443)
 set caster=null
 endfunction
 function ThundergodWrath takes nothing returns nothing
 local group g=GetAvailableGroup()
 set thundergodwrath_source=GetTriggerUnit()
@@ -58820,43 +60254,43 @@
 endfunction
 function BorrowedTime_TryAgain takes unit Hero returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,0.5,true)
 call TriggerRegisterUnitEvent(t,Hero,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function BorrowedTime_TryAgain_Iterate))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 set t=null
 endfunction
 function BorrowedTime_Defend takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=GetTriggerUnit()
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_borrowedtime)
-local integer Duration
+local integer Duration=2+Level
 local real Mana
 if Level==0 then
-set Level=GetUnitAbilityLevel(Hero,abilityid_borrowedtimeupgrade)+2
+set Level=GetUnitAbilityLevel(Hero,abilityid_borrowedtimeupgrade)
+set Duration=4+1*Level
 endif
-set Duration=2+Level
 if GetTriggerEventId()==EVENT_UNIT_DAMAGED and((LoadInteger(hash_main,(GetHandleId((Hero))),((4250))))==HERO_STATE_ON)then
 call PreventDamage(Hero,GetEventDamage())
 call PreventDamage(Hero,GetEventDamage())
 elseif(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and(GetSpellAbilityId()==abilityid_borrowedtime or GetSpellAbilityId()==abilityid_borrowedtimeupgrade))or(GetTriggerEventId()==EVENT_UNIT_DAMAGED and((LoadInteger(hash_main,(GetHandleId((Hero))),((4251))))==HERO_STATE_ON)==false and GetUnitState(Hero,UNIT_STATE_LIFE)<400)then
-call TimerStart(CTimer[GetPlayerId(GetOwningPlayer(Hero))],60,false,null)
+call TimerStart(CTimer[GetPlayerId(GetOwningPlayer(Hero))],70-10*Level,false,null)
 call AddHeroState(Hero,4250,Duration)
-call AddHeroState(Hero,4251,60)
+call AddHeroState(Hero,4251,70-10*Level)
 call UnitRemoveBuffs(Hero,false,true)
 call StickyNapalm_SetSlow(Hero,0,0)
 if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 call DisableTrigger(t)
 set borrowedtime_bypass_axe=true
 if IssueImmediateOrder(Hero,"windwalk")==false then
 call BorrowedTime_TryAgain(Hero)
 endif
 set borrowedtime_bypass_axe=false
 call EnableTrigger(t)
 endif
 call TimedLifeUnitEffect("Abilities\\Spells\\Undead\\Unsummon\\UnsummonTarget.mdl",Hero,"origin",Duration)
 endif
 set t=null
 set Hero=null
@@ -59216,31 +60650,31 @@
 endfunction
 function BerserkersCall_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_berserkerscall then
 call BerserkersCall()
 endif
 return false
 endfunction
 function Register_BerserkersCall takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function BerserkersCall_Main))
 set t=null
 endfunction
 function CounterHelix_Damage takes nothing returns nothing
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",GetEnumUnit(),"origin"))
-call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_PHYSICAL,GetUnitAbilityLevel(GetTriggerUnit(),abilityid_counterhelix)*30+70)
+call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_PHYSICAL,GetUnitAbilityLevel(GetTriggerUnit(),abilityid_counterhelix)*35+65)
 endfunction
 function CounterHelix takes nothing returns nothing
 local group g=GetAvailableGroup()
 local unit Hero=GetTriggerUnit()
 call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),300,Condition(function GenericCondition_EnemyUnitsWithAncients))
 call ForGroup(g,function CounterHelix_Damage)
 call SetUnitAnimation(Hero,"spin")
 call ResetUnitAnimationTimed(Hero,0.6)
 call AddHeroState(Hero,4267,0.7-0.05*GetUnitAbilityLevel(GetTriggerUnit(),abilityid_counterhelix))
 call KillGroup(g)
 set g=null
 set Hero=null
 endfunction
 function CounterHelix_Main takes nothing returns boolean
 if GetUnitAbilityLevel(GetTriggerUnit(),buffid_counterhelix)>0 and IsUnitType(GetAttacker(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetAttacker(),UNIT_TYPE_MECHANICAL)==false and GetUnitAbilityLevel(GetAttacker(),1093678162)==0 and IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==false and GetRandomReal(0,100)<17 and((LoadInteger(hash_main,(GetHandleId((GetTriggerUnit()))),((4267))))==HERO_STATE_ON)==false then
@@ -59307,111 +60741,149 @@
 if GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)>1 then
 call SetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE,GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)+20+70*GetUnitAbilityLevel(GetTriggerUnit(),1093683019))
 endif
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",GetSpellTargetUnit(),"origin"))
 endfunction
 function Nightmare_Process takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local player p=(LoadPlayerHandle(hash_main,(Cache),(54)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local unit Caster
 if GetUnitAbilityLevel(Target,buffid_nightmare)==0 then
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare_helper,false)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and GetTriggerUnit()==Target then
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare_helper,false)
 call UnitRemoveAbility(Target,buffid_nightmare)
 set Caster=CreateUnit(p,1697656901,GetUnitX(Target),GetUnitY(Target),0)
 call UnitAddAbility2(Caster,abilityid_nightmare)
 call SetUnitAbilityLevel(Caster,abilityid_nightmare,Level)
 call IssueTargetOrder(Caster,"sleep",GetAttacker())
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED then
 if GetUnitState(Target,UNIT_STATE_LIFE)>21 then
 call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)-20)
 else
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare_helper,false)
 call UnitRemoveAbility(Target,buffid_nightmare)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,50)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 endif
 set t=null
 set p=null
 set Caster=null
 set Target=null
 set Source=null
 return false
 endfunction
 function Nightmare takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 set Cache=GetHandleId(t)
 call SaveInteger(hash_main,(Cache),(30),(TI_AddUnit(Target)))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SavePlayerHandle(hash_main,(Cache),(54),(GetOwningPlayer(Source)))
 call SaveInteger(hash_main,(Cache),(5),(GetUnitAbilityLevel(Source,abilityid_nightmare)))
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerAddCondition(t,Condition(function Nightmare_Process))
+if GetUnitAbilityLevel(Target,abilityid_nightmare)>0 then
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare,false)
+call UnitAddAbility2(Target,abilityid_nightmare_helper)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),abilityid_nightmare_helper,true)
+endif
 set damageevent_valid=true
 call DamageTarget(Source,Target,DAMAGE_PHYSICAL,0)
 set damageevent_valid=false
 set Source=null
 set Target=null
 set t=null
 endfunction
 function Nightmare_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_nightmare and IsCourier(GetSpellTargetUnit())==false then
 call Nightmare()
 endif
 return false
 endfunction
 function Nightmare_Precast takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_nightmare and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true then
 if GetOwningPlayer(GetTriggerUnit())!=GetOwningPlayer(GetSpellTargetUnit())and IsUnitAlly(GetSpellTargetUnit(),GetOwningPlayer(GetTriggerUnit()))and(LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then
 call InterruptUnit(GetTriggerUnit())
 call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName(MSG_DISABLE_HELP_ON))
 endif
 endif
 return false
 endfunction
+function Nightmare_Cancel_Remove takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call UnitRemoveAbility(Source,buffid_nightmare)
+call UnitRemoveAbility(Source,abilityid_nightmare_helper)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_nightmare,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_nightmare_helper,false)
+set t=null
+set Source=null
+return false
+endfunction
+function Nightmare_Cancel takes nothing returns boolean
+local trigger t
+if GetIssuedOrderId()==String2OrderIdBJ("manashieldon")and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_nightmare_helper)>0 then
+set t=CreateTrigger()
+call TriggerRegisterTimerEvent(t,0,false)
+call TriggerAddCondition(t,Condition(function Nightmare_Cancel_Remove))
+call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(GetTriggerUnit()))
+endif
+return false
+endfunction
 function Register_Nightmare takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Nightmare_Main))
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function Nightmare_Precast))
+set t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
+call TriggerAddCondition(t,Condition(function Nightmare_Cancel))
 set t=null
 endfunction
 function FiendsGrip_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local real Mana
 local integer Count=6
 local fogmodifier fog=(LoadFogModifierHandle(hash_main,(Cache),(42)))
 if GetUnitAbilityLevel(Source,abilityid_fiendsgripupgrade)>0 then
-set Count=7
+set Count=8
 endif
 if GetTriggerEventId()==EVENT_UNIT_SPELL_ENDCAST then
 call FogModifierStop(fog)
 call DestroyFogModifier(fog)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEvalCount(t)>Count then
 call FogModifierStop(fog)
 call DestroyFogModifier(fog)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call InterruptUnit(Source)
 else
 set Mana=RMinBJ(0.05*GetUnitState(Target,UNIT_STATE_MAX_MANA),GetUnitState(Target,UNIT_STATE_MANA))
 if GetUnitAbilityLevel(Source,abilityid_fiendsgripupgrade)>0 then
@@ -59453,73 +60925,88 @@
 if GetSpellAbilityId()==abilityid_fiendsgrip or GetSpellAbilityId()==abilityid_fiendsgripupgrade then
 call FiendsGrip()
 endif
 return false
 endfunction
 function Register_FiendsGrip takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function FiendsGrip_Main))
 set t=null
 endfunction
 function Enfeeble_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
-if GetUnitAbilityLevel(Target,1110454852)==0 or GetTriggerEventId()==EVENT_UNIT_DEATH then
+local real EndTime=(LoadReal(hash_main,(GetHandleId(Target)),(789)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
+if GetTriggerEventId()==EVENT_WIDGET_DEATH or EndTime<(TimerGetElapsed(udg_GameTimer))then
 call UnitRemoveAbility(Target,enfeeble_1)
 call UnitRemoveAbility(Target,enfeeble_2)
 call UnitRemoveAbility(Target,enfeeble_3)
 call UnitRemoveAbility(Target,enfeeble_4)
+call UnitRemoveAbility(Target,enfeeble_buffid)
 endif
 set t=null
 set Target=null
 return false
 endfunction
 function Enfeeble takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_enfeeble)
 if Level==1 then
-call UnitAddAbility2(Target,enfeeble_1)
+call UnitRemoveAbility(Target,enfeeble_buffid)
 call UnitRemoveAbility(Target,enfeeble_2)
 call UnitRemoveAbility(Target,enfeeble_3)
 call UnitRemoveAbility(Target,enfeeble_4)
+call UnitAddAbility2(Target,enfeeble_1)
+call UnitMakeAbilityPermanent(Target,true,enfeeble_1_real)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),enfeeble_1,false)
 elseif Level==2 then
-call UnitAddAbility2(Target,enfeeble_2)
+call UnitRemoveAbility(Target,enfeeble_buffid)
 call UnitRemoveAbility(Target,enfeeble_1)
 call UnitRemoveAbility(Target,enfeeble_3)
 call UnitRemoveAbility(Target,enfeeble_4)
+call UnitAddAbility2(Target,enfeeble_2)
+call UnitMakeAbilityPermanent(Target,true,enfeeble_2_real)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),enfeeble_2,false)
 elseif Level==3 then
-call UnitAddAbility2(Target,enfeeble_3)
+call UnitRemoveAbility(Target,enfeeble_buffid)
 call UnitRemoveAbility(Target,enfeeble_1)
 call UnitRemoveAbility(Target,enfeeble_2)
 call UnitRemoveAbility(Target,enfeeble_4)
+call UnitAddAbility2(Target,enfeeble_3)
+call UnitMakeAbilityPermanent(Target,true,enfeeble_3_real)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),enfeeble_3,false)
 elseif Level==4 then
-call UnitAddAbility2(Target,enfeeble_4)
+call UnitRemoveAbility(Target,enfeeble_buffid)
 call UnitRemoveAbility(Target,enfeeble_1)
 call UnitRemoveAbility(Target,enfeeble_2)
 call UnitRemoveAbility(Target,enfeeble_3)
+call UnitAddAbility2(Target,enfeeble_4)
+call UnitMakeAbilityPermanent(Target,true,enfeeble_4_real)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),enfeeble_4,false)
 endif
-call TriggerRegisterTimerEvent(t,1,true)
-call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
+call TriggerRegisterTimerEvent(t,20,false)
+call TriggerRegisterDeathEvent(t,Target)
 call TriggerAddCondition(t,Condition(function Enfeeble_End))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveReal(hash_main,(GetHandleId(Target)),(789),((19.9+(TimerGetElapsed(udg_GameTimer)))*1.0))
 set t=null
 set Source=null
 set Target=null
 endfunction
 function Enfeeble_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_enfeeble and IsBlocked(GetSpellTargetUnit())==false then
 call Enfeeble()
 endif
 return false
 endfunction
 function Register_Enfeeble takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Enfeeble_Main))
 set t=null
@@ -59536,31 +61023,31 @@
 call SaveInteger(hash_main,(GetHandleId(Target)),(281),(0))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call StickyNapalm_SetSlow(Target,0,0)
 elseif Count==0 then
 call SetUnitTurnSpeed(Target,GetUnitDefaultTurnSpeed(Target))
 call SaveInteger(hash_main,(GetHandleId(Target)),(281),(0))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED and locked==false then
 if Count>0 and GetUnitAbilityLevel(GetEventDamageSource(),abilityid_stickynapalm)>0 and(LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource()then
 call SaveBoolean(hash_main,(Cache),(280),(true))
 if firefly_active then
 call DestroyEffect(AddSpecialEffectTarget(stickynapalm_fx_explode,Target,"chest"))
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,0.5*(5+5*GetUnitAbilityLevel(Source,abilityid_stickynapalm))*Count)
-elseif(GetEventDamage()>33 and IsUnitType(Target,UNIT_TYPE_HERO)==true)or(GetEventDamage()>40 and IsUnitType(Target,UNIT_TYPE_HERO)==false)then
+elseif(GetEventDamage()>34 and IsUnitType(Target,UNIT_TYPE_HERO)==true)or(GetEventDamage()>45 and IsUnitType(Target,UNIT_TYPE_HERO)==false)then
 call DestroyEffect(AddSpecialEffectTarget(stickynapalm_fx_explode,Target,"chest"))
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,(5+5*GetUnitAbilityLevel(Source,abilityid_stickynapalm))*Count)
 endif
 call SaveBoolean(hash_main,(Cache),(280),(false))
 endif
 else
 call SetUnitTurnSpeed(Target,GetUnitDefaultTurnSpeed(Target)*0.3)
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function StickyNapalm_Decrement takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
@@ -59930,31 +61417,31 @@
 endif
 call KillGroup(g1)
 set g1=null
 set g2=null
 endfunction
 function Firefly_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real LastX=(LoadReal(hash_main,(Cache),(23)))
 local real LastY=(LoadReal(hash_main,(Cache),(24)))
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 local integer i
 local real x
 local real y
-if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>300 then
+if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>360 then
 set i=0
 loop
 exitwhen i>Count
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(2700+i))))
 set i=i+1
 endloop
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set x=GetUnitX(Source)
 set y=GetUnitY(Source)
 if udg_ObserverMode==true then
 call Firefly_SearchTowers(Source)
 endif
 if DistanceBetweenXY(x,y,LastX,LastY)>125 then
@@ -59968,31 +61455,30 @@
 endif
 if ModuloInteger(GetTriggerEvalCount(t),10)==0 then
 set firefly_active=true
 call Firefly_Hit(Source,Cache,Count)
 set firefly_active=false
 endif
 call KillTrees(GetUnitX(Source),GetUnitY(Source),100)
 endif
 return false
 endfunction
 function Firefly takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,0.05,true)
-call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Firefly_Move))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveEffectHandle(hash_main,(Cache),(2700),(AddSpecialEffect(firefly_fx,GetUnitX(Source),GetUnitY(Source))))
 call SaveReal(hash_main,(Cache),(23),((GetUnitX(Source))*1.0))
 call SaveReal(hash_main,(Cache),(24),((GetUnitY(Source))*1.0))
 call SaveReal(hash_main,(Cache),(2300),((GetUnitX(Source))*1.0))
 call SaveReal(hash_main,(Cache),(2500),((GetUnitY(Source))*1.0))
 set Source=null
 set t=null
 endfunction
 function Firefly_Fix takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 if IsDead(Source)then
@@ -60072,40 +61558,42 @@
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local real d=DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
 local real a
 local real Duration=(LoadReal(hash_main,(Cache),(57)))
 local real x0=(LoadReal(hash_main,(Cache),(282)))
 local real y0=(LoadReal(hash_main,(Cache),(283)))
 local real x1
 local real y1
 if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>R2I(20*Duration)then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call KillUnit(Caster)
 call SetUnitPathing(Target,true)
+call UnitRemoveAbility(Source,1096971630)
 call KillTrees(GetUnitX(Target),GetUnitY(Target),175)
 else
 call SetUnitX(Caster,GetUnitX(Source))
 call SetUnitY(Caster,GetUnitY(Source))
 if DistanceBetweenXY(x0,y0,GetUnitX(Source),GetUnitY(Source))>400 then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call KillUnit(Caster)
 call SetUnitPathing(Target,true)
+call UnitRemoveAbility(Source,1096971630)
 call KillTrees(GetUnitX(Target),GetUnitY(Target),175)
 else
 call SaveReal(hash_main,(Cache),(282),((GetUnitX(Source))*1.0))
 call SaveReal(hash_main,(Cache),(283),((GetUnitY(Source))*1.0))
 if d>lasso_distance then
 set a=Atan2(GetUnitY(Target)-GetUnitY(Source),GetUnitX(Target)-GetUnitX(Source))
 set x1=GetUnitX(Source)+lasso_distance*Cos(a)
 set y1=GetUnitY(Source)+lasso_distance*Sin(a)
 if(IsPointInRegion(region_badplaces,((x1)*1.0),((y1)*1.0)))==false then
 call SetUnitX(Target,x1)
 call SetUnitY(Target,y1)
 endif
 endif
 endif
 endif
@@ -60118,30 +61606,31 @@
 function Lasso takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local unit Caster=CreateUnit(GetOwningPlayer(Source),unitid_lasso,GetUnitX(Source),GetUnitY(Source),0)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_lasso)
 if Level==0 then
 set Level=GetUnitAbilityLevel(Source,abilityid_lasso_upgrade)+2
 endif
 call UnitAddAbility2(Caster,lasso_shackle)
 call SetUnitAbilityLevel(Caster,lasso_shackle,GetUnitAbilityLevel(Source,abilityid_lasso))
 call IssueTargetOrder(Caster,"magicleash",Target)
 call SetUnitPathing(Caster,false)
 call SetUnitPathing(Target,false)
+call UnitAddAbility2(Source,1096971630)
 call TriggerRegisterTimerEvent(t,0.05,true)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Lasso_Drag))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 call SaveReal(hash_main,(Cache),(57),((2.5+Level*0.5)*1.0))
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Human\\AerialShackles\\AerialShacklesTarget.mdl",Target,"chest")))
 call SaveReal(hash_main,(Cache),(282),((GetUnitX(Source))*1.0))
 call SaveReal(hash_main,(Cache),(283),((GetUnitY(Source))*1.0))
 set t=null
 set Source=null
 set Target=null
 set Caster=null
@@ -60159,31 +61648,31 @@
 set t=null
 endfunction
 function Bloodbath_Hit takes unit Source,unit Target,real Rate returns nothing
 call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)+GetUnitState(Target,UNIT_STATE_MAX_LIFE)*Rate)
 call DestroyEffect(AddSpecialEffectTarget(bloodbath_fx,Source,"overhead"))
 endfunction
 function Bloodbath_Find takes nothing returns boolean
 if IsDead(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),abilityid_bloodbath)>0 and IsUnitEnemy(bloodbath_target,GetOwningPlayer(GetFilterUnit()))then
 call Bloodbath_Hit(GetFilterUnit(),bloodbath_target,GetUnitAbilityLevel(GetFilterUnit(),abilityid_bloodbath)*0.1*0.5)
 endif
 return false
 endfunction
 function Bloodbath_Search takes unit Source,unit Target,integer Level returns nothing
 local group g=GetAvailableGroup()
 set bloodbath_target=Target
-call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),250,Condition(function Bloodbath_Find))
+call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),350,Condition(function Bloodbath_Find))
 call KillGroup(g)
 set bloodbath_target=null
 set g=null
 endfunction
 function Bloodbath_Main takes nothing returns boolean
 local unit Source=GetKillingUnit()
 local unit Target=GetTriggerUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_bloodbath)
 if IsUnitIllusion(Target)==false and IsUnitType(Target,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Target)!=1848651852 then
 if IsUnitType(Target,UNIT_TYPE_HERO)==false then
 if Level>0 then
 call Bloodbath_Hit(Source,Target,Level*0.05+0.05)
 endif
 else
 if Level>0 then
@@ -60280,57 +61769,60 @@
 local unit Caster
 if GenericCondition_IsDotAInvis(GetEnumUnit())==false then
 call UnitRemoveAbility(GetEnumUnit(),thirst_reveal_buffid)
 call UnitShareVision(GetEnumUnit(),GetOwningPlayer(thirst_source),true)
 else
 call UnitShareVision(GetEnumUnit(),GetOwningPlayer(thirst_source),true)
 if GetUnitAbilityLevel(GetEnumUnit(),thirst_reveal_buffid)==0 and GetUnitAbilityLevel(GetEnumUnit(),1110454356)==0 and GetUnitAbilityLevel(GetEnumUnit(),1110454348)==0 then
 set Caster=CreateUnit(GetOwningPlayer(thirst_source),1697656901,GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
 call UnitAddAbility(Caster,thirst_reveal)
 call IssueTargetOrder(Caster,"faeriefire",GetEnumUnit())
 set Caster=null
 endif
 endif
 endfunction
 function Thirst_RemoveUnit takes nothing returns nothing
-if IsDead(thirst_source)==true or IsUnitInGroup(GetEnumUnit(),thirst_tempgroup)==false or GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)>0.4 or(GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)>0.2 and GenericCondition_IsDotAInvis(GetEnumUnit())==true)then
+local real rate=thirst_level*0.1+0.1
+if IsDead(thirst_source)==true or IsUnitInGroup(GetEnumUnit(),thirst_tempgroup)==false or GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)>rate or(GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)>rate/2 and GenericCondition_IsDotAInvis(GetEnumUnit())==true)then
 call GroupRemoveUnit(thirst_group,GetEnumUnit())
 call UnitShareVision(GetEnumUnit(),GetOwningPlayer(thirst_source),false)
 call UnitRemoveAbility(GetEnumUnit(),thirst_reveal_buffid)
 endif
 endfunction
 function Thirst_AddUnit takes nothing returns nothing
+local real rate
 if IsDead(thirst_source)==false and IsUnitInGroup(GetEnumUnit(),thirst_group)==false and IsUnitIllusion(GetEnumUnit())==false then
-if GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)<0.4 and GenericCondition_IsDotAInvis(GetEnumUnit())==false then
+set rate=thirst_level*0.1+0.1
+if GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)<rate and GenericCondition_IsDotAInvis(GetEnumUnit())==false then
 call GroupAddUnit(thirst_group,GetEnumUnit())
-elseif GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)<0.2 then
+elseif GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)/GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)<rate/2 then
 call GroupAddUnit(thirst_group,GetEnumUnit())
 endif
 endif
 endfunction
 function Thirst_Loop takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local group AffectedGroup=(LoadGroupHandle(hash_main,(Cache),(22)))
 local group g=GetAvailableGroup()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_thirst)
 set tt_unit1=Source
 set thirst_source=Source
 set thirst_group=AffectedGroup
 set thirst_level=Level
-call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),25+1500*Level,Condition(function GenericCondition_EnemyHeroesEx))
+call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),25+6000,Condition(function GenericCondition_EnemyHeroesEx))
 call ForGroup(g,function Thirst_AddUnit)
 set thirst_tempgroup=g
 call ForGroup(thirst_group,function Thirst_RemoveUnit)
 call ForGroup(thirst_group,function Thirst_RevealUnit)
 if FirstOfGroup(thirst_group)==null then
 call UnitRemoveAbility(Source,thirst_ms[1])
 call UnitRemoveAbility(Source,thirst_ms[2])
 call UnitRemoveAbility(Source,thirst_ms[3])
 call UnitRemoveAbility(Source,thirst_ms[4])
 call UnitRemoveAbility(Source,thirst_fx)
 else
 if Level==1 then
 call UnitRemoveAbility(Source,thirst_ms[2])
 call UnitRemoveAbility(Source,thirst_ms[3])
 call UnitRemoveAbility(Source,thirst_ms[4])
@@ -60595,83 +62087,94 @@
 endfunction
 function Register_SpawnSpiderlings takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function SpawnSpiderlings_Main))
 set t=null
 endfunction
 function Trig_chaos_bolt_Conditions takes nothing returns boolean
 return GetSpellAbilityId()==1093678389
 endfunction
 function ChaosBolt_Hit takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local real Damage=(LoadReal(hash_main,(Cache),(20)))
+local integer Duration=(LoadInteger(hash_main,(Cache),(188)))
+local texttag tt
+if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+elseif GetEventDamageSource()==Caster then
+set tt=CreateTextTag()
+call TextTagOnUnitEx(I2S(Duration),Duration,Target,0.03,127,127,255,255)
+call SetTextTagText(tt,"+"+I2S(R2I(Damage)),0.025)
+call SetTextTagPosUnit(tt,Target,10)
+call SetTextTagColor(tt,255,0,0,255)
+call SetTextTagVelocity(tt,0,0.0355)
+call SetTextTagFadepoint(tt,2)
+call SetTextTagPermanent(tt,false)
+call SetTextTagLifespan(tt,2)
+if IsUnitVisible(Target,GetLocalPlayer())or IsObserver(GetLocalPlayer())then
+call SetTextTagVisibility(tt,true)
+else
+call SetTextTagVisibility(tt,false)
+endif
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Damage)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
+endif
 set t=null
 set Source=null
 set Target=null
+set tt=null
 return false
 endfunction
 function Trig_chaos_bolt_Actions takes nothing returns nothing
-local location PointVar=GetUnitLoc(GetSpellTargetUnit())
 local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),1093678389)
 local integer randomduration=GetRandomInt(1,Level+1)
 local unit UnitVar=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
+local location PointVar=GetUnitLoc(UnitVar)
 local real Damage=GetRandomReal(1,200)
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-local texttag tt=CreateTextTag()
+local unit Caster=CreateUnit(GetOwningPlayer(UnitVar),1697656901,GetUnitX(UnitVar),GetUnitY(UnitVar),0)
 if Level==2 then
 set Damage=GetRandomReal(50,225)
 elseif Level==3 then
 set Damage=GetRandomReal(75,250)
 elseif Level==4 then
 set Damage=GetRandomReal(100,275)
 endif
-call TriggerRegisterTimerEvent(t,DistanceBetweenUnits(UnitVar,Target)/1500,false)
+call TriggerRegisterTimerEvent(t,10,false)
+call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
 call TriggerAddCondition(t,Condition(function ChaosBolt_Hit))
 call SaveUnitHandle(hash_main,(Cache),(2),(UnitVar))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 call SaveReal(hash_main,(Cache),(20),((Damage)*1.0))
 if(Level==4)then
 set randomduration=GetRandomInt(2,4)
 endif
-call CreateNUnitsAtLoc(1,1697656901,GetOwningPlayer(UnitVar),PointVar,bj_UNIT_FACING)
-call UnitAddAbility2(GetLastCreatedUnit(),1093678165)
-call SetUnitAbilityLevel(GetLastCreatedUnit(),1093678165,randomduration)
-call IssueTargetOrder(GetLastCreatedUnit(),"thunderbolt",Target)
-call TextTagOnUnitEx(I2S(randomduration),randomduration,Target,0.03,127,127,255,255)
-call SetTextTagText(tt,"+"+I2S(R2I(Damage)),0.025)
-call SetTextTagPosUnit(tt,Target,10)
-call SetTextTagColor(tt,255,0,0,255)
-call SetTextTagVelocity(tt,0,0.0355)
-call SetTextTagFadepoint(tt,2)
-call SetTextTagPermanent(tt,false)
-call SetTextTagLifespan(tt,2)
-if IsUnitVisible(Target,GetLocalPlayer())or IsObserver(GetLocalPlayer())then
-call SetTextTagVisibility(tt,true)
-else
-call SetTextTagVisibility(tt,false)
-endif
+call SaveInteger(hash_main,(Cache),(188),(randomduration))
+call UnitAddAbility2(Caster,1093678165)
+call SetUnitAbilityLevel(Caster,1093678165,randomduration)
+call IssueTargetOrder(Caster,"thunderbolt",Target)
 set t=null
-set tt=null
 endfunction
 function Chaos takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Trig_chaos_bolt_Conditions))
 call TriggerAddAction(t,function Trig_chaos_bolt_Actions)
 endfunction
 function BlinkStrike_CK_Remove takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call AddDamageBonus(Source,0)
 set t=null
@@ -61010,31 +62513,31 @@
 call ShowUnit(Target,true)
 call ClearSelectionForPlayer(GetOwningPlayer(Target))
 call SelectUnitAddForPlayer(Target,GetOwningPlayer(Target))
 call RemoveSavedHandle(hash_main,(GetHandleId(Source)),(748))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function AstralImprisonment takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_astralimprisonment)
-local integer StolenInt=IMin(GetHeroInt(Target,false),Level*2)
+local integer StolenInt=IMin(GetHeroInt(Target,false),2+Level*2)
 local trigger t
 local integer Cache
 local unit Caster=CreateUnit(GetOwningPlayer(Target),1865429305,GetUnitX(Target),GetUnitY(Target),0)
 call UnitApplyTimedLife(Caster,1112820806,Level+1)
 if(IsUnitEnemy(Target,GetOwningPlayer(Source)))==false or IsBlocked(GetSpellTargetUnit())==false then
 call SaveInteger(hash_main,(GetHandleId((Target))),((4303)),(HERO_STATE_ON))
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call SelectUnitRemoveForPlayer(Target,GetOwningPlayer(Target))
 call SetUnitInvulnerable(Target,true)
 call PauseUnit(Target,true)
 call ShowUnit(Target,false)
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkConversion\\ZombifyTarget.mdl",GetUnitX(Target),GetUnitY(Target))))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
@@ -61201,30 +62704,33 @@
 set t=null
 set fx=null
 endfunction
 function IonShell takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_ionshell then
 call IonShell_Main()
 endif
 return false
 endfunction
 function Register_IonShell takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function IonShell))
 set t=null
 endfunction
+function Vacuum_Ignore takes unit u returns boolean
+return GetUnitAbilityLevel(u,songofthesiren_buffid1)>0 or GetUnitAbilityLevel(u,songofthesiren_buffid2)>0 or GetUnitAbilityLevel(u,songofthesiren_buffid3)>0 or IsCycloned(u)
+endfunction
 function Vacuum_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local integer Level
 local unit Source
 local unit Target
 local real x1
 local real y1
 local real d
 local real a
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
@@ -61244,55 +62750,59 @@
 endif
 if GetTriggerEvalCount(t)>15 then
 set Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 set Level=(LoadInteger(hash_main,(Cache),(5)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Level*40)
 set Source=null
 endif
 set Target=null
 endif
 set t=null
 return false
 endfunction
 function Vacuum_Add takes nothing returns nothing
-local trigger t=CreateTrigger()
-local integer Cache=GetHandleId(t)
+local trigger t
+local integer Cache
 local unit Source=GetTriggerUnit()
 local unit Target=GetEnumUnit()
+if Vacuum_Ignore(Target)==false then
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerRegisterTimerEvent(t,0.025,true)
 call TriggerAddCondition(t,Condition(function Vacuum_Iterate))
 call SaveReal(hash_main,(Cache),(6),((vacuum_x)*1.0))
 call SaveReal(hash_main,(Cache),(7),((vacuum_y)*1.0))
 call SaveReal(hash_main,(Cache),(138),((DistanceBetweenXY(vacuum_x,vacuum_y,GetUnitX(Target),GetUnitY(Target)))*1.0))
 call SaveReal(hash_main,(Cache),(137),((Atan2(vacuum_y-GetUnitY(Target),vacuum_x-GetUnitX(Target)))*1.0))
 call SaveInteger(hash_main,(Cache),(5),(vacuum_level))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+endif
 set t=null
 set Source=null
 set Target=null
 endfunction
 function Vacuum_Main takes nothing returns nothing
 local group g=GetAvailableGroup()
 local location l=GetSpellTargetLoc()
 local real x=GetLocationX(l)
 local real y=GetLocationY(l)
 local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),abilityid_vacuum)
-local real r=200+100*Level
+local real r=150+100*Level+25
 set tt_unit1=GetTriggerUnit()
 call PlaySoundAtPos(gg_snd_Vacuum,x,y)
 call DestroyEffect(AddSpecialEffect("war3mapImported\\Star Aura.mdx",x,y))
 call GroupEnumUnitsInRange(g,x,y,r,Condition(function GenericCondition_EnemyUnitsNoImmune))
 set vacuum_x=x
 set vacuum_y=y
 set vacuum_level=Level
 call ForGroup(g,function Vacuum_Add)
 call KillTrees(x,y,200)
 call RemoveLocation(l)
 call KillGroup(g)
 set l=null
 set g=null
 endfunction
 function Vacuum takes nothing returns boolean
@@ -61378,43 +62888,43 @@
 call SetUnitAbilityLevel(Wall,1093685580,3+Level)
 call IssueTargetOrderById(Wall,852274,Target)
 call DamageTarget(Wall,Target,DAMAGE_MAGICAL,150)
 else
 call IssueTargetOrderById(Wall,852274,Target)
 call DamageTarget(Wall,Target,DAMAGE_MAGICAL,150)
 endif
 call UnitApplyTimedLife(InvisViewer,1112820806,0.5)
 call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl",GetUnitX(Target),GetUnitY(Target)))
 set Wall=null
 set Target=null
 return false
 endfunction
 function WallOfReplica_Detected takes nothing returns boolean
 local group g
-if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(259)))))and(GetUnitTypeId((GetFilterUnit()))==1211117642)==false then
+if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(259)))))and IsGlobalHeroDummy(GetUnitTypeId(GetFilterUnit()))==false then
 set g=(LoadGroupHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(257)))
 if IsUnitInGroup(GetFilterUnit(),g)==false then
 call GroupAddUnit(g,GetFilterUnit())
 call WallOfReplica_Detected_Main(false)
 endif
 endif
 set g=null
 return false
 endfunction
 function WallOfReplica_Detected_Scepter takes nothing returns boolean
 local group g
-if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(259)))))and(GetUnitTypeId((GetFilterUnit()))==1211117642)==false then
+if IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer((LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(259)))))and IsGlobalHeroDummy(GetUnitTypeId(GetFilterUnit()))==false then
 set g=(LoadGroupHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(257)))
 if IsUnitInGroup(GetFilterUnit(),g)==false then
 call GroupAddUnit(g,GetFilterUnit())
 call WallOfReplica_Detected_Main(true)
 endif
 endif
 set g=null
 return false
 endfunction
 function WallOfReplica_FindSource takes nothing returns nothing
 if GetPlayerId(GetOwningPlayer(GetEnumUnit()))==tt_int1 then
 call GroupAddUnit(tt_group1,GetEnumUnit())
 endif
 endfunction
 function WallOfReplica_ImageDeath takes nothing returns boolean
@@ -61522,30 +63032,33 @@
 set Level=GetUnitAbilityLevel(Hero,abilityid_wallofreplica_upgrade)
 endif
 call SetUnitAbilityLevel(Wall,1093685580,Level)
 call PlaySoundAtPos(gg_snd_WallOfReplica,x,y)
 call SaveGroupHandle(hash_main,(Cache),(257),(g1))
 call SaveGroupHandle(hash_main,(GetHandleId(Wall)),(257),(g1))
 call SaveGroupHandle(hash_main,(Cache),(258),(g2))
 call SaveUnitHandle(hash_main,(Cache),(259),(Wall))
 call SaveInteger(hash_main,(GetHandleId(Wall)),(260),(0))
 set i=0
 loop
 exitwhen i>39
 set newx=x+(500-25*i)*Cos((direction-45)*bj_DEGTORAD)
 set newy=y+(500-25*i)*Sin((direction-45)*bj_DEGTORAD)
 set u=CreateUnit(GetOwningPlayer(Hero),abilityid_wallofreplicaunitpath,newx,newy,direction)
+call SetUnitPathing(u,false)
+call SetUnitX(u,newx)
+call SetUnitY(u,newy)
 call GroupAddUnit(g2,u)
 call TriggerRegisterUnitInRange(t,u,17,Condition(function GenericCondition_True))
 set i=i+1
 endloop
 if Scepter then
 call TriggerAddCondition(t,Condition(function WallOfReplica_Detected_Scepter))
 else
 call TriggerAddCondition(t,Condition(function WallOfReplica_Detected))
 endif
 set t=CreateTrigger()
 call TriggerRegisterUnitEvent(t,Wall,EVENT_UNIT_SUMMON)
 call TriggerAddCondition(t,Condition(function WallOfReplica_ImageEnters))
 call SaveTriggerHandle(hash_main,(Cache),(256),(t))
 set t=CreateTrigger()
 call TriggerRegisterTimerEvent(t,15*Level,false)
@@ -61595,68 +63108,68 @@
 call SetHeroStr((LoadUnitHandle(hash_main,(Cache),(17))),GetHeroStr((LoadUnitHandle(hash_main,(Cache),(17))),false)+Lost,true)
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 return false
 endfunction
 function Decay_Add takes nothing returns nothing
 local unit Source=decay_source
 local unit Target=GetEnumUnit()
 local integer Lost
 local integer Level=decay_level
 local trigger t
 local integer Cache
-if IsUnitType(Target,UNIT_TYPE_HERO)==true and GetUnitTypeId(Target)!=1211117642 then
+if IsUnitType(Target,UNIT_TYPE_HERO)==true and IsGlobalHeroDummy(GetUnitTypeId(Target))==false then
 set Lost=IMinBJ(GetHeroStr(Target,false)-1,4)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call SetHeroStr(Source,GetHeroStr(Source,false)+Lost,true)
 call SetHeroStr(Target,GetHeroStr(Target,false)-Lost,true)
-call TriggerRegisterTimerEvent(t,18+3*Level,false)
+call TriggerRegisterTimerEvent(t,20+5*Level,false)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Decay_Expire))
 call SaveBoolean(hash_main,(Cache),(276),(false))
 call SaveBoolean(hash_main,(Cache),(277),(false))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveInteger(hash_main,(Cache),(29),(Lost))
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",Source,"origin"))
 endif
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,40*Level)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,40*Level-20)
 set Source=null
 set Target=null
 set t=null
 endfunction
 function Decay takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local location l=GetSpellTargetLoc()
 local real x=GetLocationX(l)
 local real y=GetLocationY(l)
 local group g=GetAvailableGroup()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_decay)
 local unit Caster=CreateUnit(GetOwningPlayer(Source),1747990346,x,y,0)
 call DestroyEffect(AddSpecialEffect("effects\\DecayGreen_Groundonly_1.mdx",x,y))
 call RemoveLocation(l)
 set tt_unit1=Source
 set decay_source=Source
 set decay_level=Level
-call GroupEnumUnitsInRange(g,x,y,325,Condition(function GenericCondition_EnemyUnitsNoImmune))
+call GroupEnumUnitsInRange(g,x,y,325+25,Condition(function GenericCondition_EnemyUnitsNoImmune))
 call ForGroup(g,function Decay_Add)
 call KillGroup(g)
 call KillUnit(Caster)
 set Source=null
 set l=null
 set g=null
 set t=null
 set Caster=null
 endfunction
 function Decay_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_decay then
 call Decay()
 endif
 return false
 endfunction
@@ -61720,47 +63233,49 @@
 endif
 return false
 endfunction
 function Register_SoulRip takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function SoulRip_Main))
 set t=null
 endfunction
 function Tombstone_ManageZombie takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
 local unit Target=TI_GetUnit(TargetIndex)
 local unit Zombie=(LoadUnitHandle(hash_main,(Cache),(269)))
+local real CurrentLife=GetUnitState(Target,UNIT_STATE_LIFE)
+local real MaxLife=GetUnitState(Target,UNIT_STATE_MAX_LIFE)
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 if GetTriggerUnit()==Target then
 call KillUnit(Zombie)
 endif
 elseif udg_GameOver==true then
 call TI_ClearUnit(TargetIndex)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call PauseUnit(Zombie,true)
 elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER then
 call DisableTrigger(t)
 call IssueTargetOrder(Zombie,"attack",Target)
 call EnableTrigger(t)
-elseif GetUnitState(Target,UNIT_STATE_LIFE)<(100*tombstone_level)and GetUnitAbilityLevel(Zombie,buffid_tombstonebonus)==0 then
+elseif(CurrentLife<(100*tombstone_level)or CurrentLife/MaxLife<(0.05*tombstone_level))and GetUnitAbilityLevel(Zombie,buffid_tombstonebonus)==0 then
 call IssueTargetOrder(tombstone_caster[GetPlayerId(GetOwningPlayer(Zombie))],"bloodlust",Zombie)
 elseif IsUnitVisible(Target,GetOwningPlayer(Zombie))==false then
 if(LoadBoolean(hash_main,(Cache),(270)))==true then
 if(LoadBoolean(hash_main,(Cache),(271)))==true then
 if(LoadBoolean(hash_main,(Cache),(272)))==true then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call KillUnit(Zombie)
 else
 call SaveBoolean(hash_main,(Cache),(272),(true))
 endif
 else
 call SaveBoolean(hash_main,(Cache),(271),(true))
 endif
 else
@@ -62158,32 +63673,32 @@
 local real y2=(LoadReal(hash_main,(Cache),(67)))
 local real a=(LoadReal(hash_main,(Cache),(137)))
 local integer Count=GetTriggerEvalCount(t)
 local real x=GetUnitX(Hero)
 local real y=GetUnitY(Hero)
 local real LastX=(LoadReal(hash_main,(Cache),(23)))
 local real LastY=(LoadReal(hash_main,(Cache),(24)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local group g=GetAvailableGroup()
 local group AlreadyHit=(LoadGroupHandle(hash_main,(Cache),(187)))
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_timewalk)
 if DistanceBetweenXY(x,y,x2,y2)<=timewalk_rate then
 set x=x2
 set y=y2
 else
-set x=LastX+65*Cos(a*bj_DEGTORAD)
-set y=LastY+65*Sin(a*bj_DEGTORAD)
+set x=SafeX(LastX+65*Cos(a*bj_DEGTORAD))
+set y=SafeY(LastY+65*Sin(a*bj_DEGTORAD))
 endif
 if Level==1 then
 set timewalk_slowability=timewalk_slow_1
 elseif Level==2 then
 set timewalk_slowability=timewalk_slow_2
 elseif Level==3 then
 set timewalk_slowability=timewalk_slow_3
 elseif Level==4 then
 set timewalk_slowability=timewalk_slow_4
 endif
 set tt_unit1=Hero
 set timewalk_group=AlreadyHit
 call GroupEnumUnitsInRange(g,x,y,325,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function Timewalk_Hit)
 call KillGroup(g)
@@ -62225,32 +63740,32 @@
 local unit Caster=CreateUnit(GetOwningPlayer(Hero),1697656901,x1,y1,0)
 if GetSpellTargetUnit()==null then
 set l=GetSpellTargetLoc()
 else
 set l=GetUnitLoc(GetSpellTargetUnit())
 endif
 set x2=GetLocationX(l)
 set y2=GetLocationY(l)
 set a=AngleBetweenXY(x1,y1,x2,y2)
 call RemoveLocation(l)
 call SetUnitAnimationByIndex(Hero,0)
 call SetUnitPathing(Hero,false)
 call SetUnitInvulnerable(Hero,true)
 call SetUnitVertexColor(Hero,0,0,0,255)
 call SaveInteger(hash_main,(GetHandleId((Hero))),((4261)),(HERO_STATE_ON))
-call SaveReal(hash_main,(Cache),(66),((x2)*1.0))
-call SaveReal(hash_main,(Cache),(67),((y2)*1.0))
+call SaveReal(hash_main,(Cache),(66),((SafeX(x2))*1.0))
+call SaveReal(hash_main,(Cache),(67),((SafeY(y2))*1.0))
 call SaveReal(hash_main,(Cache),(23),((x1)*1.0))
 call SaveReal(hash_main,(Cache),(24),((y1)*1.0))
 call SaveReal(hash_main,(Cache),(137),((a)*1.0))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 call SaveGroupHandle(hash_main,(Cache),(187),(GetAvailableGroup()))
 call UnitAddAbility2(Caster,abilityid_timewalkstomp)
 call SetUnitAbilityLevel(Caster,abilityid_timewalkstomp,GetUnitAbilityLevel(Hero,abilityid_timewalk))
 call TriggerRegisterTimerEvent(t,timewalk_interval,true)
 call TriggerAddCondition(t,Condition(function TimeWalk_Move))
 set Hero=null
 set l=null
 set t=null
 set Caster=null
 endfunction
@@ -62300,47 +63815,51 @@
 return 1966092364
 endfunction
 function Chronosphere_Condition takes nothing returns boolean
 return GetSpellAbilityId()==(1093683761)or GetSpellAbilityId()==abilityid_chronosphereupgrade
 endfunction
 function Chronosphere_PlayAnimation takes nothing returns nothing
 local timer t=GetExpiredTimer()
 local integer Cache=GetHandleId(t)
 local unit Sphere=(LoadUnitHandle(hash_main,(Cache),(19)))
 call PauseTimer(t)
 call FlushChildHashtable(hash_main,(Cache))
 call DestroyTimer(t)
 endfunction
 function Chronosphere_IsUnitException takes unit whichUnit returns boolean
 local integer ID=GetUnitTypeId(whichUnit)
-return ID==1869836340 or ID==1865429048 or ID==1865429049 or ID==1700946284 or ID==1697657398 or ID==1970107511 or ID==1966092370
+return ID==1869836340 or ID==1865429048 or ID==1865429049 or ID==1700946284 or ID==1697657398 or ID==1970107511 or ID==1966092370 or ID==1162032181
 endfunction
 function Chronosphere_WhichUnits takes nothing returns boolean
 return GetOwningPlayer(GetFilterUnit())!=GetOwningPlayer(udg_TempUnit)and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 or Chronosphere_IsUnitException(GetFilterUnit()))
 endfunction
 function Chronosphere_Pause takes nothing returns nothing
+if GetUnitTypeId(GetEnumUnit())!=1162032181 then
 call PauseUnit(GetEnumUnit(),true)
 call SetUnitTimeScale(GetEnumUnit(),0)
 call UnitRemoveAbility(GetEnumUnit(),1112896364)
 call UnitRemoveAbility(GetEnumUnit(),1112896368)
 call UnitRemoveAbility(GetEnumUnit(),1112896372)
 call SaveInteger(hash_main,(GetHandleId((GetEnumUnit()))),((4306)),(HERO_STATE_ON))
+endif
 endfunction
 function Chronosphere_Unpause takes nothing returns nothing
+if GetUnitTypeId(GetEnumUnit())!=1162032181 then
 call SaveInteger(hash_main,(GetHandleId((GetEnumUnit()))),((4306)),(HERO_STATE_OFF))
 call PauseUnit(GetEnumUnit(),false)
 call SetUnitTimeScale(GetEnumUnit(),1)
+endif
 endfunction
 function Chronosphere_PauseUnits takes nothing returns nothing
 local timer t=GetExpiredTimer()
 local integer Cache=GetHandleId(t)
 local unit Sphere=(LoadUnitHandle(hash_main,(Cache),(19)))
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local group PausedUnits=(LoadGroupHandle(hash_main,(Cache),(220)))
 local integer Counter=(LoadInteger(hash_main,(Cache),(28)))
 local real TargetX=GetUnitX(Sphere)
 local real TargetY=GetUnitY(Sphere)
 local boolexpr CondVar=Condition(function Chronosphere_WhichUnits)
 local group TempGroup=GetAvailableGroup()
 local integer Duration=35+Level*5
 if GetUnitAbilityLevel(Hero,abilityid_chronosphereupgrade)>0 then
@@ -62410,56 +63929,59 @@
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AbsorbMana\\AbsorbManaBirthMissile.mdl",Source,"origin"))
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function TimeLock_RegisterUnit takes unit Source returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call SetUnitTimeScale(Source,0)
 call SaveInteger(hash_main,(GetHandleId((Source))),((4280)),(HERO_STATE_ON))
 call TriggerRegisterTimerEvent(t,0.1,true)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function TimeLock_FX))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+if((LoadInteger(hash_main,(GetHandleId((Source))),((4306))))==HERO_STATE_ON)==true then
+call DamageTarget(timelock_source,Source,DAMAGE_MAGICAL,30+10*GetUnitAbilityLevel(timelock_source,abilityid_timelock))
+endif
 set t=null
 endfunction
 function TimeLock_FindUnitsToLock takes nothing returns boolean
 if GetUnitAbilityLevel(GetFilterUnit(),buffid_timelock)>0 and((LoadInteger(hash_main,(GetHandleId((GetFilterUnit()))),((4280))))==HERO_STATE_ON)==false then
 call TimeLock_RegisterUnit(GetFilterUnit())
 endif
 return false
 endfunction
 function TimeLock_Loop takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local group g=GetAvailableGroup()
 set timelock_source=Source
 call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),450,Condition(function TimeLock_FindUnitsToLock))
 call KillGroup(g)
 set t=null
 set Source=null
 set g=null
 return false
 endfunction
 function TimeLock takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-call TriggerRegisterTimerEvent(t,0.25,true)
+call TriggerRegisterTimerEvent(t,0.1,true)
 call TriggerAddCondition(t,Condition(function TimeLock_Loop))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 set t=null
 set Source=null
 endfunction
 function TimeLock_Main takes nothing returns boolean
 if GetLearnedSkill()==abilityid_timelock and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_timelock)==1 then
 call TimeLock()
 endif
 return false
 endfunction
 function Register_TimeLock takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function TimeLock_Main))
@@ -62905,31 +64427,31 @@
 call Invoke4_Update(GetTriggerUnit())
 endif
 return false
 endfunction
 function Register_Invoke4 takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Invoke4_Main))
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function Invoke4_Learn))
 call DelayedPreloadAbility(abilityid_invoke4_slow,GetRandomReal(1,25))
 set t=null
 endfunction
 function Invoke5_Effect takes unit Source,unit Target,integer WexLevel returns nothing
-local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Target),GetUnitY(Target),0)
+local unit Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
 call UnitAddAbility2(Caster,abilityid_invoke5_effect)
 call SetUnitAbilityLevel(Caster,abilityid_invoke5_effect,WexLevel)
 call IssueTargetOrder(Caster,"drunkenhaze",Target)
 set Caster=null
 endfunction
 function Invoke5_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local real Angle=(LoadReal(hash_main,(Cache),(13)))
 local real Rate=(LoadReal(hash_main,(Cache),(193)))
 local integer WexLevel=(LoadInteger(hash_main,(Cache),(3000)))
 local integer QuasLevel=(LoadInteger(hash_main,(Cache),(3001)))
 local integer MaxCount=QuasLevel*25/3
@@ -64142,32 +65664,36 @@
 call UnitAddAbility(Caster,1093809972)
 call IssueImmediateOrder(Caster,"thunderclap")
 call SelectUnitForPlayerSingle(Source,GetOwningPlayer(Source))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Source=null
 set Caster=null
 return false
 endfunction
 function Reincarnation_Dead takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_reincarnation)
+local real Duration=360-100*Level
+if Level==3 then
+set Duration=50
+endif
 if TimerGetRemaining(CTimer[GetPlayerId(GetOwningPlayer(Source))])==0 and GetUnitState(Source,UNIT_STATE_MANA)>=140 then
-call TimerStart(CTimer[GetPlayerId(GetOwningPlayer(Source))],360-100*Level,false,null)
+call TimerStart(CTimer[GetPlayerId(GetOwningPlayer(Source))],Duration,false,null)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,3+0.01,false)
 call TriggerAddCondition(t,Condition(function Reincarnation_Control))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function Reincarnation_Learned takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 call TriggerRegisterDeathEvent(t,Source)
@@ -64305,34 +65831,34 @@
 return 1093684803
 endfunction
 constant function Trap_Projectile takes nothing returns integer
 return 1747988547
 endfunction
 constant function Trap_DummyNet takes nothing returns integer
 return 1747988537
 endfunction
 constant function Trap_Radius takes nothing returns integer
 return 245
 endfunction
 function Trap_Condition takes nothing returns boolean
 return GetSpellAbilityId()==(1093684802)
 endfunction
 function Trap_WhichUnits takes nothing returns boolean
-return IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(udg_TempUnit))and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(udg_TempUnit))==true and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>0.5 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and GetUnitTypeId(GetFilterUnit())!=1848651852
+return IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(udg_TempUnit))and(GenericCondition_IsDotAInvis(GetFilterUnit())==false or IsUnitVisible(GetFilterUnit(),GetOwningPlayer(udg_TempUnit))==true)and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>0.5 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and GetUnitTypeId(GetFilterUnit())!=1848651852
 endfunction
 function Trap_EnsnareCast takes nothing returns nothing
-local unit Caster=CreateUnit(GetOwningPlayer(udg_TempUnit),1697656901,udg_TempReal,udg_TempReal2,0)
+local unit Caster=CreateUnit(GetOwningPlayer(GetEnumUnit()),1697656901,udg_TempReal,udg_TempReal2,0)
 call UnitAddAbility2(Caster,(1093684803))
 call IssueTargetOrder(Caster,"ensnare",GetEnumUnit())
 endfunction
 function Trap_Ensnare takes unit Projectile,real x,real y returns nothing
 local boolexpr CondVar=Condition(function Trap_WhichUnits)
 local group GroupVar=GetAvailableGroup()
 set udg_TempUnit=Projectile
 call GroupEnumUnitsInRange(GroupVar,x,y,(245),CondVar)
 set udg_TempReal=x
 set udg_TempReal2=y
 call ForGroup(GroupVar,function Trap_EnsnareCast)
 call KillGroup(GroupVar)
 endfunction
 function Trap_ProjectileMove takes nothing returns nothing
 local timer t=GetExpiredTimer()
@@ -64447,34 +65973,40 @@
 local integer TrigCache=GetHandleId(GetTriggeringTrigger())
 local player PlayerVar=(LoadPlayerHandle(hash_main,(TrigCache),(370)))
 local integer PlayerCache=GetHandleId(PlayerVar)
 local unit Kobold0=(LoadUnitHandle(hash_main,(PlayerCache),(699)))
 local unit Kobold1=(LoadUnitHandle(hash_main,(PlayerCache),(700)))
 local unit Kobold2=(LoadUnitHandle(hash_main,(PlayerCache),(701)))
 local unit Kobold3=(LoadUnitHandle(hash_main,(PlayerCache),(702)))
 local unit Kobold4=(LoadUnitHandle(hash_main,(PlayerCache),(703)))
 local integer AbilityBonuses=GetUnitAbilityLevel(Kobold0,1096904043)*2
 local integer Agility=GetHeroAgi(Kobold0,false)
 local integer AgilityBonus=GetHeroAgi(Kobold0,true)-Agility-AbilityBonuses
 local integer Strength=GetHeroStr(Kobold0,false)
 local integer StrengthBonus=GetHeroStr(Kobold0,true)-Strength-AbilityBonuses
 local integer Intelligence=GetHeroInt(Kobold0,false)
 local integer IntelligenceBonus=GetHeroInt(Kobold0,true)-Intelligence-AbilityBonuses
-local real AttributeFactor=0.25
-local integer NewAgility=R2I(Agility+AgilityBonus*AttributeFactor)
-local integer NewStrength=R2I(Strength+StrengthBonus*AttributeFactor)
-local integer NewIntelligence=R2I(Intelligence+IntelligenceBonus*AttributeFactor)
+local real AttributeFactor=0.3
+local integer NewAgility
+local integer NewStrength
+local integer NewIntelligence
+if dividedwestand_usedscepter then
+set AttributeFactor=1.0
+endif
+set NewAgility=R2I(Agility+AgilityBonus*AttributeFactor)
+set NewStrength=R2I(Strength+StrengthBonus*AttributeFactor)
+set NewIntelligence=R2I(Intelligence+IntelligenceBonus*AttributeFactor)
 if GetUnitState(Kobold0,UNIT_STATE_LIFE)>1 then
 if Kobold1!=null then
 call SetHeroAgi(Kobold1,NewAgility,false)
 call SetHeroStr(Kobold1,NewStrength,false)
 call SetHeroInt(Kobold1,NewIntelligence,false)
 endif
 if Kobold2!=null then
 call SetHeroAgi(Kobold2,NewAgility,false)
 call SetHeroStr(Kobold2,NewStrength,false)
 call SetHeroInt(Kobold2,NewIntelligence,false)
 endif
 if Kobold3!=null then
 call SetHeroAgi(Kobold3,NewAgility,false)
 call SetHeroStr(Kobold3,NewStrength,false)
 call SetHeroInt(Kobold3,NewIntelligence,false)
@@ -65487,69 +67019,79 @@
 call InterruptUnit(GetTriggerUnit())
 call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName(1848659026))
 endif
 return false
 endfunction
 function Register_FingerOfDeath takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function FingerOfDeath_Main))
 set t=null
 endfunction
 function Shapeshift_Expire takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
+if GetTriggerEventId()==EVENT_WIDGET_DEATH then
+call KillUnit(Caster)
+endif
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",Hero,"origin"))
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl",Hero,"origin"))
 call UnitRemoveAbility(Hero,1093687875)
 call UnitRemoveAbility(Hero,1110454358)
 set t=null
 set Hero=null
+set Caster=null
 return false
 endfunction
 function Shapeshift_Delayed takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",Hero,"origin"))
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspirittarget.mdl",Hero,"origin"))
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,18-0.1,false)
+call TriggerRegisterDeathEvent(t,Hero)
 call TriggerAddCondition(t,Condition(function Shapeshift_Expire))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 set t=null
 set Hero=null
+set Caster=null
 return false
 endfunction
 function Shapeshift takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=GetTriggerUnit()
 local unit Caster=CreateUnit(GetOwningPlayer(Hero),1697657174,0,0,0)
 local real Duration=18
 call UnitAddAbility2(Caster,abilityid_shapeshift_bonus)
 call UnitApplyTimedLife(Caster,1112820806,Duration)
 call FadeUnitTimed(Hero,Duration,175)
 call TriggerRegisterTimerEvent(t,0.1,false)
 call TriggerAddCondition(t,Condition(function Shapeshift_Delayed))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 set t=null
 set Hero=null
 endfunction
 function Shapeshift_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_shapeshift and GetUnitTypeId(GetTriggerUnit())==1429221432 then
 call Shapeshift()
 endif
 return false
 endfunction
 function Register_Shapeshift takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Shapeshift_Main))
 set t=null
 endfunction
@@ -65677,32 +67219,33 @@
 call Howl()
 endif
 return false
 endfunction
 function Register_Howl takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Howl_Main))
 set t=null
 endfunction
 function LevelDeath takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_leveldeath)
 local integer TargetLevel=GetHeroLevel(Target)
+local real Damage=GetUnitState(Target,UNIT_STATE_MAX_LIFE)*0.2
 if ModuloInteger(TargetLevel,7-Level)==0 or TargetLevel==25 then
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,275)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,Damage)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DemonBoltImpact\\DemonBoltImpact.mdl",Target,"chest"))
 endif
 set Source=null
 set Target=null
 endfunction
 function LevelDeath_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_leveldeath then
 call LevelDeath()
 endif
 return false
 endfunction
 function Register_LevelDeath takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function LevelDeath_Main))
@@ -65812,31 +67355,31 @@
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer TypeID=(LoadInteger(hash_main,(Cache),(230)))
 local real HP=(LoadReal(hash_main,(Cache),(232)))
 local texttag tt=(LoadTextTagHandle(hash_main,(Cache),(231)))
 local integer Count=GetTriggerEvalCount(t)
 local real NewHP=RMax(HP-Count,0)
 local boolean visible=true
 call SetTextTagText(tt,Devour_GetString(100*NewHP/HP),devour_size)
 call SetTextTagPosUnit(tt,Hero,0)
 if IsUnitVisible(Hero,GetLocalPlayer())==false and IsObserver(GetLocalPlayer())==false then
 set visible=false
 endif
 call SetTextTagVisibility(tt,visible)
 if NewHP==0 then
-call GiveGoldWithEffect(GetOwningPlayer(Hero),Hero,20+20*Level)
+call GiveGoldWithEffect(GetOwningPlayer(Hero),Hero,25*Level)
 endif
 if NewHP==0 or GetTriggerEventId()==EVENT_UNIT_DEATH then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Hero),abilityid_devour,true)
 call UnitRemoveAbility(Hero,abilityid_devourdisabled)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call DestroyTextTag(tt)
 endif
 set t=null
 set Hero=null
 return false
 endfunction
 function Devour takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
@@ -65871,32 +67414,30 @@
 call TriggerAddCondition(t,Condition(function Devour_Iterate))
 call ShowUnit(Target,false)
 call UnitRemoveBuffs(Target,true,true)
 call UnitRemoveAbility(Target,1097167980)
 call UnitDamageTarget(Caster,Target,100000000.00,true,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
 set t=null
 set Hero=null
 set Target=null
 endfunction
 function Devour_Pre takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_devour)
 local integer UnitLevel=GetUnitLevel(Target)
 if(GetOwningPlayer(Target)!=udg_SentPlayers[0]and GetOwningPlayer(Target)!=udg_ScourgePlayers[0])and((Level==1 and UnitLevel>2)or(Level==2 and UnitLevel>4)or(Level==3 and UnitLevel>5)or(Level==4 and UnitLevel>6))then
-call InterruptUnit(Hero)
-call Error(GetOwningPlayer(Hero),GetObjectName(MSG_DEVOUR_INVALID))
 endif
 set Hero=null
 set Target=null
 endfunction
 function Devoure_Finalize takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer id=(LoadInteger(hash_main,(Cache),(34)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Source=null
 return false
 endfunction
@@ -66083,31 +67624,31 @@
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 call UnitRemoveAbility(Target,skewer_slow)
 call UnitRemoveAbility(Target,buffid_skewer)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Target=null
 return false
 endfunction
 function Skewer_Hit takes unit Source,unit Target,integer Level returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call SetUnitPathing(Target,true)
-call TriggerRegisterTimerEvent(t,2,false)
+call TriggerRegisterTimerEvent(t,2.5,false)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Skewer_SlowEnd))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call UnitAddAbility2(Target,skewer_slow)
 call UnitMakeAbilityPermanent(Target,true,skewer_slow)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Target),skewer_slow,false)
 call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",Target,"chest"))
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,70*Level)
 set t=null
 endfunction
 function Skewer_Loop takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit U01=(LoadUnitHandle(hash_main,(Cache),(393)))
@@ -66126,31 +67667,31 @@
 local integer MaxLoops=(LoadInteger(hash_main,(Cache),(12)))
 local location l
 call SetUnitPosition(Source,NewX,NewY)
 call SetUnitFacing(Source,Angle*bj_RADTODEG)
 call SaveReal(hash_main,(Cache),(6),((NewX)*1.0))
 call SaveReal(hash_main,(Cache),(7),((NewY)*1.0))
 if ModuloInteger(GetTriggerEvalCount(t),4)==0 then
 call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",NewX,NewY))
 endif
 if GetTriggerEvalCount(t)==2 then
 call SetUnitAnimationByIndex(Source,3)
 endif
 if U01==null or U02==null or U03==null or U04==null then
 set tt_unit1=Source
 set g=GetAvailableGroup()
-call GroupEnumUnitsInRange(g,NewX,NewY,120,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupEnumUnitsInRange(g,NewX,NewY,125+25,Condition(function GenericCondition_EnemyHeroesExNoImmune))
 if FirstOfGroup(g)!=null then
 if U01!=null then
 call GroupRemoveUnit(g,U01)
 endif
 if U02!=null then
 call GroupRemoveUnit(g,U02)
 endif
 if U03!=null then
 call GroupRemoveUnit(g,U03)
 endif
 if FirstOfGroup(g)!=null then
 if U01==null then
 set U01=FirstOfGroup(g)
 call SetUnitPathing(U01,false)
 call AddHeroState(U01,4404,5)
@@ -66262,33 +67803,34 @@
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function Skewer takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local real TargetX=SafeX2(GetSpellTargetX())
 local real TargetY=SafeY2(GetSpellTargetY())
 local unit Source=GetTriggerUnit()
 local real SourceX=GetUnitX(Source)
 local real SourceY=GetUnitY(Source)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_skewer)
 local real a=AngleBetweenXY(SourceX,SourceY,TargetX,TargetY)*bj_DEGTORAD
-if DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)>825 then
-set TargetX=SafeX2(SourceX+825*Cos(a))
-set TargetY=SafeY2(SourceY+825*Sin(a))
+local real Distance=400+200*Level+25
+if DistanceBetweenXY(SourceX,SourceY,TargetX,TargetY)>Distance then
+set TargetX=SafeX2(SourceX+Distance*Cos(a))
+set TargetY=SafeY2(SourceY+Distance*Sin(a))
 endif
 call SetUnitPathing(Source,false)
 call SetUnitAnimationByIndex(Source,3)
 call SetUnitTimeScale(Source,1.5)
 call TriggerRegisterTimerEvent(t,0.02,true)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Skewer_Loop))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 call SaveUnitHandle(hash_main,(Cache),(393),(null))
 call SaveUnitHandle(hash_main,(Cache),(394),(null))
 call SaveUnitHandle(hash_main,(Cache),(395),(null))
 call SaveUnitHandle(hash_main,(Cache),(396),(null))
 call SaveReal(hash_main,(Cache),(47),((TargetX)*1.0))
 call SaveReal(hash_main,(Cache),(48),((TargetY)*1.0))
@@ -66313,31 +67855,31 @@
 return false
 endfunction
 function Register_Skewer takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Skewer_Main))
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function Skewer_Cast))
 set t=null
 endfunction
 function MysticSnake_DoNothing takes nothing returns nothing
 endfunction
 function MysticSnake_WhichUnits takes nothing returns boolean
 local real d
-if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(mysticsnake_last))==true and IsUnitInGroup(GetFilterUnit(),mysticsnake_group)==false and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(mysticsnake_source))==true then
+if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(mysticsnake_last))==true and IsUnitInGroup(GetFilterUnit(),mysticsnake_group)==false and GenericCondition_IsInvisibleToMe(GetFilterUnit(),GetOwningPlayer(mysticsnake_source))==true then
 set d=DistanceBetweenXY(GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()),GetUnitX(mysticsnake_last),GetUnitY(mysticsnake_last))
 if d<mysticsnake_distance then
 set mysticsnake_unit=GetFilterUnit()
 set mysticsnake_distance=d
 endif
 endif
 return false
 endfunction
 function MysticSnake_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer TargetIndex=(LoadInteger(hash_main,(Cache),(30)))
@@ -66359,35 +67901,35 @@
 set x=GetUnitX(Caster)+15*Cos(a)
 set y=GetUnitY(Caster)+15*Sin(a)
 endif
 call SetUnitX(Caster,x)
 call SetUnitY(Caster,y)
 if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<60 then
 call SetUnitX(Caster,GetUnitX(Target))
 call SetUnitY(Caster,GetUnitY(Target))
 if Source==Target then
 call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+StolenMana)
 call KillUnit(Caster)
 call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
-if IsUnitVisible(Target,GetOwningPlayer(Caster))==true then
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,(40+40*Level)+0.2*DmgCounter*(40+40*Level))
+if GenericCondition_IsDotAInvis(Target)==false or IsUnitVisible(Target,GetOwningPlayer(Caster))==true then
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,(40+40*Level)+0.25*DmgCounter*(40+40*Level))
 set DmgCounter=DmgCounter+1
 if GetUnitState(Target,UNIT_STATE_MANA)>0 then
-set Mana=RMinBJ(GetUnitState(Target,UNIT_STATE_MANA),(10+10*Level)+0.2*ManaCounter*(10+10*Level))
+set Mana=RMinBJ(GetUnitState(Target,UNIT_STATE_MANA),(10+10*Level)+0.25*ManaCounter*(10+10*Level))
 call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-Mana)
 call PlaySoundAtPos(gg_snd_MysticSnakeHit,GetUnitX(Target),GetUnitY(Target))
 set StolenMana=StolenMana+Mana
 set ManaCounter=ManaCounter+1
 endif
 endif
 call SaveReal(hash_main,(Cache),(222),((StolenMana)*1.0))
 call SaveReal(hash_main,(Cache),(224),((DmgCounter)*1.0))
 call SaveReal(hash_main,(Cache),(223),((ManaCounter)*1.0))
 set g=GetAvailableGroup()
 set mysticsnake_unit=null
 set mysticsnake_last=Target
 set mysticsnake_group=AlreadyHit
 set mysticsnake_distance=99999
 set mysticsnake_source=Source
@@ -66689,31 +68231,31 @@
 set tt_unit1=Source
 set snatch_source=Source
 set snatch_level=Level
 call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),725,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function Snatch_StartProjectile)
 call KillGroup(g)
 set g=null
 endfunction
 function Snatch_Execute takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Hero=(LoadUnitHandle(hash_main,(Cache),(14)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
-if GetTriggerEventId()==EVENT_UNIT_DEATH then
+if GetTriggerEventId()==EVENT_WIDGET_DEATH then
 call UnitShareVision(Target,GetOwningPlayer(Hero),false)
 call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl",GetUnitX(Target),GetUnitY(Target)))
 call SetUnitPosition(Hero,GetUnitX(Target),GetUnitY(Target))
 call PauseUnit(Hero,false)
 call ShowUnit(Hero,true)
 call SetUnitPathing(Hero,true)
 call ClearSelectionForPlayer(GetOwningPlayer(Hero))
 call SelectUnitForPlayerSingle(Hero,GetOwningPlayer(Hero))
 call SetUnitInvulnerable(Hero,false)
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(177))))
 call RemoveUnit(Caster)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call Snatch_AOE(Hero,Target,Level)
@@ -66795,31 +68337,31 @@
 call UnitAddAbility2(Caster,abilityid_snatchin)
 call ClearSelectionForPlayer(GetOwningPlayer(Hero))
 call SelectUnitForPlayerSingle(Caster,GetOwningPlayer(Hero))
 call UnitShareVision(Target,GetOwningPlayer(Hero),true)
 call SetUnitInvulnerable(Hero,true)
 call ShowUnit(Hero,false)
 call PauseUnit(Hero,true)
 call SetUnitPathing(Hero,false)
 call DestroyEffect(AddSpecialEffectTarget(fx1,Target,"overhead"))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(fx2,Target,"overhead")))
 call SaveEffectHandle(hash_main,(Cache),(177),(AddSpecialEffectTarget(fx3,Target,"overhead")))
 call SaveInteger(hash_main,(Cache),(5),(GetUnitAbilityLevel(Hero,abilityid_snatch)))
-call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
+call TriggerRegisterDeathEvent(t,Target)
 call TriggerRegisterPlayerUnitEvent(t,GetOwningPlayer(Hero),EVENT_PLAYER_UNIT_SELECTED,Condition(function GenericCondition_True))
 call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_SPELL_EFFECT)
 call TriggerRegisterTimerEvent(t,0.2,true)
 call TriggerAddCondition(t,Condition(function Snatch_Execute))
 call SaveInteger(hash_main,(GetHandleId((Hero))),((4310)),(HERO_STATE_ON))
 set t=null
 set Hero=null
 set Target=null
 endfunction
 function Snatch_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_snatch then
 call Snatch()
 endif
 return false
 endfunction
@@ -66860,31 +68402,31 @@
 endfunction
 function Rage takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Hero=GetTriggerUnit()
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_rage)
 call SetUnitVertexColor(Hero,0,0,0,255)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Hero),abilityid_rageimmunity,false)
 call UnitAddAbility2(Hero,abilityid_rageimmunity)
 call UnitAddAbility2(Hero,abilityid_rageias)
 call SetUnitAbilityLevel(Hero,abilityid_rageias,Level)
 call StickyNapalm_SetSlow(Hero,0,0)
 call SaveUnitHandle(hash_main,(Cache),(14),(Hero))
 call SaveEffectHandle(hash_main,(Cache),(175),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",Hero,"right hand")))
 call SaveEffectHandle(hash_main,(Cache),(176),(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",Hero,"left hand")))
-call TriggerRegisterTimerEvent(t,1.75+0.75*Level,false)
+call TriggerRegisterTimerEvent(t,2+Level,false)
 call TriggerAddCondition(t,Condition(function Rage_Expire))
 set Hero=null
 set t=null
 endfunction
 function Rage_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_rage then
 call Rage()
 endif
 return false
 endfunction
 function Register_Rage takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Rage_Main))
 set t=null
@@ -66961,31 +68503,31 @@
 call Feast_Learned()
 endif
 return false
 endfunction
 function Register_Feast takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function Feast))
 set t=null
 endfunction
 function Heartstopper_Damage takes nothing returns nothing
 local unit Target=GetEnumUnit()
 local unit Source=heartstopper_source
 local real CurrentHP=GetUnitState(Target,UNIT_STATE_LIFE)
 local real MaxHP=GetUnitState(Target,UNIT_STATE_MAX_LIFE)
-local real HPLoss=((0.004+0.002*heartstopper_level)*MaxHP)/2
+local real HPLoss=((0.003+0.003*heartstopper_level)*MaxHP)/2
 if CurrentHP<HPLoss then
 call SetUnitState(Target,UNIT_STATE_LIFE,1)
 call DamageTarget(Source,Target,DAMAGE_PURE,100)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,100)
 call DamageTarget(Source,Target,DAMAGE_PHYSICAL,100)
 else
 call SetUnitState(Target,UNIT_STATE_LIFE,RMax(GetUnitState(Target,UNIT_STATE_LIFE)-HPLoss,1))
 endif
 set Target=null
 set Source=null
 endfunction
 function Heartstopper_WhichUnits takes nothing returns boolean
 return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and GetUnitAbilityLevel(GetFilterUnit(),buffid_heartstopper)>0
 endfunction
 function Heartstopper takes nothing returns boolean
@@ -67012,56 +68554,82 @@
 call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(GetTriggerUnit()))
 set t=null
 endfunction
 function Heartstopper_Main takes nothing returns boolean
 if GetLearnedSkill()==abilityid_heartstopper and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_heartstopper)==1 then
 call Heartstopper_Learned()
 endif
 return false
 endfunction
 function Register_Heartstopper takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function Heartstopper_Main))
 set t=null
 endfunction
-function Trig_Sadist_Conditions takes nothing returns boolean
-if(not(UnitHasBuffBJ(GetKillingUnitBJ(),1110454866)==true))then
-return false
+function Sadist_Restore takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_sadist)
+local real ManaRegen=2*Level
+local real HPRegen=Level
+local integer Factor=(LoadInteger(hash_main,(Cache),(34)))
+if Level==4 then
+set ManaRegen=10
 endif
-return true
+set HPRegen=HPRegen*Factor
+set ManaRegen=ManaRegen*Factor
+call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)+ManaRegen)
+call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)+HPRegen)
+if GetTriggerEvalCount(t)>5 or GetTriggerEventId()==EVENT_WIDGET_DEATH then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+set t=null
+set Source=null
+return false
 endfunction
-function Trig_Sadist_Actions takes nothing returns nothing
-local real mana
-local integer Level
-call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",GetKillingUnit(),"origin"))
-if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and GetUnitAbilityLevel(GetKillingUnit(),1093678640)==4 then
-call SetUnitState(GetKillingUnit(),UNIT_STATE_MANA,GetUnitState(GetKillingUnit(),UNIT_STATE_MANA)+600)
+function Sadist takes nothing returns nothing
+local unit Source=GetKillingUnit()
+local integer Level=GetUnitAbilityLevel(Source,abilityid_sadist)
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\SpiritTouchTarget.mdl",Source,"origin"))
+call TriggerRegisterTimerEvent(t,1,true)
+call TriggerRegisterDeathEvent(t,Source)
+call TriggerAddCondition(t,Condition(function Sadist_Restore))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true then
+call SaveInteger(hash_main,(Cache),(34),(10))
 else
-set Level=GetUnitAbilityLevelSwapped(1093678640,GetKillingUnitBJ())
-set mana=12*Level
-if Level==4 then
-set mana=60
+call SaveInteger(hash_main,(Cache),(34),(1))
 endif
-call SetUnitManaBJ(GetKillingUnitBJ(),(GetUnitStateSwap(UNIT_STATE_MANA,GetKillingUnitBJ())+mana))
+set Source=null
+set t=null
+endfunction
+function Sadist_Main takes nothing returns boolean
+if GetUnitAbilityLevel(GetKillingUnit(),buffid_sadist)>0 then
+call Sadist()
 endif
+return false
 endfunction
-function Sadist takes nothing returns nothing
+function Register_Sadist takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
-call TriggerAddCondition(t,Condition(function Trig_Sadist_Conditions))
-call TriggerAddAction(t,function Trig_Sadist_Actions)
+call TriggerAddCondition(t,Condition(function Sadist_Main))
+set t=null
 endfunction
 function DeathPulse_Process takes nothing returns nothing
 local integer Cache=GetHandleId(GetTriggeringTrigger())
 local unit Source=tt_unit1
 local unit Target=tt_unit2
 local real Damage=(LoadReal(hash_main,(Cache),(20)))
 local real Heal=(LoadReal(hash_main,(Cache),(21)))
 if IsUnitAlly(Target,GetOwningPlayer(Source))then
 call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+Heal)
 else
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Damage)
 endif
 set Source=null
 set Target=null
 endfunction
@@ -67074,39 +68642,39 @@
 endfunction
 function DeathPulse_HitCheck takes nothing returns nothing
 if IsUnitVisible(GetEnumUnit(),GetOwningPlayer(tt_unit1))then
 call DeathPulse_Hit()
 endif
 endfunction
 function DeathPulse_Main takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local group g=GetAvailableGroup()
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_deathpulse)
 local real r
 local real Damage
 local real Heal
 if Level==1 then
 set Damage=75
-set Heal=50
+set Heal=70
 set r=500
 elseif Level==2 then
 set Damage=125
-set Heal=75
+set Heal=90
 set r=500
 elseif Level==3 then
 set Damage=200
-set Heal=100
+set Heal=110
 set r=500
 elseif Level==4 then
 set Damage=275
 set Heal=130
 set r=500
 endif
 set tt_unit1=Hero
 set tt_real1=Damage
 set tt_real2=Heal
 call GroupEnumUnitsInRange(g,GetUnitX(Hero),GetUnitY(Hero),r,Condition(function GenericCondition_AllUnitsWithAncients))
 call GroupRemoveUnit(g,Hero)
 call ForGroup(g,function DeathPulse_HitCheck)
 call KillGroup(g)
 call SetUnitState(Hero,UNIT_STATE_LIFE,GetUnitState(Hero,UNIT_STATE_LIFE)+Heal)
 set Hero=null
@@ -67118,60 +68686,67 @@
 endif
 return false
 endfunction
 function Register_DeathPulse takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function DeathPulse))
 set t=null
 endfunction
 function ReapersScythe_Hit takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local real Factor=(LoadReal(hash_main,(Cache),(680)))
+local integer AghanimLevel=GetUnitAbilityLevel(Source,abilityid_reapersscythe_upgrade)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call DestroyEffect(AddSpecialEffectTarget(reapersscythe_fx,Target,"origin"))
+if AghanimLevel>0 then
+set reaperscythe_hit=true
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,Factor*(GetUnitState(Target,UNIT_STATE_MAX_LIFE)-GetUnitState(Target,UNIT_STATE_LIFE)))
+set reaperscythe_hit=false
+else
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Factor*(GetUnitState(Target,UNIT_STATE_MAX_LIFE)-GetUnitState(Target,UNIT_STATE_LIFE)))
+endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function ReapersScythe takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level1=GetUnitAbilityLevel(Source,abilityid_reapersscythe)
 local integer Level2=GetUnitAbilityLevel(Source,abilityid_reapersscythe_upgrade)
 local real Factor
 if Level1==1 then
 set Factor=0.4
 elseif Level1==2 or Level2==1 then
 set Factor=0.6
 elseif Level1==3 or Level2==2 then
 set Factor=0.9
 elseif Level2==3 then
 set Factor=1.2
 endif
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveReal(hash_main,(Cache),(680),((Factor)*1.0))
-call TriggerRegisterTimerEvent(t,1.0,false)
+call TriggerRegisterTimerEvent(t,1.5,false)
 call TriggerAddCondition(t,Condition(function ReapersScythe_Hit))
 set t=null
 set Source=null
 set Target=null
 endfunction
 function ReapersScythe_Main takes nothing returns boolean
 if(GetSpellAbilityId()==abilityid_reapersscythe or GetSpellAbilityId()==abilityid_reapersscythe_upgrade)and IsBlocked(GetSpellTargetUnit())==false then
 call ReapersScythe()
 endif
 return false
 endfunction
 function Register_ReapersScythe takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function ReapersScythe_Main))
@@ -67224,31 +68799,31 @@
 if GetSpellAbilityId()==abilityid_nerubimpale then
 call NerubImpale()
 endif
 return false
 endfunction
 function Register_NerubImpale takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function NerubImpale_Main))
 call PreloadAbility(abilityid_genericstun)
 set t=null
 endfunction
 function ManaBurn_Start takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
-local real r=GetHeroInt(Target,true)*4
+local real r=GetHeroInt(Target,true)*5
 local integer Burn=IMinBJ(R2I(r),R2I(GetUnitState(Target,UNIT_STATE_MANA)))
 call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)-Burn)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,Burn)
 call TimedLightningToUnit("MBUR",Source,Target,1,1,1,1,0.5)
 call TextTagOnUnitEx("-"+I2S(Burn),3,Target,0.023,82,82,255,255)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl",Target,"chest"))
 set Source=null
 set Target=null
 endfunction
 function ManaBurn_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_manaburn and IsBlocked(GetSpellTargetUnit())==false then
 call ManaBurn_Start()
 endif
 return false
 endfunction
@@ -67286,195 +68861,80 @@
 return false
 endfunction
 function Register_WatcherSuicide takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function WatcherSuicide_Main))
 call PreloadAbility(scarab_silence)
 set t=null
 endfunction
 function SpikedCarapace_Think takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target
 local integer Level=GetUnitAbilityLevel(Source,abilityid_spikedcarapace)
+local group AlreadyHit=(LoadGroupHandle(hash_main,(Cache),(22)))
 if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 if GetEventDamage()>0 and IsPlayerEnemy(GetOwningPlayer(GetEventDamageSource()),GetOwningPlayer(Source))==true then
 if IsRealPlayer(GetOwningPlayer(GetEventDamageSource()))and IsLegitDamage(GetEventDamage())then
-call PreventDamage(Source,GetEventDamage())
 set Target=udg_Hero[GetPlayerId(GetOwningPlayer(GetEventDamageSource()))]
-call UnitRemoveAbility(Source,1093815120)
-call FlushChildHashtable(hash_main,(Cache))
-call CleanTrigger(t)
+if IsUnitInGroup(Target,AlreadyHit)==false then
+call GroupAddUnit(AlreadyHit,Target)
+call PreventDamage(Source,GetEventDamage())
 if IsDead(Target)==false then
 call Stun(Source,Target,0.6*Level)
 call DamageTarget(Source,Target,DAMAGE_PURE,GetEventDamage())
 endif
 endif
 endif
+endif
 else
 call UnitRemoveAbility(Source,1093815120)
+call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function SpikedCarapace takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-call TriggerRegisterTimerEvent(t,4.5,false)
+call TriggerRegisterTimerEvent(t,2.75,false)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DAMAGED)
 call TriggerAddCondition(t,Condition(function SpikedCarapace_Think))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveGroupHandle(hash_main,(Cache),(22),(GetAvailableGroup()))
 call UnitAddAbility2(Source,1093815120)
 set Source=null
 set t=null
 endfunction
 function SpikedCarapace_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_spikedcarapace then
 call SpikedCarapace()
 endif
 return false
 endfunction
 function Register_SpikedCarapace takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function SpikedCarapace_Main))
 set t=null
 endfunction
-function Necromastry_Process takes nothing returns nothing
-local integer Cache=GetHandleId(GetTriggeringTrigger())
-local unit Source=tt_unit2
-local unit Target=tt_unit1
-local integer souls=GetUnitAbilityLevel(Source,abilityid_necromastryhelper)
-local integer maxsouls
-local integer Level=GetUnitAbilityLevel(Source,abilityid_necromastry)
-if Level==1 then
-set maxsouls=12
-elseif Level==2 then
-set maxsouls=20
-elseif Level==3 then
-set maxsouls=28
-else
-set maxsouls=36
-endif
-set maxsouls=maxsouls+1
-if IsUnitType(Target,UNIT_TYPE_HERO)==false then
-set souls=souls+1
-else
-set souls=souls+6
-endif
-set souls=IMinBJ(maxsouls,souls)
-call SetUnitAbilityLevel(Source,abilityid_necromastryhelper,souls)
-call SaveInteger(hash_main,(GetHandleId(Source)),(710),(souls))
-set Source=null
-endfunction
-function Necromastry_Kill takes nothing returns nothing
-local integer souls
-local integer Level
-local integer maxsouls
-local trigger t
-local integer Cache
-local unit Source=GetKillingUnit()
-if GetUnitTypeId(Source)==1697656899 then
-set Source=udg_Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]
-endif
-set souls=GetUnitAbilityLevel(Source,abilityid_necromastryhelper)
-set Level=GetUnitAbilityLevel(Source,abilityid_necromastry)
-if Level==1 then
-set maxsouls=12
-elseif Level==2 then
-set maxsouls=20
-elseif Level==3 then
-set maxsouls=28
-else
-set maxsouls=36
-endif
-if souls<=maxsouls then
-set t=CreateProjectileToUnit(GetTriggerUnit(),Source,1747993426,"Necromastry_Process",500)
-set Cache=GetHandleId(t)
-set t=null
-call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl",GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit())))
-endif
-endfunction
-function Necromastry_Death takes nothing returns nothing
-call SaveInteger(hash_main,(GetHandleId(GetTriggerUnit())),(710),(R2I(GetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastryhelper)*0.5)+1))
-call SetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastryhelper,R2I(GetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastryhelper)*0.5)+1)
-endfunction
-function Necromastry_Main takes nothing returns boolean
-if GetUnitAbilityLevel(GetKillingUnit(),abilityid_necromastry)>0 and IsUnitIllusion(GetTriggerUnit())==false then
-call Necromastry_Kill()
-elseif GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))],abilityid_necromastry)>0 and GetUnitTypeId(GetKillingUnit())==1697656899 then
-call Necromastry_Kill()
-endif
-if GetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastry)>0 and IsUnitIllusion(GetTriggerUnit())==false then
-call Necromastry_Death()
-endif
-return false
-endfunction
-function Necromastry_Command takes nothing returns boolean
-local unit Hero=udg_Hero[GetPlayerId(GetTriggerPlayer())]
-local integer Souls=GetUnitAbilityLevel(Hero,abilityid_necromastryhelper)-1
-local integer MaxSouls=0
-local integer Level=GetUnitAbilityLevel(Hero,abilityid_necromastry)
-if Level==1 then
-set MaxSouls=12
-elseif Level==2 then
-set MaxSouls=20
-elseif Level==3 then
-set MaxSouls=28
-elseif Level==4 then
-set MaxSouls=36
-endif
-set Souls=IMaxBJ(IMinBJ(Souls,MaxSouls),0)
-if GetUnitTypeId(Hero)==1315334514 then
-call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,udg_TextY,10.00,GetObjectName(1848658757)+" "+I2S(Souls)+"/"+I2S(MaxSouls))
-endif
-return false
-endfunction
-function RegisterNecromastry takes nothing returns nothing
-local trigger t=CreateTrigger()
-call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
-call TriggerAddCondition(t,Condition(function Necromastry_Main))
-set t=CreateTrigger()
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[1],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[2],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[3],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[4],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[5],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[1],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[2],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[3],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[4],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[5],"-stats",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[1],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[2],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[3],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[4],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[5],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[1],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[2],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[3],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[4],"-st",true)
-call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[5],"-st",true)
-call TriggerAddCondition(t,Condition(function Necromastry_Command))
-set t=null
-endfunction
 constant function Shadowraze_RawCode1 takes nothing returns integer
 return 1093682521
 endfunction
 constant function Shadowraze_RawCode2 takes nothing returns integer
 return 1093682760
 endfunction
 constant function Shadowraze_RawCode3 takes nothing returns integer
 return 1093682736
 endfunction
 constant function Shadowraze_Area takes nothing returns integer
 return 275
 endfunction
 function Shadowraze_Condition takes nothing returns boolean
 return GetSpellAbilityId()==(1093682521)or GetSpellAbilityId()==(1093682760)or GetSpellAbilityId()==(1093682736)
 endfunction
@@ -67539,60 +68999,65 @@
 endif
 if(GetLearnedSkillBJ()==1093681746)then
 if(GetUnitAbilityLevelSwapped(1093681746,GetTriggerUnit())==1)then
 call UnitAddAbilityBJ(1093682001,GetTriggerUnit())
 endif
 endif
 endfunction
 function NL takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddAction(t,function Trig_Nevermore_Learn_Actions)
 endfunction
 function Trig_Requiem_of_Souls_Conditions takes nothing returns boolean
 return GetSpellAbilityId()==abilityid_requiemofsouls or GetSpellAbilityId()==abilityid_requiemofsouls_upgrade
 endfunction
-function Trig_Requiem_of_Souls_Actions takes nothing returns nothing
-local integer souls=(LoadInteger(hash_main,(GetHandleId(GetTriggerUnit())),(710)))
+function RequiemOfSouls_Cast takes unit UnitVar,integer CurrentSouls returns nothing
+local integer souls=CurrentSouls
 local integer loopcounter
 local integer loopend
-local unit UnitVar=GetTriggerUnit()
 local location PointVar=GetUnitLoc(GetTriggerUnit())
 local location PointVar2
 local integer Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls,GetTriggerUnit())
 if Level==0 then
-set Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls_upgrade,GetTriggerUnit())+1
+return
 endif
 set souls=souls/2
 set loopcounter=1
 set loopend=souls
 loop
 exitwhen loopcounter>loopend
 set PointVar2=PolarProjectionBJ(PointVar,50.00,(I2R(loopcounter)*(360/souls)))
 call CreateNUnitsAtLoc(1,1697656899,GetOwningPlayer(UnitVar),PointVar,bj_UNIT_FACING)
 call UnitAddAbilityBJ(1093683271,GetLastCreatedUnit())
 call SetUnitAbilityLevelSwapped(1093683271,GetLastCreatedUnit(),Level)
 call UnitApplyTimedLifeBJ(2.00,1112820806,GetLastCreatedUnit())
 call IssuePointOrderLoc(GetLastCreatedUnit(),"carrionswarm",PointVar2)
 call SetUnitPathing(GetLastCreatedUnit(),false)
 call SetUnitInvulnerable(GetLastCreatedUnit(),true)
 call UnitAddAbilityBJ(1097625443,GetLastCreatedUnit())
 call RemoveLocation(PointVar2)
 set loopcounter=loopcounter+1
 endloop
 call RemoveLocation(PointVar)
 endfunction
+function Trig_Requiem_of_Souls_Actions takes nothing returns nothing
+local integer souls=(LoadInteger(hash_main,(GetHandleId(GetTriggerUnit())),(710)))
+local unit UnitVar=GetTriggerUnit()
+call RequiemOfSouls_Cast(UnitVar,souls)
+set UnitVar=null
+endfunction
 function Requiem takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Trig_Requiem_of_Souls_Conditions))
 call TriggerAddAction(t,function Trig_Requiem_of_Souls_Actions)
 endfunction
 function Trig_Requiem_of_Souls_Cripple_Conditions takes nothing returns boolean
 return GetSpellAbilityId()==abilityid_requiemofsouls or GetSpellAbilityId()==abilityid_requiemofsouls_upgrade
 endfunction
 function Trig_Requiem_of_Souls_Cripple_Func008002003 takes nothing returns boolean
 if(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==true)then
 return false
 endif
 if(GetUnitAbilityLevelSwapped(1093678162,GetFilterUnit())==1)then
 return false
@@ -67609,65 +69074,65 @@
 if(GetTriggerUnit()==GetFilterUnit())then
 return false
 endif
 if(IsUnitVisible(GetFilterUnit(),GetTriggerPlayer())==false)then
 return false
 endif
 return true
 endfunction
 function Trig_Cripple700 takes nothing returns nothing
 local unit UnitVar=GetTriggerUnit()
 local location PointVar=GetUnitLoc(UnitVar)
 local integer Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls,GetTriggerUnit())
 if Level==0 then
 set Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls_upgrade,GetTriggerUnit())
 endif
-call CreateNUnitsAtLoc(1,1697656899,GetOwningPlayer(UnitVar),PointVar,bj_UNIT_FACING)
+call CreateNUnitsAtLoc(1,1697656899,GetOwningPlayer(GetEnumUnit()),PointVar,bj_UNIT_FACING)
 call UnitAddAbilityBJ(1093683272,GetLastCreatedUnit())
 call SetUnitAbilityLevelSwapped(1093683272,GetLastCreatedUnit(),Level)
 call UnitApplyTimedLifeBJ(2.00,1112820806,GetLastCreatedUnit())
 call IssueTargetOrder(GetLastCreatedUnit(),"cripple",GetEnumUnit())
 call SetUnitPathing(GetLastCreatedUnit(),false)
 call SetUnitInvulnerable(GetLastCreatedUnit(),true)
 call UnitAddAbilityBJ(1097625443,GetLastCreatedUnit())
 call RemoveLocation(PointVar)
 endfunction
 function Trig_Cripple400 takes nothing returns nothing
 local unit UnitVar=GetTriggerUnit()
 local location PointVar=GetUnitLoc(UnitVar)
 local integer Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls,GetTriggerUnit())
 if Level==0 then
 set Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls_upgrade,GetTriggerUnit())
 endif
-call CreateNUnitsAtLoc(1,1697656899,GetOwningPlayer(UnitVar),PointVar,bj_UNIT_FACING)
+call CreateNUnitsAtLoc(1,1697656899,GetOwningPlayer(GetEnumUnit()),PointVar,bj_UNIT_FACING)
 call UnitAddAbilityBJ(1093683272,GetLastCreatedUnit())
 call SetUnitAbilityLevelSwapped(1093683272,GetLastCreatedUnit(),Level)
 call UnitApplyTimedLifeBJ(2.00,1112820806,GetLastCreatedUnit())
 call IssueTargetOrder(GetLastCreatedUnit(),"cripple",GetEnumUnit())
 call SetUnitPathing(GetLastCreatedUnit(),false)
 call SetUnitInvulnerable(GetLastCreatedUnit(),true)
 call UnitAddAbilityBJ(1097625443,GetLastCreatedUnit())
 call RemoveLocation(PointVar)
 endfunction
 function Trig_Cripple200 takes nothing returns nothing
 local unit UnitVar=GetTriggerUnit()
 local location PointVar=GetUnitLoc(UnitVar)
 local integer Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls,GetTriggerUnit())
 if Level==0 then
 set Level=GetUnitAbilityLevelSwapped(abilityid_requiemofsouls_upgrade,GetTriggerUnit())
 endif
-call CreateNUnitsAtLoc(1,1697656899,GetOwningPlayer(UnitVar),PointVar,bj_UNIT_FACING)
+call CreateNUnitsAtLoc(1,1697656899,GetOwningPlayer(GetEnumUnit()),PointVar,bj_UNIT_FACING)
 call UnitAddAbilityBJ(1093683272,GetLastCreatedUnit())
 call SetUnitAbilityLevelSwapped(1093683272,GetLastCreatedUnit(),Level)
 call UnitApplyTimedLifeBJ(2.00,1112820806,GetLastCreatedUnit())
 call IssueTargetOrder(GetLastCreatedUnit(),"cripple",GetEnumUnit())
 call SetUnitPathing(GetLastCreatedUnit(),false)
 call SetUnitInvulnerable(GetLastCreatedUnit(),true)
 call UnitAddAbilityBJ(1097625443,GetLastCreatedUnit())
 call RemoveLocation(PointVar)
 endfunction
 function Trig_Requiem_of_Souls_Cripple_Actions takes nothing returns nothing
 local location PointVar=GetUnitLoc(GetTriggerUnit())
 local unit UnitVar=GetTriggerUnit()
 local group GroupVar
 set GroupVar=GetAvailableGroup()
 call GroupEnumUnitsInRangeOfLoc(GroupVar,PointVar,700,Condition(function Trig_Requiem_of_Souls_Cripple_Func008002003))
@@ -67677,83 +69142,203 @@
 call GroupEnumUnitsInRangeOfLoc(GroupVar,PointVar,400,Condition(function Trig_Requiem_of_Souls_Cripple_Func008002003))
 call ForGroup(GroupVar,function Trig_Cripple400)
 call KillGroup(GroupVar)
 set GroupVar=GetAvailableGroup()
 call GroupEnumUnitsInRangeOfLoc(GroupVar,PointVar,200,Condition(function Trig_Requiem_of_Souls_Cripple_Func008002003))
 call ForGroup(GroupVar,function Trig_Cripple200)
 call KillGroup(GroupVar)
 call RemoveLocation(PointVar)
 endfunction
 function RequiemEffect takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Trig_Requiem_of_Souls_Cripple_Conditions))
 call TriggerAddAction(t,function Trig_Requiem_of_Souls_Cripple_Actions)
 endfunction
-function Trig_Void_Conditions takes nothing returns boolean
-return GetSpellAbilityId()==1093677640
-endfunction
-function Trig_Void_Actions takes nothing returns nothing
-local unit Caster
-if(IsDay()==false)then
-set Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),1697656901,GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()),bj_UNIT_FACING)
-call UnitAddAbility2(Caster,1093677650)
-call IssueTargetOrder(Caster,"slow",GetSpellTargetUnit())
+function Necromastry_Process takes nothing returns nothing
+local integer Cache=GetHandleId(GetTriggeringTrigger())
+local unit Source=tt_unit2
+local unit Target=tt_unit1
+local integer souls=GetUnitAbilityLevel(Source,abilityid_necromastryhelper)
+local integer maxsouls
+local integer Level=GetUnitAbilityLevel(Source,abilityid_necromastry)
+if Level==1 then
+set maxsouls=12
+elseif Level==2 then
+set maxsouls=20
+elseif Level==3 then
+set maxsouls=28
 else
-set Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),1697656901,GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()),bj_UNIT_FACING)
-call UnitAddAbility2(Caster,1093748785)
-call IssueTargetOrder(Caster,"slow",GetSpellTargetUnit())
+set maxsouls=36
 endif
-endfunction
-function NSVoid takes nothing returns nothing
-local trigger t=CreateTrigger()
-call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
-call TriggerAddCondition(t,Condition(function Trig_Void_Conditions))
-call TriggerAddAction(t,function Trig_Void_Actions)
-endfunction
-function Fear_End takes nothing returns boolean
-local trigger t=GetTriggeringTrigger()
-local integer Cache=GetHandleId(t)
-local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
-local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
-call ResetUnitAnimation(Source)
-call RemoveUnit(Caster)
-call FlushChildHashtable(hash_main,(Cache))
-call CleanTrigger(t)
-set Source=null
-set Caster=null
-set t=null
-return false
-endfunction
-function Fear_Start takes nothing returns nothing
-local unit Source=GetTriggerUnit()
-local unit Caster=CreateUnit(GetOwningPlayer(Source),unitid_fear,GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
-local trigger t=CreateTrigger()
-local integer Cache=GetHandleId(t)
-call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
-call TriggerAddCondition(t,Condition(function Fear_End))
-call SaveUnitHandle(hash_main,(Cache),(2),(Source))
-call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
-call SetUnitVertexColorBJ(Caster,0,0,0,75)
-call SetUnitAnimation(Caster,"spell third")
+set maxsouls=maxsouls+1
+if IsUnitType(Target,UNIT_TYPE_HERO)==false then
+set souls=souls+1
+else
+set souls=souls+12
+endif
+set souls=IMinBJ(maxsouls,souls)
+call SetUnitAbilityLevel(Source,abilityid_necromastryhelper,souls)
+call SaveInteger(hash_main,(GetHandleId(Source)),(710),(souls))
 set Source=null
-set Caster=null
-set t=null
 endfunction
-function Fear_Main takes nothing returns boolean
-if GetSpellAbilityId()==abilityid_fear and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_fear)<5 then
-call Fear_Start()
+function Necromastry_Kill takes nothing returns nothing
+local integer souls
+local integer Level
+local integer maxsouls
+local trigger t
+local integer Cache
+local unit Source=GetKillingUnit()
+if GetUnitTypeId(Source)==1697656899 then
+set Source=udg_Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))]
+endif
+set souls=GetUnitAbilityLevel(Source,abilityid_necromastryhelper)
+set Level=GetUnitAbilityLevel(Source,abilityid_necromastry)
+if Level==1 then
+set maxsouls=12
+elseif Level==2 then
+set maxsouls=20
+elseif Level==3 then
+set maxsouls=28
+else
+set maxsouls=36
+endif
+if souls<=maxsouls then
+set t=CreateProjectileToUnit(GetTriggerUnit(),Source,1747993426,"Necromastry_Process",500)
+set Cache=GetHandleId(t)
+set t=null
+call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl",GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit())))
+endif
+endfunction
+function Necromastry_Death takes nothing returns nothing
+local integer SoulCount=(LoadInteger(hash_main,(GetHandleId(GetTriggerUnit())),(710)))
+call SaveInteger(hash_main,(GetHandleId(GetTriggerUnit())),(710),(R2I(GetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastryhelper)*0.5)+1))
+call SetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastryhelper,R2I(GetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastryhelper)*0.5)+1)
+call RequiemOfSouls_Cast(GetTriggerUnit(),SoulCount-(LoadInteger(hash_main,(GetHandleId(GetTriggerUnit())),(710))))
+endfunction
+function Necromastry_Main takes nothing returns boolean
+if GetUnitAbilityLevel(GetKillingUnit(),abilityid_necromastry)>0 and IsUnitIllusion(GetTriggerUnit())==false then
+call Necromastry_Kill()
+elseif GetUnitAbilityLevel(udg_Hero[GetPlayerId(GetOwningPlayer(GetKillingUnit()))],abilityid_necromastry)>0 and GetUnitTypeId(GetKillingUnit())==1697656899 then
+call Necromastry_Kill()
+endif
+if GetUnitAbilityLevel(GetTriggerUnit(),abilityid_necromastry)>0 and IsUnitIllusion(GetTriggerUnit())==false then
+call Necromastry_Death()
+endif
+return false
+endfunction
+function Necromastry_Command takes nothing returns boolean
+local unit Hero=udg_Hero[GetPlayerId(GetTriggerPlayer())]
+local integer Souls=GetUnitAbilityLevel(Hero,abilityid_necromastryhelper)-1
+local integer MaxSouls=0
+local integer Level=GetUnitAbilityLevel(Hero,abilityid_necromastry)
+if Level==1 then
+set MaxSouls=12
+elseif Level==2 then
+set MaxSouls=20
+elseif Level==3 then
+set MaxSouls=28
+elseif Level==4 then
+set MaxSouls=36
+endif
+set Souls=IMaxBJ(IMinBJ(Souls,MaxSouls),0)
+if GetUnitTypeId(Hero)==1315334514 then
+call DisplayTimedTextToPlayer(GetTriggerPlayer(),0,udg_TextY,10.00,GetObjectName(1848658757)+" "+I2S(Souls)+"/"+I2S(MaxSouls))
+endif
+return false
+endfunction
+function RegisterNecromastry takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
+call TriggerAddCondition(t,Condition(function Necromastry_Main))
+set t=CreateTrigger()
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[1],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[2],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[3],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[4],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[5],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[1],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[2],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[3],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[4],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[5],"-stats",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[1],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[2],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[3],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[4],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_SentPlayers[5],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[1],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[2],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[3],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[4],"-st",true)
+call TriggerRegisterPlayerChatEvent(t,udg_ScourgePlayers[5],"-st",true)
+call TriggerAddCondition(t,Condition(function Necromastry_Command))
+set t=null
+endfunction
+function Trig_Void_Conditions takes nothing returns boolean
+return GetSpellAbilityId()==1093677640
+endfunction
+function Trig_Void_Actions takes nothing returns nothing
+local unit Caster
+if(IsDay()==false)then
+set Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),1697656901,GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()),bj_UNIT_FACING)
+call UnitAddAbility2(Caster,1093677650)
+call IssueTargetOrder(Caster,"slow",GetSpellTargetUnit())
+else
+set Caster=CreateUnit(GetOwningPlayer(GetTriggerUnit()),1697656901,GetUnitX(GetSpellTargetUnit()),GetUnitY(GetSpellTargetUnit()),bj_UNIT_FACING)
+call UnitAddAbility2(Caster,1093748785)
+call IssueTargetOrder(Caster,"slow",GetSpellTargetUnit())
+endif
+endfunction
+function NSVoid takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function Trig_Void_Conditions))
+call TriggerAddAction(t,function Trig_Void_Actions)
+endfunction
+function Fear_End takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+call ResetUnitAnimation(Source)
+call RemoveUnit(Caster)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set Source=null
+set Caster=null
+set t=null
+return false
+endfunction
+function Fear_Start takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local unit Caster=CreateUnit(GetOwningPlayer(Source),unitid_fear,GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
+call TriggerAddCondition(t,Condition(function Fear_End))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+call SetUnitVertexColorBJ(Caster,0,0,0,75)
+call SetUnitAnimation(Caster,"spell third")
+set Source=null
+set Caster=null
+set t=null
+endfunction
+function Fear_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_fear and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_fear)<5 then
+call Fear_Start()
 endif
 return false
 endfunction
 function Register_Fear takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function Fear_Main))
 set t=null
 endfunction
 function Trig_NS_Learn_Abilities_Conditions takes nothing returns boolean
 return(GetLearnedSkill()==1093679158 or GetLearnedSkill()==1093679173)and IsUnitIllusion(GetTriggerUnit())==false
 endfunction
 function NS_Update takes nothing returns boolean
 local integer Cache=GetHandleId(GetTriggeringTrigger())
 local unit NightStalker=(LoadUnitHandle(hash_main,(Cache),(304)))
@@ -68020,31 +69605,31 @@
 if GetLearnedSkill()==abilityid_blur and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_blur)==1 then
 call Blur_Initialize()
 endif
 return false
 endfunction
 function Register_Blur takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function Blur_Learned))
 set t=null
 endfunction
 function Cage_Ensnare takes nothing returns nothing
 local unit Caster
 if IsUnitInGroup(GetEnumUnit(),tt_group1)==false then
 call GroupAddUnit(tt_group1,GetEnumUnit())
-set Caster=CreateUnit(GetOwningPlayer(cage_source),1697656901,GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
+set Caster=CreateUnit(GetOwningPlayer(GetEnumUnit()),1697656901,GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit()),0)
 call UnitAddAbility2(Caster,abilityid_cagehelper)
 call SetUnitAbilityLevel(Caster,abilityid_cagehelper,GetUnitAbilityLevel(cage_source,abilityid_cage))
 call IssueTargetOrder(Caster,"ensnare",GetEnumUnit())
 call DamageTarget(cage_source,GetEnumUnit(),DAMAGE_MAGICAL,100)
 endif
 set Caster=null
 endfunction
 function Cage_Interval takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer i
 local group g=(LoadGroupHandle(hash_main,(Cache),(22)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local group tempg=GetAvailableGroup()
@@ -68072,87 +69657,94 @@
 set UnitVar=null
 return false
 endfunction
 function Cage_Main takes nothing returns nothing
 local integer i=1
 local location l=GetSpellTargetLoc()
 local real srcx=GetLocationX(l)
 local real srcy=GetLocationY(l)
 local real x
 local real y
 local integer num=16
 local string fx="Abilities\\Spells\\Undead\\Graveyard\\GraveMarker.mdl"
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local group g=GetAvailableGroup()
-call TimedReveal(GetOwningPlayer(GetTriggerUnit()),settings_cageduration,srcx,srcy,settings_cageradius+500)
 call PlaySoundAtPos(gg_snd_Cage,srcx,srcy)
 call TriggerRegisterTimerEvent(t,0.1,true)
 call TriggerAddCondition(t,Condition(function Cage_Interval))
 call SaveGroupHandle(hash_main,(Cache),(22),(g))
 call SaveUnitHandle(hash_main,(Cache),(221),(GetTriggerUnit()))
 call SaveReal(hash_main,(Cache),(6),((srcx)*1.0))
 call SaveReal(hash_main,(Cache),(7),((srcy)*1.0))
-call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),1969711215,srcx,srcy,0)
 loop
 exitwhen i>num
 set x=srcx+settings_cageradius*Cos(i*360/num*bj_DEGTORAD)
 set y=srcy+settings_cageradius*Sin(i*360/num*bj_DEGTORAD)
 call SaveEffectHandle(hash_main,(Cache),(2700+i),(AddSpecialEffect(fx,x,y)))
 if i==1 or i==5 or i==9 or i==13 then
 set x=srcx+275*Cos(i*360/num*bj_DEGTORAD)
 set y=srcy+275*Sin(i*360/num*bj_DEGTORAD)
-call CreateCorpse(GetOwningPlayer(GetTriggerUnit()),1969711215,x,y,0)
 endif
 set i=i+1
 endloop
 set t=null
 set g=null
 endfunction
 function Cage takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_cage then
 call Cage_Main()
 endif
 return false
 endfunction
 function Register_Cage takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Cage))
 set t=null
 endfunction
 function DarkRift_Effect takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(393)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer Max=90
-local integer Count=GetTriggerEvalCount(t)
+local integer Count=(LoadInteger(hash_main,(Cache),(34)))
+if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()==abilityid_portal_disabled then
+call KillUnit(Caster)
+call CleanTrigger(t)
+call FlushChildHashtable(hash_main,(Cache))
+else
+set Count=Count+1
+call SaveInteger(hash_main,(Cache),(34),(Count))
+endif
 if Level==1 then
 set Max=160
 elseif Level==2 then
 set Max=120
 endif
 call SetUnitX(Caster,GetUnitX(Source))
 call SetUnitY(Caster,GetUnitY(Source))
 if Count>Max then
 call KillUnit(Caster)
 call CleanTrigger(t)
 call FlushChildHashtable(hash_main,(Cache))
 elseif Count>30 then
+call UnitRemoveAbility(Caster,1097625443)
 call ShowUnit(Caster,true)
+call UnitAddAbility2(Caster,1097625443)
 endif
 set t=null
 set Caster=null
 set Source=null
 return false
 endfunction
 function Portal_Teleport takes nothing returns nothing
 call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
 call AddHeroState(GetEnumUnit(),4406,1)
 call SetUnitPosition(GetEnumUnit(),tt_real1,tt_real2)
 call PanCameraToTimedForPlayer(GetOwningPlayer(GetEnumUnit()),tt_real1,tt_real2,0)
 call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
 endfunction
 function Portal_Action takes unit Source,unit Target returns nothing
 local group g=GetAvailableGroup()
@@ -68161,34 +69753,57 @@
 set tt_real1=GetUnitX(Target)
 set tt_real2=GetUnitY(Target)
 set tt_unit1=Source
 call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),475,Condition(function GenericCondition_AlliedHeroesEx))
 call ForGroup(g,function Portal_Teleport)
 call KillGroup(g)
 set g=null
 endfunction
 function Portal_Main takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 if GetTriggerEventId()==EVENT_UNIT_DEATH or Target==null or IsDead(Target)then
+call CleanTrigger(t)
+call FlushChildHashtable(hash_main,(Cache))
+call UnitRemoveType(Target,UNIT_TYPE_PEON)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal_disabled,false)
 call Error(GetOwningPlayer(Source),GetObjectName(MSG_PORTAL_1))
 elseif Source==null or IsDead(Source)then
+call CleanTrigger(t)
+call FlushChildHashtable(hash_main,(Cache))
+call UnitRemoveType(Target,UNIT_TYPE_PEON)
 call Error(GetOwningPlayer(Source),GetObjectName(MSG_PORTAL_2))
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal_disabled,false)
+elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
+if GetSpellAbilityId()==abilityid_portal_disabled then
+call CleanTrigger(t)
+call FlushChildHashtable(hash_main,(Cache))
+call UnitRemoveType(Target,UNIT_TYPE_PEON)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal_disabled,false)
+endif
 else
+call CleanTrigger(t)
+call FlushChildHashtable(hash_main,(Cache))
+call UnitRemoveType(Target,UNIT_TYPE_PEON)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal,true)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal_disabled,false)
 call Portal_Action(Source,Target)
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function Portal_FindTarget takes nothing returns boolean
 local real d
 if IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))==false or GetUnitAbilityLevel(GetFilterUnit(),1093678162)>0 or GetOwningPlayer(GetFilterUnit())==Player(PLAYER_NEUTRAL_PASSIVE)then
 return false
 endif
 if IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)or(tt_int1>0 and IsCreep(GetFilterUnit()))then
 set d=DistanceBetweenXY(tt_real2,tt_real3,GetUnitX(GetFilterUnit()),GetUnitY(GetFilterUnit()))
 if d<tt_real1 then
@@ -68221,39 +69836,45 @@
 endfunction
 function Portal_CreatePreEffect takes unit Source returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=GetSpellTargetUnit()
 local real x
 local real y
 local unit u
 if Target==null then
 set Target=Portal_GetNewTarget(Source)
 endif
 if Target==null then
 call Error(GetOwningPlayer(Source),GetObjectName(MSG_PORTAL_3))
 return
 endif
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal,false)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_portal_disabled,true)
+call UnitAddAbility2(Source,abilityid_portal_disabled)
 call TriggerRegisterTimerEvent(t,6-GetUnitAbilityLevel(Source,abilityid_portal),false)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
+call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Portal_Main))
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget("war3mapImported\\DarkHands.mdl",Target,"overhead")))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call UnitAddType(Target,UNIT_TYPE_PEON)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,.03,true)
+call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function DarkRift_Effect))
 call SaveInteger(hash_main,(Cache),(5),(GetUnitAbilityLevel(Source,abilityid_portal)))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 set u=CreateUnit(GetOwningPlayer(Source),1747990840,GetUnitX(Source),GetUnitY(Source),0)
 call SaveUnitHandle(hash_main,(Cache),(393),(u))
 call ShowUnit(u,false)
 set t=null
 set Target=null
 endfunction
 function Portal_CheckTarget takes nothing returns nothing
 local unit Target=GetSpellTargetUnit()
 local unit Hero=GetTriggerUnit()
 if Target!=null then
 if IsUnitAlly(Target,GetOwningPlayer(Hero))==false then
 call InterruptUnit(Hero)
@@ -68371,57 +69992,65 @@
 call SaveBoolean(hash_main,(Cache),(308),(false))
 set t=null
 endfunction
 function Expulsion takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_expulsion then
 call Expulsion_Main()
 endif
 return false
 endfunction
 function Register_Expulsion takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Expulsion))
 set t=null
 endfunction
+function Firestorm_Heal takes nothing returns nothing
+endfunction
 function Firestorm_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
-if GetSpellAbilityId()==abilityid_firestorm then
-call KillUnit(Caster)
+local group g=GetAvailableGroup()
+set tt_unit1=Source
+set firestorm_amount=GetUnitAbilityLevel(Source,abilityid_firestorm)*10+10
+call GroupEnumUnitsInRange(g,GetUnitX(Caster),GetUnitY(Caster),475,Condition(function GenericCondition_AlliedUnitsEx))
+call ForGroup(g,function Firestorm_Heal)
+call KillGroup(g)
+if GetTriggerEvalCount(t)==5 then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Caster=null
 return false
 endfunction
 function Firestorm_Main takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local real x=GetSpellTargetX()
 local real y=GetSpellTargetY()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_firestorm)
 local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,x,y,0)
-call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_ENDCAST)
 call TriggerAddCondition(t,Condition(function Firestorm_End))
+call TriggerRegisterTimerEvent(t,1,true)
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
-call UnitAddAbility2(Caster,abilityid_firestormhelper)
-call SetUnitAbilityLevel(Caster,abilityid_firestormhelper,Level)
+call UnitAddAbility2(Caster,abilityid_firestormhelper2)
+call SetUnitAbilityLevel(Caster,abilityid_firestormhelper2,Level)
 call IssuePointOrder(Caster,"rainoffire",x,y)
 set Source=null
 set Caster=null
 endfunction
 function Firestorm takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_firestorm then
 call Firestorm_Main()
 endif
 return false
 endfunction
 function Register_Firestorm takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Firestorm))
 set t=null
@@ -68793,59 +70422,228 @@
 function CorpseCollector_Learn takes nothing returns boolean
 if GetLearnedSkill()==abilityid_corpsecollector and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_corpsecollector)==1 and IsUnitIllusion(GetTriggerUnit())==false then
 call CorpseCollector_Learned()
 endif
 return false
 endfunction
 function Register_CorpseCollector takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function CorpseCollector))
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerAddCondition(t,Condition(function CorpseCollector_Learn))
 set t=null
 endfunction
+function SummonShade_AI takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local real x=(LoadReal(hash_main,(Cache),(6)))
+local real y=(LoadReal(hash_main,(Cache),(7)))
+local unit Caster2
+if GetTriggerEventId()==EVENT_UNIT_SPELL_FINISH then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call KillUnit(Caster)
+call UnitApplyTimedLife(Caster,1112820806,0.1)
+elseif IsDead(Caster)then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+else
+call SaveReal(hash_main,(Cache),(6),((GetUnitX(Caster))*1.0))
+call SaveReal(hash_main,(Cache),(7),((GetUnitY(Caster))*1.0))
+if x!=GetUnitX(Caster)or y!=GetUnitY(Caster)then
+call UnitRemoveAbility(Caster,1093815348)
+else
+call UnitAddAbility(Caster,1093815348)
+endif
+endif
+return false
+endfunction
+function SummonShade_WhichUnits takes nothing returns boolean
+return GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(summonshade_source)and GetUnitTypeId(GetFilterUnit())==unitid_summonshade
+endfunction
+function SummonShade takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Caster=CreateUnit(GetOwningPlayer(Source),unitid_summonshade,GetUnitX(Source)+100,GetUnitY(Source)+100,0)
+local group g
+local integer Level=GetUnitAbilityLevel(Source,abilityid_summonshade)
+local real Time
+local unit Oldest
+local unit Temp
+call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_SPELL_FINISH)
+call TriggerRegisterTimerEvent(t,0.1,true)
+call TriggerAddCondition(t,Condition(function SummonShade_AI))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+call SaveReal(hash_main,(Cache),(6),((GetUnitX(Caster))*1.0))
+call SaveReal(hash_main,(Cache),(7),((GetUnitY(Caster))*1.0))
+call UnitAddAbility(Caster,1093815348)
+call SetUnitAbilityLevel(Caster,1093815349,GetUnitAbilityLevel(Source,1093815350))
+call SaveReal(hash_main,(GetHandleId(Caster)),(34),(((TimerGetElapsed(udg_GameTimer)))*1.0))
+set summonshade_source=Source
+set g=GetAvailableGroup()
+call GroupEnumUnitsInRange(g,0,0,99999,Condition(function SummonShade_WhichUnits))
+if CountUnitsInGroup(g)>Level+1 then
+set Temp=FirstOfGroup(g)
+set Time=(LoadReal(hash_main,(GetHandleId(Temp)),(34)))
+set Oldest=Temp
+call GroupRemoveUnit(g,Temp)
+loop
+exitwhen Temp==null
+if Time>(LoadReal(hash_main,(GetHandleId(Temp)),(34)))then
+set Time=(LoadReal(hash_main,(GetHandleId(Temp)),(34)))
+set Oldest=Temp
+endif
+set Temp=FirstOfGroup(g)
+call GroupRemoveUnit(g,Temp)
+endloop
+call KillUnit(Oldest)
+endif
+call KillGroup(g)
+set g=null
+set Caster=null
+set Source=null
+set t=null
+endfunction
+function SummonShade_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_summonshade then
+call SummonShade()
+endif
+return false
+endfunction
+function Register_SummonShade takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function SummonShade_Main))
+endfunction
+function DiffusionAura_Decrement takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local integer Bonus=(LoadInteger(hash_main,(Cache),(34)))
+call SaveInteger(hash_main,(GetHandleId(Source)),(783),((LoadInteger(hash_main,(GetHandleId(Source)),(783)))-Bonus))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set Source=null
+set t=null
+return false
+endfunction
+function DiffusionAura_Death takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Dying=GetTriggerUnit()
+local integer Level=GetUnitAbilityLevel(Source,abilityid_diffusionaura)
+local integer Bonus
+local integer Stack
+if IsUnitInRange(Source,Dying,900+25)and IsDead(Source)==false and IsUnitAlly(Source,GetOwningPlayer(Dying))==false and GetUnitTypeId(Dying)!=unitid_tombstone_zombie and IsUnitIllusion(Dying)==false and IsGlobalHeroDummy(GetUnitTypeId(Dying))==false and GetUnitAbilityLevel(Dying,1093678162)==0 then
+set Stack=(LoadInteger(hash_main,(GetHandleId(Source)),(783)))
+if IsUnitType(Dying,UNIT_TYPE_HERO)==true then
+set Bonus=30
+else
+set Bonus=5
+endif
+set Stack=Stack+Bonus
+call SaveInteger(hash_main,(GetHandleId(Source)),(783),(Stack))
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,25+Level*5,false)
+call TriggerRegisterDeathEvent(t,Source)
+call TriggerAddCondition(t,Condition(function DiffusionAura_Decrement))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveInteger(hash_main,(Cache),(34),(Bonus))
+endif
+set t=null
+set Source=null
+set Dying=null
+return false
+endfunction
+function DiffusionAura_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local integer Stack=(LoadInteger(hash_main,(GetHandleId(Source)),(783)))
+local integer LastBonus=(LoadInteger(hash_main,(Cache),(238)))
+if LastBonus!=Stack then
+call AddDamageBonus(Source,Stack)
+call SaveInteger(hash_main,(Cache),(238),(Stack))
+endif
+set t=null
+set Source=null
+return false
+endfunction
+function DiffusionAura takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_DEATH)
+call TriggerAddCondition(t,Condition(function DiffusionAura_Death))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0.25,true)
+call TriggerAddCondition(t,Condition(function DiffusionAura_Loop))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+set Source=null
+set t=null
+endfunction
+function DiffusionAura_Main takes nothing returns boolean
+if GetLearnedSkill()==abilityid_diffusionaura and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_diffusionaura)==1 then
+call DiffusionAura()
+endif
+return false
+endfunction
+function Register_DiffusionAura takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerAddCondition(t,Condition(function DiffusionAura_Main))
+set t=null
+endfunction
 function Trig_Rot_Conditions takes nothing returns boolean
 return GetUnitAbilityLevel(GetTriggerUnit(),1093678667)>0
 endfunction
 function Trig_Rot_Actions takes nothing returns nothing
 if(GetIssuedOrderId()==String2OrderIdBJ("immolation"))then
 call UnitAddAbility2(GetTriggerUnit(),1093681498)
 endif
 if(GetIssuedOrderId()==String2OrderIdBJ("unimmolation"))then
 call UnitRemoveAbility(GetTriggerUnit(),1093681498)
 endif
 endfunction
 function Rot takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterRealUnitEvent(t,EVENT_PLAYER_UNIT_ISSUED_ORDER)
 call TriggerAddCondition(t,Condition(function Trig_Rot_Conditions))
 call TriggerAddAction(t,function Trig_Rot_Actions)
 endfunction
 function FleshHeap_Process takes nothing returns nothing
 local integer Cache=GetHandleId(GetEnumUnit())
 if GetTriggerUnit()!=GetEnumUnit()then
 call SaveInteger(hash_main,(Cache),(672),((LoadInteger(hash_main,(Cache),(672)))+1))
 endif
 endfunction
 function FleshHeal_IsPudge takes nothing returns boolean
 return GetUnitTypeId(GetFilterUnit())==1429221446 and IsUnitIllusion(GetFilterUnit())==false and IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))==true
 endfunction
 function FleshHeap_Tracker takes nothing returns boolean
 local group g
-if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and GetUnitTypeId(GetTriggerUnit())!=1211117642 and IsUnitIllusion(GetTriggerUnit())==false then
+if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsGlobalHeroDummy(GetUnitTypeId(GetTriggerUnit()))==false and IsUnitIllusion(GetTriggerUnit())==false then
 set g=GetAvailableGroup()
 call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),475,Condition(function FleshHeal_IsPudge))
 if GetUnitTypeId(GetKillingUnit())==1429221446 then
 call GroupAddUnit(g,GetKillingUnit())
 endif
 call ForGroup(g,function FleshHeap_Process)
 call KillGroup(g)
 set g=null
 endif
 return false
 endfunction
 function Pudge_Reappear takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
@@ -69187,45 +70985,76 @@
 function Trig_Nether_Ward_Conditions takes nothing returns boolean
 if(GetUnitTypeId(GetSummonedUnit())==1865429068)then
 return true
 endif
 if(GetUnitTypeId(GetSummonedUnit())==1865429069)then
 return true
 endif
 if(GetUnitTypeId(GetSummonedUnit())==1865429070)then
 return true
 endif
 if(GetUnitTypeId(GetSummonedUnit())==1865429071)then
 return true
 endif
 return false
 endfunction
+function NetherWard_Drain takes nothing returns nothing
+endfunction
+function NetherWard_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+local integer Level=(LoadInteger(hash_main,(Cache),(5)))
+local group g
+if GetTriggerEventId()==EVENT_WIDGET_DEATH then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+else
+set g=GetAvailableGroup()
+set tt_unit1=Caster
+call GroupEnumUnitsInRange(g,GetUnitX(Caster),GetUnitY(Caster),400+300*4+25,Condition(function GenericCondition_EnemyUnitsEx))
+call ForGroup(g,function NetherWard_Drain)
+call KillGroup(g)
+set g=null
+endif
+set t=null
+set Caster=null
+return false
+endfunction
 function Trig_Nether_Ward_Actions takes nothing returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Caster=GetSummonedUnit()
+call TriggerRegisterDeathEvent(t,Caster)
+call TriggerRegisterTimerEvent(t,1,true)
+call TriggerAddCondition(t,Condition(function NetherWard_Loop))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+call SaveInteger(hash_main,(Cache),(5),(GetUnitAbilityLevel(GetSummoningUnit(),1093679428)))
 call SetUnitAbilityLevelSwapped(1093679188,GetSummonedUnit(),GetUnitAbilityLevelSwapped(1093679428,GetSummoningUnit()))
 call SetUnitAbilityLevelSwapped(1093681990,GetSummonedUnit(),GetUnitAbilityLevelSwapped(1093679428,GetSummoningUnit()))
 call IssueImmediateOrderBJ(GetSummonedUnit(),"manaflareon")
 endfunction
 function NW takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
 call TriggerAddCondition(t,Condition(function Trig_Nether_Ward_Conditions))
 call TriggerAddAction(t,function Trig_Nether_Ward_Actions)
 endfunction
 function Voltage_Slow takes unit Source,unit Target returns nothing
-local real min=20+20*voltage_level
-local real max=35+35*voltage_level
-local real damage=min+(max-min)*voltage_distance/700
+local real base=20+40*voltage_level
+local real extra=70+30*voltage_level
+local real damage=(base+extra*voltage_distance/700)*0.5
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,damage)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl",Target,"chest"))
 endfunction
 function Voltage_Damage takes nothing returns nothing
 local unit Target=GetEnumUnit()
 local group AlreadyDamaged=voltage_group
 local unit Source=voltage_unit
 if IsUnitInGroup(Target,AlreadyDamaged)==false then
 call GroupAddUnit(AlreadyDamaged,Target)
 call Voltage_Slow(Source,Target)
 endif
 set Target=null
 set AlreadyDamaged=null
 set Source=null
 endfunction
@@ -69496,31 +71325,31 @@
 call TriggerRegisterTimerEvent(t,18,false)
 call TriggerAddCondition(t,Condition(function StaticLink_DelayedRemove_Finished))
 endfunction
 function StaticLink_Follow takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local lightning Light=(LoadLightningHandle(hash_main,(Cache),(196)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer Count=GetTriggerEvalCount(t)
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 call MoveLightning(Light,true,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
 call SetUnitX(Caster,GetUnitX(Target))
 call SetUnitY(Caster,GetUnitY(Target))
-if DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))>700 or GetTriggerEventId()==EVENT_UNIT_DEATH or IsUnitVisible(Target,GetOwningPlayer(Source))==false then
+if DistanceBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))>700 or GetTriggerEventId()==EVENT_UNIT_DEATH then
 call DestroyLightning(Light)
 call KillUnit(Caster)
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call StaticLink_DelayedRemove(Source,Target,GetTriggerUnit())
 else
 call StaticLink_DelayedRemove(Source,Target,null)
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif Count>160 then
 call DestroyLightning(Light)
 call KillUnit(Caster)
 call StaticLink_DelayedRemove(Source,Target,null)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
@@ -69759,81 +71588,82 @@
 call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),525,Condition(function EyeOfTheStorm_FindBest))
 endif
 call KillGroup(g)
 if eyeofthestrom_bestunit!=null then
 call EyeOfTheStorm_Nuke(Source,Caster,eyeofthestrom_bestunit,Level)
 endif
 set g=null
 endfunction
 function EyeOfTheStorm_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer Count=GetTriggerEvalCount(t)
-local integer Interval
+local real Interval
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call EyeOfTheStorm_Clear(Cache)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 if GetTriggerUnit()==Source then
 call KillUnit(Caster)
 endif
 else
 if GetUnitAbilityLevel(Source,abilityid_eyeofthestorm_upgrade)>0 then
 if Level==1 then
-set Interval=14
+set Interval=0.65
 elseif Level==2 then
-set Interval=12
+set Interval=0.55
 else
-set Interval=10
+set Interval=0.45
 endif
 else
 if Level==1 then
-set Interval=17
+set Interval=0.75
 elseif Level==2 then
-set Interval=15
+set Interval=0.65
 else
-set Interval=12
+set Interval=0.55
 endif
 endif
-if ModuloInteger(Count,Interval)==0 or Count==1 then
+set Interval=Interval/eyeofthestorm_tickrate
+if ModuloInteger(Count,R2I(Interval))==0 or Count==1 then
 set eyeofthestorm_cache=Cache
 call EyeOfTheStorm_Hit(Source,Caster,Level)
 endif
 call SetUnitX(Caster,GetUnitX(Source))
 call SetUnitY(Caster,GetUnitY(Source))
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function EyeOfTheStorm takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_eyeofthestorm)
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Caster=CreateUnit(GetOwningPlayer(Source),unitid_eyeofthestorm,GetUnitX(Source),GetUnitY(Source),0)
 if Level==0 then
 set Level=GetUnitAbilityLevel(Source,abilityid_eyeofthestorm_upgrade)
 endif
 call UnitApplyTimedLife(Caster,1112820806,15+5*Level)
 call SetUnitAbilityLevel(Caster,1093747786,Level)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerRegisterUnitEvent(t,Caster,EVENT_UNIT_DEATH)
-call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerRegisterTimerEvent(t,eyeofthestorm_tickrate,true)
 call TriggerAddCondition(t,Condition(function EyeOfTheStorm_Move))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 set Source=null
 set t=null
 endfunction
 function EyeOfTheStorm_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_eyeofthestorm or GetSpellAbilityId()==abilityid_eyeofthestorm_upgrade then
 call EyeOfTheStorm()
 endif
 return false
 endfunction
 function Register_EyeOfTheStorm takes nothing returns nothing
 local trigger t=CreateTrigger()
@@ -70464,36 +72294,36 @@
 constant function Desolate_AbilityId takes nothing returns integer
 return 1093682776
 endfunction
 function Desolate_Condition takes nothing returns boolean
 return IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and GetUnitAbilityLevel(GetAttacker(),(1093682776))>0
 endfunction
 function Desolate_AnyNearAlliedUnits takes nothing returns boolean
 return IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>1 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false
 endfunction
 function Desolate_Action takes nothing returns nothing
 local unit Attacker=GetAttacker()
 local unit Defender=GetTriggerUnit()
 local group GroupVar=GetAvailableGroup()
 local boolexpr CondVar=Condition(function Desolate_AnyNearAlliedUnits)
 local integer Cache
-call GroupEnumUnitsInRange(GroupVar,GetUnitX(Defender),GetUnitY(Defender),350,CondVar)
+call GroupEnumUnitsInRange(GroupVar,GetUnitX(Defender),GetUnitY(Defender),325+25,CondVar)
 call GroupRemoveUnit(GroupVar,Defender)
 if FirstOfGroup(GroupVar)==null then
 set Cache=GetHandleId(Attacker)
 if((LoadInteger(hash_main,(GetHandleId((Attacker))),((4275))))==HERO_STATE_ON)==false then
-call UnitDamageTarget(Attacker,Defender,10+10*GetUnitAbilityLevel(Attacker,(1093682776)),true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_DIVINE,WEAPON_TYPE_WHOKNOWS)
+call UnitDamageTarget(Attacker,Defender,5+15*GetUnitAbilityLevel(Attacker,(1093682776)),true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_DIVINE,WEAPON_TYPE_WHOKNOWS)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl",Defender,"overhead"))
 call AddHeroState(Attacker,4275,0.3)
 endif
 endif
 call KillGroup(GroupVar)
 endfunction
 function RegisterDesolate takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
 call TriggerAddCondition(t,Condition(function Desolate_Condition))
 call TriggerAddAction(t,function Desolate_Action)
 endfunction
 function Dispersion_Damage takes nothing returns nothing
 local real d=DistanceBetweenUnits(GetTriggerUnit(),GetEnumUnit())-25
 local real factor=0
@@ -70703,31 +72533,31 @@
 endfunction
 function Reality_KillOtherImages takes nothing returns nothing
 call KillUnit(GetEnumUnit())
 endfunction
 function Reality_Action takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local unit Target=Reality_FindTarget()
 local unit Enemy=(LoadUnitHandle(hash_main,(GetHandleId(Hero)),(7100+GetHandleId(Target))))
 local real TargetX
 local real TargetY
 if Target==null then
 call Error(GetOwningPlayer(Hero),GetObjectName(MSG_HAUNT_1))
 else
 set TargetX=GetUnitX(Target)
 set TargetY=GetUnitY(Target)
-call ForGroup(reality_killgroup,function Reality_KillOtherImages)
+call KillUnit(Target)
 call KillGroup(reality_killgroup)
 set reality_killgroup=null
 call SetUnitX(Hero,TargetX)
 call SetUnitY(Hero,TargetY)
 if DistanceBetweenXY(GetCameraEyePositionX(),GetCameraEyePositionY(),GetUnitX(Target),GetUnitY(Target))>1400 then
 call PanCameraToTimedForPlayer(GetOwningPlayer(Hero),TargetX,TargetY,0)
 endif
 call IssueTargetOrder(Hero,"attack",Enemy)
 endif
 endfunction
 function Reality_CheckValid takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local unit Target=Reality_FindTarget()
 if Target==null then
 call InterruptUnit(Hero)
@@ -70740,31 +72570,30 @@
 call TriggerAddCondition(t,Condition(function Reality_Condition))
 call TriggerAddAction(t,function Reality_Action)
 endfunction
 function EmpoweringHaste_Update takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_empoweringhaste)
 local integer Bonus
 local integer LastBonus
 if Level>0 and IsDead(Source)==false then
 set Bonus=R2I(GetUnitMoveSpeed(Source)*0.04*Level)
 set LastBonus=(LoadInteger(hash_main,(Cache),(238)))
 if Bonus!=LastBonus then
 call SaveInteger(hash_main,(Cache),(238),(Bonus))
-call AddDamageBonus(Source,Bonus)
 endif
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function EmpoweringHaste takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,0.5,true)
 call TriggerAddCondition(t,Condition(function EmpoweringHaste_Update))
 call SaveUnitHandle(hash_main,(Cache),(2),(GetTriggerUnit()))
 call SaveInteger(hash_main,(Cache),(238),(0))
 set t=null
 endfunction
@@ -70851,35 +72680,35 @@
 if Override then
 endif
 if Level>0 then
 set Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
 call UnitAddAbility2(Caster,greaterbash_stun)
 call SetUnitAbilityLevel(Caster,greaterbash_stun,Level)
 if IssueTargetOrder(Caster,"thunderbolt",Target)then
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",Source,"weapon"))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveReal(hash_main,(Cache),(13),((Angle)*1.0))
 call SaveReal(hash_main,(Cache),(193),((2)*1.0))
 call SaveBoolean(hash_main,(Cache),(698),(External))
-call SaveInteger(hash_main,(Cache),(12),(75+20*Level))
+call SaveInteger(hash_main,(Cache),(12),(80+20*Level))
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerRegisterTimerEvent(t,0.01,true)
 call TriggerAddCondition(t,Condition(function Greaterbash_Move))
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,25*Level)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,GetUnitMoveSpeed(Source)*0.1*Level)
 call Spiritbash_AddMS(Source)
 endif
 if External==false then
 call AddHeroState(Source,4276,1.5)
 endif
 endif
 set t=null
 set Source=null
 set Target=null
 set Caster=null
 endfunction
 function Greaterbash_Main takes nothing returns boolean
 if GetUnitAbilityLevel(GetAttacker(),abilityid_greaterbash)>0 and IsUnitIllusion(GetAttacker())==false and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(GetTriggerUnit())!=1848651852 and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))and GetRandomInt(1,100)<=17 and((LoadInteger(hash_main,(GetHandleId((GetAttacker()))),((4276))))==HERO_STATE_ON)==false then
 call Greaterbash(GetAttacker(),GetTriggerUnit(),false,false)
 endif
@@ -70925,31 +72754,31 @@
 set charge_best=null
 set charge_distance=999999
 set charge_old=Target
 call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),4000,Condition(function ChargeOfDarkness_WhichTarget))
 call KillGroup(g)
 set g=null
 return charge_best
 endfunction
 function ChargeOfDarkness_Loop takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
-local real rate=(350+75*Level)*0.02
+local real rate=(550+50*Level)*0.02
 local real LastX=(LoadReal(hash_main,(Cache),(23)))
 local real LastY=(LoadReal(hash_main,(Cache),(24)))
 local real x
 local real y
 local real a
 local real d
 local string fx
 local group g
 if(GetTriggerEventId()==EVENT_WIDGET_DEATH and GetTriggerUnit()==Source)or GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER or IsReallyStunned(Source)or(LoadReal(hash_main,(Cache),(442)))<(TimerGetElapsed(udg_GameTimer))then
 if(GetTriggerEventId()!=EVENT_UNIT_ISSUED_ORDER and GetTriggerEventId()!=EVENT_UNIT_ISSUED_POINT_ORDER and GetTriggerEventId()!=EVENT_UNIT_ISSUED_TARGET_ORDER)or((GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER)and ChargeOfDarkness_BadOrder(GetIssuedOrderId())==false)then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(175))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(176))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(177))))
 call UnitRemoveAbility(Target,chargeofdarkness_icon)
 call UnitRemoveAbility(Target,chargeofdarkness_icon_buffid)
@@ -71046,31 +72875,30 @@
 call SetUnitX(Caster,GetUnitX(Target))
 call SetUnitY(Caster,GetUnitY(Target))
 call SaveReal(hash_main,(Cache),(23),((x)*1.0))
 call SaveReal(hash_main,(Cache),(24),((y)*1.0))
 set charge_group=(LoadGroupHandle(hash_main,(Cache),(187)))
 set g=GetAvailableGroup()
 set tt_unit1=Source
 set charge_source=Source
 call GroupEnumUnitsInRange(g,x,y,325,Condition(function GenericCondition_EnemyUnitsEx))
 call GroupRemoveUnit(g,Target)
 set charge_level=Level
 call ForGroup(g,function ChargeOfDarkness_Bash)
 call KillGroup(g)
 set g=null
 if d<3000 and GetUnitAbilityLevel(Target,chargeofdarkness_icon)==0 then
-call UnitAddAbility2(Target,chargeofdarkness_icon)
 endif
 endif
 endif
 set t=null
 set Source=null
 set Target=null
 set Caster=null
 return false
 endfunction
 function ChargeOfDarkness takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local unit Caster=CreateUnit(GetOwningPlayer(Source),1865429073,GetUnitX(Target),GetUnitY(Target),0)
@@ -71391,134 +73219,98 @@
 call TriggerAddCondition(t,Condition(function Reflection_Image_AI))
 call SaveUnitHandle(hash_main,(Cache),(335),(Image))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call UnitAddAbility(Image,1097625443)
 call SetUnitPosition(Image,GetUnitX(Target)+100,GetUnitY(Target)+100)
 call IssueTargetOrder(Image,"attack",Target)
 call SetUnitMoveSpeed(Image,522)
 call SetUnitVertexColorBJ(Image,100,100,100,60)
 endif
 set t=null
 set Target=null
 set Source=null
 set Caster=null
 return false
 endfunction
-function Reflection_Add takes nothing returns nothing
+function Reflection takes nothing returns nothing
 local unit Source=GetTriggerUnit()
-local unit Target=GetEnumUnit()
+local unit Target=GetSpellTargetUnit()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_reflection)
 local integer id
 local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Source),GetUnitY(Source),0)
 local trigger t
 local integer Cache
-if Level==1 then
-set id=reflection_slow_1
-elseif Level==2 then
-set id=reflection_slow_2
-elseif Level==3 then
-set id=reflection_slow_3
-elseif Level==4 then
-set id=reflection_slow_4
-endif
-call SetPlayerAbilityAvailable(GetOwningPlayer(Target),id,false)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),reflection_slow_4,false)
 if IsRealSummoned(Target)==false then
-call AddTimedAbilityAndRemove(Target,id,1,4,reflection_slow_buffid)
+call AddTimedAbilityAndRemove(Target,reflection_slow_4,1,5,reflection_slow_buffid)
 endif
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
 call TriggerAddCondition(t,Condition(function Reflection_ImageEnters))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
 call UnitAddAbility2(Caster,reflection_image)
 call SetUnitAbilityLevel(Caster,reflection_image,Level)
 call IssueTargetOrderById(Caster,852274,Target)
 set Source=null
 set Target=null
 set Caster=null
 set t=null
-endfunction
-function Reflection takes nothing returns nothing
-local unit Source=GetTriggerUnit()
-local group g=GetAvailableGroup()
-local real x=GetSpellTargetX()
-local real y=GetSpellTargetY()
-call TimedReveal(GetOwningPlayer(Source),2.5,x,y,400)
-call GroupEnumUnitsInRange(g,x,y,375,Condition(function GenericCondition_EnemyUnits))
-call ForGroup(g,function Reflection_Add)
-call KillGroup(g)
-call DestroyEffect(AddSpecialEffect(reflection_fx,x,y))
-call PlaySoundAtPos(gg_snd_ZigguratUpgrade,x,y)
-set g=null
+call PlaySoundAtPos(gg_snd_ZigguratUpgrade,GetUnitX(Target),GetUnitY(Target))
 set Source=null
 endfunction
 function Reflection_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_reflection then
 call Reflection()
 endif
 return false
 endfunction
 function Register_Reflection takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Reflection_Main))
 set t=null
 endfunction
 function MetaMorph_ImageControl takes nothing returns nothing
 local unit Source=GetSummoningUnit()
 local unit Image=GetSummonedUnit()
 call SelectUnitAddForPlayer(Image,GetOwningPlayer(Source))
+call UnitAddAbility(Image,metamorph_in)
+call UnitRemoveAbility(Image,metamorph_in)
+call SetUnitState(Image,UNIT_STATE_LIFE,GetUnitState(Image,UNIT_STATE_MAX_LIFE))
+call SetUnitPosition(Image,GetUnitX(Image),GetUnitY(Image))
 set Source=null
 set Image=null
 endfunction
 function MetaMorph_ImageEnter takes nothing returns boolean
 if GetUnitAbilityLevel(GetSummonedUnit(),metamorph_buffid)>0 then
 call MetaMorph_ImageControl()
 endif
 return false
 endfunction
-function MetaMorph_Delay_Image takes nothing returns boolean
-local trigger t=GetTriggeringTrigger()
-local integer Cache=GetHandleId(t)
-local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+function MetaMorph_Delay takes nothing returns nothing
+local unit Source=GetTriggerUnit()
 local unit Caster
 local integer Level=GetUnitAbilityLevel(Source,abilityid_metamorph)
-if Level>1 then
 set Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Source),GetUnitY(Source),0)
 call UnitAddAbility2(Caster,metamorph_image)
 call SetUnitAbilityLevel(Caster,metamorph_image,Level)
 call IssueTargetOrderById(Caster,852274,Source)
-if Level==4 then
-call IssueTargetOrderById(Caster,852274,Source)
-endif
-endif
-call FlushChildHashtable(hash_main,(Cache))
-call CleanTrigger(t)
-set t=null
 set Source=null
 set Caster=null
-return false
-endfunction
-function MetaMorph_Delay takes nothing returns nothing
-local trigger t=CreateTrigger()
-local integer Cache=GetHandleId(t)
-call TriggerRegisterTimerEvent(t,0.2,false)
-call TriggerAddCondition(t,Condition(function MetaMorph_Delay_Image))
-call SaveUnitHandle(hash_main,(Cache),(2),(GetTriggerUnit()))
-set t=null
 endfunction
 function MetaMorph_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_metamorph and GetUnitTypeId(GetTriggerUnit())==1164277353 then
 call MetaMorph_Delay()
 endif
 return false
 endfunction
 function Register_MetaMorph takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function MetaMorph_Main))
 set t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
 call TriggerAddCondition(t,Condition(function MetaMorph_ImageEnter))
 set t=null
@@ -71756,43 +73548,43 @@
 function Ravage takes nothing returns nothing
 local unit Hero=GetTriggerUnit()
 local unit Caster
 local integer i=1
 local real x1=GetUnitX(Hero)
 local real y1=GetUnitY(Hero)
 local real x2
 local real y2
 local real Damage
 local real Duration
 local integer Level=GetUnitAbilityLevel(Hero,abilityid_ravage)
 local group g=GetAvailableGroup()
 local real d=500
 if Level==1 then
 set Duration=1.5
-set Damage=250
+set Damage=200
 elseif Level==2 then
 set Duration=1.8
-set Damage=350
+set Damage=325
 elseif Level==3 then
 set Duration=2.25
 set Damage=450
 endif
 loop
 exitwhen i>16
 set x2=x1+(d+Level*100)*Cos(22.5*i*bj_DEGTORAD)
 set y2=y1+(d+Level*100)*Sin(22.5*i*bj_DEGTORAD)
-call Impale(Hero,null,Damage,Duration,0.52,x1,y1,x2,y2,250,g,false,900)
+call Impale(Hero,null,Damage,Duration,0.52,x1,y1,x2,y2,250,g,false,775)
 set i=i+1
 endloop
 call Ravage_KillGroup(g)
 set Hero=null
 set Caster=null
 set g=null
 endfunction
 function Ravage_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_ravage then
 call Ravage()
 endif
 return false
 endfunction
 function Register_Ravage takes nothing returns nothing
 local trigger t=CreateTrigger()
@@ -71893,31 +73685,31 @@
 endfunction
 function Healing_Condition takes nothing returns boolean
 return GetSpellAbilityId()==(1093685074)
 endfunction
 function Healing_WhichUnitsToDamage takes nothing returns boolean
 return IsUnitEnemy(GetFilterUnit(),GetOwningPlayer(udg_TempUnit))and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0
 endfunction
 function Healing_Damage takes nothing returns nothing
 call DamageTarget(udg_TempUnit,GetEnumUnit(),DAMAGE_PHYSICAL,udg_TempReal)
 endfunction
 function Healing_DamageUnitsAround takes unit Source,unit Target,real Damage returns nothing
 local group GroupVar=GetAvailableGroup()
 local boolexpr CondVar=Condition(function Healing_WhichUnitsToDamage)
 set udg_TempUnit=Source
 set udg_TempReal=Damage
-call GroupEnumUnitsInRange(GroupVar,GetUnitX(Target),GetUnitY(Target),195,CondVar)
+call GroupEnumUnitsInRange(GroupVar,GetUnitX(Target),GetUnitY(Target),185+25,CondVar)
 call ForGroup(GroupVar,function Healing_Damage)
 call KillGroup(GroupVar)
 endfunction
 function Healing_WhichUnits takes nothing returns boolean
 return IsUnitInGroup(GetFilterUnit(),udg_TempGroup)==false and IsUnitAlly(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and IsUnitVisible(GetFilterUnit(),GetOwningPlayer(GetTriggerUnit()))and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsDead(GetFilterUnit())==false and GetFilterUnit()!=shadowwave_source
 endfunction
 function Healing_FindBestTarget takes group AlreadyHealed,unit LastHealed,unit Source,unit OriginalTargetreturns returns unit
 local group GroupVar=GetAvailableGroup()
 local boolexpr CondVar=Condition(function Healing_WhichUnits)
 local unit Potential=null
 local unit CurrentUnit
 set udg_TempGroup=AlreadyHealed
 set udg_TempUnit=Source
 call GroupEnumUnitsInRange(GroupVar,GetUnitX(LastHealed),GetUnitY(LastHealed),500,CondVar)
 set CurrentUnit=FirstOfGroup(GroupVar)
@@ -72144,31 +73936,31 @@
 call SetUnitAbilityLevel(Target,abilityid_weave_positive,tt_int1+1)
 endif
 endif
 endif
 set Target=null
 endfunction
 function Weave_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local group g=(LoadGroupHandle(hash_main,(Cache),(22)))
 local player p=(LoadPlayerHandle(hash_main,(Cache),(54)))
 local integer Count=GetTriggerEvalCount(t)
 local integer Duration=(LoadInteger(hash_main,(Cache),(188)))
 set tt_player1=p
 set tt_int1=Count
-if Count==Duration then
+if Count>=Duration/weave_interval then
 call ForGroup(g,function Weave_ClearArmor)
 call KillGroup(g)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 call ForGroup(g,function Weave_ModifyArmor)
 endif
 set t=null
 set g=null
 set p=null
 return false
 endfunction
 function Weave_AddFX takes nothing returns nothing
 call TimedLifeUnitEffect(tt_string1,GetEnumUnit(),"chest",3)
 call TimedLifeUnitEffect(tt_string1,GetEnumUnit(),"chest",3)
@@ -72197,31 +73989,31 @@
 set tt_string1=""
 set tt_int1=Duration
 set a=255
 set tt_string1="Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl"
 call SetUnitVertexColor(Caster,255,255,255,a)
 call UnitApplyTimedLife(Caster,1112820806,5)
 if Scepter then
 call GroupEnumUnitsInRange(g,x,y,800,Condition(function GenericCondition_AllHeroes))
 else
 call GroupEnumUnitsInRange(g,x,y,600,Condition(function GenericCondition_AllHeroes))
 endif
 call ForGroup(g,function Weave_AddFX)
 call SaveGroupHandle(hash_main,(Cache),(22),(g))
 call SavePlayerHandle(hash_main,(Cache),(54),(GetOwningPlayer(Hero)))
 call SaveInteger(hash_main,(Cache),(188),(Duration))
-call TriggerRegisterTimerEvent(t,1,true)
+call TriggerRegisterTimerEvent(t,weave_interval,true)
 call TriggerAddCondition(t,Condition(function Weave_Iterate))
 call TriggerEvaluate(t)
 set Hero=null
 set l=null
 set g=null
 set t=null
 endfunction
 function Weave_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_weave or GetSpellAbilityId()==abilityid_weaveupgrade then
 call Weave()
 endif
 return false
 endfunction
 function Register_Weave takes nothing returns nothing
 local trigger t=CreateTrigger()
@@ -72401,51 +74193,56 @@
 endif
 endfunction
 function VenomousGale_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local group g=(LoadGroupHandle(hash_main,(Cache),(22)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local real Angle=(LoadReal(hash_main,(Cache),(13)))
 local group TempGroup
 local real x
 local real y
 local real safex
 local real safey
 local real Rate=30
+local unit DummyVision
 set venomousgale_level=Level
 if GetTriggerEvalCount(t)>28 then
 call KillGroup(g)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call ShowUnit(Caster,false)
 call KillUnit(Caster)
 else
 set x=GetUnitX(Caster)
 set y=GetUnitY(Caster)
 set TempGroup=GetAvailableGroup()
 set tt_group1=g
 set tt_unit1=Caster
 set tt_real1=Level*70
 call GroupEnumUnitsInRange(TempGroup,x,y,150,Condition(function GenericCondition_EnemyUnitsWithAncientsEx))
 call ForGroup(TempGroup,function VenomousGale_Damage)
 call KillGroup(TempGroup)
 set safex=SafeX(x+Rate*Cos(Angle*bj_DEGTORAD))
 set safey=SafeY(y+Rate*Sin(Angle*bj_DEGTORAD))
 call SetUnitX(Caster,safex)
 call SetUnitY(Caster,safey)
+if ModuloInteger(GetTriggerEvalCount(t),3)==0 then
+set DummyVision=CreateUnit(GetOwningPlayer(Caster),1865429335,safex,safey,0)
+call KillUnit(DummyVision)
+endif
 endif
 set t=null
 set g=null
 set TempGroup=null
 set Caster=null
 return false
 endfunction
 function VenomousGale takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local group g=GetAvailableGroup()
 local unit Hero=GetTriggerUnit()
 local location l=GetSpellTargetLoc()
 local real x1=GetUnitX(Hero)
 local real y1=GetUnitY(Hero)
@@ -72517,50 +74314,51 @@
 call TriggerAddCondition(t,Condition(function PoisonNova_Main))
 set t=null
 endfunction
 function Nethertoxin_Expire takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 call AddDamageBonus(Source,0)
 call SaveInteger(hash_main,(GetHandleId((Source))),((4277)),(HERO_STATE_OFF))
 set t=null
 set Source=null
 return false
 endfunction
 function Nethertoxin takes unit Attacker,unit Target returns nothing
 local real Percent=100*GetUnitState(Target,UNIT_STATE_LIFE)/GetUnitState(Target,UNIT_STATE_MAX_LIFE)
-local integer Bonus=2*GetUnitAbilityLevel(Attacker,abilityid_nethertoxin)
+local real Bonus=2.5*GetUnitAbilityLevel(Attacker,abilityid_nethertoxin)
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
+local integer FinalBonus
 call SaveInteger(hash_main,(GetHandleId((Attacker))),((4277)),(HERO_STATE_ON))
 call TriggerRegisterTimerEvent(t,0.35,false)
 call TriggerAddCondition(t,Condition(function Nethertoxin_Expire))
 call SaveUnitHandle(hash_main,(Cache),(2),(Attacker))
 if IsUnitType(Target,UNIT_TYPE_HERO)==false then
 set Bonus=Bonus/2
 endif
 if Percent>80 then
-call AddDamageBonus(Attacker,Bonus)
+call AddDamageBonus(Attacker,R2I(Bonus))
 elseif Percent>60 then
-call AddDamageBonus(Attacker,Bonus*2)
+call AddDamageBonus(Attacker,R2I(Bonus*2))
 elseif Percent>40 then
-call AddDamageBonus(Attacker,Bonus*2*2)
+call AddDamageBonus(Attacker,R2I(Bonus*2*2))
 elseif Percent>20 then
-call AddDamageBonus(Attacker,Bonus*2*2*2)
+call AddDamageBonus(Attacker,R2I(Bonus*2*2*2))
 else
-call AddDamageBonus(Attacker,Bonus*2*2*2*2)
+call AddDamageBonus(Attacker,R2I(Bonus*2*2*2*2))
 endif
 set t=null
 endfunction
 function Nethertoxin_Main takes nothing returns boolean
 if GetTriggerEventId()==EVENT_PLAYER_UNIT_SPELL_CAST then
 if GetSpellAbilityId()==1093679446 and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_nethertoxin)>0 then
 call Nethertoxin(GetTriggerUnit(),GetSpellTargetUnit())
 endif
 else
 if GetUnitAbilityLevel(GetAttacker(),abilityid_nethertoxin)>0 and IsUnitIllusion(GetAttacker())==false and IsUnitEnemy(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==true and((LoadInteger(hash_main,(GetHandleId((GetAttacker()))),((4277))))==HERO_STATE_ON)==false then
 call Nethertoxin(GetAttacker(),GetTriggerUnit())
 endif
 endif
 return false
 endfunction
@@ -72591,35 +74389,35 @@
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,5+5*Level)
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function CorrosiveSkin takes nothing returns nothing
 local trigger t
 local integer Cache
 local unit Source=GetTriggerUnit()
 local unit Target=GetAttacker()
 local real EndTime=(LoadReal(hash_main,(GetHandleId(Target)),(684)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_corrosiveskin)
 if EndTime>(TimerGetElapsed(udg_GameTimer))then
-call SaveReal(hash_main,(GetHandleId(Target)),(684),(((TimerGetElapsed(udg_GameTimer))+3)*1.0))
+call SaveReal(hash_main,(GetHandleId(Target)),(684),(((TimerGetElapsed(udg_GameTimer))+corrosiveskin_duration)*1.0))
 else
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
-call SaveReal(hash_main,(GetHandleId(Target)),(684),(((TimerGetElapsed(udg_GameTimer))+3)*1.0))
+call SaveReal(hash_main,(GetHandleId(Target)),(684),(((TimerGetElapsed(udg_GameTimer))+corrosiveskin_duration)*1.0))
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterDeathEvent(t,Target)
 call TriggerAddCondition(t,Condition(function CorrosiveSkin_Loop))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 if IsRealSummoned(Target)==false then
 if Level==1 then
 call UnitAddAbility2(Target,corrosiveskin_1)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Target),corrosiveskin_1,false)
 elseif Level==2 then
 call UnitAddAbility2(Target,corrosiveskin_2)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Target),corrosiveskin_2,false)
 elseif Level==3 then
 call UnitAddAbility2(Target,corrosiveskin_3)
@@ -73349,31 +75147,31 @@
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 call SoulAssumption_AdjustLevel(Source,(LoadReal(hash_main,(GetHandleId(Source)),(443))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Source=null
 return false
 endfunction
 function SoulAssumption_Nuke takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local integer Level=(LoadInteger(hash_main,(GetHandleId((Source))),(450)))
 local trigger t=CreateProjectileToUnit(Source,Target,1747993157,"SoulAssumption_Process",1000)
 local integer Cache=GetHandleId(t)
-call SaveReal(hash_main,(Cache),(20),((20+Level*60)*1.0))
+call SaveReal(hash_main,(Cache),(20),((20+Level*65)*1.0))
 call DestroyEffect(AddSpecialEffectTarget(soulassumption_fx,Source,"chest"))
 call SaveReal(hash_main,(GetHandleId(Source)),(443),((0)*1.0))
 call SoulAssumption_AdjustLevel(Source,0)
 call AddHeroState(Source,2484,4)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerAddCondition(t,Condition(function SoulAssumption_UpdateVisuals))
 call TriggerRegisterTimerEvent(t,4,false)
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 set Source=null
 set Target=null
 set t=null
 endfunction
 function SoulAssumption_Decrease takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
@@ -73647,51 +75445,51 @@
 call PreloadAbility((1093683769))
 endfunction
 function ShadowWord_Damage takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_shadowword)
 if GetTriggerEvalCount(t)>9 or GetTriggerEventId()==EVENT_UNIT_DEATH then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call UnitRemoveAbility(Target,abilityid_shadowword_damagebuff)
 call UnitRemoveAbility(Target,buffid_shadowword_damage)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,Level*10)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,Level*10+5)
 endif
 set Source=null
 set Target=null
 set t=null
 return false
 endfunction
 function ShadowWord_Heal takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_shadowword)
 if GetTriggerEvalCount(t)>9 or GetTriggerEventId()==EVENT_UNIT_DEATH then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call UnitRemoveAbility(Target,abilityid_shadowword_healbuff)
 call UnitRemoveAbility(Target,buffid_shadowword_heal)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
-call UnitAddLife(Target,Level*10)
+call UnitAddLife(Target,Level*10+5)
 endif
 set Source=null
 set Target=null
 set t=null
 return false
 endfunction
 function ShadowWord takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
@@ -74379,36 +76177,36 @@
 local real StartingHP=(LoadReal(hash_main,(Cache),(392)))
 local real BonusDamage=0
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 if Count==4 or Count==8 or Count==12 then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 if Count==12 then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif Count==4 or Count==8 then
 call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(maledict_fx,Target,"origin")))
 endif
-set BonusDamage=Level*0.1*RMax(StartingHP-GetUnitState(Target,UNIT_STATE_LIFE),0)
+set BonusDamage=(0.08+Level*0.08)*RMax(StartingHP-GetUnitState(Target,UNIT_STATE_LIFE),0)
 if BonusDamage>0 then
 call TextTagOnUnitEx("+"+I2S(R2I(BonusDamage)),2,Target,0.023,68,0,187,216)
 endif
 endif
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,Level*5+BonusDamage)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,5*Level+BonusDamage)
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function Maledict_Create takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local unit Target=GetEnumUnit()
 call DestroyEffect(AddSpecialEffectTarget(maledict_fx,Target,"origin"))
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Maledict_Iterate))
@@ -74493,48 +76291,41 @@
 endfunction
 function Gust_Scan takes nothing returns boolean
 local integer id=0
 local unit Target
 local real Time=(TimerGetElapsed(udg_GameTimer))
 local real mp
 local real hp
 loop
 exitwhen id>12
 set Target=udg_Hero[id]
 if Target!=null and GetUnitAbilityLevel(Target,gust_icon_buff)==0 and gust_time[id]>Time then
 set gust_time[id]=0
 endif
 if Target!=null and GetUnitAbilityLevel(Target,gust_icon_buff)>0 then
 if gust_time[id]>Time and IsDead(Target)==false then
-if IsUnitInRegion(Region_Fountains,Target)==true then
-set hp=GetUnitState(Target,UNIT_STATE_LIFE)
-set mp=GetUnitState(Target,UNIT_STATE_MANA)
-set gust_hp[id]=hp
-set gust_mp[id]=mp
-else
 set hp=GetUnitState(Target,UNIT_STATE_LIFE)
 set mp=GetUnitState(Target,UNIT_STATE_MANA)
 if hp<gust_hp[id]then
 set gust_hp[id]=hp
 else
 endif
 if mp<gust_mp[id]then
 set gust_mp[id]=mp
 else
 endif
 call SetUnitState(Target,UNIT_STATE_LIFE,gust_hp[id])
-endif
 set gust_dmgcounter[id]=gust_dmgcounter[id]+1
 if gust_dmgcounter[id]==10 then
 set gust_dmgcounter[id]=0
 if gust_level[id]==1 then
 call DamageTarget(gust_source[id],Target,DAMAGE_MAGICAL,12.5)
 elseif gust_level[id]==2 then
 call DamageTarget(gust_source[id],Target,DAMAGE_MAGICAL,20)
 elseif gust_level[id]==3 then
 call DamageTarget(gust_source[id],Target,DAMAGE_MAGICAL,32)
 endif
 endif
 elseif gust_time[id]>Time and IsDead(Target)==true then
 set gust_time[id]=0
 set gust_hp[id]=9999
 set gust_mp[id]=9999
@@ -74571,55 +76362,55 @@
 set Caster=CreateUnit(GetOwningPlayer(GetEventDamageSource()),1697656901,0,0,0)
 call UnitRemoveBuffs(Target,true,true)
 call UnitRemoveAbility(Target,1097167980)
 call UnitDamageTarget(Caster,Target,100000000.00,true,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
 set Caster=null
 endif
 set t=null
 set Target=null
 return false
 endfunction
 function Gust_Register takes unit Source,unit Target returns nothing
 local integer Level=GetUnitAbilityLevel(Source,abilityid_iceblast)
 local integer id=GetPlayerId(GetOwningPlayer(Target))
 local trigger t
 local integer Cache
-if Level>0 and IsUnitType(Target,UNIT_TYPE_HERO)==true and IsUnitIllusion(Target)==false and GetUnitTypeId(Target)!=1211117642 then
+if Level>0 and IsUnitType(Target,UNIT_TYPE_HERO)==true and IsUnitIllusion(Target)==false and IsGlobalHeroDummy(GetUnitTypeId(Target))==false then
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
 call TriggerAddCondition(t,Condition(function Gust_Shatter))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 call UnitAddAbility2(Target,gust_icon)
 call UnitAddAbility2(Target,gust_fx)
 set gust_time[id]=(TimerGetElapsed(udg_GameTimer))+7+Level
 set gust_hp[id]=GetUnitState(Target,UNIT_STATE_LIFE)
 set gust_mp[id]=GetUnitState(Target,UNIT_STATE_MANA)
 set gust_source[id]=Source
 set gust_level[id]=Level
 endif
 set t=null
 endfunction
 function Gust_Add takes nothing returns nothing
 local unit Source=tt_unit1
 local unit Target=GetEnumUnit()
 local integer id=GetPlayerId(GetOwningPlayer(Target))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_iceblast)
 local trigger t
 local integer Cache
-if IsUnitType(Target,UNIT_TYPE_HERO)==true and IsUnitIllusion(Target)==false and GetUnitAbilityLevel(Target,gust_icon_buff)==0 and GetUnitTypeId(Target)!=1211117642 then
+if IsUnitType(Target,UNIT_TYPE_HERO)==true and IsUnitIllusion(Target)==false and GetUnitAbilityLevel(Target,gust_icon_buff)==0 and IsGlobalHeroDummy(GetUnitTypeId(Target))==false then
 set gust_time[id]=(TimerGetElapsed(udg_GameTimer))+7+Level
 call UnitAddAbility2(Target,gust_icon)
 call UnitAddAbility2(Target,gust_fx)
 set gust_hp[id]=GetUnitState(Target,UNIT_STATE_LIFE)
 set gust_mp[id]=GetUnitState(Target,UNIT_STATE_MANA)
 set gust_source[id]=Source
 set gust_level[id]=Level
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
 call TriggerAddCondition(t,Condition(function Gust_Shatter))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 set t=null
 endif
@@ -75113,104 +76904,104 @@
 call TriggerAddCondition(t,Condition(function IceBlast_Main))
 set t=null
 endfunction
 function ChillingTouch_UnitDamaged takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local integer ChillingCounter=(LoadInteger(hash_main,(GetHandleId(Source)),(449)))
 if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 if GetEventDamageSource()==Source and GetEventDamage()>1 then
 call DisableTrigger(t)
 if ChillingCounter>0 then
 call SaveInteger(hash_main,(GetHandleId(Source)),(449),(ChillingCounter-1))
-call TextTagOnUnitEx("+"+I2S(30+10*Level),1,Source,0.024,100,200,255,255)
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,30+10*Level)
+call TextTagOnUnitEx("+"+I2S(40+10*Level),1,Source,0.024,100,200,255,255)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,40+10*Level)
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 else
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Source=null
 set Target=null
 return false
 endfunction
 function ChillingTouch_Attack takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 if GetTriggerEventId()!=EVENT_PLAYER_UNIT_ATTACKED or(LoadInteger(hash_main,(GetHandleId(Source)),(449)))==0 then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(175))))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(176))))
 call SaveInteger(hash_main,(GetHandleId(Source)),(449),(0))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call UnitRemoveAbility(Source,chillingtouch_icon)
 call UnitRemoveAbility(Source,buffid_chillingtouch)
 call UnitRemoveAbility(Source,chillingtouch_ias)
-elseif GetAttacker()==Source and IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and((LoadInteger(hash_main,(GetHandleId((Source))),((4289))))==HERO_STATE_ON)==false then
+elseif GetAttacker()==Source and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and((LoadInteger(hash_main,(GetHandleId((Source))),((4289))))==HERO_STATE_ON)==false then
 call AddHeroState(Source,4289,0.4)
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_DAMAGED)
 call TriggerRegisterTimerEvent(t,2.0,false)
 call TriggerAddCondition(t,Condition(function ChillingTouch_UnitDamaged))
 call SaveUnitHandle(hash_main,(Cache),(17),(GetTriggerUnit()))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function ChillingTouch_Register takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetEnumUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_chillingtouch)
 call UnitAddAbility2(Target,chillingtouch_icon)
 call UnitAddAbility2(Target,chillingtouch_ias)
-call SaveInteger(hash_main,(GetHandleId(Target)),(449),(1+Level))
+call SaveInteger(hash_main,(GetHandleId(Target)),(449),(2+Level))
 call SaveUnitHandle(hash_main,(Cache),(2),(Target))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 call SaveEffectHandle(hash_main,(Cache),(175),(AddSpecialEffectTarget(chillingtouch_fx,Target,"right,hand")))
 call SaveEffectHandle(hash_main,(Cache),(176),(AddSpecialEffectTarget(chillingtouch_fx,Target,"left,hand")))
-call TriggerRegisterTimerEvent(t,40,false)
+call TriggerRegisterTimerEvent(t,30,false)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
 call TriggerAddCondition(t,Condition(function ChillingTouch_Attack))
 set Source=null
 set Target=null
 set t=null
 endfunction
 function ChillingTouch takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local group g=GetAvailableGroup()
 local location l=GetSpellTargetLoc()
 local real x=GetLocationX(l)
 local real y=GetLocationY(l)
 call RemoveLocation(l)
 call DestroyEffect(AddSpecialEffect("war3mapImported\\IcyWind.mdl",x,y))
-call GroupEnumUnitsInRange(g,x,y,475,Condition(function GenericCondition_AlliedHeroes))
+call GroupEnumUnitsInRange(g,x,y,525+25,Condition(function GenericCondition_AlliedHeroes))
 call ForGroup(g,function ChillingTouch_Register)
 call KillGroup(g)
 set Source=null
 set g=null
 set l=null
 endfunction
 function ChillingTouch_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_chillingtouch then
 call ChillingTouch()
 endif
 return false
 endfunction
 function Register_ChillingTouch takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
@@ -75912,135 +77703,134 @@
 set Source=null
 set t=null
 endfunction
 function Shackle_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_shackle then
 call Shackle()
 endif
 return false
 endfunction
 function Register_Shackle takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Shackle_Main))
 set t=null
 endfunction
-function Dash_Remove takes nothing returns boolean
+function Dash_Burn takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
-if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>(15+5*Level)or IsMagicImmune(Source)then
-call SaveInteger(hash_main,(GetHandleId((Source))),((4311)),(HERO_STATE_OFF))
+if GetTriggerEventId()==EVENT_WIDGET_DEATH or GetTriggerEvalCount(t)==4 or IsMagicImmune(Target)then
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
-if((LoadInteger(hash_main,(GetHandleId((Source))),((4312))))==HERO_STATE_ON)==false then
-call UnitRemoveAbility(Source,dash_disarm)
-endif
+call UnitRemoveAbility(Target,dash_slow)
+call UnitRemoveAbility(Target,dash_slow_buffid)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
+if GetTriggerEventId()!=EVENT_WIDGET_DEATH then
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,20*Level-10)
+endif
 set t=null
 set Source=null
+set Target=null
 return false
 endfunction
-function Dash_Add takes unit Source,integer Level returns nothing
+function Dash_Add takes unit Source,unit Target,integer Level returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-call UnitAddAbility(Source,dash_disarm)
-call UnitMakeAbilityPermanent(Source,true,dash_disarm)
-call SaveInteger(hash_main,(GetHandleId((Source))),((4311)),(HERO_STATE_ON))
-call TriggerRegisterTimerEvent(t,0.1,true)
-call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
-call TriggerAddCondition(t,Condition(function Dash_Remove))
+call UnitAddAbility2(Target,dash_slow)
+call TriggerRegisterTimerEvent(t,1,true)
+call TriggerRegisterDeathEvent(t,Target)
+call TriggerAddCondition(t,Condition(function Dash_Burn))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveInteger(hash_main,(Cache),(5),(Level))
-call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Other\\TalkToMe\\TalkToMe.mdl",Source,"overhead")))
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(overheat_fx,Target,"chest")))
 set t=null
 endfunction
 function Dash_Hit takes nothing returns boolean
 if IsUnitInGroup(GetEnumUnit(),dash_alreadydamaged)==false and IsMagicImmune(GetEnumUnit())==false then
 call GroupAddUnit(dash_alreadydamaged,GetEnumUnit())
 call DestroyEffect(AddSpecialEffectTarget(dash_fx,GetEnumUnit(),"chest"))
-call DamageTarget(dash_source,GetEnumUnit(),DAMAGE_MAGICAL,50+50*dash_level)
-if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==true then
-call Dash_Add(GetEnumUnit(),dash_level)
-endif
+call Dash_Add(dash_source,GetEnumUnit(),dash_level)
 endif
 return false
 endfunction
 function Dash_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real SourceX=(LoadReal(hash_main,(Cache),(189)))
 local real SourceY=(LoadReal(hash_main,(Cache),(190)))
 local real TargetX=(LoadReal(hash_main,(Cache),(47)))
 local real TargetY=(LoadReal(hash_main,(Cache),(48)))
 local real a=(LoadReal(hash_main,(Cache),(13)))
 local real EllipseAngle=(1-I2R(Count)/50)*bj_PI
 local real EllipseX=dash_length/2*Cos(EllipseAngle)
 local real EllipseY=dash_width/2*Sin(EllipseAngle)
 local real x=SafeX(TargetX+EllipseX*Cos(a)-EllipseY*Sin(a))
 local real y=SafeY(TargetY+EllipseX*Sin(a)+EllipseY*Cos(a))
 local group AlreadyDamaged=(LoadGroupHandle(hash_main,(Cache),(133)))
 local group g
 local integer Level=GetUnitAbilityLevel(Source,abilityid_dash)
-if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and Count>0)or Count>100 or IsReallyStunned(Source)then
+if GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and Count>0 and(GetSpellAbilityId()==abilityid_dash_helper or GetSpellAbilityId()==abilityid_supernova))or Count>100 then
 call KillTrees(x,y,300)
 call SetUnitVertexColor(Source,255,255,255,255)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_dash then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_dash,true)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_dash_helper,false)
 call SetUnitPathing(Source,true)
 call KillGroup(AlreadyDamaged)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 if ModuloInteger(Count,10)==0 then
 call KillTrees(x,y,200)
 endif
 call SaveInteger(hash_main,(Cache),(34),(Count+1))
 call SetUnitX(Source,x)
 call SetUnitY(Source,y)
 call SetUnitFacing(Source,(a+EllipseAngle-bj_PI/2)*bj_RADTODEG)
 set g=GetAvailableGroup()
 set dash_alreadydamaged=AlreadyDamaged
 set tt_unit1=Source
 set dash_source=Source
 set dash_level=GetUnitAbilityLevel(Source,abilityid_dash)
-call GroupEnumUnitsInRange(g,x,y,325,Condition(function GenericCondition_EnemyUnitsNoImmune))
+call GroupEnumUnitsInRange(g,x,y,200+25,Condition(function GenericCondition_EnemyUnitsNoImmune))
 call ForGroup(g,function Dash_Hit)
 call KillGroup(g)
 endif
 set t=null
 set Source=null
 set g=null
 set AlreadyDamaged=null
 return false
 endfunction
 function Dash takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local real SourceX=GetUnitX(Source)
 local real SourceY=GetUnitY(Source)
 local real a=AngleBetweenXY(SourceX,SourceY,GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
 local real TargetX=SourceX+dash_length/2*Cos(a)
 local real TargetY=SourceY+dash_length/2*Sin(a)
-call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)-GetUnitState(Source,UNIT_STATE_LIFE)*0.1)
+call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)-GetUnitState(Source,UNIT_STATE_LIFE)*0.15)
 call AddHeroState(Source,4301,2)
 call AddHeroState(Source,4415,2)
 call TriggerRegisterTimerEvent(t,0.02,true)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Dash_Move))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(189),((SourceX)*1.0))
 call SaveReal(hash_main,(Cache),(190),((SourceY)*1.0))
 call SaveReal(hash_main,(Cache),(47),((TargetX)*1.0))
 call SaveReal(hash_main,(Cache),(48),((TargetY)*1.0))
 call SaveReal(hash_main,(Cache),(13),((a)*1.0))
 call SaveGroupHandle(hash_main,(Cache),(133),(GetAvailableGroup()))
 call SetUnitPathing(Source,false)
 call SetUnitVertexColor(Source,255,255,255,50)
@@ -76072,166 +77862,193 @@
 endfunction
 function Supernova_DPS takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_supernova)
 local group g
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set tt_unit1=Source
 set supernova_source=Source
 set supernova_level=Level
 set g=GetAvailableGroup()
-call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1025,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),1000+25,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function Supernova_Hit)
 call KillGroup(g)
 set g=null
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function Supernova_Position takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Sun=(LoadUnitHandle(hash_main,(Cache),(589)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 if IsUnitIllusion(GetEventDamageSource())==true then
 call PreventDamage(Sun,GetEventDamage())
 endif
 else
 if GetUnitX(Sun)!=x or GetUnitY(Sun)!=y then
 call SetUnitPosition(Sun,x,y)
 endif
 if GetUnitY(Source)!=x or GetUnitY(Source)!=y then
 call SetUnitPosition(Source,x,y)
 endif
+call SetUnitX(Caster,GetUnitX(Source))
+call SetUnitY(Caster,GetUnitY(Source))
 endif
 if GetTriggerEvalCount(t)==1 then
 call PauseUnit(Source,true)
 endif
 set t=null
 set Sun=null
 set Source=null
+set Caster=null
 return false
 endfunction
 function Supernova_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Ground=(LoadUnitHandle(hash_main,(Cache),(588)))
 local unit Sun=(LoadUnitHandle(hash_main,(Cache),(589)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local unit Dummy=(LoadUnitHandle(hash_main,(Cache),(239)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_supernova)
 local group g
 local unit Caster
+local integer TempLevel
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call StopSound(gg_snd_VolcanoLoop,false,false)
 call ShowUnit(Ground,false)
 call ShowUnit(Dummy,false)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call ShowUnit(Source,true)
+call SaveInteger(hash_main,(GetHandleId((Source))),((4326)),(HERO_STATE_OFF))
 call UnitRemoveAbility(Source,1093678162)
 call SetUnitInvulnerable(Source,false)
 call PauseUnit(Source,false)
 if GetLocalPlayer()==GetOwningPlayer(Source)then
 call ClearSelection()
 call SelectUnit(Source,true)
 endif
 call SetUnitState(Source,UNIT_STATE_LIFE,1)
 set Caster=CreateUnit(GetOwningPlayer(GetKillingUnit()),1697656901,0,0,0)
 call UnitRemoveBuffs(Source,true,true)
 call UnitRemoveAbility(Source,1097167980)
 call UnitDamageTarget(Caster,Source,100000000.00,true,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
 set Caster=null
 else
 if GetTriggerEvalCount(t)==1 then
 call SetUnitFlyHeight(Sun,0,200)
 elseif GetTriggerEvalCount(t)==2 then
 call PauseUnit(Sun,false)
 call UnitApplyTimedLife(Sun,1112820806,0.1)
 call StopSound(gg_snd_VolcanoLoop,false,false)
 call StartSound(gg_snd_ThunderClapCaster)
 call DestroyEffect(AddSpecialEffect("war3mapImported\\FireNova2.mdx",GetUnitX(Ground),GetUnitY(Ground)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call ShowUnit(Source,true)
+call SaveInteger(hash_main,(GetHandleId((Source))),((4326)),(HERO_STATE_OFF))
 call UnitRemoveAbility(Source,1093678162)
 call SetUnitInvulnerable(Source,false)
 call SetUnitAnimationByIndex(Source,8)
 call QueueUnitAnimation(Source,"idle")
 call PauseUnit(Source,false)
 if GetLocalPlayer()==GetOwningPlayer(Source)then
 call ClearSelection()
 call SelectUnit(Source,true)
 endif
 call ShowUnit(Ground,false)
 call ShowUnit(Dummy,false)
 call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_MAX_LIFE))
 call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MAX_MANA))
+set TempLevel=GetUnitAbilityLevel(Source,abilityid_dash)
+if TempLevel>0 then
+call UnitRemoveAbility(Source,abilityid_dash)
+call UnitAddAbility(Source,abilityid_dash)
+call SetUnitAbilityLevel(Source,abilityid_dash,TempLevel)
+endif
+set TempLevel=GetUnitAbilityLevel(Source,abilityid_firespirits)
+if TempLevel>0 then
+call UnitRemoveAbility(Source,abilityid_firespirits)
+call UnitAddAbility(Source,abilityid_firespirits)
+call SetUnitAbilityLevel(Source,abilityid_firespirits,TempLevel)
+endif
+set TempLevel=GetUnitAbilityLevel(Source,abilityid_sunray)
+if TempLevel>0 then
+call UnitRemoveAbility(Source,abilityid_sunray)
+call UnitAddAbility(Source,abilityid_sunray)
+call SetUnitAbilityLevel(Source,abilityid_sunray,TempLevel)
+endif
 set Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Source),GetUnitY(Source),0)
 call UnitAddAbility2(Caster,supernova_stun)
 call SetUnitAbilityLevel(Caster,supernova_stun,Level)
 call IssueImmediateOrder(Caster,"stomp")
 set Caster=null
 endif
 endif
 set t=null
 set Source=null
 set Ground=null
 set Dummy=null
 set Sun=null
 return false
 endfunction
 function Supernova takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local real x=GetUnitX(Source)
 local real y=GetUnitY(Source)
 local unit Ground
 local unit Sun
 local unit Dummy=CreateUnit(GetOwningPlayer(Source),1747993420,GetUnitX(Source),GetUnitY(Source),0)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_supernova)
 local unit Caster
+local unit ItemCaster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Source),GetUnitY(Source),0)
 set Ground=CreateUnit(GetOwningPlayer(Source),unitid_fx_ground,x,y,0)
 if Level==1 then
 set Sun=CreateUnit(GetOwningPlayer(Source),unitid_fx_sun_1,x,y,0)
 elseif Level==2 then
 set Sun=CreateUnit(GetOwningPlayer(Source),unitid_fx_sun_2,x,y,0)
 elseif Level==3 then
 set Sun=CreateUnit(GetOwningPlayer(Source),unitid_fx_sun_3,x,y,0)
 endif
 call AddSpecialEffectTarget("war3mapImported\\PhoenixDown_2.mdl",Ground,"origin")
 if GetLocalPlayer()==GetOwningPlayer(Source)then
 call ClearSelection()
 call SelectUnit(Sun,true)
 endif
 call KillTrees(x,y,400)
 call ShowUnit(Source,false)
+call SaveInteger(hash_main,(GetHandleId((Source))),((4326)),(HERO_STATE_ON))
 call UnitAddAbility2(Source,1093678162)
 call StickyNapalm_SetSlow(Source,0,0)
 call SetUnitInvulnerable(Source,true)
 call UnitRemoveBuffs(Source,true,true)
 call StartSound(gg_snd_VolcanoLoop)
 call UnitRemoveAbility(Sun,1098015094)
 call UnitApplyTimedLife(Ground,1112820806,6.1)
 call UnitApplyTimedLife(Dummy,1112820806,6.1)
 call UnitApplyTimedLife(Sun,1112820806,6.1)
 call TriggerRegisterTimerEvent(t,5.2,false)
 call TriggerRegisterTimerEvent(t,6,false)
 call TriggerAddCondition(t,Condition(function Supernova_End))
 call TriggerRegisterUnitEvent(t,Sun,EVENT_UNIT_DEATH)
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(588),(Ground))
@@ -76243,30 +78060,34 @@
 set Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,1,true)
 call TriggerRegisterUnitEvent(t,Sun,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Supernova_DPS))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,.02,true)
 call TriggerRegisterUnitEvent(t,Sun,EVENT_UNIT_DEATH)
 call TriggerRegisterUnitEvent(t,Sun,EVENT_UNIT_DAMAGED)
 call TriggerAddCondition(t,Condition(function Supernova_Position))
 call SaveUnitHandle(hash_main,(Cache),(589),(Sun))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(6),((GetUnitX(Source))*1.0))
 call SaveReal(hash_main,(Cache),(7),((GetUnitY(Source))*1.0))
+call SaveUnitHandle(hash_main,(Cache),(19),(ItemCaster))
+if UnitHasItemOfType(Source,1227899192)then
+call UnitAddAbility(ItemCaster,1093678153)
+endif
 set t=null
 set Source=null
 set Ground=null
 set Sun=null
 endfunction
 function Supernova_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_supernova then
 call Supernova()
 endif
 return false
 endfunction
 function Register_Supernova takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Supernova_Main))
@@ -76493,46 +78314,46 @@
 return false
 endfunction
 function Register_SweepingFlame takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function SweepingFlame_Main))
 set t=null
 endfunction
 function Sunray_Slow_End takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real Time=(LoadReal(hash_main,(GetHandleId(Source)),(681)))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
-if((TimerGetElapsed(udg_GameTimer))-Time<0.249)==false or GetTriggerEventId()==EVENT_UNIT_DEATH then
+if((TimerGetElapsed(udg_GameTimer))-Time<0.49)==false or GetTriggerEventId()==EVENT_UNIT_DEATH then
 call UnitRemoveAbility(Source,sunray_maim_1)
 call UnitRemoveAbility(Source,sunray_maim_2)
 call UnitRemoveAbility(Source,sunray_maim_3)
 call UnitRemoveAbility(Source,sunray_maim_4)
 call UnitRemoveAbility(Source,buffid_sunray)
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function Sunray_Slow takes unit Source returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local integer slowabil
-call TriggerRegisterTimerEvent(t,0.25,false)
+call TriggerRegisterTimerEvent(t,0.5,false)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Sunray_Slow_End))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(GetHandleId(Source)),(681),(((TimerGetElapsed(udg_GameTimer)))*1.0))
 if sunray_level==1 then
 set slowabil=sunray_maim_1
 call UnitRemoveAbility(Source,sunray_maim_2)
 call UnitRemoveAbility(Source,sunray_maim_3)
 call UnitRemoveAbility(Source,sunray_maim_4)
 elseif sunray_level==2 then
 set slowabil=sunray_maim_2
 call UnitRemoveAbility(Source,sunray_maim_1)
 call UnitRemoveAbility(Source,sunray_maim_3)
 call UnitRemoveAbility(Source,sunray_maim_4)
 elseif sunray_level==3 then
@@ -76540,42 +78361,44 @@
 call UnitRemoveAbility(Source,sunray_maim_1)
 call UnitRemoveAbility(Source,sunray_maim_2)
 call UnitRemoveAbility(Source,sunray_maim_4)
 elseif sunray_level==4 then
 set slowabil=sunray_maim_4
 call UnitRemoveAbility(Source,sunray_maim_1)
 call UnitRemoveAbility(Source,sunray_maim_2)
 call UnitRemoveAbility(Source,sunray_maim_3)
 endif
 call UnitAddAbility2(Source,slowabil)
 call UnitMakeAbilityPermanent(Source,true,slowabil)
 set t=null
 endfunction
 function Sunray_Hit takes nothing returns nothing
 local unit Target=GetEnumUnit()
-local real Damage=(15*sunray_level+0.06*GetUnitState(Target,UNIT_STATE_MAX_LIFE))/5
-if sunray_source==Target then
-elseif IsUnitType(Target,UNIT_TYPE_HERO)==false then
-call DamageTarget(sunray_source,Target,DAMAGE_PURE,Damage)
-else
+local real Damage1=sunray_damage1
+local real Damage2=sunray_damage2
+local real Damage=Damage1+Damage2*GetUnitState(Target,UNIT_STATE_MAX_LIFE)
+set Damage=Damage/5
+if IsUnitEnemy(Target,GetOwningPlayer(sunray_source))==true then
 call DamageTarget(sunray_source,Target,DAMAGE_PURE,Damage)
 if IsMagicImmune(Target)==false then
 call Sunray_Slow(Target)
 endif
+else
+call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+Damage*0.5)
+endif
 call DestroyEffect(AddSpecialEffectTarget(sunray_fx,Target,"origin"))
 call TimedReveal(GetOwningPlayer(Target),2,GetUnitX(sunray_source),GetUnitY(sunray_source),500)
-endif
 set Target=null
 endfunction
 function Sunray_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real a_deg=GetUnitFacing(Source)
 local real a=a_deg*bj_DEGTORAD
 local location l1=GetUnitLoc(Source)
 local real basez_source=GetLocationZ(l1)
 local location l2=Location(GetUnitX(Source)+sunray_maxdistance*Cos(a),GetUnitY(Source)+sunray_maxdistance*Sin(a))
 local real basez_target=GetLocationZ(l2)
 local lightning Light1=(LoadLightningHandle(hash_main,(Cache),(676)))
 local lightning Light2=(LoadLightningHandle(hash_main,(Cache),(677)))
@@ -76626,30 +78449,34 @@
 local boolean left=FALSE
 local boolean right=false
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit NewTarget=null
 local unit DriftTarget=null
 local real DriftX
 local real DriftY
 local real DriftA
 local real TurnAngle=(LoadReal(hash_main,(Cache),(688)))
 local boolean Drifting=(LoadBoolean(hash_main,(Cache),(689)))
 local boolean TurnFast=(LoadBoolean(hash_main,(Cache),(672)))
 local real DriftIncrement
 local ubersplat Splat
 local real LastX=(LoadReal(hash_main,(Cache),(23)))
 local real LastY=(LoadReal(hash_main,(Cache),(24)))
+local real Damage1
+local real Damage2
+local real DurationFactor
+local real DriftAmount=5
 if GetUnitCurrentOrder(Source)==852001 then
 call DisableTrigger(t)
 call InterruptUnit(Source)
 call EnableTrigger(t)
 endif
 call RemoveLocation(l1)
 call RemoveLocation(l2)
 if IsUnitPaused(Source)==false and(GetTriggerEventId()==EVENT_UNIT_ISSUED_POINT_ORDER or GetTriggerEventId()==EVENT_UNIT_ISSUED_TARGET_ORDER)then
 set SourceX=GetUnitX(Source)
 set SourceY=GetUnitY(Source)
 if GetIssuedOrderId()!=852490 and GetIssuedOrderId()!=852185 and GetIssuedOrderId()!=852600 then
 call DisableTrigger(t)
 call InterruptUnit(Source)
 call EnableTrigger(t)
 endif
@@ -76667,54 +78494,52 @@
 endif
 set newangle2=a_deg-diffangle
 if newangle2<0 then
 set newangle2=newangle2+360
 endif
 if newangle2<180 then
 set left=true
 set newangle=a_deg+6
 else
 set right=true
 set newangle=a_deg-6
 endif
 set TurnAngle=AngleBetweenXY(x,y,SourceX,SourceY)+180
 call SaveReal(hash_main,(Cache),(688),((TurnAngle)*1.0))
 endif
-elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT or GetTriggerEventId()==EVENT_WIDGET_DEATH or GetUnitState(Source,UNIT_STATE_MANA)<10 or IsStunned(Source)or IsSilenced(Source)or IsUnitPaused(Source)or IsCycloned(Source)or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==-1 then
+elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT or GetTriggerEventId()==EVENT_WIDGET_DEATH or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==-1 or Count>=sunray_max_duration/.02 or IsStunned(Source)or IsSilenced(Source)then
 if GetTriggerEventId()!=EVENT_UNIT_SPELL_EFFECT or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and(GetSpellAbilityId()==abilityid_sunray_off or GetSpellAbilityId()==abilityid_supernova or GetSpellAbilityId()==abilityid_spellsteal))then
 call SaveInteger(hash_main,(GetHandleId((Source))),((4312)),(HERO_STATE_OFF))
 if((LoadInteger(hash_main,(GetHandleId((Source))),((4311))))==HERO_STATE_ON)==false then
 call UnitRemoveAbility(Source,1096971630)
 endif
 call SetUnitPathing(Source,true)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call UnitRemoveAbility(Source,abilityid_sunray_movement)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_sunray_off,false)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_sunray_movement,false)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_sunray then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_sunray,true)
 endif
 call DestroyLightning(Light1)
 call DestroyLightning(Light2)
 call DestroyLightning(Light3)
 call DestroyLightning(Light4)
 call DestroyLightning(Light5)
 call StopSound(gg_snd_Sunray,false,true)
 endif
-if GetUnitState(Source,UNIT_STATE_LIFE)<50 then
-endif
 elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
 if GetIssuedOrderId()==String2OrderIdBJ("immolation")then
 set Drifting=true
 endif
 if GetIssuedOrderId()==String2OrderIdBJ("unimmolation")then
 set Drifting=false
 endif
 call SaveBoolean(hash_main,(Cache),(689),(Drifting))
 else
 set diffangle=a_deg-TurnAngle
 if diffangle<-180 then
 set diffangle=diffangle+360
 elseif diffangle>180 then
 set diffangle=diffangle-360
 endif
@@ -76728,81 +78553,73 @@
 set a_deg=a_deg-DriftIncrement
 else
 set TurnFast=false
 call SaveBoolean(hash_main,(Cache),(672),(TurnFast))
 set a_deg=TurnAngle
 endif
 if((LoadInteger(hash_main,(GetHandleId((Source))),((4301))))==HERO_STATE_ON)==false then
 call SetUnitFacing(Source,a_deg)
 endif
 set a=a_deg*bj_DEGTORAD
 set Count=Count+1
 call SaveInteger(hash_main,(Cache),(34),(Count))
 set light_distance=sunray_maxdistance
 set SourceX=GetUnitX(Source)+50*Cos(a)
 set SourceY=GetUnitY(Source)+50*Sin(a)
+if Drifting and IsEnsnared(Source)==false and IsStunned(Source)==false then
+if((LoadInteger(hash_main,(GetHandleId((Source))),((4331))))==HERO_STATE_ON)==true then
+set DriftAmount=DriftAmount*2
+endif
+set DriftA=a
+set DriftX=SafeX(GetUnitX(Source)+DriftAmount*Cos(DriftA))
+set DriftY=SafeY(GetUnitY(Source)+DriftAmount*Sin(DriftA))
+call KillTrees(DriftX,DriftY,200)
+call SetUnitX(Source,DriftX)
+call SetUnitY(Source,DriftY)
+endif
+call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)-GetUnitState(Source,UNIT_STATE_LIFE)*0.03*0.02)
 call KillTrees(SourceX,SourceY,200)
+if ModuloInteger(Count,10)==0 then
 set sunray_group=GetAvailableGroup()
 set tt_unit1=Source
 set i=0
 loop
-exitwhen i*50>sunray_maxdistance or NewTarget!=null
+exitwhen i*50>sunray_maxdistance
 set x=SourceX+i*50*Cos(a)
 set y=SourceY+i*50*Sin(a)
 set g=GetAvailableGroup()
-call GroupEnumUnitsInRange(g,x,y,100,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupEnumUnitsInRange(g,x,y,130+25,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupAddGroup(g,sunray_group)
+call GroupEnumUnitsInRange(g,x,y,130+25,Condition(function GenericCondition_AlliedUnitsEx))
 call GroupAddGroup(g,sunray_group)
-call GroupEnumUnitsInRange(g,x,y,100,Condition(function GenericCondition_EnemyHeroesEx))
-set NewTarget=FirstOfGroup(g)
 call KillGroup(g)
-if ModuloInteger(Count,10)==0 then
 if ModuloInteger(i,3)==0 then
 call TimedReveal(GetOwningPlayer(Source),2,x,y,225)
 endif
-endif
 set i=i+1
 endloop
-if Drifting and IsEnsnared(Source)==false then
-set DriftA=a
-set DriftX=SafeX(GetUnitX(Source)+5*Cos(DriftA))
-set DriftY=SafeY(GetUnitY(Source)+5*Sin(DriftA))
-call KillTrees(DriftX,DriftY,200)
-call SetUnitX(Source,DriftX)
-call SetUnitY(Source,DriftY)
-endif
 set sunray_source=Source
 set sunray_level=GetUnitAbilityLevel(Source,abilityid_sunray)
-call RemoveSavedHandle(hash_main,(Cache),(17))
-set Target=NewTarget
-if Target!=null then
-call SaveUnitHandle(hash_main,(Cache),(17),(Target))
-endif
-set sunray_damage=(10+5*sunray_level)+(2+2*sunray_level)*GetHeroLevel(Source)
-set sunray_damage=sunray_damage/5
-if ModuloInteger(Count,10)==0 then
-call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)-(0.04*GetUnitState(Source,UNIT_STATE_MAX_MANA)/5.0))
-if Target!=null then
-set g=GetAvailableGroup()
-call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),200,Condition(function GenericCondition_EnemyUnitsEx))
-call GroupAddGroup(g,sunray_group)
-call KillGroup(g)
-endif
+set DurationFactor=(I2R(Count)/50.0)/6
+set sunray_damage1=(5*sunray_level+10)+(5*sunray_level+10)*DurationFactor
+set sunray_damage2=(sunray_level+DurationFactor*(sunray_level))/100
+call GroupRemoveUnit(sunray_group,Source)
 call ForGroup(sunray_group,function Sunray_Hit)
-endif
 call KillGroup(sunray_group)
 set g=null
 set sunray_group=null
+endif
 if IsDead(Source)==false then
 if Target!=null then
 set light_distance=DistanceBetweenUnits(Source,Target)
 endif
 set light1_source_x=SourceX
 set light1_source_y=SourceY
 set light1_source_z=basez_source+200
 set light1_target_x=light1_source_x+light_distance*Cos(a)
 set light1_target_y=light1_source_y+light_distance*Sin(a)
 set light1_target_z=basez_target
 set light2_source_x=SourceX+sunray_offset_x*Cos((a_deg-90)*bj_DEGTORAD)
 set light2_source_y=SourceY+sunray_offset_y*Cos((a_deg-90)*bj_DEGTORAD)
 set light2_source_z=basez_source+200
 set light2_target_x=light2_source_x+light_distance*Cos(a)
 set light2_target_y=light2_source_y+light_distance*Sin(a)
@@ -76865,31 +78682,30 @@
 set l2=null
 return false
 endfunction
 function Sunray takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local real a=AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
 local real TargetX=SafeX(GetUnitX(Source)+sunray_maxdistance*Cos(a))
 local real TargetY=SafeY(GetUnitY(Source)+sunray_maxdistance*Sin(a))
 local lightning Light1=AddLightning("SRAY",false,GetUnitX(Source),GetUnitY(Source),TargetX,TargetY)
 local lightning Light2=AddLightning("SRAY",false,GetUnitX(Source),GetUnitY(Source),TargetX,TargetY)
 local lightning Light3=AddLightning("SRAY",false,GetUnitX(Source),GetUnitY(Source),TargetX,TargetY)
 local lightning Light4=AddLightning("SRAY",false,GetUnitX(Source),GetUnitY(Source),TargetX,TargetY)
 local lightning Light5=AddLightning("SRAY",false,GetUnitX(Source),GetUnitY(Source),TargetX,TargetY)
-call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)-GetUnitState(Source,UNIT_STATE_LIFE)*0.20)
 call SetUnitFacing(Source,a*bj_RADTODEG)
 call StartSound(gg_snd_Sunray)
 call SetSoundPosition(gg_snd_Sunray,GetUnitX(Source),GetUnitY(Source),100)
 call TriggerRegisterTimerEvent(t,0.02,true)
 call TriggerRegisterDeathEvent(t,Source)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_TARGET_ORDER)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_POINT_ORDER)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_ISSUED_ORDER)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Sunray_Move))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(13),((a)*1.0))
 call SaveReal(hash_main,(Cache),(688),((a*bj_RADTODEG)*1.0))
 call SaveLightningHandle(hash_main,(Cache),(676),(Light1))
 call SaveLightningHandle(hash_main,(Cache),(677),(Light2))
@@ -76929,76 +78745,85 @@
 endif
 endif
 return false
 endfunction
 function Register_Sunray takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)
 call TriggerAddCondition(t,Condition(function Sunray_Main))
 call SetAbilityUnavailableToAll(sunray_maim_1)
 call SetAbilityUnavailableToAll(sunray_maim_2)
 call SetAbilityUnavailableToAll(sunray_maim_3)
 call SetAbilityUnavailableToAll(sunray_maim_4)
 set t=null
 endfunction
-function Firespirits_Hit takes nothing returns nothing
-call DamageTarget(firespirits_source,GetEnumUnit(),DAMAGE_MAGICAL,firespirits_damage)
+function Firespirits_End takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_firespirits)
+if GetTriggerEventId()==EVENT_UNIT_DEATH or(TimerGetElapsed(udg_GameTimer))>=(LoadReal(hash_main,(GetHandleId(Target)),(757)))or IsMagicImmune(Target)==true then
+call UnitRemoveAbility(Target,firespirits_disarm)
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(176))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+if ModuloInteger(GetTriggerEvalCount(t),4)==0 then
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,20*Level)
+endif
+set t=null
+set Source=null
+return false
 endfunction
-function Firespirits_Heal takes nothing returns nothing
-call SetUnitState(GetEnumUnit(),UNIT_STATE_LIFE,GetUnitState(GetEnumUnit(),UNIT_STATE_LIFE)+firespirits_damage*0.5)
+function Firespirits_Add takes nothing returns nothing
+local unit Source=firespirits_source
+local unit Target=GetEnumUnit()
+local trigger t
+local integer Cache
+call SaveReal(hash_main,(GetHandleId(Target)),(757),(((TimerGetElapsed(udg_GameTimer))+4)*1.0))
+if GetUnitAbilityLevel(Target,firespirits_disarm)==0 then
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0.25,true)
+call TriggerAddCondition(t,Condition(function Firespirits_End))
+call TriggerRegisterDeathEvent(t,Target)
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveEffectHandle(hash_main,(Cache),(176),(AddSpecialEffectTarget(overheat_fx,Target,"chest")))
+call UnitAddAbility(Target,firespirits_disarm)
+call UnitMakeAbilityPermanent(Target,true,firespirits_disarm)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),overheat_disarm,false)
+endif
+set Source=null
+set Target=null
+set t=null
 endfunction
 function Firespirits_Detonate takes unit Source,unit Projectile,real Percentage,unit Caster,unit Target returns nothing
-local group g=GetAvailableGroup()
-local group g1=GetAvailableGroup()
-local group g2=GetAvailableGroup()
 local real x=GetUnitX(Projectile)
 local real y=GetUnitY(Projectile)
-set firespirits_source=Source
-set firespirits_caster=Caster
-set firespirits_damage=(GetUnitAbilityLevel(Source,abilityid_firespirits)*20+10)*Percentage
-set tt_unit1=Source
-call GroupEnumUnitsInRange(g1,x,y,425,Condition(function GenericCondition_EnemyUnitsEx))
-if Source!=Target then
-call GroupEnumUnitsInRange(g2,GetUnitX(Source),GetUnitY(Source),425,Condition(function GenericCondition_EnemyUnitsEx))
-endif
-call GroupAddGroup(g1,g)
-call GroupAddGroup(g2,g)
-call ForGroup(g,function Firespirits_Hit)
-call GroupClear(g)
-call GroupClear(g1)
-call GroupClear(g2)
+local group g=GetAvailableGroup()
 set tt_unit1=Source
-call GroupEnumUnitsInRange(g1,x,y,425,Condition(function GenericCondition_AlliedUnitsEx))
-if Source!=Target then
-call GroupEnumUnitsInRange(g2,GetUnitX(Source),GetUnitY(Source),425,Condition(function GenericCondition_AlliedUnitsEx))
-endif
-call GroupAddGroup(g1,g)
-call GroupAddGroup(g2,g)
-call ForGroup(g,function Firespirits_Heal)
+set firespirits_source=Source
+call GroupEnumUnitsInRange(g,x,y,175+25,Condition(function GenericCondition_EnemyUnitsNoImmune))
+call ForGroup(g,function Firespirits_Add)
 call KillGroup(g)
-call KillGroup(g1)
-call KillGroup(g2)
 call DestroyEffect(AddSpecialEffect(firespirits_fx,x,y))
-if Source!=Target then
-call DestroyEffect(AddSpecialEffect(firespirits_fx,GetUnitX(Source),GetUnitY(Source)))
-endif
 call KillUnit(Projectile)
 call ShowUnit(Projectile,false)
 set g=null
-set g1=null
-set g2=null
 endfunction
 function Firespirits_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local unit Bird=(LoadUnitHandle(hash_main,(Cache),(393)))
 local real Percentage=(LoadReal(hash_main,(Cache),(685)))
 local real TargetX
 local real TargetY
 local real x
 local real y
 local real a
@@ -77029,83 +78854,94 @@
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Source=null
 set Target=null
 set Bird=null
 set Caster=null
 return false
 endfunction
 function Firespirits_Launch takes unit Source,unit Bird,unit Target,real Percentage,unit Caster returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local group g
 local unit NewTarget
+if Source==Target then
+call KillUnit(Bird)
+call ShowUnit(Bird,false)
+else
 call SetUnitVertexColor(Bird,255,255,255,255)
 call TriggerRegisterTimerEvent(t,0.02,true)
 call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
 call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DEATH)
 call TriggerAddCondition(t,Condition(function Firespirits_Move))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(393),(Bird))
 call SaveReal(hash_main,(Cache),(47),((GetSpellTargetX())*1.0))
 call SaveReal(hash_main,(Cache),(48),((GetSpellTargetY())*1.0))
 call SaveReal(hash_main,(Cache),(685),((Percentage)*1.0))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+endif
 set t=null
 endfunction
 function Firespirits_Loop takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real SourceX=GetUnitX(Source)
 local real SourceY=GetUnitY(Source)
 local unit Bird1=(LoadUnitHandle(hash_main,(Cache),(393)))
 local unit Bird2=(LoadUnitHandle(hash_main,(Cache),(394)))
 local unit Bird3=(LoadUnitHandle(hash_main,(Cache),(395)))
 local unit Bird4=(LoadUnitHandle(hash_main,(Cache),(396)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_firespirits)
 local real a=GetUnitFacing(Source)
 local real x
 local real y
 local group g
 local group g2
 local real rate=-1*360*0.02/4
 local real a2
 local real offset
 local real Percentage=(LoadReal(hash_main,(Cache),(685)))
 local real Scale
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+local integer TotalDuration=800
 if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
 if GetSpellAbilityId()==abilityid_firespirits_helper then
+if IsDead(Bird1)==false then
 call Firespirits_Launch(Source,Bird1,GetSpellTargetUnit(),Percentage,Caster)
 call RemoveSavedHandle(hash_main,(Cache),(393))
+elseif IsDead(Bird2)==false then
 call Firespirits_Launch(Source,Bird2,GetSpellTargetUnit(),Percentage,Caster)
 call RemoveSavedHandle(hash_main,(Cache),(394))
+elseif IsDead(Bird3)==false then
 call Firespirits_Launch(Source,Bird3,GetSpellTargetUnit(),Percentage,Caster)
 call RemoveSavedHandle(hash_main,(Cache),(395))
+elseif IsDead(Bird4)==false then
 call Firespirits_Launch(Source,Bird4,GetSpellTargetUnit(),Percentage,Caster)
 call RemoveSavedHandle(hash_main,(Cache),(396))
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_firespirits_helper,false)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_firespirits then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_firespirits,true)
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
+endif
 elseif GetSpellAbilityId()==abilityid_supernova then
 if Bird1!=null and IsDead(Bird1)==false then
 call Firespirits_Launch(Source,Bird1,Source,Percentage,Caster)
 endif
 if Bird2!=null and IsDead(Bird2)==false then
 call Firespirits_Launch(Source,Bird2,Source,Percentage,Caster)
 endif
 if Bird3!=null and IsDead(Bird3)==false then
 call Firespirits_Launch(Source,Bird3,Source,Percentage,Caster)
 endif
 if Bird4!=null and IsDead(Bird4)==false then
 call Firespirits_Launch(Source,Bird4,Source,Percentage,Caster)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_firespirits_helper,false)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_firespirits then
@@ -77141,61 +78977,61 @@
 set x=SafeX(SourceX+200*Cos(a2*bj_DEGTORAD))
 set y=SafeY(SourceY+200*Sin(a2*bj_DEGTORAD))
 call SetUnitFacing(Bird3,a2-90)
 call SetUnitX(Bird3,x)
 call SetUnitY(Bird3,y)
 endif
 if Bird4!=null and IsDead(Bird4)==false then
 set offset=360*1/4.0
 set a2=offset+rate*Count
 set x=SafeX(SourceX+200*Cos(a2*bj_DEGTORAD))
 set y=SafeY(SourceY+200*Sin(a2*bj_DEGTORAD))
 call SetUnitFacing(Bird4,a2-90)
 call SetUnitX(Bird4,x)
 call SetUnitY(Bird4,y)
 endif
-if Count>625 or GetTriggerEventId()==EVENT_UNIT_DEATH then
+if Count>TotalDuration or GetTriggerEventId()==EVENT_UNIT_DEATH then
 if Bird1!=null and IsDead(Bird1)==false then
 call Firespirits_Launch(Source,Bird1,Source,Percentage,Caster)
 endif
 if Bird2!=null and IsDead(Bird2)==false then
 call Firespirits_Launch(Source,Bird2,Source,Percentage,Caster)
 endif
 if Bird3!=null and IsDead(Bird3)==false then
 call Firespirits_Launch(Source,Bird3,Source,Percentage,Caster)
 endif
 if Bird4!=null and IsDead(Bird4)==false then
 call Firespirits_Launch(Source,Bird4,Source,Percentage,Caster)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_firespirits_helper,false)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_firespirits then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_firespirits,true)
 endif
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set Percentage=RMinBJ(0.25+0.75*(I2R(Count)/500.0),1)
 call SaveReal(hash_main,(Cache),(685),((Percentage)*1.0))
-set Scale=0.25+(Percentage-0.2)*2.5
+set Scale=0.25+(1-0.2)*2.5
 call SetUnitScale(Bird1,Scale,Scale,Scale)
 call SetUnitScale(Bird2,Scale,Scale,Scale)
 call SetUnitScale(Bird3,Scale,Scale,Scale)
 call SetUnitScale(Bird4,Scale,Scale,Scale)
-if Count==450 then
+if Count==(TotalDuration-175)then
 call PlaySoundForPlayerEx(gg_snd_FireSpiritsReady,GetOwningPlayer(Source))
 endif
-if Count>425 then
+if Count>(TotalDuration-200)then
 if ModuloInteger(Count,10)==0 or ModuloInteger(Count,10)==1 or ModuloInteger(Count,10)==2 or ModuloInteger(Count,10)==3 or ModuloInteger(Count,10)==4 then
 call SetUnitVertexColor(Bird1,255,0,0,255)
 call SetUnitVertexColor(Bird2,255,0,0,255)
 call SetUnitVertexColor(Bird3,255,0,0,255)
 call SetUnitVertexColor(Bird4,255,0,0,255)
 else
 call SetUnitVertexColor(Bird1,255,255,255,255)
 call SetUnitVertexColor(Bird2,255,255,255,255)
 call SetUnitVertexColor(Bird3,255,255,255,255)
 call SetUnitVertexColor(Bird4,255,255,255,255)
 endif
 endif
 endif
 endif
 set t=null
@@ -77210,31 +79046,31 @@
 function Firespirits takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local real SourceX=GetUnitX(Source)
 local real SourceY=GetUnitY(Source)
 local real x
 local real y
 local unit Bird1
 local unit Bird2
 local unit Bird3
 local unit Bird4
 local real a=GetUnitFacing(Source)
 local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,SourceX,SourceY,0)
 call UnitAddAbility(Caster,abilityid_firespirits_slow)
-call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)-GetUnitState(Source,UNIT_STATE_LIFE)*0.1)
+call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)-GetUnitState(Source,UNIT_STATE_LIFE)*0.15)
 call UnitAddAbility2(Source,1093753394)
 call UnitMakeAbilityPermanent(Source,true,1093753394)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_firespirits_helper,true)
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_firespirits,false)
 set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*4/4.0*-1.0)
 set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*4/4.0*-1.0)
 set Bird1=CreateUnit(GetOwningPlayer(Source),unitid_firespirits,x,y,360*4/4.0*-1.0)
 set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*3/4.0*-1.0)
 set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*3/4.0*-1.0)
 set Bird2=CreateUnit(GetOwningPlayer(Source),unitid_firespirits,x,y,360*3/4.0*-1.0)
 set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*2/4.0*-1.0)
 set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*2/4.0*-1.0)
 set Bird3=CreateUnit(GetOwningPlayer(Source),unitid_firespirits,x,y,360*2/4.0*-1.0)
 set x=GetUnitX(Source)+200*Cos(bj_DEGTORAD*360*1/4.0*-1.0)
 set y=GetUnitY(Source)+200*Sin(bj_DEGTORAD*360*1/4.0*-1.0)
@@ -77256,30 +79092,91 @@
 set Bird4=null
 set Caster=null
 endfunction
 function Firespirits_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_firespirits then
 call Firespirits()
 endif
 return false
 endfunction
 function Register_Firespirits takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Firespirits_Main))
 set t=null
 endfunction
+function Overheat_End takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_overheat)
+if GetTriggerEventId()==EVENT_UNIT_DEATH or GetTriggerEvalCount(t)>4 then
+call UnitRemoveAbility(Target,overheat_disarm)
+call SaveInteger(hash_main,(GetHandleId((Target))),((4311)),(HERO_STATE_OFF))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(176))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,20*Level)
+set t=null
+set Source=null
+return false
+endfunction
+function Overheat_Add takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local unit Target=GetEnumUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,1,true)
+call TriggerAddCondition(t,Condition(function Overheat_End))
+call TriggerRegisterDeathEvent(t,Target)
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveEffectHandle(hash_main,(Cache),(176),(AddSpecialEffectTarget(overheat_fx,Target,"chest")))
+call UnitAddAbility(Target,overheat_disarm)
+call UnitMakeAbilityPermanent(Target,true,overheat_disarm)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),overheat_disarm,false)
+call SaveInteger(hash_main,(GetHandleId((Target))),((4311)),(HERO_STATE_ON))
+set Source=null
+set Target=null
+set t=null
+endfunction
+function Overheat takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local real x=GetSpellTargetX()
+local real y=GetSpellTargetY()
+local group g=GetAvailableGroup()
+call DestroyEffect(AddSpecialEffect(overheat_fx,x,y))
+call GroupEnumUnitsInRange(g,x,y,275+25,Condition(function GenericCondition_EnemyUnits))
+call ForGroup(g,function Overheat_Add)
+call KillGroup(g)
+set g=null
+set Source=null
+endfunction
+function Overheat_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_overheat then
+call Overheat()
+endif
+return false
+endfunction
+function Register_Overheat takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function Overheat_Main))
+set t=null
+endfunction
 function ShadowPoison_Expire takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local integer Count=(LoadInteger(hash_main,(GetHandleId(Target)),(627)))
 local real ExpireTime=(LoadReal(hash_main,(GetHandleId(Target)),(628)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_shadowpoison)
 local real Damage=(5+Level*15)*Pow(2,IMinBJ(Count,4)-1)
 set Damage=Damage+IMaxBJ(Count-4,0)*50
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 if IsUnitType(Target,UNIT_TYPE_HERO)==true then
 call KillUnit((LoadUnitHandle(hash_main,(Cache),(45))))
 endif
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
@@ -77386,31 +79283,31 @@
 local group g
 local group AlreadyDamaged=(LoadGroupHandle(hash_main,(Cache),(133)))
 local unit Target
 if Count==75 then
 call KillGroup(AlreadyDamaged)
 call KillUnit(Projectile)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set tt_unit1=Source
 set shadowpoison_source=Source
 set shadowpoison_group=AlreadyDamaged
 call SetUnitX(Projectile,x)
 call SetUnitY(Projectile,y)
 set g=GetAvailableGroup()
-call GroupEnumUnitsInRange(g,x,y,175,Condition(function GenericCondition_EnemyUnitsNoImmune))
+call GroupEnumUnitsInRange(g,x,y,180+25,Condition(function GenericCondition_EnemyUnitsNoImmune))
 call ForGroup(g,function ShadowPoison_Process)
 set Target=FirstOfGroup(g)
 call KillGroup(g)
 endif
 set t=null
 set Source=null
 set Projectile=null
 set g=null
 set Target=null
 set AlreadyDamaged=null
 return false
 endfunction
 function ShadowPoison takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
@@ -77699,63 +79596,64 @@
 endfunction
 function SeekingMissle_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local integer Count=GetTriggerEvalCount(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
 local real x
 local real y
 local real d
 local real damage
 local real LastX=(LoadReal(hash_main,(Cache),(23)))
 local real LastY=(LoadReal(hash_main,(Cache),(24)))
 local real a=AngleBetweenXY(LastX,LastY,GetUnitX(Target),GetUnitY(Target))*bj_DEGTORAD
+local integer Level=GetUnitAbilityLevel(Source,abilityid_seekingmissle)
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call UnitShareVision(Projectile,GetOwningPlayer(Target),false)
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 if GetTriggerUnit()!=Projectile then
 call KillUnit(Projectile)
 endif
 elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 call UnitRemoveBuffs(Projectile,true,true)
 elseif Count<3/seekingmissle_tickrate then
 call SetUnitFacing(Projectile,a*bj_RADTODEG)
 else
 if Count==4/seekingmissle_tickrate then
 call UnitShareVision(Projectile,GetOwningPlayer(Target),true)
 endif
 call SetUnitFacing(Projectile,a*bj_RADTODEG)
 set x=LastX+(280+seekingmissle_acceleration*Count*seekingmissle_tickrate)*seekingmissle_tickrate*Cos(a)
 set y=LastY+(280+seekingmissle_acceleration*Count*seekingmissle_tickrate)*seekingmissle_tickrate*Sin(a)
 call SetUnitPosition(Projectile,x,y)
 call SaveReal(hash_main,(Cache),(23),((x)*1.0))
 call SaveReal(hash_main,(Cache),(24),((y)*1.0))
 if DistanceBetweenXY(x,y,GetUnitX(Target),GetUnitY(Target))<20 then
-set d=RMinBJ(DistanceBetweenXY(x,y,(LoadReal(hash_main,(Cache),(6))),(LoadReal(hash_main,(Cache),(7)))),2000)
-set damage=d/2000*(110*GetUnitAbilityLevel(Source,abilityid_seekingmissle))
+set d=RMinBJ(DistanceBetweenXY(x,y,(LoadReal(hash_main,(Cache),(6))),(LoadReal(hash_main,(Cache),(7)))),1500)
+set damage=d/1500*(110*GetUnitAbilityLevel(Source,abilityid_seekingmissle))
 set damage=RMaxBJ(damage,50)
 call KillUnit(Projectile)
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 if GenericCondition_IsDotAInvis(Target)==false or IsUnitVisible(Target,GetOwningPlayer(Source))==true then
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,damage)
-call Stun(Source,Target,2.5)
+call Stun(Source,Target,2+0.2*Level)
 endif
 endif
 endif
 set t=null
 set Source=null
 set Target=null
 set Projectile=null
 return false
 endfunction
 function SeekingMissle takes nothing returns nothing
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local real a=AngleBetweenXY(GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))*bj_DEGTORAD
@@ -77887,41 +79785,41 @@
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local group g
 local integer Count=GetTriggerEvalCount(t)
 local fogmodifier fog=(LoadFogModifierHandle(hash_main,(Cache),(42)))
 if Count==1 then
 call DestroyEffect(AddSpecialEffectTarget(fx_calldown_up,Source,"chest"))
 elseif Count==2 then
 call DestroyEffect(AddSpecialEffectTarget(fx_calldown_up,Source,"chest"))
 elseif Count==3 then
 call DestroyEffect(AddSpecialEffect(fx_calldown_down,x,y))
 elseif Count==4 then
 set g=GetAvailableGroup()
 set tt_unit1=Source
 set calldown_source=Source
-call GroupEnumUnitsInRange(g,x,y,425,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupEnumUnitsInRange(g,x,y,450+25,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function CallDown_Hit1)
 call KillGroup(g)
 call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl",x,y))
 elseif Count==5 then
 call DestroyEffect(AddSpecialEffect(fx_calldown_down,x,y))
 elseif Count==6 then
 set g=GetAvailableGroup()
 set tt_unit1=Source
 set calldown_source=Source
-call GroupEnumUnitsInRange(g,x,y,425,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupEnumUnitsInRange(g,x,y,450+25,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function CallDown_Hit2)
 call KillGroup(g)
 call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\DemolisherFireMissile\\DemolisherFireMissile.mdl",x,y))
 call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FogModifierStop(fog)
 call DestroyFogModifier(fog)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Source=null
 set g=null
 return false
 endfunction
 function CallDown takes nothing returns nothing
@@ -78104,30 +80002,33 @@
 call TriggerAddCondition(t,Condition(function FlakCannon_RemoveIllusions))
 set t=null
 endfunction
 function EnergyField_Process takes nothing returns boolean
 local unit Target=GetFilterUnit()
 local unit Source=energyfield_source
 local real SourceX=energyfield_sourcex
 local real SourceY=energyfield_sourcey
 local real CurrentX=energyfield_currentx
 local real CurrentY=energyfield_currenty
 local real x
 local real y
 local real a
 local real d
 if(IsMagicImmune(GetFilterUnit())==false and IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))then
+if((LoadInteger(hash_main,(GetHandleId((Target))),((4324))))==HERO_STATE_ON)==false then
+call AddHeroState(Target,4324,0.3)
+endif
 set d=DistanceBetweenXY(SourceX,SourceY,GetUnitX(Target),GetUnitY(Target))
 set a=AngleBetweenXY(SourceX,SourceY,GetUnitX(Target),GetUnitY(Target))*bj_DEGTORAD
 if d>energyfield_range then
 set x=GetUnitX(Target)+11*Cos(a)
 set y=GetUnitY(Target)+11*Sin(a)
 else
 set x=GetUnitX(Target)-11*Cos(a)
 set y=GetUnitY(Target)-11*Sin(a)
 endif
 call SetUnitX(Target,x)
 call SetUnitY(Target,y)
 endif
 set Target=null
 set Source=null
 return false
@@ -78342,83 +80243,93 @@
 call TriggerAddCondition(t,Condition(function Glipse_Loop))
 set t=null
 endfunction
 function ThunderSurge_Hit takes nothing returns nothing
 if thundersurge_target!=GetEnumUnit()then
 call DamageTarget(thundersurge_source,GetEnumUnit(),DAMAGE_MAGICAL,thundersurge_level*25+25)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",GetEnumUnit(),"chest"))
 endif
 endfunction
 function ThunderSurge_Iterate takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
 local integer Level=(LoadInteger(hash_main,(Cache),(5)))
 local group g
 local integer Count=GetTriggerEvalCount(t)
 local unit Dummy=null
 call SetUnitX(Caster,GetUnitX(Target))
 call SetUnitY(Caster,GetUnitY(Target))
+call SetUnitX(Projectile,GetUnitX(Target))
+call SetUnitY(Projectile,GetUnitY(Target))
 if Count==1 or Count==100 or Count==200 then
 set g=GetAvailableGroup()
 if IsDead(Target)then
 set Dummy=CreateUnit(GetOwningPlayer(Target),1697656899,GetUnitX(Target),GetUnitY(Target),0)
 call UnitApplyTimedLife(Dummy,1112820806,0.2)
 call IssueTargetOrder(Caster,"chainlightning",Dummy)
 else
 call IssueTargetOrder(Caster,"chainlightning",Target)
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,Level*25+25)
 endif
 call TimedLifeUnitEffect("war3mapImported\\ThunderStorm_Groundeffect.mdx",Target,"origin",0.6)
 set tt_unit1=Source
 set thundersurge_source=Source
 set thundersurge_target=Target
 set thundersurge_level=Level
-call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),225,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),200+25,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function ThunderSurge_Hit)
 call KillGroup(g)
 if GetTriggerEvalCount(t)==200 then
 call KillUnit(Caster)
+call KillUnit(Projectile)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 endif
 set t=null
 set Source=null
 set Target=null
 set Caster=null
+set Projectile=null
 return false
 endfunction
 function ThunderSurge takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local integer Level=GetUnitAbilityLevel(Source,abilityid_thundersurge)
-local unit Caster=CreateUnit(GetOwningPlayer(Source),1697657424,GetUnitX(Target),GetUnitY(Target),0)
+local unit Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
+local unit Projectile=CreateUnit(GetOwningPlayer(Source),1697657424,GetUnitX(Target),GetUnitY(Target),0)
+call UnitAddAbility2(Projectile,1097625443)
 call UnitAddAbility2(Caster,thundersurge_lightning)
 call SetUnitAbilityLevel(Caster,thundersurge_lightning,Level)
 call UnitAddAbility2(Caster,1097625443)
 call TriggerRegisterTimerEvent(t,0.02,true)
 call TriggerAddCondition(t,Condition(function ThunderSurge_Iterate))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+call SaveUnitHandle(hash_main,(Cache),(45),(Projectile))
 call SaveInteger(hash_main,(Cache),(5),(Level))
 set Source=null
 set Target=null
+set Projectile=null
 set t=null
 endfunction
 function ThunderSurge_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_thundersurge and IsBlocked(GetSpellTargetUnit())==false then
 call ThunderSurge()
 endif
 return false
 endfunction
 function Register_ThunderSurge takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function ThunderSurge_Main))
 set t=null
 endfunction
 function StaticStorm_Hit takes nothing returns nothing
@@ -78433,31 +80344,31 @@
 local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 local group g
 local integer Count=GetTriggerEvalCount(t)
 if Count>20 then
 call StopSound(gg_snd_CloudOfFogLoop1,false,true)
 call KillUnit(Projectile)
 call ShowUnit(Projectile,false)
 call KillUnit(Caster)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set g=GetAvailableGroup()
 set tt_unit1=Source
 set staticstorm_source=Source
-set staticstorm_damage=0.25*(130+40*Level)*(Count/20.0)
+set staticstorm_damage=0.25*(120+50*Level)*(Count/20.0)
 set staticstorm_show=false
 if ModuloInteger(Count,4)==0 then
 set staticstorm_show=true
 endif
 call GroupEnumUnitsInRange(g,GetUnitX(Projectile),GetUnitY(Projectile),400,Condition(function GenericCondition_EnemyUnitsWithAncientsEx))
 call ForGroup(g,function StaticStorm_Hit)
 call KillGroup(g)
 set g=null
 endif
 set t=null
 set Source=null
 set Projectile=null
 set Caster=null
 return false
 endfunction
@@ -78921,32 +80832,32 @@
 call SaveTriggerHandle(hash_main,(GetHandleId(u)),(709),(t))
 call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(u))
 call SaveInteger(hash_main,(GetHandleId(t)),(5),(i))
 endif
 set t=null
 endfunction
 function Overcharge_Loop takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 local integer Level=GetUnitAbilityLevel(Source,abilityid_overcharge)
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Tethered=(LoadUnitHandle(hash_main,(GetHandleId(Source)),(652)))
 local boolean Active=false
-local real LifeDrain=0.2*(GetUnitState(Source,UNIT_STATE_LIFE)*0.025)
-local real ManaDrain=0.2*(GetUnitState(Source,UNIT_STATE_MANA)*0.025)
+local real LifeDrain=0.2*(GetUnitState(Source,UNIT_STATE_LIFE)*0.035)
+local real ManaDrain=0.2*(GetUnitState(Source,UNIT_STATE_MANA)*0.035)
 if GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
 if GetIssuedOrderId()==String2OrderIdBJ("manashieldon")then
 call Overcharge_Add(Source,Level)
 elseif GetIssuedOrderId()==String2OrderIdBJ("manashieldoff")then
 call Overcharge_Remove(Source)
 endif
 endif
 if GetUnitAbilityLevel(Source,overcharge_damage_1)>0 or GetUnitAbilityLevel(Source,overcharge_damage_2)>0 or GetUnitAbilityLevel(Source,overcharge_damage_3)>0 or GetUnitAbilityLevel(Source,overcharge_damage_4)>0 then
 set Active=true
 call SetUnitState(Source,UNIT_STATE_LIFE,RMaxBJ(GetUnitState(Source,UNIT_STATE_LIFE)-LifeDrain,1))
 call SetUnitState(Source,UNIT_STATE_MANA,RMaxBJ(GetUnitState(Source,UNIT_STATE_MANA)-ManaDrain,1))
 endif
 if Tethered==null then
 if Target!=null then
 call Overcharge_Remove(Target)
@@ -79084,60 +80995,61 @@
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local group AlreadyDamaged=(LoadGroupHandle(hash_main,(Cache),(133)))
 local lightning Light=(LoadLightningHandle(hash_main,(Cache),(196)))
 local integer Count=GetTriggerEvalCount(t)
 local real d=DistanceBetweenUnits(Source,Target)
 local real a=1
 local real CurrentHealth=GetUnitState(Source,UNIT_STATE_LIFE)
 local real CurrentMana=GetUnitState(Source,UNIT_STATE_MANA)
 local real PercentageHealth=(LoadReal(hash_main,(Cache),(670)))
 local real PercentageMana=(LoadReal(hash_main,(Cache),(667)))
 local real NewPercentageHealth
 local real NewPercentageMana
+local real BonusFactor=1.5
 if Target==null or Source==null or IsDead(Source)==true or(Count>600 and Tether_IsRelocating(Source,Target)==false and((LoadInteger(hash_main,(GetHandleId((Source))),((4295))))==HERO_STATE_ON)==false)or(d>925 and((LoadInteger(hash_main,(GetHandleId((Source))),((4295))))==HERO_STATE_ON)==false)or GetTriggerEventId()==EVENT_UNIT_DEATH or(GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()==abilityid_tether_helper)then
 call KillGroup(AlreadyDamaged)
 call DestroyLightning(Light)
 call UnitRemoveAbility(Target,tether_ms_1)
 call UnitRemoveAbility(Target,tether_ms_2)
 call UnitRemoveAbility(Target,tether_ms_3)
 call UnitRemoveAbility(Target,tether_ms_4)
 call UnitRemoveAbility(Target,tether_buff)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 call UnitRemoveAbility(Source,tether_ms_1)
 call UnitRemoveAbility(Source,tether_ms_2)
 call UnitRemoveAbility(Source,tether_ms_3)
 call UnitRemoveAbility(Source,tether_ms_4)
 call UnitRemoveAbility(Source,tether_buff)
 call UnitRemoveAbility(Source,abilityid_tether_helper)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_tether then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_tether,true)
 endif
 call RemoveSavedHandle(hash_main,GetHandleId(Source),652)
 else
 set NewPercentageHealth=CurrentHealth/GetUnitState(Source,UNIT_STATE_MAX_LIFE)
 set NewPercentageMana=CurrentMana/GetUnitState(Source,UNIT_STATE_MAX_MANA)
 if NewPercentageHealth-PercentageHealth>0 and(NewPercentageHealth-PercentageHealth)<0.5 then
 if((LoadInteger(hash_main,(GetHandleId((Source))),((4298))))==HERO_STATE_ON)==false then
-call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+(NewPercentageHealth-PercentageHealth)*GetUnitState(Source,UNIT_STATE_MAX_LIFE))
+call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+BonusFactor*(NewPercentageHealth-PercentageHealth)*GetUnitState(Source,UNIT_STATE_MAX_LIFE))
 endif
 endif
 if NewPercentageMana-PercentageMana>0 and(NewPercentageHealth-PercentageHealth)<0.5 then
-call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)+(NewPercentageMana-PercentageMana)*GetUnitState(Source,UNIT_STATE_MAX_MANA))
+call SetUnitState(Target,UNIT_STATE_MANA,GetUnitState(Target,UNIT_STATE_MANA)+BonusFactor*(NewPercentageMana-PercentageMana)*GetUnitState(Source,UNIT_STATE_MAX_MANA))
 endif
 call SaveReal(hash_main,(Cache),(670),((GetUnitState(Source,UNIT_STATE_LIFE)/GetUnitState(Source,UNIT_STATE_MAX_LIFE))*1.0))
 call SaveReal(hash_main,(Cache),(667),((GetUnitState(Source,UNIT_STATE_MANA)/GetUnitState(Source,UNIT_STATE_MAX_MANA))*1.0))
 call MoveLightning(Light,true,GetUnitX(Source),GetUnitY(Source),GetUnitX(Target),GetUnitY(Target))
 call Tether_Search(Source,Target,AlreadyDamaged)
 if IsUnitVisible(Source,GetLocalPlayer())==false and IsUnitVisible(Target,GetLocalPlayer())==false then
 set a=0
 endif
 if IsObserver(GetLocalPlayer())then
 set a=1
 endif
 if d<700 or((LoadInteger(hash_main,(GetHandleId((Source))),((4295))))==HERO_STATE_ON)==true then
 call SetLightningColorBJ(Light,0.00,1.00,1.00,a)
 else
 call SetLightningColorBJ(Light,0.80,0.70,0.40,a)
@@ -79863,31 +81775,31 @@
 set AlreadyDamaged=null
 return false
 endfunction
 function Snowball_Add takes nothing returns nothing
 call DestroyEffect(AddSpecialEffect("war3mapImported\\ChainFreeze_F6.mdx",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
 call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",GetUnitX(GetEnumUnit()),GetUnitY(GetEnumUnit())))
 call ShowUnit(GetEnumUnit(),false)
 call UnitAddAbility2(GetEnumUnit(),1093678162)
 call SetUnitInvulnerable(GetEnumUnit(),true)
 call PauseUnit(GetEnumUnit(),true)
 if snowball_source!=GetEnumUnit()then
 set snowball_count=snowball_count+1
 endif
 endfunction
 function Snowball_WhichUnits takes nothing returns boolean
-return(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and((LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(GetFilterUnit()))),(139)))==false or snowball_source==GetFilterUnit())
+return((IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO)==true and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetFilterUnit()))==false and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))or(GetOwningPlayer(GetFilterUnit())==GetOwningPlayer(GetTriggerUnit())and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit()))))and((LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(GetFilterUnit()))),(139)))==false or snowball_source==GetFilterUnit())
 endfunction
 function Snowball takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local unit Target=GetSpellTargetUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 local real SourceX=GetUnitX(Source)
 local real SourceY=GetUnitY(Source)
 local real TargetX=GetUnitX(Target)
 local real TargetY=GetUnitY(Target)
 local real a=AngleBetweenXY(SourceX,SourceY,TargetX,TargetY)*bj_DEGTORAD
 local unit Projectile=CreateUnit(GetOwningPlayer(Source),unitid_snowball,GetUnitX(Source),GetUnitY(Source),GetUnitFacing(Source))
 local group g=GetAvailableGroup()
 set snowball_speed=0
 set snowball_count=1
@@ -79954,42 +81866,30 @@
 set Source=null
 set Target=null
 endfunction
 function FrozenSigil_Main takes nothing returns boolean
 local integer id=GetUnitTypeId(GetSummonedUnit())
 if id==1865429322 or id==1865429323 or id==1865429324 or id==1865429325 then
 call FrozenSigil()
 endif
 return false
 endfunction
 function Register_FrozenSigil takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SUMMON)
 call TriggerAddCondition(t,Condition(function FrozenSigil_Main))
 endfunction
-function PrimalSplit_IsPanda takes integer uid returns boolean
-if uid==1852862003 or uid==1852862006 or uid==1848652080 or uid==1848657754 then
-return true
-endif
-if uid==1852862002 or uid==1852862006 or uid==1848652082 or uid==1848657969 then
-return true
-endif
-if uid==1852862001 or uid==1852862004 or uid==1848652081 or uid==1848657968 then
-return true
-endif
-return false
-endfunction
 function PrimalSplit_Loop takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
 if GetTriggerEventId()==EVENT_UNIT_DEATH then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEventId()==EVENT_UNIT_DAMAGED then
 set primalsplit_killer=GetEventDamageSource()
 else
 call SetUnitX(Source,GetUnitX(Target))
 call SetUnitY(Source,GetUnitY(Target))
 call SetUnitX(Caster,GetUnitX(Target))
@@ -80309,31 +82209,31 @@
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
 local group AlreadyHit=(LoadGroupHandle(hash_main,(Cache),(187)))
 local real x=GetUnitX(Target)
 local real y=GetUnitY(Target)
 local group g=GetAvailableGroup()
 call GroupAddUnit(AlreadyHit,Target)
 call FadeBolt_Hit(Source,Target)
 set tt_unit1=Source
 set fadebolt_newtarget=null
 set fadebolt_projectile=Target
 set fadebolt_group=AlreadyHit
 set fadebolt_d=999999
-call GroupEnumUnitsInRange(g,x,y,525,Condition(function GenericCondition_EnemyUnitsExNoImmuneNoInvis))
+call GroupEnumUnitsInRange(g,x,y,440+25,Condition(function GenericCondition_EnemyUnitsExNoImmuneNoInvis))
 call ForGroup(g,function FadeBolt_WhichUnit)
 call KillGroup(g)
 if fadebolt_newtarget==null or GetTriggerEvalCount(t)>26 then
 call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set Target=fadebolt_newtarget
 call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 endif
 set g=null
 set t=null
 set Source=null
 set Target=null
 set AlreadyHit=null
@@ -80396,56 +82296,57 @@
 return true
 endif
 set i=i+1
 endloop
 return false
 endfunction
 function SpellSteal_Monitor takes nothing returns boolean
 if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and SpellSteal_IsBlocked(GetSpellAbilityId())==false then
 call SaveInteger(hash_main,(GetHandleId(GetTriggerUnit())),(705),(GetSpellAbilityId()))
 call SaveInteger(hash_main,(GetHandleId(GetTriggerUnit())),(712),(GetUnitAbilityLevel(GetTriggerUnit(),GetSpellAbilityId())))
 endif
 return false
 endfunction
 function SpellSteal_RemoveAll takes unit u returns nothing
 call UnitRemoveAbility(u,1093743428)
-call UnitRemoveAbility(u,1093808458)
+call UnitRemoveAbility(u,abilityid_ancestralcharge_end)
 call UnitRemoveAbility(u,1093751126)
 call UnitRemoveAbility(u,1093751893)
 call UnitRemoveAbility(u,1093809217)
 call UnitRemoveAbility(u,1093809218)
 call UnitRemoveAbility(u,1093750344)
 call UnitRemoveAbility(u,1093808206)
 call UnitRemoveAbility(u,1093753394)
 call UnitRemoveAbility(u,1093753395)
 call UnitRemoveAbility(u,1093808181)
 call UnitRemoveAbility(u,1093752405)
 call UnitRemoveAbility(u,1093683011)
 call UnitRemoveAbility(u,1093809221)
 call UnitRemoveAbility(u,1093685844)
 call UnitRemoveAbility(u,1093751361)
 call UnitRemoveAbility(u,1093683265)
 call UnitRemoveAbility(u,1093686081)
 call UnitRemoveAbility(u,1093743153)
 call UnitRemoveAbility(u,1093752646)
 call UnitRemoveAbility(u,1093677652)
 call UnitRemoveAbility(u,1093751609)
 call UnitRemoveAbility(u,1093808456)
 call UnitRemoveAbility(u,1093750094)
 call UnitRemoveAbility(u,1093678667)
 call UnitRemoveAbility(u,1093684805)
 call UnitRemoveAbility(u,1093684560)
+call UnitRemoveAbility(u,1093815618)
 endfunction
 function SpellSteal_DelayRemove_Process takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer spellid=(LoadInteger(hash_main,(Cache),(704)))
 local integer Offset=(LoadInteger(hash_main,(Cache),(713)))
 if spellid==(LoadInteger(hash_main,(GetHandleId(Source)),(704)))then
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif GetTriggerEvalCount(t)>(15-Offset)and IsDead(Source)==false then
 call UnitRemoveAbility(Source,spellid)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
@@ -80614,32 +82515,33 @@
 endfunction
 function SpellSteal_CreateIgnoreList takes nothing returns nothing
 call SpellSteal_RegisterIgnoredSpell(1093752648)
 call SpellSteal_RegisterIgnoredSpell(1095656306)
 call SpellSteal_RegisterIgnoredSpell(1093677895)
 call SpellSteal_RegisterIgnoredSpell(1093679411)
 call SpellSteal_RegisterIgnoredSpell(1093743946)
 call SpellSteal_RegisterIgnoredSpell(1093681479)
 call SpellSteal_RegisterIgnoredSpell(1093681733)
 call SpellSteal_RegisterIgnoredSpell(1093751896)
 call SpellSteal_RegisterIgnoredSpell(1093808697)
 call SpellSteal_RegisterIgnoredSpell(1093751369)
 call SpellSteal_RegisterIgnoredSpell(1093747504)
 call SpellSteal_RegisterIgnoredSpell(1093742932)
 call SpellSteal_RegisterIgnoredSpell(1093744986)
+call SpellSteal_RegisterIgnoredSpell(1093815877)
 call SpellSteal_RegisterIgnoredSpell(1093743428)
-call SpellSteal_RegisterIgnoredSpell(1093808458)
+call SpellSteal_RegisterIgnoredSpell(abilityid_ancestralcharge_end)
 call SpellSteal_RegisterIgnoredSpell(1093751126)
 call SpellSteal_RegisterIgnoredSpell(1093751893)
 call SpellSteal_RegisterIgnoredSpell(1093809217)
 call SpellSteal_RegisterIgnoredSpell(1093809218)
 call SpellSteal_RegisterIgnoredSpell(1093750344)
 call SpellSteal_RegisterIgnoredSpell(1093808206)
 call SpellSteal_RegisterIgnoredSpell(1093753394)
 call SpellSteal_RegisterIgnoredSpell(1093753395)
 call SpellSteal_RegisterIgnoredSpell(1093808181)
 call SpellSteal_RegisterIgnoredSpell(1093752405)
 call SpellSteal_RegisterIgnoredSpell(1093683011)
 call SpellSteal_RegisterIgnoredSpell(1093809221)
 call SpellSteal_RegisterIgnoredSpell(1093685844)
 call SpellSteal_RegisterIgnoredSpell(1093751361)
 call SpellSteal_RegisterIgnoredSpell(1093683265)
@@ -80649,30 +82551,34 @@
 call SpellSteal_RegisterIgnoredSpell(1093677652)
 call SpellSteal_RegisterIgnoredSpell(1093751609)
 call SpellSteal_RegisterIgnoredSpell(1093808456)
 call SpellSteal_RegisterIgnoredSpell(1093750094)
 call SpellSteal_RegisterIgnoredSpell(1093684056)
 call SpellSteal_RegisterIgnoredSpell(1093684055)
 call SpellSteal_RegisterIgnoredSpell(1093681461)
 call SpellSteal_RegisterIgnoredSpell(1093681735)
 call SpellSteal_RegisterIgnoredSpell(1093808471)
 call SpellSteal_RegisterIgnoredSpell(1093808472)
 call SpellSteal_RegisterIgnoredSpell(1093808470)
 call SpellSteal_RegisterIgnoredSpell(1093808473)
 call SpellSteal_RegisterIgnoredSpell(1093748565)
 call SpellSteal_RegisterIgnoredSpell(1093752392)
 call SpellSteal_RegisterIgnoredSpell(1093752391)
+call SpellSteal_RegisterIgnoredSpell(1093815600)
+call SpellSteal_RegisterIgnoredSpell(1093815618)
+call SpellSteal_RegisterIgnoredSpell(abilityid_trueshotaura)
+call SpellSteal_RegisterIgnoredSpell(abilityid_nightmare_helper)
 call SpellSteal_RegisterIgnoredSpell(1093685582)
 call SpellSteal_RegisterIgnoredSpell(1093677622)
 call SpellSteal_RegisterIgnoredSpell(1095263841)
 call SpellSteal_RegisterIgnoredSpell(1093679446)
 call SpellSteal_RegisterIgnoredSpell(1093682265)
 call SpellSteal_RegisterIgnoredSpell(1093752642)
 call SpellSteal_RegisterIgnoredSpell(1093684314)
 call SpellSteal_RegisterIgnoredSpell(1093685065)
 call SpellSteal_RegisterIgnoredSpell(1093750337)
 call SpellSteal_RegisterIgnoredSpell(1093748033)
 call SpellSteal_RegisterIgnoredSpell(1093684819)
 call SpellSteal_RegisterIgnoredSpell(1093747777)
 call SpellSteal_RegisterIgnoredSpell(1093810257)
 call SpellSteal_RegisterIgnoredSpell(1093687121)
 call SpellSteal_RegisterIgnoredSpell(1093751864)
@@ -80752,30 +82658,31 @@
 call SpellSteal_RegisterIgnoredSpell(1095328865)
 call SpellSteal_RegisterIgnoredSpell(1093809721)
 call SpellSteal_RegisterIgnoredSpell(1093752655)
 call SpellSteal_RegisterIgnoredSpell(1093748055)
 call SpellSteal_RegisterIgnoredSpell(1093750095)
 call SpellSteal_RegisterIgnoredSpell(1093753417)
 call SpellSteal_RegisterIgnoredSpell(1093753416)
 call SpellSteal_RegisterIgnoredSpell(1093753431)
 call SpellSteal_RegisterIgnoredSpell(1093808945)
 call SpellSteal_RegisterIgnoredSpell(1093743191)
 call SpellSteal_RegisterIgnoredSpell(1093743681)
 call SpellSteal_RegisterIgnoredSpell(1093751096)
 call SpellSteal_RegisterIgnoredSpell(1093810265)
 call SpellSteal_RegisterIgnoredSpell(1093810244)
 call SpellSteal_RegisterIgnoredSpell(veilofdiscord)
+call SpellSteal_RegisterIgnoredSpell(1093815857)
 call SpellSteal_RegisterIgnoredSpell(1093814863)
 call SpellSteal_RegisterIgnoredSpell(1093814865)
 call SpellSteal_RegisterIgnoredSpell(1093814864)
 call SpellSteal_RegisterIgnoredSpell(1093814866)
 call SpellSteal_RegisterIgnoredSpell(1093814860)
 call SpellSteal_RegisterIgnoredSpell(1093813848)
 call SpellSteal_RegisterIgnoredSpell(1093815089)
 call SpellSteal_RegisterIgnoredSpell(1093815092)
 call SpellSteal_RegisterIgnoredSpell(1093815095)
 call SpellSteal_RegisterIgnoredSpell(1093815111)
 call SpellSteal_RegisterIgnoredSpell(1093815109)
 call SpellSteal_RegisterIgnoredSpell(1093815112)
 call SpellSteal_RegisterIgnoredSpell(1093815097)
 call SpellSteal_RegisterIgnoredSpell(1093813569)
 endfunction
@@ -81505,31 +83412,31 @@
 call SaveReal(hash_main,(Cache),(10000),(((TimerGetElapsed(udg_GameTimer)))*1.0))
 call SaveReal(hash_main,(Cache),(11000),((x)*1.0))
 call SaveReal(hash_main,(Cache),(11000),((y)*1.0))
 endfunction
 function FireRemnant_RegisterDPSCode takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call TriggerRegisterTimerEvent(t,0.5,true)
 call TriggerAddCondition(t,Condition(function FireRemnantPath_DPS))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 set Source=null
 set t=null
 endfunction
 function FireRemnant_Hit takes nothing returns nothing
-call DamageTarget(fireremnant_source,GetEnumUnit(),DAMAGE_MAGICAL,80+fireremnant_level*40)
+call DamageTarget(fireremnant_source,GetEnumUnit(),DAMAGE_MAGICAL,50+fireremnant_level*50)
 call DestroyEffect(AddSpecialEffectTarget(fireremnant_fx_impact,GetEnumUnit(),"origin"))
 endfunction
 function FireRemnant_Explode takes unit Source,unit Remnant,real x,real y returns nothing
 local group g
 call KillUnit(Remnant)
 call TimedLifeEffect("war3mapImported\\Firaga_2.mdx",x,y,2)
 set g=GetAvailableGroup()
 set tt_unit1=Source
 set fireremnant_source=Source
 set fireremnant_level=GetUnitAbilityLevel(Source,abilityid_fireremnant)
 call GroupEnumUnitsInRange(g,x,y,450+25,Condition(function GenericCondition_EnemyUnitsEx))
 call UnitRemoveAbility(Source,1093678162)
 call ForGroup(g,function FireRemnant_Hit)
 call UnitAddAbility2(Source,1093678162)
 call KillGroup(g)
@@ -81825,31 +83732,31 @@
 call FireRemnant_Activate()
 endif
 return false
 endfunction
 function FireRemnant_ChargeLogic takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local integer Charges=(LoadInteger(hash_main,(GetHandleId(Source)),(747)))
 local integer Count=(LoadInteger(hash_main,(Cache),(34)))
 if Charges<3 then
 set Count=Count-1
 call SaveInteger(hash_main,(Cache),(34),(Count))
 if Count==0 then
 call UnitRemoveAbility(Source,abilityid_fireremnant_place[Charges])
-set Count=30
+set Count=35
 call SaveInteger(hash_main,(Cache),(34),(Count))
 set Charges=Charges+1
 call SaveInteger(hash_main,(GetHandleId(Source)),(747),(Charges))
 call UnitAddAbility2(Source,abilityid_fireremnant_place[Charges])
 endif
 endif
 set t=null
 set Source=null
 return false
 endfunction
 function FireRemnant_RegisterCharges takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
 call SaveInteger(hash_main,(GetHandleId(Source)),(747),(3))
@@ -82254,80 +84161,86 @@
 set Source=null
 endfunction
 function Wraith_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_wraith then
 call Wraith()
 endif
 return false
 endfunction
 function Register_Wraith takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Wraith_Main))
 set t=null
 endfunction
 function Blackjack_RegisterTarget takes unit Source,unit Creature,unit Target,integer Level returns nothing
+call GroupAddUnit(blackjack_alreadyhit,Target)
 call Stun(Source,Target,1.25+0.25*Level)
 call DamageTarget(Source,Target,DAMAGE_MAGICAL,40*Level)
 call KillUnit(Creature)
-call AddHeroState(Target,4314,3)
 endfunction
 function Blackjack_Find takes nothing returns boolean
-return(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and((LoadInteger(hash_main,(GetHandleId((GetFilterUnit()))),((4314))))==HERO_STATE_ON)==false and(IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))==true or GenericCondition_IsDotAInvis(GetFilterUnit())==false)
+if(IsUnitEnemy(tt_unit1,GetOwningPlayer(GetFilterUnit()))and(GetUnitAbilityLevel(GetFilterUnit(),1093678162)==0 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsDead(GetFilterUnit())==false)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_ANCIENT)==false or GenericCondition_IsBear(GetFilterUnit())))and(IsUnitVisible(GetFilterUnit(),GetOwningPlayer(tt_unit1))==true or GenericCondition_IsDotAInvis(GetFilterUnit())==false)then
+return IsUnitInGroup(GetFilterUnit(),blackjack_alreadyhit)==false
+endif
+return false
 endfunction
 function Blackjack_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local group g
 local integer i=1
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real x=(LoadReal(hash_main,(Cache),(6)))
 local real y=(LoadReal(hash_main,(Cache),(7)))
 local real a=(LoadReal(hash_main,(Cache),(137)))
 local unit Creature
 local unit Target
 local real TargetX=(LoadReal(hash_main,(Cache),(47)))
 local real TargetY=(LoadReal(hash_main,(Cache),(48)))
-set x=SafeX(x+18*Cos(a))
-set y=SafeY(y+18*Sin(a))
+local group AlreadyHit=(LoadGroupHandle(hash_main,(Cache),(187)))
+set blackjack_alreadyhit=AlreadyHit
+set x=SafeX(x+12*Cos(a))
+set y=SafeY(y+12*Sin(a))
 call SaveReal(hash_main,(Cache),(6),((x)*1.0))
 call SaveReal(hash_main,(Cache),(7),((y)*1.0))
 if GetTriggerEvalCount(t)>39 then
 loop
 exitwhen i>3
 call KillUnit((LoadUnitHandle(hash_main,(Cache),(393+i-1))))
 set i=i+1
 endloop
+call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 else
 set g=GetAvailableGroup()
 set tt_unit1=Source
 call GroupEnumUnitsInRange(g,x,y,275,Condition(function Blackjack_Find))
 loop
 exitwhen i>3
 if(LoadBoolean(hash_main,(Cache),(511+i-1)))==false then
 set Creature=(LoadUnitHandle(hash_main,(Cache),(393+i-1)))
 set x=(LoadReal(hash_main,(Cache),(549+i-1)))
 set y=(LoadReal(hash_main,(Cache),(567+i-1)))
-set x=SafeX(x+18*Cos(a))
-set y=SafeY(y+18*Sin(a))
+set x=SafeX(x+12*Cos(a))
+set y=SafeY(y+12*Sin(a))
 call SaveReal(hash_main,(Cache),(549+i-1),((x)*1.0))
 call SaveReal(hash_main,(Cache),(567+i-1),((y)*1.0))
 call SetUnitX(Creature,x)
 call SetUnitY(Creature,y)
-set Target=FirstOfGroup(g)
+set Target=GroupPickRandomUnit(g)
 if Target!=null then
 call GroupRemoveUnit(g,Target)
 call SaveInteger(hash_main,(GetHandleId((Target))),((4314)),(HERO_STATE_ON))
 call SaveBoolean(hash_main,(Cache),(511+i-1),(true))
 call Blackjack_RegisterTarget(Source,Creature,Target,GetUnitAbilityLevel(Source,abilityid_blackjack))
 endif
 endif
 set i=i+1
 endloop
 call KillGroup(g)
 set g=null
 set Creature=null
 set Target=null
 endif
 set t=null
@@ -82375,30 +84288,31 @@
 call SaveReal(hash_main,(Cache),(567+i-1),((GetUnitY(Caster))*1.0))
 set i=i+1
 set Caster=CreateUnit(GetOwningPlayer(Source),uid,x+100*Cos(a),y+100*Sin(a),a*bj_RADTODEG)
 call SaveUnitHandle(hash_main,(Cache),(393+i-1),(Caster))
 call SaveBoolean(hash_main,(Cache),(511+i-1),(false))
 call SaveReal(hash_main,(Cache),(549+i-1),((GetUnitX(Caster))*1.0))
 call SaveReal(hash_main,(Cache),(567+i-1),((GetUnitY(Caster))*1.0))
 call TriggerRegisterTimerEvent(t,0.015,true)
 call TriggerAddCondition(t,Condition(function Blackjack_Move))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
 call SaveReal(hash_main,(Cache),(6),((x)*1.0))
 call SaveReal(hash_main,(Cache),(7),((y)*1.0))
 call SaveReal(hash_main,(Cache),(137),((a)*1.0))
 call SaveReal(hash_main,(Cache),(47),((NewX)*1.0))
 call SaveReal(hash_main,(Cache),(48),((NewY)*1.0))
+call SaveGroupHandle(hash_main,(Cache),(187),(GetAvailableGroup()))
 set Source=null
 set Caster=null
 set t=null
 endfunction
 function Blackjack_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_blackjack then
 call Blackjack()
 endif
 return false
 endfunction
 function Register_Blackjack takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Blackjack_Main))
 set t=null
@@ -82982,56 +84896,56 @@
 set presstheattack_speed[1]=1093814841
 set presstheattack_speed[2]=1093814849
 set presstheattack_speed[3]=1093814840
 set presstheattack_speed[4]=1093814839
 set t=null
 endfunction
 function Cleanse_AddMS takes unit Source,integer Level returns nothing
 local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Source),GetUnitY(Source),0)
 call UnitAddAbility2(Caster,cleanse_ms)
 call SetUnitAbilityLevel(Caster,cleanse_ms,Level/3)
 call IssueTargetOrder(Caster,"bloodlust",Source)
 set Caster=null
 endfunction
 function Cleanse_Hit takes nothing returns nothing
 if IsUnitType(GetEnumUnit(),UNIT_TYPE_SUMMONED)==true or IsUnitIllusion(GetEnumUnit())==true then
-call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_MAGICAL,GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)*0.5)
+call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_MAGICAL,GetUnitState(GetEnumUnit(),UNIT_STATE_MAX_LIFE)*0.25)
 endif
 call DamageTarget(GetTriggerUnit(),GetEnumUnit(),DAMAGE_MAGICAL,60*cleanse_level+10*(cleanse_heroes+cleanse_creeps))
 endfunction
 function Cleanse_Count takes nothing returns nothing
 if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==true then
 set cleanse_heroes=cleanse_heroes+1
 else
 set cleanse_creeps=cleanse_creeps+1
 endif
 endfunction
 function Cleanse takes nothing returns nothing
 local unit Source=GetTriggerUnit()
 local real x=GetSpellTargetX()
 local real y=GetSpellTargetY()
 local integer Level=GetUnitAbilityLevel(Source,abilityid_cleanse)
 local group g=GetAvailableGroup()
 call DestroyEffect(AddSpecialEffect("war3mapImported\\OverwhelmingOdds.mdx",x,y))
 call GroupEnumUnitsInRange(g,x,y,315+25,Condition(function GenericCondition_EnemyUnits))
 set cleanse_creeps=0
 set cleanse_heroes=0
 set cleanse_level=Level
 call ForGroup(g,function Cleanse_Count)
 call ForGroup(g,function Cleanse_Hit)
 call KillGroup(g)
-call Cleanse_AddMS(Source,6*cleanse_heroes+3*cleanse_creeps)
+call Cleanse_AddMS(Source,9*cleanse_heroes+3*cleanse_creeps)
 set Source=null
 set g=null
 endfunction
 function Cleanse_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_cleanse then
 call Cleanse()
 endif
 return false
 endfunction
 function Register_Cleanse takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Cleanse_Main))
 call PreloadAbility(cleanse_ms)
 set t=null
@@ -84126,31 +86040,31 @@
 endfunction
 function Chakram_RemoveImmo takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 call UnitRemoveAbility(Source,1114663271)
 call UnitRemoveAbility(Source,1111845217)
 call UnitRemoveAbility(Source,abilityid_chakram_return)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 set t=null
 set Source=null
 return false
 endfunction
 function Chakram_SetSlow takes unit Source,unit Target returns nothing
-local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Target),GetUnitY(Target),0)
+local unit Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
 local integer LifePercent=R2I(100*GetUnitState(Target,UNIT_STATE_LIFE)/GetUnitState(Target,UNIT_STATE_MAX_LIFE))
 local integer Level=IMax(IMin(R2I(100-LifePercent)/5,20),1)
 call UnitAddAbility(Caster,chakram_slow)
 call SetUnitAbilityLevel(Caster,chakram_slow,Level)
 call IssueTargetOrder(Caster,"slow",Target)
 set Caster=null
 endfunction
 function Chakram_DamageOverTime takes nothing returns nothing
 if udg_GameOver==false then
 call DamageTarget(chakram_source,GetEnumUnit(),DAMAGE_PURE,(25+25*chakram_level)*0.5)
 call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",GetEnumUnit(),"origin"))
 call Chakram_SetSlow(chakram_source,GetEnumUnit())
 endif
 endfunction
 function Chakram_DamageOnce takes nothing returns nothing
@@ -84191,32 +86105,32 @@
 elseif GetTriggerEventId()==EVENT_WIDGET_DEATH or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==-1 then
 call UnitRemoveAbility(Source,chakram_disableattack)
 if(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==0 or(LoadInteger(hash_main,(GetHandleId(Source)),(704)))==abilityid_chakram then
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_chakram,true)
 endif
 call SetPlayerAbilityAvailable(GetOwningPlayer(Source),abilityid_chakram_return,false)
 call UnitRemoveAbility(Source,abilityid_chakram_return)
 call UnitRemoveAbility(Source,1114663271)
 call UnitRemoveAbility(Source,1111845217)
 call KillUnit(Projectile)
 call KillGroup(AlreadyHit)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 elseif state==0 then
 set a=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),TargetX,TargetY)*bj_DEGTORAD
-set x=GetUnitX(Projectile)+20*Cos(a)
-set y=GetUnitY(Projectile)+20*Sin(a)
+set x=GetUnitX(Projectile)+16*Cos(a)
+set y=GetUnitY(Projectile)+16*Sin(a)
 call KillTrees(x,y,175)
 if DistanceBetweenXY(x,y,TargetX,TargetY)<40 then
 set x=TargetX
 set y=TargetY
 endif
 call SetUnitX(Projectile,x)
 call SetUnitY(Projectile,y)
 set tt_unit1=Source
 set chakram_source=Source
 set chakram_level=GetUnitAbilityLevel(Source,abilityid_chakram)
 set chakram_group=AlreadyHit
 set g=GetAvailableGroup()
 call GroupEnumUnitsInRange(g,x,y,chakram_aoe+25,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function Chakram_DamageOnce)
 call KillGroup(g)
@@ -84240,32 +86154,32 @@
 call KillGroup(g)
 set manacost=(15+5*chakram_level)/2
 if GetUnitState(Source,UNIT_STATE_MANA)<manacost or DistanceBetweenUnits(Source,Projectile)>2000 then
 call SaveInteger(hash_main,(Cache),(33),(2))
 call GroupClear(AlreadyHit)
 call UnitRemoveAbility(Source,abilityid_chakram_return)
 call UnitRemoveAbility(Source,1114663271)
 call UnitRemoveAbility(Source,1111845217)
 else
 call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)-manacost)
 endif
 endif
 call SaveInteger(hash_main,(Cache),(34),(Count))
 elseif state==2 then
 set a=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),GetUnitX(Source),GetUnitY(Source))*bj_DEGTORAD
-set x=GetUnitX(Projectile)+20*Cos(a)
-set y=GetUnitY(Projectile)+20*Sin(a)
+set x=GetUnitX(Projectile)+16*Cos(a)
+set y=GetUnitY(Projectile)+16*Sin(a)
 call KillTrees(x,y,175)
 call SetUnitX(Projectile,x)
 call SetUnitY(Projectile,y)
 set tt_unit1=Source
 set chakram_source=Source
 set chakram_level=GetUnitAbilityLevel(Source,abilityid_chakram)
 set chakram_group=AlreadyHit
 set g=GetAvailableGroup()
 call GroupEnumUnitsInRange(g,x,y,chakram_aoe+25,Condition(function GenericCondition_EnemyUnitsEx))
 call ForGroup(g,function Chakram_DamageOnce)
 call KillGroup(g)
 if DistanceBetweenXY(x,y,GetUnitX(Source),GetUnitY(Source))<40 then
 call UnitRemoveAbility(Source,chakram_disableattack)
 call KillUnit(Projectile)
 call KillGroup(AlreadyHit)
@@ -84311,248 +86225,753 @@
 set Projectile=null
 endfunction
 function Chakram_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_chakram then
 call Chakram()
 endif
 return false
 endfunction
 function Register_Chakram takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Chakram_Main))
 call PreloadAbility(chakram_slow)
 set t=null
 endfunction
-function Breeze_Hit takes unit Source,unit Projectile,unit Target returns nothing
-local real d=RAbsBJ(GetUnitFacing(Target)-GetUnitFacing(Projectile))
-local real duration=3
-local integer Level=GetUnitAbilityLevel(Source,abilityid_breeze)
-local integer slowid=breeze_slow_1
-if Level==2 then
-set slowid=breeze_slow_2
-elseif Level==3 then
-set slowid=breeze_slow_3
-elseif Level==4 then
-set slowid=breeze_slow_4
+function Trap_RemoveBonus takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+if((LoadInteger(hash_main,(GetHandleId(Source)),(754)))==(LoadInteger(hash_main,(Cache),(754))))then
+call AddDamageBonus((Source),(0))
 endif
-if d>180 then
-set d=360-d
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=null
+set Source=null
+return false
+endfunction
+function Trap_RemoveBuffs takes nothing returns nothing
+if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==true then
+set trap_bonuscount=trap_bonuscount+60
+else
+set trap_bonuscount=trap_bonuscount+20
+endif
+call UnitRemoveAbility(GetEnumUnit(),trap_marker)
+call UnitRemoveAbility(GetEnumUnit(),trap_marker_buffid)
+endfunction
+function Trap_Count takes nothing returns nothing
+if IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO)==true then
+set trap_bonuscount=trap_bonuscount+60
+else
+set trap_bonuscount=trap_bonuscount+20
+endif
+endfunction
+function Trap_DoEffect takes nothing returns nothing
+call Stun(trap_source,GetEnumUnit(),0.5+trap_level*0.5)
+call DamageTarget(trap_source,GetEnumUnit(),DAMAGE_MAGICAL,trap_bonuscount)
+endfunction
+function Trap_FindUnits takes nothing returns boolean
+return GetUnitAbilityLevel(GetFilterUnit(),trap_marker_buffid)>0
+endfunction
+function Trap takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local group g=GetAvailableGroup()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+set trap_source=Source
+set trap_level=GetUnitAbilityLevel(Source,abilityid_trap)
+set trap_bonuscount=0
+call GroupEnumUnitsInRange(g,0,0,9999,Condition(function Trap_FindUnits))
+call ForGroup(g,function Trap_RemoveBuffs)
+call ForGroup(g,function Trap_DoEffect)
+call KillGroup(g)
+set g=null
+set Source=null
+endfunction
+function Trap_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_trap then
+call Trap()
+endif
+return false
+endfunction
+function Trap_TextTag takes string text,unit Target,unit Hero returns nothing
+local texttag tt=CreateTextTag()
+call SetTextTagText(tt,text,0.033)
+call SetTextTagPosUnit(tt,Target,64)
+call SetTextTagColor(tt,0,75,255,255)
+call SetTextTagVelocity(tt,0,0.0355)
+call SetTextTagFadepoint(tt,0.15)
+call SetTextTagPermanent(tt,false)
+call SetTextTagLifespan(tt,1.0)
+if IsUnitAlly(Hero,GetLocalPlayer())or IsObserver(GetLocalPlayer())then
+call SetTextTagVisibility(tt,true)
+else
+call SetTextTagVisibility(tt,false)
 endif
-if d<=105 then
-call Stun(Source,Target,1.5)
-set duration=4
-endif
-call SetPlayerAbilityAvailable(GetOwningPlayer(Target),slowid,false)
-call AddTimedAbilityAndRemove(Target,slowid,1,duration,breeze_slow_buffid)
-call DamageTarget(Source,Target,DAMAGE_MAGICAL,80+20*Level)
-call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostDamage\\FrostDamage.mdl",Target,"chest"))
-endfunction
-function Breeze_Process takes nothing returns nothing
-if IsUnitInGroup(GetEnumUnit(),breeze_group)==false then
-call GroupAddUnit(breeze_group,GetEnumUnit())
-call Breeze_Hit(breeze_source,breeze_projectile,GetEnumUnit())
+set tt=null
+endfunction
+function Trap_Attack_End takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local real LastTime=(LoadReal(hash_main,(GetHandleId(Target)),(753)))
+if GetTriggerEventId()==EVENT_WIDGET_DEATH or LastTime<(TimerGetElapsed(udg_GameTimer))then
+call UnitRemoveAbility(Target,trap_marker)
+call UnitRemoveAbility(Target,trap_marker_buffid)
+call SaveReal(hash_main,(GetHandleId(Target)),(753),((0)*1.0))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
 endif
+set t=null
+set Target=null
+return false
+endfunction
+function Trap_Attack_SuccessfulHit takes unit Source,unit Target returns nothing
+local trigger t
+local integer Cache
+local group g=GetAvailableGroup()
+call SaveReal(hash_main,(GetHandleId(Target)),(753),(((TimerGetElapsed(udg_GameTimer))+trap_duration)*1.0))
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0.25,true)
+call TriggerRegisterDeathEvent(t,Target)
+call TriggerAddCondition(t,Condition(function Trap_Attack_End))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call UnitAddAbility2(Target,trap_marker)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),trap_marker,false)
+set trap_source=Source
+set trap_level=GetUnitAbilityLevel(Source,abilityid_trap)
+set trap_bonuscount=0
+call GroupEnumUnitsInRange(g,0,0,9999,Condition(function Trap_FindUnits))
+call ForGroup(g,function Trap_Count)
+call KillGroup(g)
+call Trap_TextTag(I2S(trap_bonuscount),Target,Source)
+set t=null
 endfunction
-function Breeze_Move takes nothing returns boolean
+function Trap_Attack_Hit takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
-local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
-local group AlreadyHit=(LoadGroupHandle(hash_main,(Cache),(187)))
-local real a=(LoadReal(hash_main,(Cache),(137)))
-local real x=GetUnitX(Projectile)
-local real y=GetUnitY(Projectile)
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+if GetTriggerEventId()!=EVENT_UNIT_DAMAGED then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+else
+if GetEventDamageSource()==Source and GetEventDamage()>0 then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+if IsRealSummoned(Target)==false then
+call Trap_Attack_SuccessfulHit(Source,Target)
+endif
+endif
+endif
+set t=null
+set Source=null
+set Target=null
+return false
+endfunction
+function Trap_Attack_Child takes nothing returns nothing
+local unit Source=GetAttacker()
+local unit Target=GetTriggerUnit()
+local trigger t
+local integer Cache
+if((LoadInteger(hash_main,(GetHandleId((Source))),((4325))))==HERO_STATE_ON)==false then
+call AddHeroState(Source,4325,0.2)
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
+call TriggerRegisterTimerEvent(t,2.5,false)
+call TriggerAddCondition(t,Condition(function Trap_Attack_Hit))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+endif
+set Source=null
+set Target=null
+endfunction
+function Trap_Attack takes nothing returns boolean
+if GetUnitAbilityLevel(GetAttacker(),abilityid_trap)>0 and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(GetTriggerUnit())!=1848651852 and IsUnitEnemy(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))then
+call Trap_Attack_Child()
+endif
+return false
+endfunction
+function Register_Trap takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function Trap_Main))
+set t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
+call TriggerAddCondition(t,Condition(function Trap_Attack))
+set t=null
+endfunction
+function Split_SecondaryImpact takes nothing returns nothing
+local integer Cache=GetHandleId(GetTriggeringTrigger())
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit OriginalTarget=tt_unit1
+local unit Target=tt_unit2
+local integer Level=GetUnitAbilityLevel(Source,abilityid_split)
+if IsMagicImmune(Target)==false then
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,20+80*Level)
+call AddTimedAbilityAndRemove(Target,split_slow,1,4,split_slow_buffid)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),split_slow,false)
+call UnitMakeAbilityPermanent(Target,true,1093815626)
+endif
+set Source=null
+set Target=null
+set OriginalTarget=null
+endfunction
+function Split_Process takes nothing returns nothing
+local unit Source=split_source
+local unit Target=GetEnumUnit()
+local trigger t=CreateProjectileToUnit(split_target,Target,1747993925,"Split_SecondaryImpact",600)
+local integer Cache=GetHandleId(t)
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+set Source=null
+set Target=null
+set t=null
+endfunction
+function Split_InitialImpact takes unit Source,unit Target returns nothing
+local integer Level=GetUnitAbilityLevel(Source,abilityid_split)
 local group g=GetAvailableGroup()
-set x=SafeX(x+28*Cos(a))
-set y=SafeY(y+28*Sin(a))
-call SetUnitX(Projectile,x)
-call SetUnitY(Projectile,y)
 set tt_unit1=Source
-set breeze_source=Source
-set breeze_projectile=Projectile
-set breeze_group=AlreadyHit
-call GroupEnumUnitsInRange(g,x,y,325,Condition(function GenericCondition_EnemyUnitsEx))
-call ForGroup(g,function Breeze_Process)
+set split_source=Source
+set split_target=Target
+call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),500+25,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupRemoveUnit(g,Target)
+call ForGroup(g,function Split_Process)
 call KillGroup(g)
-if GetTriggerEvalCount(t)>50 then
+set Source=null
+set Target=null
+set g=null
+endfunction
+function Split_Move takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
+local real x=GetUnitX(Projectile)
+local real y=GetUnitY(Projectile)
+local real TargetX=GetUnitX(Target)
+local real TargetY=GetUnitY(Target)
+local real Dist=GetDist(TargetX,TargetY,x,y)
+local integer Count=GetTriggerEvalCount(t)
+local real NewAngle=AngleBetweenXY(x,y,TargetX,TargetY)
+local real NewX
+local real NewY
+local real MoveRate=Dist/((split_time/.02)-Count)
+if MoveRate<split_minspeed*0.02 then
+set MoveRate=split_minspeed*0.02
+endif
+set NewX=x+MoveRate*Cos(NewAngle*bj_DEGTORAD)
+set NewY=y+MoveRate*Sin(NewAngle*bj_DEGTORAD)
+call SetUnitX(Projectile,NewX)
+call SetUnitY(Projectile,NewY)
+call SetUnitFacing(Projectile,NewAngle)
+if GetDist(TargetX,TargetY,NewX,NewY)<=MoveRate then
+call KillUnit(Projectile)
+call Split_InitialImpact(Source,Target)
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
-call KillUnit(Projectile)
-call KillGroup(AlreadyHit)
 endif
 set t=null
+set Target=null
 set Source=null
 set Projectile=null
-set AlreadyHit=null
-set g=null
 return false
 endfunction
-function Breeze takes nothing returns nothing
+function Split takes nothing returns nothing
 local unit Source=GetTriggerUnit()
-local real x=GetUnitX(Source)
-local real y=GetUnitY(Source)
-local real a=AngleBetweenXY(x,y,GetSpellTargetX(),GetSpellTargetY())*bj_DEGTORAD
-local unit Projectile=CreateUnit(GetOwningPlayer(Source),unitid_breeze,x,y,a*bj_RADTODEG)
+local unit Target=GetSpellTargetUnit()
 local trigger t=CreateTrigger()
 local integer Cache=GetHandleId(t)
-call TriggerRegisterTimerEvent(t,0.025,true)
-call TriggerAddCondition(t,Condition(function Breeze_Move))
+local unit Projectile=CreateUnit(GetOwningPlayer(Source),1747993930,GetUnitX(Source),GetUnitY(Source),0)
+call TriggerRegisterTimerEvent(t,0.02,true)
+call TriggerAddCondition(t,Condition(function Split_Move))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
 call SaveUnitHandle(hash_main,(Cache),(45),(Projectile))
-call SaveReal(hash_main,(Cache),(137),((a)*1.0))
-call SaveGroupHandle(hash_main,(Cache),(187),(GetAvailableGroup()))
 set Source=null
+set Target=null
 set Projectile=null
 set t=null
 endfunction
-function Breeze_Main takes nothing returns boolean
-if GetSpellAbilityId()==abilityid_breeze then
-call Breeze()
+function Split_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_split then
+call Split()
 endif
 return false
 endfunction
-function Register_Breeze takes nothing returns nothing
+function Register_Split takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
-call TriggerAddCondition(t,Condition(function Breeze_Main))
+call TriggerAddCondition(t,Condition(function Split_Main))
 set t=null
 endfunction
-function FrostSkin_Clear takes unit Target returns nothing
-call UnitRemoveAbility(Target,frostskin_reduction_1)
-call UnitRemoveAbility(Target,frostskin_reduction_2)
-call UnitRemoveAbility(Target,frostskin_reduction_3)
-call UnitRemoveAbility(Target,frostskin_reduction_4)
+function Shield_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_shield)
+call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)+0.1*(20+GetUnitState(Target,UNIT_STATE_MAX_LIFE)*(0.02+0.01*Level)))
+if GetTriggerEvalCount(t)>39 or(GetTriggerEvalCount(t)==1 and IsUnitHidden(Target))then
+call UnitRemoveAbility(Target,shield_armor)
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(609))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(610))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(611))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(612))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(613))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(614))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(615))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(616))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(617))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+set t=null
+set Source=null
+set Target=null
+return false
 endfunction
-function FrostSkin_Add takes unit Source,unit Target returns nothing
-local integer Level=GetUnitAbilityLevel(Source,abilityid_frostskin)
-if Level==1 then
-call SetPlayerAbilityAvailable(GetOwningPlayer(Target),frostskin_reduction_1,false)
-call UnitAddAbility2(Target,frostskin_reduction_1)
-elseif Level==2 then
-call SetPlayerAbilityAvailable(GetOwningPlayer(Target),frostskin_reduction_2,false)
-call UnitAddAbility2(Target,frostskin_reduction_2)
-elseif Level==3 then
-call SetPlayerAbilityAvailable(GetOwningPlayer(Target),frostskin_reduction_3,false)
-call UnitAddAbility2(Target,frostskin_reduction_3)
-elseif Level==4 then
-call SetPlayerAbilityAvailable(GetOwningPlayer(Target),frostskin_reduction_4,false)
-call UnitAddAbility2(Target,frostskin_reduction_4)
+function Shield takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local unit Target=GetSpellTargetUnit()
+local trigger t
+local integer Cache
+local unit Caster=CreateUnit(GetOwningPlayer(Target),1697656901,GetUnitX(Target),GetUnitY(Target),0)
+call UnitAddAbility(Caster,1093815367)
+if IssueTargetOrder(Caster,"thunderbolt",Target)==true then
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call UnitAddAbility2(Target,shield_armor)
+call TriggerRegisterTimerEvent(t,0.1,true)
+call TriggerRegisterTimerEvent(t,0,false)
+call TriggerAddCondition(t,Condition(function Shield_Loop))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveEffectHandle(hash_main,(Cache),(609),(AddSpecialEffectTarget(shield_fx,Target,"hand right")))
+call SaveEffectHandle(hash_main,(Cache),(610),(AddSpecialEffectTarget(shield_fx,Target,"hand left")))
+call SaveEffectHandle(hash_main,(Cache),(611),(AddSpecialEffectTarget(shield_fx,Target,"foot right")))
+call SaveEffectHandle(hash_main,(Cache),(612),(AddSpecialEffectTarget(shield_fx,Target,"foot left")))
+call SaveEffectHandle(hash_main,(Cache),(613),(AddSpecialEffectTarget(shield_fx,Target,"foot right mount rear")))
+call SaveEffectHandle(hash_main,(Cache),(614),(AddSpecialEffectTarget(shield_fx,Target,"foot left mount rear")))
+call SaveEffectHandle(hash_main,(Cache),(615),(AddSpecialEffectTarget(shield_fx,Target,"head")))
+call SaveEffectHandle(hash_main,(Cache),(616),(AddSpecialEffectTarget(shield_fx,Target,"chest")))
+call SaveEffectHandle(hash_main,(Cache),(617),(AddSpecialEffectTarget(shield_fx,Target,"weapon")))
+endif
+set Source=null
+set Target=null
+set t=null
+endfunction
+function Shield_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_shield then
+call Shield()
+endif
+return false
+endfunction
+function Register_Shield takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function Shield_Main))
+set t=null
+endfunction
+function Curse_AdjustControl takes nothing returns nothing
+local unit Target=GetEnumUnit()
+call DisableTrigger(curse_trigger)
+call UnitWakeUp(Target)
+call IssueTargetOrder(Target,"attack",curse_target)
+call EnableTrigger(curse_trigger)
+set Target=null
+endfunction
+function Curse_Unregister takes nothing returns nothing
+call AddHeroState(GetEnumUnit(),4328,0.75)
+endfunction
+function Curse_RegisterNewUnit takes nothing returns nothing
+local unit Target=GetEnumUnit()
+if IsUnitInGroup(Target,curse_group)==false then
+call GroupAddUnit(curse_group,Target)
+call TriggerRegisterUnitEvent(curse_trigger,Target,EVENT_UNIT_ISSUED_TARGET_ORDER)
+call TriggerRegisterUnitEvent(curse_trigger,Target,EVENT_UNIT_ISSUED_POINT_ORDER)
+call TriggerRegisterUnitEvent(curse_trigger,Target,EVENT_UNIT_ISSUED_TARGET_ORDER)
+call SaveInteger(hash_main,(GetHandleId((Target))),((4328)),(HERO_STATE_ON))
 endif
+set Target=null
 endfunction
-function FrostSkin_Attacked takes nothing returns boolean
+function Curse_Force takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
-local unit Source=GetTriggerUnit()
-local unit Attacker=GetAttacker()
-if IsUnitType(Attacker,UNIT_TYPE_MELEE_ATTACKER)==false then
-if GetUnitAbilityLevel(Source,abilityid_frostskin)>0 then
-call FrostSkin_Add(Source,Attacker)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Level=(LoadInteger(hash_main,(Cache),(5)))
+local integer Count=(LoadInteger(hash_main,(Cache),(34)))
+local group AlreadyHit=(LoadGroupHandle(hash_main,(Cache),(22)))
+local group g
+if GetTriggerEventId()!=EVENT_UNIT_ISSUED_TARGET_ORDER and GetTriggerEventId()!=EVENT_UNIT_ISSUED_POINT_ORDER and GetTriggerEventId()!=EVENT_UNIT_ISSUED_TARGET_ORDER then
+set Count=Count+1
+call SaveInteger(hash_main,(Cache),(34),(Count))
+set curse_group=AlreadyHit
+set curse_trigger=t
+set g=GetAvailableGroup()
+set tt_unit1=Source
+call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),350+25,Condition(function GenericCondition_EnemyUnitsNoImmune))
+call GroupRemoveUnit(g,Target)
+call ForGroup(g,function Curse_RegisterNewUnit)
+call KillGroup(g)
+if Count==(2.25+0.25*Level)*20 or IsDead(Target)then
+call ForGroup(AlreadyHit,function Curse_Unregister)
+call KillGroup(AlreadyHit)
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(176))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
 else
-call FrostSkin_Clear(Attacker)
+set curse_trigger=t
+set curse_target=Target
+call ForGroup(AlreadyHit,function Curse_AdjustControl)
+if ModuloInteger(Count,20)==0 or Count==0 then
+endif
+endif
+else
+if UnitIsSleeping(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),1110454328)==0 and GetIssuedOrderId()!=851973 and borrowedtime_bypass_axe==false then
+call DisableTrigger(t)
+call ClearSelectionForPlayer(GetOwningPlayer(GetTriggerUnit()))
+call IssueTargetOrder(GetTriggerUnit(),"attack",Target)
+call EnableTrigger(t)
 endif
 endif
 set t=null
 set Source=null
-set Attacker=null
+set Target=null
 return false
 endfunction
-function FrostSkin_Learned takes nothing returns nothing
+function Curse takes nothing returns nothing
 local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local integer Level=GetUnitAbilityLevel(Source,abilityid_curse)
+local unit Target=GetSpellTargetUnit()
+local unit Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Target),GetUnitY(Target),0)
+call UnitAddAbility(Caster,1093815882)
+call SetUnitAbilityLevel(Caster,1093815882,Level)
+call IssueTargetOrder(Caster,"thunderbolt",Target)
+set curse_source=Source
+call TriggerRegisterTimerEvent(t,0.05,true)
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveInteger(hash_main,(Cache),(5),(Level))
+call SaveGroupHandle(hash_main,(Cache),(22),(GetAvailableGroup()))
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(curse_fx,Target,"overhead")))
+call SaveEffectHandle(hash_main,(Cache),(176),(AddSpecialEffect(curse_ground_fx,GetUnitX(Target),GetUnitY(Target))))
+call TriggerAddCondition(t,Condition(function Curse_Force))
+set Source=null
+set Target=null
+set t=null
+endfunction
+function Curse_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_curse and IsBlocked(GetSpellTargetUnit())==false then
+call Curse()
+endif
+return false
+endfunction
+function Register_Curse takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function Curse_Main))
+set t=null
+endfunction
+function Touch_DPS takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_touch)
+call DamageTarget(Source,Target,DAMAGE_PURE,(0.032+0.002*Level)*GetUnitState(Target,UNIT_STATE_MAX_LIFE))
+if(TimerGetElapsed(udg_GameTimer))>=(LoadReal(hash_main,(GetHandleId(Source)),(782)))then
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+set t=null
+set Source=null
+set Target=null
+return false
+endfunction
+function Touch_FireBlast takes unit Source,unit Target returns nothing
 local trigger t
 local integer Cache
-local integer Level=GetUnitAbilityLevel(Source,abilityid_frostskin)
-if Level==1 then
-call UnitAddAbility2(Source,frostskin_mana_1)
+call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)*0.8)
+if(LoadReal(hash_main,(GetHandleId(Source)),(782)))>(TimerGetElapsed(udg_GameTimer))then
+call SaveReal(hash_main,(GetHandleId(Source)),(782),(((TimerGetElapsed(udg_GameTimer))+touch_burnduration)*1.0))
+else
 set t=CreateTrigger()
 set Cache=GetHandleId(t)
-call TriggerRegisterAnyUnitEventBJ(t,EVENT_PLAYER_UNIT_ATTACKED)
-call TriggerAddCondition(t,Condition(function FrostSkin_Attacked))
+call TriggerRegisterTimerEvent(t,1,true)
+call TriggerAddCondition(t,Condition(function Touch_DPS))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
-elseif Level==2 then
-call UnitRemoveAbility(Source,frostskin_mana_1)
-call UnitAddAbility2(Source,frostskin_mana_2)
-elseif Level==3 then
-call UnitRemoveAbility(Source,frostskin_mana_1)
-call UnitRemoveAbility(Source,frostskin_mana_2)
-call UnitAddAbility2(Source,frostskin_mana_3)
-elseif Level==4 then
-call UnitRemoveAbility(Source,frostskin_mana_1)
-call UnitRemoveAbility(Source,frostskin_mana_2)
-call UnitRemoveAbility(Source,frostskin_mana_3)
-call UnitAddAbility2(Source,frostskin_mana_4)
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(touch_burnfx,Target,"chest")))
+call SaveReal(hash_main,(GetHandleId(Source)),(782),(((TimerGetElapsed(udg_GameTimer))+touch_burnduration)*1.0))
 endif
+set t=null
+endfunction
+function Touch_Attack_Damage takes nothing returns boolean
+local real d
+local real LastTime
+local integer Count
+local unit Source
+local unit Target
+if GetUnitAbilityLevel(GetTriggerUnit(),buffid_touch)>0 and GetUnitAbilityLevel(GetEventDamageSource(),abilityid_touch)>0 and(LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(2)))==GetEventDamageSource()then
+set Source=GetEventDamageSource()
+set Target=GetTriggerUnit()
+set Count=(LoadInteger(hash_main,(GetHandleId(Source)),(780)))
+set LastTime=(LoadReal(hash_main,(GetHandleId(Source)),(781)))
+if LastTime+touch_burnduration<(TimerGetElapsed(udg_GameTimer))then
+set Count=1
+set LastTime=(TimerGetElapsed(udg_GameTimer))
+call SaveInteger(hash_main,(GetHandleId(Source)),(780),(Count))
+call SaveReal(hash_main,(GetHandleId(Source)),(781),((LastTime)*1.0))
+else
+set Count=Count+1
+set LastTime=(TimerGetElapsed(udg_GameTimer))
+call SaveInteger(hash_main,(GetHandleId(Source)),(780),(Count))
+call SaveReal(hash_main,(GetHandleId(Source)),(781),((LastTime)*1.0))
+endif
+if Count==4 then
+set Count=0
+call SaveInteger(hash_main,(GetHandleId(Source)),(780),(Count))
+call Touch_FireBlast(Source,Target)
+endif
+call FlushChildHashtable(hash_main,(GetHandleId(GetTriggeringTrigger())))
+call CleanTrigger(GetTriggeringTrigger())
+endif
+return false
+endfunction
+function Touch_Attack_Child takes nothing returns nothing
+local trigger t
+local unit Target
+local unit Source
+if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
+set Target=GetSpellTargetUnit()
+set Source=GetTriggerUnit()
+else
+set Target=GetTriggerUnit()
+set Source=GetAttacker()
+endif
+if IsUnitIllusion(Source)==false then
+set t=CreateTrigger()
+if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT then
+call SaveBoolean(hash_main,(GetHandleId(t)),(264),(true))
+else
+call SaveBoolean(hash_main,(GetHandleId(t)),(264),(false))
+endif
+call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(Source))
+call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
+call TriggerAddCondition(t,Condition(function Touch_Attack_Damage))
+endif
+set t=null
+set Target=null
 set Source=null
+endfunction
+function Touch_Attack takes nothing returns boolean
+if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED then
+if GetUnitAbilityLevel(GetAttacker(),abilityid_touch)>0 and(LoadBoolean(hash_main,(GetHandleId(GetTriggeringTrigger())),(263)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and GetAttacker()==(LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(14)))then
+call Touch_Attack_Child()
+endif
+elseif GetTriggerEventId()==EVENT_UNIT_ISSUED_ORDER then
+if(GetIssuedOrderId()==OrderId("poisonarrows"))then
+call SaveBoolean(hash_main,(GetHandleId(GetTriggeringTrigger())),(263),(true))
+elseif(GetIssuedOrderId()==OrderId("unpoisonarrows"))then
+call SaveBoolean(hash_main,(GetHandleId(GetTriggeringTrigger())),(263),(false))
+endif
+elseif GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()==abilityid_touch then
+call Touch_Attack_Child()
+endif
+return false
+endfunction
+function Touch_Learned takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
+call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_SPELL_EFFECT)
+call TriggerRegisterUnitEvent(t,GetTriggerUnit(),EVENT_UNIT_ISSUED_ORDER)
+call TriggerAddCondition(t,Condition(function Touch_Attack))
+call SaveUnitHandle(hash_main,(GetHandleId(t)),(14),(GetTriggerUnit()))
 set t=null
 endfunction
-function FrostSkin_Main takes nothing returns boolean
-if GetLearnedSkill()==abilityid_frostskin and IsUnitIllusion(GetTriggerUnit())==false then
-call FrostSkin_Learned()
+function Touch takes nothing returns boolean
+if GetLearnedSkill()==abilityid_touch and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_touch)==1 then
+call Touch_Learned()
 endif
 return false
 endfunction
-function Register_FrostSkin takes nothing returns nothing
+function Register_Touch takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
-call TriggerAddCondition(t,Condition(function FrostSkin_Main))
+call TriggerAddCondition(t,Condition(function Touch))
 set t=null
 endfunction
-function FrostGiant_Loop takes nothing returns boolean
+function ArcticSiege_Burn takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
-local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
-call SetUnitX(Caster,GetUnitX(Source))
-call SetUnitY(Caster,GetUnitY(Source))
-if GetTriggerEventId()==EVENT_WIDGET_DEATH then
-if GetTriggerUnit()!=Caster then
-call KillUnit(Caster)
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+if IsDead(Target)==false then
+call SetUnitState(Target,UNIT_STATE_LIFE,GetUnitState(Target,UNIT_STATE_LIFE)*0.94)
 endif
+if GetTriggerEvalCount(t)==5 then
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
 call FlushChildHashtable(hash_main,(Cache))
 call CleanTrigger(t)
 endif
 set t=null
 set Source=null
-set Caster=null
+set Target=null
 return false
 endfunction
-function FrostGiant takes nothing returns nothing
-local unit Source=GetTriggerUnit()
-local unit Caster=CreateUnit(GetOwningPlayer(Source),unitid_frostgiant,GetUnitX(Source),GetUnitY(Source),0)
+function ArcticSiege_SuccessfulAttack takes unit Source,unit Target returns nothing
+local trigger t
+local integer Cache
+local integer Level
+local integer ability1
+local integer ability2
+if((LoadInteger(hash_main,(GetHandleId((Target))),((4329))))==HERO_STATE_ON)==false and IsMagicImmune(Target)==false and GetUnitTypeId(Target)!=1848651852 then
+call AddHeroState(Target,4329,arcticsiege_duration)
+set Level=GetUnitAbilityLevel(Source,abilityid_arcticsiege)
+if Level==1 then
+set ability1=arcticsiege_slow_1
+set ability2=arcticsiege_slow_1_real
+elseif Level==2 then
+set ability1=arcticsiege_slow_2
+set ability2=arcticsiege_slow_2_real
+elseif Level==3 then
+set ability1=arcticsiege_slow_3
+set ability2=arcticsiege_slow_3_real
+elseif Level==4 then
+set ability1=arcticsiege_slow_4
+set ability2=arcticsiege_slow_4_real
+endif
+call AddTimedAbilityAndRemove(Target,ability1,1,4,arcticsiege_slow_buffid)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),ability1,false)
+call UnitMakeAbilityPermanent(Target,true,ability2)
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,1,true)
+call TriggerAddCondition(t,Condition(function ArcticSiege_Burn))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostDamage\\FrostDamage.mdl",Target,"chest")))
+endif
+endfunction
+function ArcticSiege_UnitDamaged takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+if GetTriggerEventId()==EVENT_UNIT_DAMAGED then
+if GetEventDamageSource()==Source then
+call DisableTrigger(t)
+call ArcticSiege_SuccessfulAttack(Source,Target)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+else
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+endif
+set t=null
+set Target=null
+set Source=null
+return false
+endfunction
+function ArcticSiege_Attack_Child takes nothing returns nothing
 local trigger t=CreateTrigger()
+local unit Target=GetTriggerUnit()
+local unit Source=GetAttacker()
 local integer Cache=GetHandleId(t)
-call UnitApplyTimedLifeBJ(15,1112820806,Caster)
-call TriggerRegisterTimerEvent(t,0.02,true)
-call TriggerRegisterDeathEvent(t,Source)
-call TriggerRegisterDeathEvent(t,Caster)
-call TriggerAddCondition(t,Condition(function FrostGiant_Loop))
+call TriggerRegisterUnitEvent(t,Target,EVENT_UNIT_DAMAGED)
+call TriggerRegisterTimerEvent(t,2.5,false)
+call TriggerAddCondition(t,Condition(function ArcticSiege_UnitDamaged))
 call SaveUnitHandle(hash_main,(Cache),(2),(Source))
-call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+set t=null
+set Target=null
+set Source=null
+endfunction
+function ArcticSiege_Attack takes nothing returns boolean
+if GetAttacker()==(LoadUnitHandle(hash_main,(GetHandleId(GetTriggeringTrigger())),(2)))and IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitAlly(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))==false then
+if GetUnitTypeId(GetAttacker())==1311788354 or GetUnitTypeId(GetAttacker())==1311788355 or GetUnitTypeId(GetAttacker())==1311788367 or GetUnitTypeId(GetAttacker())==1311788353 then
+call ArcticSiege_Attack_Child()
+endif
+endif
+return false
+endfunction
+function ArcticSiege_Learned takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_ATTACKED)
+call TriggerAddCondition(t,Condition(function ArcticSiege_Attack))
+call SaveUnitHandle(hash_main,(GetHandleId(t)),(2),(Source))
+set Source=null
+set t=null
+endfunction
+function ArcticSiege_Fix_Finish takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local real x=(LoadReal(hash_main,(Cache),(6)))
+local real y=(LoadReal(hash_main,(Cache),(7)))
+call SetTerrainPathable(x,y,PATHING_TYPE_WALKABILITY,false)
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=null
+return false
+endfunction
+function ArcticSiege_Fix takes nothing returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=GetTriggerUnit()
+local real x=GetUnitX(Source)
+local real y=GetUnitY(Source)
+call SetTerrainPathable(x,y,PATHING_TYPE_WALKABILITY,true)
+call TriggerRegisterTimerEvent(t,0,false)
+call TriggerAddCondition(t,Condition(function ArcticSiege_Fix_Finish))
+call SaveReal(hash_main,(Cache),(6),((x)*1.0))
+call SaveReal(hash_main,(Cache),(7),((y)*1.0))
 set Source=null
-set Caster=null
 set t=null
 endfunction
-function FrostGiant_Main takes nothing returns boolean
-if GetSpellAbilityId()==abilityid_frostgiant and GetUnitTypeId(GetTriggerUnit())==frostgiant_sourceid then
-call FrostGiant()
+function ArcticSiege_Learn takes nothing returns boolean
+if GetTriggerEventId()==EVENT_PLAYER_HERO_SKILL then
+if GetLearnedSkill()==abilityid_arcticsiege and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_arcticsiege)==1 and IsUnitIllusion(GetTriggerUnit())==false then
+call ArcticSiege_Learned()
+endif
+else
+if GetSpellAbilityId()==abilityid_arcticsiege then
+if GetUnitTypeId(GetTriggerUnit())!=1311788343 then
+call KillTrees(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),150)
+if IsTerrainPathable(GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),PATHING_TYPE_WALKABILITY)then
+call ArcticSiege_Fix()
+endif
+endif
+endif
 endif
 return false
 endfunction
-function Register_FrostGiant takes nothing returns nothing
+function Register_ArcticSiege takes nothing returns nothing
 local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
-call TriggerAddCondition(t,Condition(function FrostGiant_Main))
+call TriggerAddCondition(t,Condition(function ArcticSiege_Learn))
 set t=null
 endfunction
 function SonicBoom_Process takes nothing returns nothing
 call Stun(sonicboom_source,GetEnumUnit(),1.5)
 call DamageTarget(sonicboom_source,GetEnumUnit(),DAMAGE_PHYSICAL,50+50*sonicboom_level)
 endfunction
 function SonicBoom_Move takes nothing returns boolean
 local trigger t=GetTriggeringTrigger()
 local integer Cache=GetHandleId(t)
 local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
 local real a=(LoadReal(hash_main,(Cache),(137)))
 local real TargetX=(LoadReal(hash_main,(Cache),(47)))
 local real TargetY=(LoadReal(hash_main,(Cache),(48)))
 local real x=GetUnitX(Source)
 local real y=GetUnitY(Source)
@@ -85050,30 +87469,672 @@
 set Caster=null
 set Target=null
 endfunction
 function Chill_Main takes nothing returns boolean
 if GetSpellAbilityId()==abilityid_chill then
 call Chill()
 endif
 return false
 endfunction
 function Register_Chill takes nothing returns nothing
 local trigger t=CreateTrigger()
 call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
 call TriggerAddCondition(t,Condition(function Chill_Main))
 set t=null
 endfunction
+function LightningSeeker_Follow takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
+local integer Level=(LoadInteger(hash_main,(Cache),(5)))
+local real x
+local real y
+local real a
+if GetTriggerEventId()==EVENT_WIDGET_DEATH then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call KillUnit(Projectile)
+else
+set a=AngleBetweenXY(GetUnitX(Projectile),GetUnitY(Projectile),GetUnitX(Target),GetUnitY(Target))
+set x=GetUnitX(Projectile)+20*Cos(a*bj_DEGTORAD)
+set y=GetUnitY(Projectile)+20*Sin(a*bj_DEGTORAD)
+call SetUnitX(Projectile,x)
+call SetUnitY(Projectile,y)
+call SetUnitFacing(Projectile,a)
+if DistanceBetweenUnits(Projectile,Target)<30 then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call DamageTarget(Projectile,Target,DAMAGE_MAGICAL,100+50*Level)
+call KillUnit(Projectile)
+call SetUnitAnimationByIndex(Projectile,3)
+endif
+endif
+set t=null
+set Target=null
+set Projectile=null
+return false
+endfunction
+function LightningSeeker_Seek takes integer Level,unit Projectile,unit Target returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+call SetUnitAnimationByIndex(Projectile,2)
+call SetUnitVertexColor(Projectile,255,255,255,150)
+call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerRegisterDeathEvent(t,Target)
+call TriggerAddCondition(t,Condition(function LightningSeeker_Follow))
+call SaveInteger(hash_main,(Cache),(5),(Level))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveUnitHandle(hash_main,(Cache),(45),(Projectile))
+call SetUnitAnimationByIndex(Projectile,2)
+set t=null
+endfunction
+function LightningSeeker_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local integer Level=(LoadInteger(hash_main,(Cache),(5)))
+local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
+local group g
+local unit Target
+if GetTriggerEvalCount(t)>lightningseeker_duration/0.05 then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call KillUnit(Projectile)
+else
+set tt_unit1=Projectile
+set g=GetAvailableGroup()
+call GroupEnumUnitsInRange(g,GetUnitX(Projectile),GetUnitY(Projectile),375+25,Condition(function GenericCondition_EnemyUnitsNoImmune))
+set Target=GroupPickClosestUnit(g,GetUnitX(Projectile),GetUnitY(Projectile))
+call KillGroup(g)
+if Target!=null then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call LightningSeeker_Seek(Level,Projectile,Target)
+endif
+set g=null
+set Target=null
+endif
+set t=null
+set Projectile=null
+return false
+endfunction
+function LightningSeeker_Start takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local integer Level=(LoadInteger(hash_main,(Cache),(5)))
+local unit Projectile=(LoadUnitHandle(hash_main,(Cache),(45)))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerAddCondition(t,Condition(function LightningSeeker_Loop))
+call SaveInteger(hash_main,(Cache),(5),(Level))
+call SaveUnitHandle(hash_main,(Cache),(45),(Projectile))
+call SetUnitAnimationByIndex(Projectile,1)
+set t=null
+set Projectile=null
+return false
+endfunction
+function LightningSeeker takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local real x=GetSpellTargetX()
+local real y=GetSpellTargetY()
+local unit Projectile=CreateUnit(GetOwningPlayer(Source),lightningseeker_unitid,x,y,270)
+local integer Level=GetUnitAbilityLevel(Source,abilityid_lightningseeker)
+call SetUnitAnimationByIndex(Projectile,0)
+call TriggerRegisterTimerEvent(t,3,false)
+call TriggerAddCondition(t,Condition(function LightningSeeker_Start))
+call SaveInteger(hash_main,(Cache),(5),(Level))
+call SaveUnitHandle(hash_main,(Cache),(45),(Projectile))
+set Source=null
+set Projectile=null
+set t=null
+endfunction
+function LightningSeeker_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_lightningseeker then
+call LightningSeeker()
+endif
+return false
+endfunction
+function Register_LightningSeeker takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function LightningSeeker_Main))
+set t=null
+endfunction
+function MagneticField_Remove takes nothing returns nothing
+if IsRealSummoned(GetEnumUnit())then
+return
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion1)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion1)
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion2)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion2)
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion3)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion3)
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion4)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion4)
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion1_basic)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion1_basic)
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion2_basic)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion2_basic)
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion3_basic)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion3_basic)
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_evasion4_basic)>0 then
+call UnitRemoveAbility(GetEnumUnit(),magneticfield_evasion4_basic)
+endif
+endfunction
+function MagneticField_Add takes nothing returns nothing
+if IsRealSummoned(GetEnumUnit())then
+return
+endif
+if magneticfield_level==1 then
+set magneticfield_desiredbuff=magneticfield_evasion1
+elseif magneticfield_level==2 then
+set magneticfield_desiredbuff=magneticfield_evasion2
+elseif magneticfield_level==3 then
+set magneticfield_desiredbuff=magneticfield_evasion3
+elseif magneticfield_level==4 then
+set magneticfield_desiredbuff=magneticfield_evasion4
+endif
+if GetUnitAbilityLevel(GetEnumUnit(),magneticfield_desiredbuff)==0 then
+call UnitAddAbility2(GetEnumUnit(),magneticfield_desiredbuff)
+call SetPlayerAbilityAvailable(GetOwningPlayer(GetEnumUnit()),magneticfield_desiredbuff,false)
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1094935923)
+if magneticfield_desiredbuff==magneticfield_evasion1 then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815604)
+elseif magneticfield_desiredbuff==magneticfield_evasion2 then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815605)
+elseif magneticfield_desiredbuff==magneticfield_evasion3 then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815606)
+elseif magneticfield_desiredbuff==magneticfield_evasion4 then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815607)
+elseif magneticfield_desiredbuff==magneticfield_evasion1_basic then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815885)
+elseif magneticfield_desiredbuff==magneticfield_evasion2_basic then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815884)
+elseif magneticfield_desiredbuff==magneticfield_evasion3_basic then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815886)
+elseif magneticfield_desiredbuff==magneticfield_evasion4_basic then
+call UnitMakeAbilityPermanent(GetEnumUnit(),true,1093815887)
+endif
+endif
+endfunction
+function MagneticField_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local real x=(LoadReal(hash_main,(Cache),(6)))
+local real y=(LoadReal(hash_main,(Cache),(7)))
+local real EndTime=(LoadReal(hash_main,(Cache),(442)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_magneticfield)
+local group ActiveGroup=(LoadGroupHandle(hash_main,(Cache),(340)))
+local group g=GetAvailableGroup()
+local group g1=GetAvailableGroup()
+local group g2=GetAvailableGroup()
+set magneticfield_level=Level
+if(TimerGetElapsed(udg_GameTimer))>EndTime then
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call ForGroup(ActiveGroup,function MagneticField_Remove)
+call KillGroup(ActiveGroup)
+call KillGroup(g)
+call KillGroup(g1)
+call KillGroup(g2)
+return false
+endif
+set tt_unit1=Source
+call GroupEnumUnitsInRange(g1,x,y,325+25,Condition(function GenericCondition_AlliedHeroesEx))
+call GroupEnumUnitsInRange(g2,x,y,325+144,Condition(function GenericCondition_AlliedStructureEx))
+call GroupAddGroup(g1,g)
+call GroupAddGroup(g2,g)
+call KillGroup(g1)
+call KillGroup(g2)
+call GroupRemoveGroup(g,ActiveGroup)
+call ForGroup(ActiveGroup,function MagneticField_Remove)
+call ForGroup(g,function MagneticField_Add)
+call SaveGroupHandle(hash_main,(Cache),(340),(g))
+call KillGroup(ActiveGroup)
+set t=null
+set Source=null
+set ActiveGroup=null
+set g=null
+return false
+endfunction
+function MagneticField takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local real TargetX=GetSpellTargetX()
+local real TargetY=GetSpellTargetY()
+local integer i
+local integer Level=GetUnitAbilityLevel(Source,abilityid_magneticfield)
+call TriggerRegisterTimerEvent(t,0.1,true)
+call TriggerAddCondition(t,Condition(function MagneticField_Loop))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveGroupHandle(hash_main,(Cache),(340),(GetAvailableGroup()))
+call SaveReal(hash_main,(Cache),(6),((TargetX)*1.0))
+call SaveReal(hash_main,(Cache),(7),((TargetY)*1.0))
+call SaveReal(hash_main,(Cache),(442),(((TimerGetElapsed(udg_GameTimer))+3+0.5*Level)*1.0))
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffect(magneticfield_fx,TargetX,TargetY)))
+set i=0
+loop
+exitwhen i>5
+call SetPlayerAbilityAvailable(udg_SentPlayers[i],magneticfield_evasion1,false)
+call SetPlayerAbilityAvailable(udg_ScourgePlayers[i],magneticfield_evasion1,false)
+call SetPlayerAbilityAvailable(udg_SentPlayers[i],magneticfield_evasion2,false)
+call SetPlayerAbilityAvailable(udg_ScourgePlayers[i],magneticfield_evasion2,false)
+call SetPlayerAbilityAvailable(udg_SentPlayers[i],magneticfield_evasion2,false)
+call SetPlayerAbilityAvailable(udg_ScourgePlayers[i],magneticfield_evasion3,false)
+call SetPlayerAbilityAvailable(udg_SentPlayers[i],magneticfield_evasion4,false)
+call SetPlayerAbilityAvailable(udg_ScourgePlayers[i],magneticfield_evasion4,false)
+set i=i+1
+endloop
+set Source=null
+set t=null
+endfunction
+function MagneticField_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_magneticfield then
+call MagneticField()
+endif
+return false
+endfunction
+function Register_MagneticField takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function MagneticField_Main))
+set t=null
+endfunction
+function NuralShock_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Target=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_nuralshock)
+local integer abilid=(LoadInteger(hash_main,(Cache),(758)))
+local integer Count=(LoadInteger(hash_main,(Cache),(34)))
+local group g
+if GetTriggerEventId()==EVENT_WIDGET_DEATH or Count>120 or IsMagicImmune(Target)then
+call UnitRemoveAbility(Target,nuralshock_slow_1)
+call UnitRemoveAbility(Target,nuralshock_slow_2)
+call UnitRemoveAbility(Target,nuralshock_slow_1_buffid)
+call UnitRemoveAbility(Target,nuralshock_slow_2_buffid)
+call DestroyEffect((LoadEffectHandle(hash_main,(Cache),(32))))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+else
+set Count=Count+1
+call SaveInteger(hash_main,(Cache),(34),(Count))
+set tt_unit1=Source
+set g=GetAvailableGroup()
+call GroupEnumUnitsInRange(g,GetUnitX(Target),GetUnitY(Target),225+25,Condition(function GenericCondition_EnemyUnitsEx))
+call GroupRemoveUnit(g,Target)
+if FirstOfGroup(g)==null then
+if abilid==nuralshock_slow_1 then
+if GetUnitAbilityLevel(Target,nuralshock_slow_1)==0 then
+call UnitAddAbility2(Target,nuralshock_slow_1)
+call UnitMakeAbilityPermanent(Target,true,1093815381)
+call UnitMakeAbilityPermanent(Target,true,1093815621)
+endif
+else
+if GetUnitAbilityLevel(Target,nuralshock_slow_2)==0 then
+call UnitAddAbility2(Target,nuralshock_slow_2)
+call UnitMakeAbilityPermanent(Target,true,1093815380)
+call UnitMakeAbilityPermanent(Target,true,1093815621)
+endif
+endif
+if ModuloInteger(Count,10)==0 then
+call DamageTarget(Source,Target,DAMAGE_MAGICAL,Level*15*0.5)
+endif
+else
+if abilid==nuralshock_slow_1 then
+if GetUnitAbilityLevel(Target,nuralshock_slow_1)>0 then
+call UnitRemoveAbility(Target,nuralshock_slow_1)
+call UnitRemoveAbility(Target,nuralshock_slow_1_buffid)
+endif
+else
+if GetUnitAbilityLevel(Target,nuralshock_slow_2)>0 then
+call UnitRemoveAbility(Target,nuralshock_slow_2)
+call UnitRemoveAbility(Target,nuralshock_slow_2_buffid)
+endif
+endif
+endif
+call KillGroup(g)
+set g=null
+endif
+set t=null
+set Source=null
+set Target=null
+return false
+endfunction
+function NuralShock takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local unit Target=GetSpellTargetUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local integer abilid=nuralshock_slow_1
+if GetUnitTypeId(Source)==1311788365 then
+set abilid=nuralshock_slow_2
+endif
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),nuralshock_slow_1,false)
+call SetPlayerAbilityAvailable(GetOwningPlayer(Target),nuralshock_slow_2,false)
+call TriggerRegisterTimerEvent(t,0.05,true)
+call TriggerRegisterDeathEvent(t,Target)
+call TriggerAddCondition(t,Condition(function NuralShock_Loop))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Target))
+call SaveInteger(hash_main,(Cache),(758),(abilid))
+call SaveEffectHandle(hash_main,(Cache),(32),(AddSpecialEffectTarget(nuralshock_fx,Target,"origin")))
+call TriggerEvaluate(t)
+set Source=null
+set Target=null
+set t=null
+endfunction
+function NuralShock_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_nuralshock and IsBlocked(GetSpellTargetUnit())==false then
+call NuralShock()
+endif
+return false
+endfunction
+function Register_NuralShock takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function NuralShock_Main))
+set t=null
+endfunction
+function TempestDouble_Remove takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Clone=(LoadUnitHandle(hash_main,(Cache),(17)))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call FlushChildHashtable(hash_main,(GetHandleId(Clone)))
+call RemoveUnit(Clone)
+set t=null
+set Clone=null
+return false
+endfunction
+function TempestDouble_DelayHide takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Clone=(LoadUnitHandle(hash_main,(Cache),(2)))
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call FlushChildHashtable(hash_main,(GetHandleId(Clone)))
+call ShowUnit(Clone,false)
+set t=null
+set Clone=null
+return false
+endfunction
+function TempestDouble_Loop takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Clone=(LoadUnitHandle(hash_main,(Cache),(17)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_tempestdouble)
+if GetTriggerEvalCount(t)==200 or GetTriggerEventId()==EVENT_WIDGET_DEATH then
+call FlushChildHashtable(hash_main,(Cache))
+call CleanTrigger(t)
+call KillUnit(Clone)
+call DestroyEffect(AddSpecialEffect(tempestdouble_fx,GetUnitX(Clone),GetUnitX(Clone)))
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call SaveUnitHandle(hash_main,(Cache),(2),(Clone))
+call TriggerRegisterTimerEvent(t,0,false)
+call TriggerAddCondition(t,Condition(function TempestDouble_DelayHide))
+set t=CreateTrigger()
+set Cache=GetHandleId(t)
+call TriggerRegisterTimerEvent(t,3,false)
+call TriggerAddCondition(t,Condition(function TempestDouble_Remove))
+call SaveUnitHandle(hash_main,(Cache),(17),(Clone))
+else
+call SuspendHeroXP(Clone,true)
+call UnitModifySkillPoints(Clone,-25)
+endif
+set t=null
+set Source=null
+set Clone=null
+return false
+endfunction
+function TempestDouble takes nothing returns nothing
+local unit Source=GetTriggerUnit()
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Clone=CreateUnit(GetOwningPlayer(Source),unitid_tempestdouble,GetUnitX(Source),GetUnitY(Source),0)
+local integer Level=GetUnitAbilityLevel(Source,abilityid_tempestdouble)
+local integer i=0
+local item Item
+local integer dummyitemid=1227895373
+call DestroyEffect(AddSpecialEffectTarget(tempestdouble_fx,Clone,"chest"))
+if IsSent(GetOwningPlayer(Clone))==false then
+set dummyitemid=1227903043
+endif
+if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(Source))==true or IsPlayerObserver(GetLocalPlayer())==true then
+call SetUnitVertexColor(Clone,75,75,75,100)
+endif
+call SelectUnitAddForPlayer(Clone,GetOwningPlayer(Source))
+call DisableTrigger(t_manipulateitem)
+loop
+exitwhen i>5
+if UnitItemInSlot(Source,i)!=null and GetItemTypeId(UnitItemInSlot(Source,i))!=Item_Real[indexid_aegis]and GetItemTypeId(UnitItemInSlot(Source,i))!=Item_Real[indexid_refresherorb]and GetItemTypeId(UnitItemInSlot(Source,i))!=Item_Real[indexid_observerwards]and GetItemTypeId(UnitItemInSlot(Source,i))!=Item_Real[indexid_sentrywards]and GetItemTypeId(UnitItemInSlot(Source,i))!=Item_Real[indexid_smokeofdeceit]then
+set Item=CreateItem(GetItemTypeId(UnitItemInSlot(Source,i)),0,0)
+if GetItemCharges(UnitItemInSlot(Source,i))>0 then
+call SetItemCharges(Item,GetItemCharges(UnitItemInSlot(Source,i)))
+endif
+call UnitAddItem(Clone,Item)
+call SetItemPlayer(Item,GetOwningPlayer(Clone),false)
+if GetItemTypeId(Item)==Item_Real[indexid_divinerapier]or GetItemTypeId(Item)==Item_Real[indexid_divinerapierfree]or GetItemTypeId(Item)==Item_Real[indexid_gemoftruesight]then
+call SetItemDropOnDeath(Item,false)
+endif
+else
+call UnitAddItem(Clone,CreateItem(dummyitemid,0,0))
+endif
+set i=i+1
+endloop
+call EnableTrigger(t_manipulateitem)
+call SetHeroLevel(Clone,GetHeroLevel(Source),false)
+set i=1
+loop
+exitwhen i>GetUnitAbilityLevel(Source,1096904043)
+call SelectHeroSkill(Clone,1096904043)
+set i=i+1
+endloop
+set i=1
+loop
+exitwhen i>GetUnitAbilityLevel(Source,abilityid_lightningseeker)
+call SelectHeroSkill(Clone,abilityid_lightningseeker)
+set i=i+1
+endloop
+set i=1
+loop
+exitwhen i>GetUnitAbilityLevel(Source,abilityid_magneticfield)
+call SelectHeroSkill(Clone,abilityid_magneticfield)
+set i=i+1
+endloop
+set i=1
+loop
+exitwhen i>GetUnitAbilityLevel(Source,abilityid_nuralshock)
+call SelectHeroSkill(Clone,abilityid_nuralshock)
+set i=i+1
+endloop
+set i=1
+loop
+exitwhen i>GetUnitAbilityLevel(Source,abilityid_blackjack)
+call SelectHeroSkill(Clone,abilityid_blackjack)
+set i=i+1
+endloop
+set i=1
+loop
+exitwhen i>GetUnitAbilityLevel(Source,abilityid_tempestdouble)
+call SelectHeroSkill(Clone,abilityid_tempestdouble)
+set i=i+1
+endloop
+call UnitRemoveAbility(Clone,abilityid_tempestdouble)
+call UnitModifySkillPoints(Clone,-25)
+call SuspendHeroXP(Clone,true)
+call TriggerRegisterTimerEvent(t,0.1,true)
+call TriggerRegisterDeathEvent(t,Clone)
+call TriggerAddCondition(t,Condition(function TempestDouble_Loop))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(17),(Clone))
+call SetUnitState(Source,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE)*(1-(0.45-0.15*Level)))
+call SetUnitState(Source,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA)*(1-(0.45-0.15*Level)))
+call SetUnitState(Clone,UNIT_STATE_LIFE,GetUnitState(Source,UNIT_STATE_LIFE))
+call SetUnitState(Clone,UNIT_STATE_MANA,GetUnitState(Source,UNIT_STATE_MANA))
+set Source=null
+set Clone=null
+set t=null
+endfunction
+function TempestDouble_Main takes nothing returns boolean
+if GetSpellAbilityId()==abilityid_tempestdouble then
+call TempestDouble()
+endif
+return false
+endfunction
+function Register_TempestDouble takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)
+call TriggerAddCondition(t,Condition(function TempestDouble_Main))
+set t=null
+endfunction
+function Marksmanship_Think takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local group g=GetAvailableGroup()
+local integer Level=GetUnitAbilityLevel(Source,abilityid_marksmanship)
+set tt_unit1=Source
+call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),400+25,Condition(function GenericCondition_EnemyHeroesEx))
+if FirstOfGroup(g)==null then
+if GetUnitAbilityLevel(Source,abilityid_marksmanship_double)!=Level then
+call UnitAddAbility2(Source,abilityid_marksmanship_double)
+call SetUnitAbilityLevel(Source,abilityid_marksmanship_double,Level)
+endif
+else
+if GetUnitAbilityLevel(Source,abilityid_marksmanship_double)>0 then
+call UnitRemoveAbility(Source,abilityid_marksmanship_double)
+endif
+endif
+call KillGroup(g)
+set Source=null
+set t=null
+set g=null
+return false
+endfunction
+function Marksmanship takes nothing returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=GetTriggerUnit()
+call TriggerRegisterTimerEvent(t,0.1,true)
+call TriggerAddCondition(t,Condition(function Marksmanship_Think))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+set t=null
+set Source=null
+endfunction
+function Marksmanship_Main takes nothing returns boolean
+if GetLearnedSkill()==abilityid_marksmanship and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_marksmanship)==1 then
+call Marksmanship()
+endif
+return false
+endfunction
+function Register_Marksmanship takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerAddCondition(t,Condition(function Marksmanship_Main))
+set t=null
+endfunction
+function TrueshotAura_Think takes nothing returns boolean
+local trigger t=GetTriggeringTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=(LoadUnitHandle(hash_main,(Cache),(2)))
+local unit Caster=(LoadUnitHandle(hash_main,(Cache),(19)))
+local integer Level=GetUnitAbilityLevel(Source,abilityid_trueshotaura)
+local integer Agility=GetHeroAgi(Source,true)
+local real DesiredDamage=Agility*(0.1+0.04*Level)
+local integer CasterLevel=R2I(DesiredDamage/2.0+0.5)
+local integer GlobalBehavior=(LoadInteger(hash_main,(Cache),(34)))
+if GetTriggerEventId()==EVENT_UNIT_SPELL_EFFECT and GetSpellAbilityId()==abilityid_trueshotaura then
+if GlobalBehavior==TRUESHOT_CREEPS_GLOBAL_ON then
+set GlobalBehavior=TRUESHOT_CREEPS_GLOBAL_OFF
+else
+set GlobalBehavior=TRUESHOT_CREEPS_GLOBAL_ON
+endif
+call SaveInteger(hash_main,(Cache),(34),(GlobalBehavior))
+call UnitRemoveAbility(Caster,abilityid_trueshotaura_aura)
+call UnitRemoveAbility(Caster,abilityid_trueshotaura_aura_creeps_global)
+endif
+if IsDead(Source)==true then
+call UnitRemoveAbility(Caster,abilityid_trueshotaura_aura)
+call UnitRemoveAbility(Caster,abilityid_trueshotaura_aura_creeps_global)
+else
+if GetUnitAbilityLevel(Caster,abilityid_trueshotaura_aura)==0 then
+call UnitAddAbility2(Caster,abilityid_trueshotaura_aura)
+if GlobalBehavior==TRUESHOT_CREEPS_GLOBAL_ON then
+call UnitAddAbility2(Caster,abilityid_trueshotaura_aura_creeps_global)
+else
+endif
+endif
+call SetUnitAbilityLevel(Caster,abilityid_trueshotaura_aura,CasterLevel)
+call SetUnitAbilityLevel(Caster,abilityid_trueshotaura_aura_creeps_global,CasterLevel)
+call SetUnitX(Caster,GetUnitX(Source))
+call SetUnitY(Caster,GetUnitY(Source))
+endif
+set Source=null
+set t=null
+return false
+endfunction
+function TrueshotAura takes nothing returns nothing
+local trigger t=CreateTrigger()
+local integer Cache=GetHandleId(t)
+local unit Source=GetTriggerUnit()
+local unit Caster=CreateUnit(GetOwningPlayer(Source),1697657174,0,0,0)
+call TriggerRegisterUnitEvent(t,Source,EVENT_UNIT_SPELL_EFFECT)
+call TriggerRegisterTimerEvent(t,0.1,true)
+call TriggerAddCondition(t,Condition(function TrueshotAura_Think))
+call SaveUnitHandle(hash_main,(Cache),(2),(Source))
+call SaveUnitHandle(hash_main,(Cache),(19),(Caster))
+call SaveInteger(hash_main,(Cache),(34),(TRUESHOT_CREEPS_GLOBAL_ON))
+call UnitAddAbility2(Caster,abilityid_trueshotaura_aura)
+call UnitAddAbility2(Caster,abilityid_trueshotaura_aura_creeps_global)
+set t=null
+set Source=null
+endfunction
+function TrueshotAura_Main takes nothing returns boolean
+if GetLearnedSkill()==abilityid_trueshotaura and IsUnitIllusion(GetTriggerUnit())==false and GetUnitAbilityLevel(GetTriggerUnit(),abilityid_trueshotaura)==1 then
+call TrueshotAura()
+endif
+return false
+endfunction
+function Register_TrueshotAura takes nothing returns nothing
+local trigger t=CreateTrigger()
+call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_HERO_SKILL)
+call TriggerAddCondition(t,Condition(function TrueshotAura_Main))
+call PreloadAbility(abilityid_trueshotaura_aura)
+call PreloadAbility(abilityid_trueshotaura_aura_creeps_global)
+set t=null
+endfunction
 function InitTrig_Invoker_Core takes nothing returns nothing
 local trigger t=CreateTrigger()
 local region rectRegion=CreateRegion()
 call RegionAddRect(rectRegion,GetWorldBounds())
 call TriggerRegisterEnterRegion(t,rectRegion,Condition(function GenericCondition_True))
 call TriggerAddCondition(t,Condition(function InvokerCore_Enter))
 set InvokeA[1]=abilityid_invoke1a
 set InvokeA[2]=abilityid_invoke2a
 set InvokeA[3]=abilityid_invoke3a
 set InvokeA[4]=abilityid_invoke4a
 set InvokeA[5]=abilityid_invoke5a
 set InvokeA[6]=abilityid_invoke6a
 set InvokeA[7]=abilityid_invoke7a
 set InvokeA[8]=abilityid_invoke8a
 set InvokeA[9]=abilityid_invoke9a
@@ -85113,30 +88174,31 @@
 call InitTrig_Misc()
 call InitTrig_Map_Info()
 call InitTrig_Leave()
 call InitTrig_Remove_On_Respawn()
 call InitTrig_HeroRevive()
 call InitTrig_HeroEnters()
 call InitTrig_OneHero()
 call InitTrig_Money()
 call InitTrig_Time()
 call InitTrig_Cooldown_Tracker()
 call InitTrig_Reliable_Gold()
 call InitTrig_Ban_Dev_Hero()
 call InitTrig_Track_Dying_Creeps()
 call InitTrig_CustomHeroRevive()
 call InitTrig_Deathtrigger()
+call InitTrig_Image_Enters()
 call InitTrig_First_Blood()
 call InitTrig_RoshanDies()
 call InitTrig_AntiDeny()
 call InitTrig_Chicken_Dies()
 call InitTrig_Item_Definitions()
 call InitTrig_Powerup_Definitions()
 call Initialize_Recipes()
 call AghanimsScepter_Init()
 call InitTrig_Goblin_Definitions()
 call InitTrig_Unit_Item_Conversion()
 call InitTrig_Manipulate_Item()
 call InitTrig_Hero_Morphing_Restrictions()
 call InitTrig_Item_Traffic()
 call InitTrig_Item_Cooldown()
 call InitTrig_Disassemble()
