

5218a5329
> set mbitem=null

5224a5336
> set mbitem=null

5230a5343
> set mbitem=null

5236a5350
> set mbitem=null

5242a5357
> set mbitem=null



7979,7986c8208
< function IsNotAttackable takes unit u returns boolean

< return GetUnitAbilityLevel(u,1097167980)>0 or GetUnitAbilityLevel(u,1113815395)>0 or GetUnitAbilityLevel(u,1113815346)>0

< endfunction

< function IsStunned takes unit u returns boolean

< return(GetUnitAbilityLevel((u),(1112560453))>0)or(GetUnitAbilityLevel((u),(1110456633))>0)or(GetUnitAbilityLevel((u),(1112757326))>0)or(GetUnitAbilityLevel((u),(1110459206))>0)or(GetUnitAbilityLevel((u),(1110458957))>0)or(GetUnitAbilityLevel((u),(1111844210))>0)or(GetUnitAbilityLevel((u),(1110454583))>0)or(GetUnitAbilityLevel((u),(1110455885))>0)or(GetUnitAbilityLevel((u),(1110456142))>0)or(GetUnitAbilityLevel((u),(1110456403))>0)or(GetUnitAbilityLevel((u),(1110454353))>0)or(GetUnitAbilityLevel((u),(1110455382))>0)or(GetUnitAbilityLevel((u),(1110456114))>0)or(GetUnitAbilityLevel((u),(1112891758))>0)or(GetUnitAbilityLevel((u),(1110456629))>0)or(GetUnitAbilityLevel((u),(1110454617))>0)or(GetUnitAbilityLevel((u),(1110455113))>0)or(GetUnitAbilityLevel((u),(1110455859))>0)or(GetUnitAbilityLevel((u),(1113943655))>0)or(GetUnitAbilityLevel((u),(1110458692))>0)or(GetUnitAbilityLevel((u),(1110458693))>0)or(GetUnitAbilityLevel((u),(1110458949))>0)or(GetUnitAbilityLevel((u),(1110458950))>0)or(GetUnitAbilityLevel((u),(1110454328))>0)or(GetUnitAbilityLevel((u),(1110455362))>0)or(GetUnitAbilityLevel((u),(1110454854))>0)or(GetUnitAbilityLevel((u),(1112896368))>0)or(GetUnitAbilityLevel((u),(1112896372))>0)or(GetUnitAbilityLevel((u),(1110459460))>0)or((LoadInteger(hash_main,(GetHandleId((u))),((4293))))==HERO_STATE_ON)==true

< endfunction

< function SetTime takes integer Minutes,integer Seconds,boolean extraColor returns nothing

< local integer x=0

---

7988,7991c8210,8212
< exitwhen x>15

< call SetPlayerState(Player(x),PLAYER_STATE_RESOURCE_LUMBER,Minutes)

< call SetPlayerState(Player(x),PLAYER_STATE_RESOURCE_FOOD_USED,Seconds)

< set x=x+1

---

7993c8214
< endfunction


8292a8490,8491
> elseif unitId==1164799855 then

> return indexid_aghanimsscepterenchantress

8383a8583,8584
> elseif unitId==1164799855 then

> return abilityid_aghanimsscepter_enchantress

14320a14604,14605
> elseif GetUnitTypeId(KillHero)==1160786502 then

> call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,(udg_Colors[GetPlayerId(DeadPlayer)]+(PlayerNames[GetPlayerId((DeadPlayer))])+"|r has been killed by Phoenix"))

14392a14678,14680
> if GetUnitTypeId(KillHero)==1160786502 then

> set KillPlayerString=udg_Colors[0]+GetObjectName(1160786502)+"|r"

> endif




20019a20365,20371
> function LastWill_FindUnit takes unit u returns unit

> if IsUnitType(u,UNIT_TYPE_HERO)or GetUnitAbilityLevel(u,1093678162)==0 then

> return u

> else

> return udg_Hero[GetPlayerId(GetOwningPlayer(u))]

> endif

> endfunction

20023c20375
< call DamageTarget(GetDyingUnit(),GetKillingUnit(),DAMAGE_PURE,200)

---
> call DamageTarget(GetDyingUnit(),LastWill_FindUnit(GetKillingUnit()),DAMAGE_PURE,200)

20025c20377
< call DamageTarget(GetDyingUnit(),GetKillingUnit(),DAMAGE_PURE,400)

---
> call DamageTarget(GetDyingUnit(),LastWill_FindUnit(GetKillingUnit()),DAMAGE_PURE,400)

20027c20379
< call DamageTarget(GetDyingUnit(),GetKillingUnit(),DAMAGE_PURE,600)

---
> call DamageTarget(GetDyingUnit(),LastWill_FindUnit(GetKillingUnit()),DAMAGE_PURE,600)


22160,22161c22593,22597
< local trigger t=CreateTrigger()

< local integer Cache=GetHandleId(t)

---
> local trigger t

> local integer Cache

> if IsCourier(Source)==false then

> set t=CreateTrigger()

> set Cache=GetHandleId(t)

22167a22604
> endif

22229c22666
< if CurrentHP>150 then

---
> if CurrentHP>151 then

22278c22715
< if GetSpellAbilityId()==abilityid_mantastyle and(GetUnitAbilityLevel((GetTriggerUnit()),buffid_linkensphere)>0)==true then

---
> if(GetSpellAbilityId()==abilityid_mantastyle or GetSpellAbilityId()==1093752645)and(GetUnitAbilityLevel((GetTriggerUnit()),buffid_linkensphere)>0)==true then



28092,28093d28654
< call TechHeroForAll(1211119409)

< call TechHeroForAll(1429221441)

28095,28096d28655
< call TechHeroForAll(1430466865)

< call TechHeroForAll(1164277353)

28100d28658
< call TechHeroForAll(1160786510)

28103a28662,28663
> call TechHeroForAll(1164277353)

> call TechHeroForAll(1160786510)

28343c28903
< if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))then

---
> if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))and GetUnitTypeId(GetTriggerUnit())!=1966092621 and GetUnitTypeId(GetTriggerUnit())!=1966092622 then

39755,39756c40345,40633
< call StartingReplayData()

< call CleanTrigger(GetTriggeringTrigger())

---
> call StartingReplayData()

> call CleanTrigger(GetTriggeringTrigger())

> return false

> endfunction

40709c41635
< call GroupEnumUnitsInRange(GroupVar,x,y,625,CondVar)

---
> call GroupEnumUnitsInRange(GroupVar,x,y,650,CondVar)

44440c45434
< call GroupEnumUnitsInRange(g,x,y,400,Condition(function GenericCondition_EnemyUnitsWithAncients))

---
> call GroupEnumUnitsInRange(g,x,y,425,Condition(function GenericCondition_EnemyUnitsWithAncients))


44878c45946
< if(GetSpellAbilityId()==abilityid_souleater or GetSpellAbilityId()==abilityid_souleaterupgrade)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false then

---
> if(GetSpellAbilityId()==abilityid_souleater or GetSpellAbilityId()==abilityid_souleaterupgrade)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false and GetOwningPlayer(GetSpellTargetUnit())!=udg_NeutralHostile then

45024,45026d46091
< function BurningSpear_RestoreMana takes unit whichUnit returns nothing

< call SetUnitState(whichUnit,UNIT_STATE_MANA,GetUnitState(whichUnit,UNIT_STATE_MANA)+15+5*GetUnitAbilityLevel(whichUnit,abilityid_burningspear))

< endfunction

45043d46107
< call BurningSpear_RestoreMana(GetTriggerUnit())

45771,45772c46853,46854
< local trigger t=CreateTrigger()

< local integer Cache=GetHandleId(t)

---
> local trigger t

> local integer Cache

45773a46856,46870
> local group g

> if Target==null then

> set recall_target=null

> set recall_distance=999999

> set recall_x=GetSpellTargetX()

> set recall_y=GetSpellTargetY()

> set tt_unit1=Source

> set g=GetAvailableGroup()

> call GroupEnumUnitsInRange(g,0,0,9999,Condition(function GenericCondition_AlliedHeroesEx))

> call GroupRemoveUnit(g,Source)

> call ForGroup(g,function Recall_FindTarget)

> call KillGroup(g)

> set Target=recall_target

> set g=null

> endif

45782a46880,46882
> if Target!=null then

> set t=CreateTrigger()

> set Cache=GetHandleId(t)

45791a46892
> endif

45804c46905
< if(LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then

---
> if GetSpellTargetUnit()!=null and(LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then

46441c47542
< set TargetLimit=5

---
> set TargetLimit=6

47037a48139,48140
> set Hero=null

> set Replicate=null

47056a48160,48161
> set Hero=null

> set Replicate=null

47075a48181,48183
> set Hero=null

> set Target=null

> set Replicate=null

47083a48192,48202
> set Hero=null

> set Target=null

> endfunction

> function Replicate_Restriction takes nothing returns boolean

> if GetSpellAbilityId()==(1093683000)then

> if GetOwningPlayer(GetSpellTargetUnit())==GetOwningPlayer(GetTriggerUnit())or GetOwningPlayer(GetSpellTargetUnit())==udg_NeutralHostile then

> call InterruptUnit(GetTriggerUnit())

> call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName(1848659014))

> endif

> endif

> return false

47098a48218,48221
> set t=CreateTrigger()

> call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)

> call TriggerAddCondition(t,Condition(function Replicate_Restriction))

> set t=null

47321c48444
< call UnitDamageTarget(UnitVar,Target,TotalDamage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)

---
> call DamageTarget(UnitVar,Target,DAMAGE_MAGICAL,TotalDamage)

47332a48456
> call PreloadAbility(abilityid_genericstun)

47357c48481
< call GroupEnumUnitsInRange(GroupVar,GetUnitX(UnitVar),GetUnitY(UnitVar),500+500*Level,Boolexpr)

---
> call GroupEnumUnitsInRange(GroupVar,GetUnitX(UnitVar),GetUnitY(UnitVar),500+500*Level+25,Boolexpr)

47768c48892
< call SetUnitAnimation(GetFilterUnit(),"slam")

---
> call SetUnitAnimation(GetFilterUnit(),"spell")

47959a49084
> set g=null

48100a49226,49227
> set r5=null

> set r6=null

48222a49350,49351
> set Source=null

> set Target=null

49158a50303,50305
> if IsDead(GetFilterUnit())then

> return false

> endif

49244a50392,50394
> if IsDead(GetFilterUnit())then

> return false

> endif

49267a50418
> local unit Bear

49289a50441,50445
> elseif NoBear==false then

> set Bear=FirstOfGroup(GroupVar)

> call AddSpecialEffectTargetUnitBJ("chest",Bear,"Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl")

> call SetUnitState(Bear,UNIT_STATE_LIFE,GetUnitState(Bear,UNIT_STATE_MAX_LIFE))

> set Bear=null

49322,49325d50477
< set t=CreateTrigger()

< call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)

< call TriggerAddCondition(t,Condition(function Trig_Summon_Spirit_Bear_Conditions))

< call TriggerAddAction(t,function Trig_Summon_Spirit_Bear_PreActions)

49361c50513
< if((GetUnitX(BearOwner)-GetUnitX(Bear))*(GetUnitX(BearOwner)-GetUnitX(Bear))+(GetUnitY(BearOwner)-GetUnitY(Bear))*(GetUnitY(BearOwner)-GetUnitY(Bear))>=855625)then

---
> if((GetUnitX(BearOwner)-GetUnitX(Bear))*(GetUnitX(BearOwner)-GetUnitX(Bear))+(GetUnitY(BearOwner)-GetUnitY(Bear))*(GetUnitY(BearOwner)-GetUnitY(Bear))>=(1100*1100))then

49647c50799
< if IsRealSummoned(GetEnumUnit())then

---
> if IsRealSummoned(GetEnumUnit())or GetUnitTypeId(GetEnumUnit())==1160786502 then



50446d51618
< call SelectUnitAddForPlayer(GetTriggerUnit(),GetOwningPlayer(GetTriggerUnit()))

50849c52021
< if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and Count<3 then

---
> if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and Count<6 then

50858c52030
< if Count>2 then

---
> if Count>5 then

50868c52040
< if Count>2 then

---
> if Count>5 then

51138c52310
< call AddTimedAbilityAndRemove(GetEnumUnit(),abilityid_rampagebonus,rampage_level,rampage_duration+3,1110454338)

---
> call AddTimedAbilityAndRemove(GetEnumUnit(),abilityid_rampagebonus,rampage_level,rampage_duration*2,1110454338)


52607a53784
> if GetUnitTypeId(GetEnumUnit())!=1160786502 then

52609a53787
> endif


53866c55139,55140
< local real dmg=0.2*Level*SquareRoot((LastX-x)*(LastX-x)+(LastY-y)*(LastY-y))

---
> local real d=SquareRoot((LastX-x)*(LastX-x)+(LastY-y)*(LastY-y))

> local real dmg=0.2*Level*d

53868c55142
< if dmg>200 then

---
> if d>1300 then

53948c55222
< if Distance>=udg_TempInt*1500 or(Distance<udg_TempInt*1500 and GetUnitStatePercent(GetEnumUnit(),UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)>40)then

---
> if Distance>=(udg_TempInt*1500+25)or(Distance<(udg_TempInt*1500+25)and GetUnitStatePercent(GetEnumUnit(),UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)>40)then

53951c55225
< if Distance<udg_TempInt*1500 and GetUnitLifePercent(GetEnumUnit())<=40 then

---
> if Distance<(udg_TempInt*1500+25)and GetUnitLifePercent(GetEnumUnit())<=40 then

54076a55364
> call UnitRemoveAbility(Hero,1110454597)

54313c55601
< local integer BonusDamage=R2I((0.05+0.01*Level)*TargetLife)

---
> local integer BonusDamage=R2I((0.02+0.02*Level)*TargetLife)

54845a56134
> if GetOwningPlayer(Target)!=udg_NeutralHostile then

54846a56136
> endif

57015a58306,58314
> if GetLearnedSkill()==abilityid_wex then

> call SetHeroAgi(GetTriggerUnit(),GetHeroAgi(GetTriggerUnit(),false)+2,true)

> endif

> if GetLearnedSkill()==abilityid_quas then

> call SetHeroStr(GetTriggerUnit(),GetHeroStr(GetTriggerUnit(),false)+2,true)

> endif

> if GetLearnedSkill()==abilityid_exort then

> call SetHeroInt(GetTriggerUnit(),GetHeroInt(GetTriggerUnit(),false)+2,true)

> endif

57218c58579
< elseif Target==null then

---
> else

57221a58583,58585
> if Target!=null then

> set TargetLoc=GetUnitLoc(Target)

> else

57222a58587
> endif

58293c59658
< call TriggerRegisterTimerEvent(t,13+1*GetUnitAbilityLevel(Hero,abilityid_shapeshift)-0.1,false)

---
> call TriggerRegisterTimerEvent(t,18-0.1,false)

58305c59670
< local real Duration=13+1*GetUnitAbilityLevel(Hero,abilityid_shapeshift)

---
> local real Duration=18

59505a60874
> if GetUnitTypeId(Target)!=1160786502 then

59508a60878
> endif

59726c61096
< return(GetSpellAbilityId()==1093678647 or GetSpellAbilityId()==1093679184)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false

---
> return(GetSpellAbilityId()==1093678647 or GetSpellAbilityId()==1093679184)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false and GetOwningPlayer(GetSpellTargetUnit())!=udg_NeutralHostile

60651c62061
< call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),400,Condition(function GenericCondition_AlliedHeroesEx))

---
> call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),475,Condition(function GenericCondition_AlliedHeroesEx))

61251c62661
< if GetSpellAbilityId()==abilityid_dismemberupgrade or GetSpellAbilityId()==abilityid_dismember then

---
> if GetSpellAbilityId()==abilityid_dismemberupgrade and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false then

62046c63456
< set MaxIteration=MaxIteration+1

---
> set MaxIteration=MaxIteration+2

62105a63516
> call PreloadAbility(abilityid_epicentereffect)

62111a63523
> if((LoadInteger(hash_main,(GetHandleId((Hero))),((4299))))==HERO_STATE_ON)==false then

62112a63525
> endif

62129a63543
> call SaveInteger(hash_main,(GetHandleId((Hero))),((4299)),(HERO_STATE_OFF))

62189a63604
> call SaveInteger(hash_main,(GetHandleId((Hero))),((4299)),(HERO_STATE_ON))




