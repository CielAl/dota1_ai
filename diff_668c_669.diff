534d540
< trigger gg_trg_Generic_Condition=null

537d542
< trigger gg_trg_Utility_Functions=null

538a544,545
> trigger gg_trg_Generic_Condition=null

> trigger gg_trg_Utility_Functions=null

557a565
> trigger gg_trg_RangeTest=null

595a604
> trigger gg_trg_Hero_Morphing_Restrictions=null

598d606
< trigger gg_trg_Custom_Pick_Up_Item=null

620a629
> trigger gg_trg_Custom_Pick_Up_Item=null


2220a2236
> integer indexid_mantastyleranged

2273a2290
> integer indexid_phoenixblade


2453a2473,2474
> constant integer morphrestrict_metamorph=1093751369

> constant integer morphrestrict_berserkerrage=1093681733

2462,2465d2482
< real array TP_Location_X

< real array TP_Location_Y

< real array Blink_Location_X

< real array Blink_Location_Y


2535a2555,2558
> real array TP_Location_X

> real array TP_Location_Y

> real array Blink_Location_X

> real array Blink_Location_Y


3502a3594
> constant integer abilityid_bloodrage=1093682499

3634a3727
> constant integer abilityid_reincarnation=1093677401

5218a5329
> set mbitem=null

5224a5336
> set mbitem=null

5230a5343
> set mbitem=null

5236a5350
> set mbitem=null

5242a5357
> set mbitem=null

> function LockAllItems takes player p returns nothing

> local unit Hero=udg_Hero[GetPlayerId(p)]

> local integer i=0

> local item Item

> loop

> exitwhen i>5

> set Item=UnitItemInSlot(Hero,i)

> call SetItemDroppable(Item,false)

> set i=i+1

> endloop

> set Hero=null

> set Item=null

> endfunction

> function UnlockAllItems takes player p returns nothing

> local unit Hero=udg_Hero[GetPlayerId(p)]

> local integer i=0

> local item Item

> loop

> exitwhen i>5

> set Item=UnitItemInSlot(Hero,i)

> call SetItemDroppable(Item,true)

> set i=i+1

> endloop

> set Hero=null

> set Item=null

> endfunction


7958,7960c8198,8199
< exitwhen i>5

< set Item=UnitItemInSlot(Hero,i)

< call SetItemDroppable(Item,false)

---

7963,7969c8202
< set Hero=null

< set Item=null

< endfunction

< function UnlockAllItems takes player p returns nothing

< local unit Hero=udg_Hero[GetPlayerId(p)]

< local integer i=0

< local item Item

---

7971,7973c8204,8205
< exitwhen i>5

< set Item=UnitItemInSlot(Hero,i)

< call SetItemDroppable(Item,true)

---

7976,7986c8208
< set Hero=null

< set Item=null

< endfunction

< function IsNotAttackable takes unit u returns boolean

< return GetUnitAbilityLevel(u,1097167980)>0 or GetUnitAbilityLevel(u,1113815395)>0 or GetUnitAbilityLevel(u,1113815346)>0

< endfunction

< function IsStunned takes unit u returns boolean

< return(GetUnitAbilityLevel((u),(1112560453))>0)or(GetUnitAbilityLevel((u),(1110456633))>0)or(GetUnitAbilityLevel((u),(1112757326))>0)or(GetUnitAbilityLevel((u),(1110459206))>0)or(GetUnitAbilityLevel((u),(1110458957))>0)or(GetUnitAbilityLevel((u),(1111844210))>0)or(GetUnitAbilityLevel((u),(1110454583))>0)or(GetUnitAbilityLevel((u),(1110455885))>0)or(GetUnitAbilityLevel((u),(1110456142))>0)or(GetUnitAbilityLevel((u),(1110456403))>0)or(GetUnitAbilityLevel((u),(1110454353))>0)or(GetUnitAbilityLevel((u),(1110455382))>0)or(GetUnitAbilityLevel((u),(1110456114))>0)or(GetUnitAbilityLevel((u),(1112891758))>0)or(GetUnitAbilityLevel((u),(1110456629))>0)or(GetUnitAbilityLevel((u),(1110454617))>0)or(GetUnitAbilityLevel((u),(1110455113))>0)or(GetUnitAbilityLevel((u),(1110455859))>0)or(GetUnitAbilityLevel((u),(1113943655))>0)or(GetUnitAbilityLevel((u),(1110458692))>0)or(GetUnitAbilityLevel((u),(1110458693))>0)or(GetUnitAbilityLevel((u),(1110458949))>0)or(GetUnitAbilityLevel((u),(1110458950))>0)or(GetUnitAbilityLevel((u),(1110454328))>0)or(GetUnitAbilityLevel((u),(1110455362))>0)or(GetUnitAbilityLevel((u),(1110454854))>0)or(GetUnitAbilityLevel((u),(1112896368))>0)or(GetUnitAbilityLevel((u),(1112896372))>0)or(GetUnitAbilityLevel((u),(1110459460))>0)or((LoadInteger(hash_main,(GetHandleId((u))),((4293))))==HERO_STATE_ON)==true

< endfunction

< function SetTime takes integer Minutes,integer Seconds,boolean extraColor returns nothing

< local integer x=0

---

7988,7991c8210,8212
< exitwhen x>15

< call SetPlayerState(Player(x),PLAYER_STATE_RESOURCE_LUMBER,Minutes)

< call SetPlayerState(Player(x),PLAYER_STATE_RESOURCE_FOOD_USED,Seconds)

< set x=x+1

---

7993,8008c8214
< endfunction

< function IsRealSummoned takes unit u returns boolean

< local integer id=GetUnitTypeId(u)

< return id==1848652343 or id==unitid_gargoyle_a_1 or id==unitid_gargoyle_a_2 or id==unitid_gargoyle_a_3 or id==unitid_gargoyle_b_1 or id==unitid_gargoyle_b_2 or id==unitid_gargoyle_b_3 or id==unitid_gargoyle_a_1_stone or id==unitid_gargoyle_a_2_stone or id==unitid_gargoyle_a_3_stone or id==unitid_gargoyle_b_1_stone or id==unitid_gargoyle_b_2_stone or id==unitid_gargoyle_b_3_stone

< endfunction

< function SetUnitInvulnerable2 takes unit u,boolean b returns nothing

< call SetUnitInvulnerable(u,b)

< call SaveBoolean(hash_main,(GetHandleId(u)),(509),(b))

< endfunction

< function IsInvulnerable2 takes unit u returns boolean

< return(LoadBoolean(hash_main,(GetHandleId(u)),(509)))or GetUnitAbilityLevel(u,1098282348)>0

< endfunction

< function FindClearLocation takes real x,real y returns location

< local real NewX

< local real NewY

< local integer i=0

---

8010,8030c8216,8217
< exitwhen i>40

< set NewX=x+i*20

< set NewY=y+i*20

< if IsPointInRegion(region_badplaces,NewX,NewY)==false then

< return Location(NewX,NewY)

< endif

< set NewX=x+i*20

< set NewY=y-i*20

< if IsPointInRegion(region_badplaces,NewX,NewY)==false then

< return Location(NewX,NewY)

< endif

< set NewX=x-i*20

< set NewY=y+i*20

< if IsPointInRegion(region_badplaces,NewX,NewY)==false then

< return Location(NewX,NewY)

< endif

< set NewX=x-i*20

< set NewY=y-i*20

< if IsPointInRegion(region_badplaces,NewX,NewY)==false then

< return Location(NewX,NewY)

< endif

---

8033c8220,8229
< return Location(x,y)

---


8292a8490,8491
> elseif unitId==1164799855 then

> return indexid_aghanimsscepterenchantress

8383a8583,8584
> elseif unitId==1164799855 then

> return abilityid_aghanimsscepter_enchantress

14189a14407,14471
> function GiveBonusXPGold_Count takes nothing returns nothing

> if(GetUnitTypeId((GetEnumUnit()))==1211117642)==false then

> set Bonus_Count_XP=Bonus_Count_XP+1

> if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then

> set Bonus_Count_Gold=Bonus_Count_Gold+1

> endif

> endif

> endfunction

> function GiveBonusXPGold_Give takes nothing returns nothing

> if(GetUnitTypeId((GetEnumUnit()))==1211117642)==false then

> call AddHeroXP(GetEnumUnit(),bonusgoldxp_xp,true)

> set Bonus_XP[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=Bonus_XP[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_xp

> if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then

> set Bonus_Gold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=Bonus_Gold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_gold

> set ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_gold

> call GiveGoldWithAnimation(GetOwningPlayer(GetEnumUnit()),bonusgoldxp_gold,GetEnumUnit())

> endif

> endif

> endfunction

> function GiveBonusXPGold takes nothing returns boolean

> local integer Level

> local integer BonusXP=0

> local integer BonusGold=0

> local group g

> if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetTriggerUnit())==false and(GetUnitTypeId((GetTriggerUnit()))==1211117642)==false then

> set Level=GetHeroLevel(GetTriggerUnit())

> set bonusgoldxp_xp=0

> set bonusgoldxp_gold=0

> set g=GetAvailableGroup()

> set Bonus_Count_XP=0

> set Bonus_Count_Gold=0

> call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),1025,Condition(function GenericCondition_EnemyHeroes))

> call ForGroup(g,function GiveBonusXPGold_Count)

> if Bonus_Count_XP==1 then

> set BonusXP=20*Level+120

> elseif Bonus_Count_XP==2 then

> set BonusXP=15*Level+90

> elseif Bonus_Count_XP==3 then

> set BonusXP=7*Level+30

> elseif Bonus_Count_XP==4 then

> set BonusXP=6*Level+15

> elseif Bonus_Count_XP==5 then

> set BonusXP=5*Level+10

> endif

> if Bonus_Count_Gold==1 then

> set BonusGold=9*Level+95

> elseif Bonus_Count_Gold==2 then

> set BonusGold=8*Level+20

> elseif Bonus_Count_Gold==3 then

> set BonusGold=6*Level

> elseif Bonus_Count_Gold==4 then

> set BonusGold=6*Level

> elseif Bonus_Count_Gold==5 then

> set BonusGold=6*Level

> endif

> if udg_ModeEM then

> endif

> set bonusgoldxp_xp=BonusXP

> set bonusgoldxp_gold=BonusGold

> call ForGroup(g,function GiveBonusXPGold_Give)

> call KillGroup(g)

> set g=null

> endif

> return false

> endfunction

14219a14502
> call GiveBonusXPGold()

14320a14604,14605
> elseif GetUnitTypeId(KillHero)==1160786502 then

> call DisplayTimedTextToForceEx(udg_AllMsgPlayers,10.00,(udg_Colors[GetPlayerId(DeadPlayer)]+(PlayerNames[GetPlayerId((DeadPlayer))])+"|r has been killed by Phoenix"))

14392a14678,14680
> if GetUnitTypeId(KillHero)==1160786502 then

> set KillPlayerString=udg_Colors[0]+GetObjectName(1160786502)+"|r"

> endif

14700a14989
> call SetUnitAcquireRange(udg_Roshan,150)

14745,14805d15033
< function GiveBonusXPGold_Count takes nothing returns nothing

< if(GetUnitTypeId((GetEnumUnit()))==1211117642)==false then

< set Bonus_Count_XP=Bonus_Count_XP+1

< if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then

< set Bonus_Count_Gold=Bonus_Count_Gold+1

< endif

< endif

< endfunction

< function GiveBonusXPGold_Give takes nothing returns nothing

< if(GetUnitTypeId((GetEnumUnit()))==1211117642)==false then

< call AddHeroXP(GetEnumUnit(),bonusgoldxp_xp,true)

< set Bonus_XP[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=Bonus_XP[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_xp

< if GetOwningPlayer(GetKillingUnit())!=GetOwningPlayer(GetEnumUnit())then

< set Bonus_Gold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=Bonus_Gold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_gold

< set ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]=ReliableGold[GetPlayerId(GetOwningPlayer(GetEnumUnit()))]+bonusgoldxp_gold

< call GiveGoldWithAnimation(GetOwningPlayer(GetEnumUnit()),bonusgoldxp_gold,GetEnumUnit())

< endif

< endif

< endfunction

< function GiveBonusXPGold takes nothing returns boolean

< local integer Level

< local integer BonusXP=0

< local integer BonusGold=0

< local group g

< if IsUnitType(GetTriggerUnit(),UNIT_TYPE_HERO)==true and IsUnitIllusion(GetTriggerUnit())==false and(GetUnitTypeId((GetTriggerUnit()))==1211117642)==false then

< set Level=GetHeroLevel(GetTriggerUnit())

< set bonusgoldxp_xp=0

< set bonusgoldxp_gold=0

< set g=GetAvailableGroup()

< set Bonus_Count_XP=0

< set Bonus_Count_Gold=0

< call GroupEnumUnitsInRange(g,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()),1025,Condition(function GenericCondition_EnemyHeroes))

< call ForGroup(g,function GiveBonusXPGold_Count)

< if Bonus_Count_XP==1 or Bonus_Count_XP==2 then

< set BonusXP=15*Level+50

< elseif Bonus_Count_XP==3 then

< set BonusXP=14*Level+50

< elseif Bonus_Count_XP==4 then

< set BonusXP=13*Level+50

< elseif Bonus_Count_XP==5 then

< set BonusXP=12*Level+50

< endif

< if Bonus_Count_Gold==1 then

< set BonusGold=45+10*Level

< elseif Bonus_Count_Gold==2 then

< set BonusGold=40+9*Level

< elseif Bonus_Count_Gold==3 then

< set BonusGold=35+8*Level

< elseif Bonus_Count_Gold==4 or Bonus_Count_Gold==5 then

< set BonusGold=30+7*Level

< endif

< if udg_ModeEM then

< endif

< set bonusgoldxp_xp=BonusXP

< set bonusgoldxp_gold=BonusGold

< call ForGroup(g,function GiveBonusXPGold_Give)

< call KillGroup(g)

< set g=null

< endif

< return false

< endfunction

14877,14888d15104
< set t=CreateTrigger()

< call TriggerRegisterPlayerUnitEvent(t,udg_SentPlayers[1],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_SentPlayers[2],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_SentPlayers[3],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_SentPlayers[4],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_SentPlayers[5],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_ScourgePlayers[1],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_ScourgePlayers[2],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_ScourgePlayers[3],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_ScourgePlayers[4],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerRegisterPlayerUnitEvent(t,udg_ScourgePlayers[5],EVENT_PLAYER_UNIT_DEATH,Condition(function GenericCondition_True))

< call TriggerAddCondition(t,Condition(function GiveBonusXPGold))

18499,18510c18725,18930
< set x=UnitItem_GetBestXOld(GetSellingUnit(),u)

< set y=UnitItem_GetBestYOld(GetSellingUnit(),u)

< call DelayedItemCreation(Item_Dummy[indexid_observerwards],x,y,p,true,2)

< else

< call ItemStats_Track(p,FindRealIndexId(indexId))

< if Item_Real[indexId]==0 then

< call Error(p,GetObjectName(MSG_NO_RECIPE))

< else

< set x=UnitItem_GetBestX(GetSellingUnit(),u)

< set y=UnitItem_GetBestY(GetSellingUnit(),u)

< if indexId==indexid_dustofappearance then

< call CheckFuse(p,u,GetSellingUnit(),FindRealIndexId(indexId),x,y,2,0)

---
> set x=UnitItem_GetBestXOld(GetSellingUnit(),u)

> set y=UnitItem_GetBestYOld(GetSellingUnit(),u)

> call DelayedItemCreation(Item_Dummy[indexid_observerwards],x,y,p,true,2)

> else

> call ItemStats_Track(p,FindRealIndexId(indexId))

> if Item_Real[indexId]==0 then

> call Error(p,GetObjectName(MSG_NO_RECIPE))

> else

> set x=UnitItem_GetBestX(GetSellingUnit(),u)

> set y=UnitItem_GetBestY(GetSellingUnit(),u)

> if indexId==indexid_dustofappearance then

> call CheckFuse(p,u,GetSellingUnit(),FindRealIndexId(indexId),x,y,2,0)

> else

> call CheckFuse(p,u,GetSellingUnit(),FindRealIndexId(indexId),x,y,0,0)

> endif

> endif

> endif

> call UnitAddAbility(u,1097625443)

> call ShowUnit(u,false)

> call UnitApplyTimedLife(u,1112820806,2)

> set u=null

> set p=null

> endfunction

> function UnitItem_Enter takes nothing returns boolean

> if fake_item_buy==false then

> if GetUnitPointValue(GetSoldUnit())>=200 then

> call UnitItem_Main()

> if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(GetSoldUnit()))or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then

> if GetUnitTypeId(GetSoldUnit())==1747989062 then

> call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

> call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,20,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658005)+"|r")

> elseif GetUnitTypeId(GetSoldUnit())==1747989329 then

> call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

> call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,20,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658759)+"|r")

> elseif GetUnitTypeId(GetSoldUnit())==1747990326 then

> call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658767)+"|r")

> elseif GetUnitTypeId(GetSoldUnit())==1747989059 then

> call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

> call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658768)+"|r")

> elseif GetUnitTypeId(GetSoldUnit())==1747989060 then

> call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

> call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658769)+"|r")

> elseif GetUnitTypeId(GetSoldUnit())==1747993153 then

> call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

> call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658772)+"|r")

> elseif GetUnitTypeId(GetSoldUnit())==1747988807 then

> call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

> call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848659010)+"|r")

> endif

> endif

> else

> call DeliverItems_Main()

> endif

> else

> endif

> return false

> endfunction

> function InitTrig_Unit_Item_Conversion takes nothing returns nothing

> local trigger t=CreateTrigger()

> call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)

> call TriggerAddCondition(t,Condition(function UnitItem_Enter))

> set t=null

> endfunction

> function RestrictedItems_UpdateMeleeRange takes unit Hero,item Item returns nothing

> local unit u=Hero

> local integer unitId=GetUnitTypeId(u)

> local integer indexId=GetIndex(Item)

> if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true or IsUnitType(u,UNIT_TYPE_HERO)==false then

> if indexId==indexid_eyeofskadiranged then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_eyeofskadi])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_quellingbladeranged then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_quellingblade])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_stoutshieldranged then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_stoutshield])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_poormanshieldranged then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_poormanshield])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_vanguardranged then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_vanguard])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_orbofvenomranged then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_orbofvenom])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_mantastyleranged then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_mantastyle])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> endif

> else

> if indexId==indexid_eyeofskadi then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_eyeofskadiranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_quellingblade then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_quellingbladeranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_stoutshield then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_stoutshieldranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_poormanshield then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_poormanshieldranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_vanguard then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_vanguardranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_orbofvenom then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_orbofvenomranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_mantastyle then

> set tt_player1=GetItemPlayer(Item)

> call DestroyItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_mantastyleranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> endif

> endif

> set u=null

> endfunction

> function RestrictedItems_UpdateMeleeRange2 takes unit Hero,item Item returns nothing

> local unit u=Hero

> local integer unitId=GetUnitTypeId(u)

> local integer indexId=GetIndex(Item)

> if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==false or IsUnitType(u,UNIT_TYPE_HERO)==false then

> if indexId==indexid_eyeofskadiranged then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_eyeofskadi])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_quellingbladeranged then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_quellingblade])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_stoutshieldranged then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_stoutshield])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_poormanshieldranged then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_poormanshield])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_vanguardranged then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_vanguard])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_orbofvenomranged then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_orbofvenom])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_mantastyleranged then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_mantastyle])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> endif

18512,18513c18932,18973
< call CheckFuse(p,u,GetSellingUnit(),FindRealIndexId(indexId),x,y,0,0)

< endif

---
> if indexId==indexid_eyeofskadi then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_eyeofskadiranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_quellingblade then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_quellingbladeranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_stoutshield then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_stoutshieldranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_poormanshield then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_poormanshieldranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_vanguard then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_vanguardranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_orbofvenom then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_orbofvenomranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

> elseif indexId==indexid_mantastyle then

> set tt_player1=GetItemPlayer(Item)

> call RemoveItem(Item)

> set tt_item1=UnitAddItemById(u,Item_Real[indexid_mantastyleranged])

> call SetItemPlayer(tt_item1,tt_player1,false)

> call SetItemUserData(tt_item1,1)

18516,18518d18975
< call UnitAddAbility(u,1097625443)

< call ShowUnit(u,false)

< call UnitApplyTimedLife(u,1112820806,2)

18520d18976
< set p=null

18522,18552c18978,18986
< function UnitItem_Enter takes nothing returns boolean

< if fake_item_buy==false then

< if GetUnitPointValue(GetSoldUnit())>=200 then

< call UnitItem_Main()

< if IsPlayerAlly(GetLocalPlayer(),GetOwningPlayer(GetSoldUnit()))or(udg_ObserverMode and(GetLocalPlayer()==udg_Observer1 or GetLocalPlayer()==udg_Observer2))then

< if GetUnitTypeId(GetSoldUnit())==1747989062 then

< call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

< call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,20,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658005)+"|r")

< elseif GetUnitTypeId(GetSoldUnit())==1747989329 then

< call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

< call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,20,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658759)+"|r")

< elseif GetUnitTypeId(GetSoldUnit())==1747990326 then

< call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658767)+"|r")

< elseif GetUnitTypeId(GetSoldUnit())==1747989059 then

< call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

< call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658768)+"|r")

< elseif GetUnitTypeId(GetSoldUnit())==1747989060 then

< call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

< call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658769)+"|r")

< elseif GetUnitTypeId(GetSoldUnit())==1747993153 then

< call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

< call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848658772)+"|r")

< elseif GetUnitTypeId(GetSoldUnit())==1747988807 then

< call PingMinimapEx(GetUnitX(GetSoldUnit()),GetUnitY(GetSoldUnit()),3,255,255,255,false)

< call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,4,udg_Colors[GetPlayerId(GetOwningPlayer(GetSoldUnit()))]+(PlayerNames[GetPlayerId((GetOwningPlayer(GetSoldUnit())))])+"|r |c00ffff00"+GetObjectName(1848659010)+"|r")

< endif

< endif

< else

< call DeliverItems_Main()

< endif

< else

---
> function RestrictedItems_UpdateMeleeRange_All takes unit Hero returns nothing

> local integer i=0

> local item Item

> call DisableTrigger(t_manipulateitem)

> loop

> exitwhen i>5

> set Item=UnitItemInSlot(Hero,i)

> if Item!=null then

> call RestrictedItems_UpdateMeleeRange2(Hero,Item)

18554,18560c18988,18991
< return false

< endfunction

< function InitTrig_Unit_Item_Conversion takes nothing returns nothing

< local trigger t=CreateTrigger()

< call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SELL)

< call TriggerAddCondition(t,Condition(function UnitItem_Enter))

< set t=null

---
> set i=i+1

> endloop

> call EnableTrigger(t_manipulateitem)

> set Item=null

18636,18637d19066
< else

< set tt_item1=CreateItem(Item_Dummy[indexId],x,y)

18667,18743c19096
< if IsUnitType(u,UNIT_TYPE_MELEE_ATTACKER)==true or IsUnitType(u,UNIT_TYPE_HERO)==false then

< if indexId==indexid_eyeofskadiranged then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_eyeofskadi])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_quellingbladeranged then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_quellingblade])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_stoutshieldranged then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_stoutshield])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_poormanshieldranged then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_poormanshield])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_vanguardranged then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_vanguard])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_orbofvenomranged then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_orbofvenom])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< endif

< else

< if indexId==indexid_eyeofskadi then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_eyeofskadiranged])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_quellingblade then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_quellingbladeranged])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_stoutshield then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_stoutshieldranged])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_poormanshield then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_poormanshieldranged])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_vanguard then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_vanguardranged])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< elseif indexId==indexid_orbofvenom then

< set tt_player1=GetItemPlayer(Item)

< call DestroyItem(Item)

< set tt_item1=UnitAddItemById(u,Item_Real[indexid_orbofvenomranged])

< call SetItemPlayer(tt_item1,tt_player1,false)

< call SetItemUserData(tt_item1,1)

< endif

< endif

---
> call RestrictedItems_UpdateMeleeRange(Hero,Item)

19096a19456,19467
> function HeroMorphRestrictions takes nothing returns boolean

> if GetSpellAbilityId()==morphrestrict_metamorph or GetSpellAbilityId()==morphrestrict_berserkerrage then

> call RestrictedItems_UpdateMeleeRange_All(GetTriggerUnit())

> endif

> return false

> endfunction

> function InitTrig_Hero_Morphing_Restrictions takes nothing returns nothing

> local trigger t=CreateTrigger()

> call TriggerAddCondition(t,Condition(function HeroMorphRestrictions))

> call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)

> set t=null

> endfunction


19814a20158
> if safedamage_urn[GetPlayerId(GetOwningPlayer(GetTriggerUnit()))]==false then

19816a20161
> endif

20019a20365,20371
> function LastWill_FindUnit takes unit u returns unit

> if IsUnitType(u,UNIT_TYPE_HERO)or GetUnitAbilityLevel(u,1093678162)==0 then

> return u

> else

> return udg_Hero[GetPlayerId(GetOwningPlayer(u))]

> endif

> endfunction

20023c20375
< call DamageTarget(GetDyingUnit(),GetKillingUnit(),DAMAGE_PURE,200)

---
> call DamageTarget(GetDyingUnit(),LastWill_FindUnit(GetKillingUnit()),DAMAGE_PURE,200)

20025c20377
< call DamageTarget(GetDyingUnit(),GetKillingUnit(),DAMAGE_PURE,400)

---
> call DamageTarget(GetDyingUnit(),LastWill_FindUnit(GetKillingUnit()),DAMAGE_PURE,400)

20027c20379
< call DamageTarget(GetDyingUnit(),GetKillingUnit(),DAMAGE_PURE,600)

---
> call DamageTarget(GetDyingUnit(),LastWill_FindUnit(GetKillingUnit()),DAMAGE_PURE,600)


22160,22161c22593,22597
< local trigger t=CreateTrigger()

< local integer Cache=GetHandleId(t)

---
> local trigger t

> local integer Cache

> if IsCourier(Source)==false then

> set t=CreateTrigger()

> set Cache=GetHandleId(t)

22167a22604
> endif

22229c22666
< if CurrentHP>150 then

---
> if CurrentHP>151 then

22278c22715
< if GetSpellAbilityId()==abilityid_mantastyle and(GetUnitAbilityLevel((GetTriggerUnit()),buffid_linkensphere)>0)==true then

---
> if(GetSpellAbilityId()==abilityid_mantastyle or GetSpellAbilityId()==1093752645)and(GetUnitAbilityLevel((GetTriggerUnit()),buffid_linkensphere)>0)==true then



28092,28093d28654
< call TechHeroForAll(1211119409)

< call TechHeroForAll(1429221441)

28095,28096d28655
< call TechHeroForAll(1430466865)

< call TechHeroForAll(1164277353)

28100d28658
< call TechHeroForAll(1160786510)

28103a28662,28663
> call TechHeroForAll(1164277353)

> call TechHeroForAll(1160786510)

28343c28903
< if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))then

---
> if IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker()))and GetUnitTypeId(GetTriggerUnit())!=1966092621 and GetUnitTypeId(GetTriggerUnit())!=1966092622 then

39755,39756c40345,40633
< call StartingReplayData()

< call CleanTrigger(GetTriggeringTrigger())

---
> call StartingReplayData()

> call CleanTrigger(GetTriggeringTrigger())

> return false

> endfunction

40709c41635
< call GroupEnumUnitsInRange(GroupVar,x,y,625,CondVar)

---
> call GroupEnumUnitsInRange(GroupVar,x,y,650,CondVar)

44440c45434
< call GroupEnumUnitsInRange(g,x,y,400,Condition(function GenericCondition_EnemyUnitsWithAncients))

---
> call GroupEnumUnitsInRange(g,x,y,425,Condition(function GenericCondition_EnemyUnitsWithAncients))

44846a45859,45914
> function WrathOfNature_FindTarget takes nothing returns nothing

> local unit Target=GetEnumUnit()

> local real d=DistanceBetweenXY(GetUnitX(Target),GetUnitY(Target),wrathofnature_x,wrathofnature_y)

> if d<wrathofnature_distance and IsUnitVisible(Target,GetOwningPlayer(wrathofnature_source))==true then

> set wrathofnature_target=GetEnumUnit()

> set wrathofnature_distance=d

> endif

> set Target=null

> endfunction

> function WrathOfNature takes nothing returns nothing

> local unit Source=GetTriggerUnit()

> local unit Target=GetSpellTargetUnit()

> local integer Level=GetUnitAbilityLevel(GetTriggerUnit(),abilityid_wrathofnature)

> local integer abilid=abilityid_wrathofnature_real

> local group g

> local unit Caster

> if Level==0 then

> set Level=GetUnitAbilityLevel(GetTriggerUnit(),abilityid_wrathofnatureupgrade)

> set abilid=abilityid_wrathofnatureupgrade_real

> endif

> if Target==null then

> set wrathofnature_target=null

> set wrathofnature_source=Source

> set wrathofnature_distance=999999

> set wrathofnature_x=GetSpellTargetX()

> set wrathofnature_y=GetSpellTargetY()

> set tt_unit1=Source

> set g=GetAvailableGroup()

> call GroupEnumUnitsInRange(g,0,0,9999,Condition(function GenericCondition_EnemyUnitsEx))

> call ForGroup(g,function WrathOfNature_FindTarget)

> call KillGroup(g)

> set Target=wrathofnature_target

> set g=null

> endif

> if Target!=null then

> set Caster=CreateUnit(GetOwningPlayer(Source),1697656901,GetUnitX(Source),GetUnitY(Source),0)

> call UnitAddAbility(Caster,abilid)

> call SetUnitAbilityLevel(Caster,abilid,Level)

> call IssueTargetOrder(Caster,"chainlightning",Target)

> set Caster=null

> endif

> set Source=null

> set Target=null

> endfunction

> function WrathOfNature_Main takes nothing returns boolean

> if GetSpellAbilityId()==abilityid_wrathofnature or GetSpellAbilityId()==abilityid_wrathofnatureupgrade then

> call WrathOfNature()

> endif

> return false

> endfunction

> function Register_WrathOfNature takes nothing returns nothing

> local trigger t=CreateTrigger()

> call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_EFFECT)

> call TriggerAddCondition(t,Condition(function WrathOfNature_Main))

> set t=null

> endfunction

44878c45946
< if(GetSpellAbilityId()==abilityid_souleater or GetSpellAbilityId()==abilityid_souleaterupgrade)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false then

---
> if(GetSpellAbilityId()==abilityid_souleater or GetSpellAbilityId()==abilityid_souleaterupgrade)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false and GetOwningPlayer(GetSpellTargetUnit())!=udg_NeutralHostile then

45024,45026d46091
< function BurningSpear_RestoreMana takes unit whichUnit returns nothing

< call SetUnitState(whichUnit,UNIT_STATE_MANA,GetUnitState(whichUnit,UNIT_STATE_MANA)+15+5*GetUnitAbilityLevel(whichUnit,abilityid_burningspear))

< endfunction

45043d46107
< call BurningSpear_RestoreMana(GetTriggerUnit())

45771,45772c46853,46854
< local trigger t=CreateTrigger()

< local integer Cache=GetHandleId(t)

---
> local trigger t

> local integer Cache

45773a46856,46870
> local group g

> if Target==null then

> set recall_target=null

> set recall_distance=999999

> set recall_x=GetSpellTargetX()

> set recall_y=GetSpellTargetY()

> set tt_unit1=Source

> set g=GetAvailableGroup()

> call GroupEnumUnitsInRange(g,0,0,9999,Condition(function GenericCondition_AlliedHeroesEx))

> call GroupRemoveUnit(g,Source)

> call ForGroup(g,function Recall_FindTarget)

> call KillGroup(g)

> set Target=recall_target

> set g=null

> endif

45782a46880,46882
> if Target!=null then

> set t=CreateTrigger()

> set Cache=GetHandleId(t)

45791a46892
> endif

45804c46905
< if(LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then

---
> if GetSpellTargetUnit()!=null and(LoadBoolean(hash_main,(GetHandleId(GetOwningPlayer(GetSpellTargetUnit()))),(139)))then

46441c47542
< set TargetLimit=5

---
> set TargetLimit=6

47037a48139,48140
> set Hero=null

> set Replicate=null

47056a48160,48161
> set Hero=null

> set Replicate=null

47075a48181,48183
> set Hero=null

> set Target=null

> set Replicate=null

47083a48192,48202
> set Hero=null

> set Target=null

> endfunction

> function Replicate_Restriction takes nothing returns boolean

> if GetSpellAbilityId()==(1093683000)then

> if GetOwningPlayer(GetSpellTargetUnit())==GetOwningPlayer(GetTriggerUnit())or GetOwningPlayer(GetSpellTargetUnit())==udg_NeutralHostile then

> call InterruptUnit(GetTriggerUnit())

> call Error(GetOwningPlayer(GetTriggerUnit()),GetObjectName(1848659014))

> endif

> endif

> return false

47098a48218,48221
> set t=CreateTrigger()

> call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)

> call TriggerAddCondition(t,Condition(function Replicate_Restriction))

> set t=null

47321c48444
< call UnitDamageTarget(UnitVar,Target,TotalDamage,true,true,ATTACK_TYPE_HERO,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)

---
> call DamageTarget(UnitVar,Target,DAMAGE_MAGICAL,TotalDamage)

47332a48456
> call PreloadAbility(abilityid_genericstun)

47357c48481
< call GroupEnumUnitsInRange(GroupVar,GetUnitX(UnitVar),GetUnitY(UnitVar),500+500*Level,Boolexpr)

---
> call GroupEnumUnitsInRange(GroupVar,GetUnitX(UnitVar),GetUnitY(UnitVar),500+500*Level+25,Boolexpr)

47768c48892
< call SetUnitAnimation(GetFilterUnit(),"slam")

---
> call SetUnitAnimation(GetFilterUnit(),"spell")

47959a49084
> set g=null

48100a49226,49227
> set r5=null

> set r6=null

48222a49350,49351
> set Source=null

> set Target=null

49158a50303,50305
> if IsDead(GetFilterUnit())then

> return false

> endif

49244a50392,50394
> if IsDead(GetFilterUnit())then

> return false

> endif

49267a50418
> local unit Bear

49289a50441,50445
> elseif NoBear==false then

> set Bear=FirstOfGroup(GroupVar)

> call AddSpecialEffectTargetUnitBJ("chest",Bear,"Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl")

> call SetUnitState(Bear,UNIT_STATE_LIFE,GetUnitState(Bear,UNIT_STATE_MAX_LIFE))

> set Bear=null

49322,49325d50477
< set t=CreateTrigger()

< call TriggerRegisterAnyUnitEvent(t,EVENT_PLAYER_UNIT_SPELL_CAST)

< call TriggerAddCondition(t,Condition(function Trig_Summon_Spirit_Bear_Conditions))

< call TriggerAddAction(t,function Trig_Summon_Spirit_Bear_PreActions)

49361c50513
< if((GetUnitX(BearOwner)-GetUnitX(Bear))*(GetUnitX(BearOwner)-GetUnitX(Bear))+(GetUnitY(BearOwner)-GetUnitY(Bear))*(GetUnitY(BearOwner)-GetUnitY(Bear))>=855625)then

---
> if((GetUnitX(BearOwner)-GetUnitX(Bear))*(GetUnitX(BearOwner)-GetUnitX(Bear))+(GetUnitY(BearOwner)-GetUnitY(Bear))*(GetUnitY(BearOwner)-GetUnitY(Bear))>=(1100*1100))then

49647c50799
< if IsRealSummoned(GetEnumUnit())then

---
> if IsRealSummoned(GetEnumUnit())or GetUnitTypeId(GetEnumUnit())==1160786502 then



50446d51618
< call SelectUnitAddForPlayer(GetTriggerUnit(),GetOwningPlayer(GetTriggerUnit()))

50849c52021
< if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and Count<3 then

---
> if GetTriggerEventId()==EVENT_PLAYER_UNIT_ATTACKED and Count<6 then

50858c52030
< if Count>2 then

---
> if Count>5 then

50868c52040
< if Count>2 then

---
> if Count>5 then

51138c52310
< call AddTimedAbilityAndRemove(GetEnumUnit(),abilityid_rampagebonus,rampage_level,rampage_duration+3,1110454338)

---
> call AddTimedAbilityAndRemove(GetEnumUnit(),abilityid_rampagebonus,rampage_level,rampage_duration*2,1110454338)


52607a53784
> if GetUnitTypeId(GetEnumUnit())!=1160786502 then

52609a53787
> endif


53866c55139,55140
< local real dmg=0.2*Level*SquareRoot((LastX-x)*(LastX-x)+(LastY-y)*(LastY-y))

---
> local real d=SquareRoot((LastX-x)*(LastX-x)+(LastY-y)*(LastY-y))

> local real dmg=0.2*Level*d

53868c55142
< if dmg>200 then

---
> if d>1300 then

53948c55222
< if Distance>=udg_TempInt*1500 or(Distance<udg_TempInt*1500 and GetUnitStatePercent(GetEnumUnit(),UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)>40)then

---
> if Distance>=(udg_TempInt*1500+25)or(Distance<(udg_TempInt*1500+25)and GetUnitStatePercent(GetEnumUnit(),UNIT_STATE_LIFE,UNIT_STATE_MAX_LIFE)>40)then

53951c55225
< if Distance<udg_TempInt*1500 and GetUnitLifePercent(GetEnumUnit())<=40 then

---
> if Distance<(udg_TempInt*1500+25)and GetUnitLifePercent(GetEnumUnit())<=40 then

54076a55364
> call UnitRemoveAbility(Hero,1110454597)

54313c55601
< local integer BonusDamage=R2I((0.05+0.01*Level)*TargetLife)

---
> local integer BonusDamage=R2I((0.02+0.02*Level)*TargetLife)

54845a56134
> if GetOwningPlayer(Target)!=udg_NeutralHostile then

54846a56136
> endif

57015a58306,58314
> if GetLearnedSkill()==abilityid_wex then

> call SetHeroAgi(GetTriggerUnit(),GetHeroAgi(GetTriggerUnit(),false)+2,true)

> endif

> if GetLearnedSkill()==abilityid_quas then

> call SetHeroStr(GetTriggerUnit(),GetHeroStr(GetTriggerUnit(),false)+2,true)

> endif

> if GetLearnedSkill()==abilityid_exort then

> call SetHeroInt(GetTriggerUnit(),GetHeroInt(GetTriggerUnit(),false)+2,true)

> endif

57218c58579
< elseif Target==null then

---
> else

57221a58583,58585
> if Target!=null then

> set TargetLoc=GetUnitLoc(Target)

> else

57222a58587
> endif

58293c59658
< call TriggerRegisterTimerEvent(t,13+1*GetUnitAbilityLevel(Hero,abilityid_shapeshift)-0.1,false)

---
> call TriggerRegisterTimerEvent(t,18-0.1,false)

58305c59670
< local real Duration=13+1*GetUnitAbilityLevel(Hero,abilityid_shapeshift)

---
> local real Duration=18

59505a60874
> if GetUnitTypeId(Target)!=1160786502 then

59508a60878
> endif

59726c61096
< return(GetSpellAbilityId()==1093678647 or GetSpellAbilityId()==1093679184)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false

---
> return(GetSpellAbilityId()==1093678647 or GetSpellAbilityId()==1093679184)and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false and GetOwningPlayer(GetSpellTargetUnit())!=udg_NeutralHostile

60651c62061
< call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),400,Condition(function GenericCondition_AlliedHeroesEx))

---
> call GroupEnumUnitsInRange(g,GetUnitX(Source),GetUnitY(Source),475,Condition(function GenericCondition_AlliedHeroesEx))

61251c62661
< if GetSpellAbilityId()==abilityid_dismemberupgrade or GetSpellAbilityId()==abilityid_dismember then

---
> if GetSpellAbilityId()==abilityid_dismemberupgrade and(GetUnitAbilityLevel((GetSpellTargetUnit()),buffid_linkensphere)>0)==false then

62046c63456
< set MaxIteration=MaxIteration+1

---
> set MaxIteration=MaxIteration+2

62105a63516
> call PreloadAbility(abilityid_epicentereffect)

62111a63523
> if((LoadInteger(hash_main,(GetHandleId((Hero))),((4299))))==HERO_STATE_ON)==false then

62112a63525
> endif

62129a63543
> call SaveInteger(hash_main,(GetHandleId((Hero))),((4299)),(HERO_STATE_OFF))

62189a63604
> call SaveInteger(hash_main,(GetHandleId((Hero))),((4299)),(HERO_STATE_ON))



69422c71009

---
> call InitTrig_Hero_Morphing_Restrictions()



